Menu

## Memory Configuration

Relevant source files
- [.prettierignore](https://github.com/openclaw/openclaw/blob/bf6ec64f/.prettierignore)
- [docs/cli/memory.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/memory.md)
- [docs/concepts/memory.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/memory.md)
- [src/agents/memory-search.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.test.ts)
- [src/agents/memory-search.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts)
- [src/agents/tools/memory-tool.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tools/memory-tool.ts)
- [src/auto-reply/reply/agent-runner.heartbeat-typing.runreplyagent-typing-heartbeat.retries-after-compaction-failure-by-resetting-session.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/agent-runner.heartbeat-typing.runreplyagent-typing-heartbeat.retries-after-compaction-failure-by-resetting-session.test.ts)
- [src/cli/memory-cli.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.test.ts)
- [src/cli/memory-cli.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.ts)
- [src/config/config.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts)
- [src/config/schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts)
- [src/config/types.tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.tools.ts)
- [src/config/zod-schema.agent-runtime.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts)
- [src/memory/index.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/index.test.ts)
- [src/memory/internal.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.test.ts)
- [src/memory/internal.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.ts)
- [src/memory/manager-cache-key.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager-cache-key.ts)
- [src/memory/manager.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts)
- [src/memory/sync-memory-files.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/sync-memory-files.ts)

This page documents how to configure OpenClaw's memory search system. Memory search provides semantic retrieval over workspace Markdown files using embeddings and hybrid (vector + BM25) search.

For memory indexing mechanics, see [Memory Indexing](https://deepwiki.com/openclaw/openclaw/7.2-memory-indexing). For search query behavior, see [Memory Search](https://deepwiki.com/openclaw/openclaw/7.3-memory-search). For general memory concepts and file layout, see the concepts documentation.

---

## Configuration Overview

Memory search configuration lives under `agents.defaults.memorySearch` (global defaults) and `agents.list[].memorySearch` (per-agent overrides). The configuration controls:

- **Provider selection**: which embedding service to use (`openai`, `gemini`, `local`, or `auto`)
- **Embedding model**: which model generates embeddings
- **Storage**: SQLite database path, vector extension, and embedding cache
- **Sync behavior**: when files are indexed (on session start, on search, file watching, intervals)
- **Query settings**: result count, score thresholds, hybrid search weights

**Configuration Resolution Flow**

```
OpenClawConfig
(openclaw.json)agents.defaults.memorySearch
(MemorySearchConfig)agents.list[].memorySearch
(MemorySearchConfig)resolveMemorySearchConfig()
src/agents/memory-search.ts:282mergeConfig()
src/agents/memory-search.ts:112ResolvedMemorySearchConfig
(validated, normalized)MemoryIndexManager
src/memory/manager.ts:119computeMemoryManagerCacheKey()
src/memory/manager-cache-key.ts:6
```

**Sources**: [src/agents/memory-search.ts 282-291](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L282-L291) [src/memory/manager.ts 176-206](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L176-L206) [src/memory/manager-cache-key.ts 6-55](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager-cache-key.ts#L6-L55)

---

## Provider Selection

The `provider` field determines which embedding service generates vectors. Valid values: `"openai"`, `"gemini"`, `"local"`, `"auto"`.

**Auto-Selection Logic** (`provider: "auto"`)

When `provider` is `"auto"` or unspecified, OpenClaw resolves the provider in this order:

1. **Local** if `local.modelPath` is configured and the file exists
2. **OpenAI** if an OpenAI API key can be resolved (from auth profiles, `models.providers.openai.apiKey`, or `OPENAI_API_KEY` env var)
3. **Gemini** if a Gemini API key can be resolved (`GEMINI_API_KEY` or `models.providers.google.apiKey`)
4. **Disabled** if no provider is available
```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "auto"  // default: auto-select first available
      }
    }
  }
}
```

**Sources**: [src/agents/memory-search.ts 9-72](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L9-L72) [src/memory/embeddings.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings.ts)

---

## Embedding Models

The `model` field specifies which embedding model to use. Defaults:

| Provider | Default Model | Config Field |
| --- | --- | --- |
| OpenAI | `text-embedding-3-small` | `memorySearch.model` |
| Gemini | `gemini-embedding-001` | `memorySearch.model` |
| Local | Auto-downloaded GGUF | `memorySearch.local.modelPath` |

**OpenAI Models**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "openai",
        model: "text-embedding-3-small"  // or text-embedding-3-large
      }
    }
  }
}
```

**Gemini Models**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "gemini",
        model: "gemini-embedding-001"  // native Gemini embeddings
      }
    }
  }
}
```

**Local Models** (node-llama-cpp)

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "local",
        local: {
          modelPath: "hf:ggml-org/embeddinggemma-300M-GGUF/embeddinggemma-300M-Q8_0.gguf",
          modelCacheDir: "~/.openclaw/models"  // optional cache directory
        }
      }
    }
  }
}
```

Local models auto-download on first use (requires `pnpm approve-builds` for native builds).

**Sources**: [src/agents/memory-search.ts 74-76](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L74-L76) [src/memory/embeddings-openai.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings-openai.ts) [src/memory/embeddings-gemini.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings-gemini.ts) [src/memory/embeddings-local.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings-local.ts)

---

## Storage Configuration

Memory search stores embeddings and chunks in a per-agent SQLite database. Configuration:

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `store.driver` | `"sqlite"` | `"sqlite"` | Storage driver (only SQLite supported) |
| `store.path` | `string` | `~/.openclaw/memory/{agentId}.sqlite` | SQLite database path (supports `{agentId}` token) |
| `store.vector.enabled` | `boolean` | `true` | Enable sqlite-vec extension for vector search |
| `store.vector.extensionPath` | `string?` | Auto-detected | Override sqlite-vec extension path |

**Storage Path Resolution**

```
store.path
(raw config)Replace {agentId}
with agent IDresolveUserPath()
expand ~ and env varsResolved path
e.g. /home/user/.openclaw/memory/main.sqlite
```

**Example: Custom Storage Path**

```
{
  agents: {
    defaults: {
      memorySearch: {
        store: {
          path: "~/my-project/memory/{agentId}.sqlite"
        }
      }
    }
  }
}
```

**Sources**: [src/agents/memory-search.ts 104-110](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L104-L110) [src/memory/manager.ts 709-718](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L709-L718)

---

## Vector Extension (sqlite-vec)

The sqlite-vec extension accelerates vector search by performing cosine similarity queries inside SQLite. Without it, OpenClaw falls back to in-process cosine similarity.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `store.vector.enabled` | `boolean` | `true` | Enable vector table |
| `store.vector.extensionPath` | `string?` | Auto-detected | Override extension path |

**Vector Table Schema** (`chunks_vec`)

When vector extension is available and the embedding dimensions are known, OpenClaw creates:

```
CREATE VIRTUAL TABLE chunks_vec USING vec0(
  id TEXT PRIMARY KEY,
  embedding FLOAT[{dimensions}]
)
```

**Vector Load Flow**

```
truefalsesuccesserrorstore.vector.enabled?loadSqliteVecExtension()
src/memory/sqlite-vec.tsResolve extension path
(extensionPath or bundled)db.loadExtension()vector.available = truevector.available = false
(use JS cosine similarity)
```

**Sources**: [src/memory/manager.ts 627-675](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L627-L675) [src/memory/sqlite-vec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/sqlite-vec.ts)

---

## Embedding Cache

The embedding cache stores chunk embeddings in SQLite to avoid re-embedding unchanged text during reindexing.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `cache.enabled` | `boolean` | `true` | Enable embedding cache |
| `cache.maxEntries` | `number?` | Unlimited | Cap on cached embeddings (best-effort) |

**Cache Table Schema** (`embedding_cache`)

```
CREATE TABLE embedding_cache (
  provider TEXT NOT NULL,
  model TEXT NOT NULL,
  provider_key TEXT NOT NULL,
  hash TEXT NOT NULL,
  embedding TEXT NOT NULL,
  dims INTEGER,
  updated_at INTEGER NOT NULL,
  PRIMARY KEY (provider, model, provider_key, hash)
)
```

**Cache Key**: `(provider, model, provider_key, hash)` where:

- `provider`: Embedding provider ID (`openai`, `gemini`, `local`)
- `model`: Model identifier
- `provider_key`: Fingerprint of provider config (base URL, headers)
- `hash`: SHA-256 of chunk text

**Example: Disable Cache**

```
{
  agents: {
    defaults: {
      memorySearch: {
        cache: {
          enabled: false
        }
      }
    }
  }
}
```

**Sources**: [src/memory/manager.ts 230-233](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L230-L233) [src/memory/memory-schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/memory-schema.ts)

---

## Sync Behavior

Sync configuration controls when memory files are indexed.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `sync.onSessionStart` | `boolean` | `true` | Index on first message in a session |
| `sync.onSearch` | `boolean` | `true` | Index when `memory_search` is called (lazy) |
| `sync.watch` | `boolean` | `true` | Watch memory files for changes (chokidar) |
| `sync.watchDebounceMs` | `number` | `1500` | Debounce file change events (ms) |
| `sync.intervalMinutes` | `number` | `0` | Background sync interval (0 = disabled) |

**Sync Trigger Flow**

```
truetruetruetrueSession Start
(first message)File Change
(chokidar event)Interval Timer
(cron-style)sync.onSessionStart?sync.onSearch &&
dirty?sync.watch?sync.intervalMinutes > 0?Debounce
(watchDebounceMs)Schedule Sync
(async background task)manager.sync()
src/memory/manager.ts:383
```

**Example: Disable Auto-Sync**

```
{
  agents: {
    defaults: {
      memorySearch: {
        sync: {
          onSessionStart: false,
          onSearch: false,
          watch: false
        }
      }
    }
  }
}
```

**Sources**: [src/memory/manager.ts 184-203](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L184-L203) [src/memory/manager.ts 383-393](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L383-L393) [src/memory/manager.ts 812-844](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L812-L844)

---

## Session Transcript Indexing

Session transcripts can optionally be indexed for memory search. This feature is experimental and gated behind a flag.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `experimental.sessionMemory` | `boolean` | `false` | Enable session transcript indexing |
| `sources` | `Array<"memory"\|"sessions">` | `["memory"]` | Sources to index |
| `sync.sessions.deltaBytes` | `number` | `100000` | Bytes appended before reindex |
| `sync.sessions.deltaMessages` | `number` | `50` | JSONL lines appended before reindex |

**Delta Threshold Logic**

Session transcripts are large and frequently updated. OpenClaw tracks byte/message deltas and only reindexes when thresholds are crossed:

```
yesnoyesSession Transcript Update
(append JSONL line)updateSessionDelta()
src/memory/manager.ts:899deltaBytes >= threshold?deltaMessages >= threshold?sessionsDirtyFiles.add(file)
sessionsDirty = trueReset delta countersSchedule background sync
```

**Example: Enable Session Memory**

```
{
  agents: {
    defaults: {
      memorySearch: {
        experimental: {
          sessionMemory: true
        },
        sources: ["memory", "sessions"],
        sync: {
          sessions: {
            deltaBytes: 100000,   // ~100 KB
            deltaMessages: 50      // 50 JSONL lines
          }
        }
      }
    }
  }
}
```

**Sources**: [src/memory/manager.ts 845-897](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L845-L897) [src/memory/manager.ts 899-957](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L899-L957) [src/agents/memory-search.ts 90-102](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L90-L102)

---

## Query Settings

Query configuration controls search result limits, scoring, and hybrid search behavior.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `query.maxResults` | `number` | `6` | Max results returned |
| `query.minScore` | `number` | `0.35` | Min score threshold (0-1) |
| `query.hybrid.enabled` | `boolean` | `true` | Enable hybrid BM25 + vector |
| `query.hybrid.vectorWeight` | `number` | `0.7` | Vector similarity weight (0-1) |
| `query.hybrid.textWeight` | `number` | `0.3` | BM25 text relevance weight (0-1) |
| `query.hybrid.candidateMultiplier` | `number` | `4` | Candidate pool size multiplier |

**Weight Normalization**

Vector and text weights are normalized to sum to 1.0:

```
normalized_vector_weight = vectorWeight / (vectorWeight + textWeight)
normalized_text_weight = textWeight / (vectorWeight + textWeight)
```

**Example: Favor Keyword Matching**

```
{
  agents: {
    defaults: {
      memorySearch: {
        query: {
          hybrid: {
            vectorWeight: 0.3,
            textWeight: 0.7  // favor BM25 keyword matches
          }
        }
      }
    }
  }
}
```

**Sources**: [src/memory/manager.ts 262-308](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L262-L308) [src/agents/memory-search.ts 204-278](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L204-L278)

---

## Chunking Configuration

Chunking splits Markdown files into overlapping segments for embedding.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `chunking.tokens` | `number` | `400` | Target chunk size (tokens) |
| `chunking.overlap` | `number` | `80` | Overlap between chunks (tokens) |

**Chunking Algorithm**

```
yesnoMarkdown FileSplit into linesFor each linecurrentChars + lineSize
> maxChars?Flush current chunk
(create MemoryChunk)Carry overlap
(last N chars)Append line to currentFinal flush
(remaining lines)
```

Token counts are estimated at 4 characters per token. Long lines are split into multiple segments.

**Sources**: [src/memory/internal.ts 144-215](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.ts#L144-L215) [src/agents/memory-search.ts 180-183](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L180-L183)

---

## Remote Configuration (Batch API)

Remote providers (OpenAI, Gemini) support batch APIs for faster, cheaper indexing.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `remote.batch.enabled` | `boolean` | `true` | Use batch API for indexing |
| `remote.batch.wait` | `boolean` | `true` | Wait for batch completion |
| `remote.batch.concurrency` | `number` | `2` | Max concurrent batch jobs |
| `remote.batch.pollIntervalMs` | `number` | `2000` | Poll interval for batch status |
| `remote.batch.timeoutMinutes` | `number` | `60` | Batch job timeout |

**Batch Indexing Flow**

```
completedin_progressfailednoyesMemory Chunks
(need embeddings)Group into batches
(~8000 tokens each)Submit batch jobs
(up to concurrency limit)Poll batch status
(pollIntervalMs)Status?Retrieve results
(batch output)Write embeddings to cacheTimeout reached?Batch failed
(increment failure count)Fall back to sync API
```

Batch jobs are submitted to OpenAI's `/v1/batches` endpoint or Gemini's async embeddings API.

**Example: Disable Batch API**

```
{
  agents: {
    defaults: {
      memorySearch: {
        remote: {
          batch: {
            enabled: false  // use synchronous embeddings
          }
        }
      }
    }
  }
}
```

**Sources**: [src/memory/batch-openai.ts 26-135](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/batch-openai.ts#L26-L135) [src/memory/batch-gemini.ts 25-121](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/batch-gemini.ts#L25-L121) [src/agents/memory-search.ts 133-151](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L133-L151)

---

## Custom OpenAI-Compatible Endpoints

OpenClaw supports custom embedding endpoints (OpenRouter, vLLM, proxies) via `remote.*` configuration.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `remote.baseUrl` | `string?` | Provider default | Custom base URL |
| `remote.apiKey` | `string?` | From auth profiles | Custom API key |
| `remote.headers` | `Record<string, string>?` | `{}` | Extra headers |

**Example: OpenRouter Embeddings**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "openai",
        model: "text-embedding-3-small",
        remote: {
          baseUrl: "https://openrouter.ai/api/v1",
          apiKey: "sk-or-...",
          headers: {
            "HTTP-Referer": "https://my-app.com",
            "X-Title": "My App"
          }
        }
      }
    }
  }
}
```

**Example: Custom vLLM Endpoint**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "openai",
        model: "BAAI/bge-large-en-v1.5",
        remote: {
          baseUrl: "http://localhost:8000/v1",
          apiKey: "none"  // vLLM may not require auth
        }
      }
    }
  }
}
```

**Sources**: [src/memory/embeddings-openai.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings-openai.ts) [src/agents/memory-search.ts 121-152](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L121-L152)

---

## Fallback Configuration

The `fallback` field specifies an alternate provider when the primary fails.

| Value | Description |
| --- | --- |
| `"openai"` | Fall back to OpenAI embeddings |
| `"gemini"` | Fall back to Gemini embeddings |
| `"local"` | Fall back to local embeddings |
| `"none"` | Disable fallback (fail on errors) |

**Fallback Flow**

```
yesnoyesnoPrimary Provider
(from config)Attempt embedBatch()Success?Use primary resultfallback != 'none'?Switch to fallback provider
(record reason)Retry embedBatch()
(with fallback)Throw error
(no fallback available)
```

**Example: Fallback Chain**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "local",
        fallback: "openai"  // fall back to OpenAI if local fails
      }
    }
  }
}
```

**Sources**: [src/memory/embeddings.ts 17-132](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/embeddings.ts#L17-L132) [src/agents/memory-search.ts 153](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L153-L153)

---

## Per-Agent Overrides

Each agent can override default memory search settings via `agents.list[].memorySearch`.

**Configuration Merge Priority**

```
agents.list[].memorySearch  (highest)
  ↓
agents.defaults.memorySearch
  ↓
System defaults  (lowest)
```

**Example: Agent-Specific Configuration**

```
{
  agents: {
    defaults: {
      memorySearch: {
        provider: "openai",
        model: "text-embedding-3-small",
        query: {
          maxResults: 6
        }
      }
    },
    list: [
      {
        id: "main",
        default: true
        // inherits all defaults
      },
      {
        id: "work",
        memorySearch: {
          // override model for this agent
          model: "text-embedding-3-large",
          query: {
            maxResults: 10  // more results for work context
          }
        }
      }
    ]
  }
}
```

**Sources**: [src/agents/memory-search.ts 282-291](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L282-L291) [src/agents/memory-search.ts 112-280](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L112-L280)

---

## Extra Paths Configuration

Memory search can index additional Markdown files outside the default workspace layout.

| Field | Type | Default | Description |
| --- | --- | --- | --- |
| `extraPaths` | `string[]` | `[]` | Additional paths to index |

Paths can be:

- **Absolute**: `/srv/shared-notes`
- **Workspace-relative**: `../team-docs`
- **Directories**: scanned recursively for `*.md` files
- **Files**: single `.md` files

**Path Resolution**

```
yesnoextraPaths
(from config)Trim whitespace
filter emptyAbsolute?path.resolve(value)path.resolve(workspaceDir, value)normalizeExtraMemoryPaths()
src/memory/internal.ts:33Deduplicate pathsResolved paths
```

**Example: Index Multiple Sources**

```
{
  agents: {
    defaults: {
      memorySearch: {
        extraPaths: [
          "../shared-knowledge",
          "/srv/team-docs",
          "~/projects/notes/openlaw.md"
        ]
      }
    }
  }
}
```

Symlinks are ignored (both file and directory symlinks).

**Sources**: [src/memory/internal.ts 33-42](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.ts#L33-L42) [src/memory/internal.ts 66-122](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.ts#L66-L122) [src/agents/memory-search.ts 166-169](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L166-L169)

---

## Sources Configuration

The `sources` array specifies which content types to index.

| Value | Description |
| --- | --- |
| `"memory"` | `MEMORY.md`, `memory/*.md`, and `extraPaths` |
| `"sessions"` | Session transcripts (`~/.openclaw/agents/{agentId}/sessions/*.jsonl`) |

**Example: Memory Only (Default)**

```
{
  agents: {
    defaults: {
      memorySearch: {
        sources: ["memory"]
      }
    }
  }
}
```

**Example: Include Session Transcripts**

```
{
  agents: {
    defaults: {
      memorySearch: {
        experimental: {
          sessionMemory: true  // required to enable session sources
        },
        sources: ["memory", "sessions"]
      }
    }
  }
}
```

Session sources are gated behind `experimental.sessionMemory` flag.

**Sources**: [src/agents/memory-search.ts 90-102](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L90-L102) [src/agents/memory-search.ts 165](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L165-L165) [src/memory/manager.ts 227](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L227-L227)

---

OpenClaw stores a metadata fingerprint in the SQLite database to detect configuration changes that require full reindexing.

**Fingerprint Includes**:

```
{
  model: string,              // embedding model
  provider: string,           // provider ID
  providerKey?: string,       // hash of baseUrl + headers
  chunkTokens: number,        // chunking.tokens
  chunkOverlap: number,       // chunking.overlap
  vectorDims?: number         // embedding dimensions
}
```

**Reindex Triggers**:

- Embedding model changes
- Provider changes
- Base URL or headers change (for remote)
- Chunking parameters change

**Metadata Storage** (SQLite):

```
INSERT INTO meta (key, value)
VALUES ('memory_index_meta_v1', '{"model":"...","provider":"...",...}')
ON CONFLICT (key) DO UPDATE SET value = excluded.value
```

**Sources**: [src/memory/manager.ts 61-68](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L61-L68) [src/memory/manager.ts 229](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L229-L229) [src/memory/manager-cache-key.ts 6-55](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager-cache-key.ts#L6-L55)

---

## CLI Configuration Commands

Memory configuration can be inspected via CLI:

```
# View memory configuration status
openclaw memory status

# Deep probe (check embeddings, vector extension)
openclaw memory status --deep

# Force reindex
openclaw memory index --force

# Per-agent
openclaw memory status --agent work
```

**Status Output Includes**:

- Provider and model
- Indexed files/chunks count
- Dirty flag
- Vector extension status
- FTS availability
- Embedding cache stats
- Batch API status
- Fallback information

**Sources**: [src/cli/memory-cli.ts 226-449](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.ts#L226-L449) [src/cli/memory-cli.ts 451-472](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.ts#L451-L472)

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-7khuxtjp8f" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>