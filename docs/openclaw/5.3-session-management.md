Menu

## Session Management

Relevant source files
- [.npmrc](https://github.com/openclaw/openclaw/blob/bf6ec64f/.npmrc)
- [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md)
- [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)
- [assets/avatar-placeholder.svg](https://github.com/openclaw/openclaw/blob/bf6ec64f/assets/avatar-placeholder.svg)
- [docs/concepts/system-prompt.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/system-prompt.md)
- [docs/gateway/configuration-examples.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration-examples.md)
- [docs/gateway/configuration.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md)
- [docs/gateway/sandbox-vs-tool-policy-vs-elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md)
- [docs/gateway/sandboxing.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md)
- [docs/multi-agent-sandbox-tools.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md)
- [docs/tools/elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/elevated.md)
- [docs/tools/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md)
- [extensions/memory-core/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/extensions/memory-core/package.json)
- [package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json)
- [pnpm-lock.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-lock.yaml)
- [pnpm-workspace.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-workspace.yaml)
- [scripts/clawtributors-map.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/clawtributors-map.json)
- [scripts/update-clawtributors.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.ts)
- [scripts/update-clawtributors.types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.types.ts)
- [src/agents/bash-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts)
- [src/agents/channel-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/channel-tools.ts)
- [src/agents/cli-runner.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/cli-runner.test.ts)
- [src/agents/cli-runner/helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/cli-runner/helpers.ts)
- [src/agents/pi-embedded-helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers.ts)
- [src/agents/pi-embedded-runner-extraparams.live.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.live.test.ts)
- [src/agents/pi-embedded-runner-extraparams.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.test.ts)
- [src/agents/pi-embedded-runner.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.test.ts)
- [src/agents/pi-embedded-runner.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.ts)
- [src/agents/pi-embedded-runner/compact.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts)
- [src/agents/pi-embedded-runner/run.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run.ts)
- [src/agents/pi-embedded-runner/run/attempt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts)
- [src/agents/pi-embedded-runner/run/params.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/params.ts)
- [src/agents/pi-embedded-runner/run/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/types.ts)
- [src/agents/pi-embedded-runner/system-prompt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts)
- [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts)
- [src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts)
- [src/agents/sandbox.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox.ts)
- [src/agents/system-prompt-params.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.test.ts)
- [src/agents/system-prompt-params.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts)
- [src/agents/system-prompt-report.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts)
- [src/agents/system-prompt.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.test.ts)
- [src/agents/system-prompt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts)
- [src/auto-reply/reply/commands-context-report.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/commands-context-report.ts)
- [src/commands/agent/run-context.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/agent/run-context.ts)
- [src/commands/agent/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/agent/types.ts)
- [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)
- [src/config/zod-schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts)
- [src/gateway/protocol/schema/agent.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/agent.ts)
- [src/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts)
- [src/telegram/group-migration.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/group-migration.test.ts)
- [src/telegram/group-migration.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/group-migration.ts)
- [ui/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/package.json)
- [ui/src/styles.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles.css)
- [ui/src/styles/layout.mobile.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles/layout.mobile.css)

**Purpose**: This document describes how OpenClaw manages isolated conversation contexts (sessions), including session key resolution, history storage, state management, context compaction, and lifecycle policies.

For agent execution flow and tool handling, see [Agent Execution Flow](https://deepwiki.com/openclaw/openclaw/5.1-agent-execution-flow). For system prompt construction that uses session context, see [System Prompt](https://deepwiki.com/openclaw/openclaw/5.2-system-prompt). For model selection and failover that operates within sessions, see [Model Selection and Failover](https://deepwiki.com/openclaw/openclaw/5.4-model-selection-and-failover).

---

## Session Keys

Sessions are identified by **session keys** that encode the agent, channel, and conversation scope. The Gateway uses these keys to isolate conversation history and per-session settings.

### Session Key Format

```
agent:<agentId>:<channel>:<scope>:<identifier>
```

**Pattern Examples**:

- `agent:main:whatsapp:dm:+15555550123` – Direct message on WhatsApp
- `agent:main:telegram:group:123456789` – Telegram group chat
- `agent:main:discord:dm:user123` – Discord DM
- `agent:work:slack:dm:account2:U12345` – Multi-account Slack DM (account-scoped)
- `agent:main:telegram:dm:123456789:topic42` – Telegram DM topic (thread-scoped)
- `main` – Legacy/shorthand for main agent direct interaction

**Components**:

- **Agent ID**: Which agent handles this session (e.g., `main`, `work`, `support`)
- **Channel**: Message provider (e.g., `whatsapp`, `telegram`, `discord`, `signal`)
- **Scope**: Conversation type (`dm`, `group`, `thread`)
- **Identifier**: Channel-specific ID (phone number, user ID, group ID, thread ID)

### Session Key Resolution

```
DeniedGrantedExistsNewInbound MessageChannel RouterAccess Control Check
(allowlist/pairing/dm)Drop/Silent RejectionResolve Session KeyAgent Binding Lookup
channels → accountId → agentDerive Scope
(dm/group/thread)Build Session Key
agent:agentId:channel:scope:idSession Store LookupLoad Session HistoryCreate Session EntryQueue Message for AgentAcquire Session Lock
(sequential mode)Agent Runtime Execution
```

**Sources**: [src/routing/session-key.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/routing/session-key.ts) [src/auto-reply/reply.ts 306-358](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply.ts#L306-L358) [docs/gateway/configuration.md 424-478](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md#L424-L478)

---

## Session Storage

Sessions are persisted as **JSONL transcript files** in the agent directory. Each line is a JSON entry representing a message, tool call, or metadata event.

### Storage Layout

```
~/.openclaw/agents/<agentId>/sessions/
  ├── agent_main_whatsapp_dm_+15555550123.jsonl
  ├── agent_main_telegram_group_123456789.jsonl
  ├── agent_work_slack_dm_U12345.jsonl
  └── session-metadata.json
```

**Transcript Format** (JSONL):

```
{"type":"message","timestamp":1704067200000,"message":{"role":"user","content":"Hello"}}
{"type":"message","timestamp":1704067201000,"message":{"role":"assistant","content":[{"type":"text","text":"Hi!"}]}}
{"type":"compact","timestamp":1704067300000,"reason":"overflow","turns_removed":5}
```

**Metadata Store** (`session-metadata.json`):

```
{
  "agent:main:whatsapp:dm:+15555550123": {
    "lastActiveAt": "2026-01-27T12:00:00.000Z",
    "model": "anthropic/claude-opus-4-5",
    "thinkingLevel": "medium",
    "verboseLevel": "on",
    "elevated": false,
    "messageCount": 42,
    "sessionAge": 86400000
  }
}
```

### Transcript Entry Types

| Type | Purpose |
| --- | --- |
| `message` | User or assistant message |
| `compact` | Compaction event (history summarized) |
| `reset` | Session reset marker |
| `tool_call` | Tool invocation record |
| `thinking` | Reasoning block (when saved separately) |

**Sources**: [src/config/sessions.ts 15-45](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts#L15-L45) [src/agents/pi-embedded-runner/session-manager-init.ts 1-60](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/session-manager-init.ts#L1-L60)

---

## Session State

Each session maintains conversation history and per-session settings that override agent defaults.

### Session State Diagram

```
Settings Override ChainSession StatefallbackMessage History
(turns)Per-Session Settings/model, /think, /elevated
slash commandssessions.patch RPCagents.list[].defaultsmodel
(primary + fallbacks)thinkingLevel
(off/minimal/low/medium/high)verboseLevel
(off/on)elevated
(bash permissions)sendPolicy
(skip/announce/reply)
```

**Sources**: [src/auto-reply/reply/reply-directives.ts 1-120](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/reply-directives.ts#L1-L120) [src/config/types.agents.ts 1-85](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.agents.ts#L1-L85)

### Per-Session Settings

Settings persist across messages until explicitly changed:

```
interface SessionSettings {
  model?: string;                      // "anthropic/claude-opus-4-5"
  thinkingLevel?: ThinkLevel;          // "off" | "minimal" | "low" | "medium" | "high" | "xhigh"
  verboseLevel?: "on" | "off";         // Tool output verbosity
  elevated?: boolean;                  // Elevated bash permissions
  sendPolicy?: "skip" | "announce" | "reply"; // Subagent reply routing
  groupActivation?: "mention" | "always";     // Group trigger mode
  ttsMode?: "off" | "always" | "inbound" | "tagged"; // TTS behavior
}
```

**Modification Methods**:

1. **Slash commands** in messages: `/model anthropic/claude-opus-4-5`, `/think high`, `/elevated on`
2. **RPC**: `sessions.patch` method with `sessionKey` and settings
3. **Control UI**: Session settings form

**Sources**: [src/config/types.agents.ts 155-185](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.agents.ts#L155-L185) [src/auto-reply/reply/reply-directives.ts 45-90](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/reply-directives.ts#L45-L90)

---

## Context Management

Sessions accumulate history until context window limits are approached. OpenClaw implements multiple strategies to manage history size.

### History Limits

```
YesNoautomanualpruneCheck History Size
(token estimate)Below
Reserve?Proceed with Full HistoryCompaction
Policy?Trigger Auto-CompactionPrune Oldest TurnsCompact Session
(summarize + drop turns)Save Compaction EventRetry Agent RunRecord Pruned Turn CountNotify User:
'Context overflow, run /compact'
```

**Token Reserve Calculation**:

```
const contextWindow = modelContextWindow;  // e.g., 200,000 tokens
const maxOutput = modelMaxOutputTokens;    // e.g., 8,192 tokens
const systemPromptSize = estimateTokens(systemPrompt);
const toolSchemaSize = estimateTokens(toolSchemas);

const reserve = systemPromptSize + toolSchemaSize + maxOutput + buffer;
const availableForHistory = contextWindow - reserve;
```

**DM History Limits** (configurable per-channel):

```
{
  session: {
    dmHistoryLimit: 50,  // Max turns for DMs (default)
    dmHistoryLimitByChannel: {
      whatsapp: 30,
      telegram: 50,
      signal: 40
    }
  }
}
```

**Sources**: [src/agents/context-window-guard.ts 1-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/context-window-guard.ts#L1-L150) [src/agents/pi-embedded-runner/history.ts 1-85](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/history.ts#L1-L85)

### Auto-Compaction

When context overflow is detected, OpenClaw can automatically compact session history by summarizing older turns and dropping non-essential messages.

**Compaction Process**:

1. **Detect Overflow**: Token estimate exceeds `contextWindow - reserve`
2. **Select Turns**: Identify turns to summarize (exclude recent N turns)
3. **Generate Summary**: Use model to create condensed version
4. **Adaptive Chunking**: Split large summaries into paragraph-sized chunks
5. **Replace History**: Swap out detailed turns with summary
6. **Record Event**: Write compaction metadata to transcript

**Compaction Config**:

```
{
  session: {
    compaction: {
      enabled: true,
      mode: "auto",              // "auto" | "manual" | "prune"
      keepRecentTurns: 10,       // Preserve last N turns
      summaryMaxTokens: 4000,    // Summary size limit
      adaptiveChunking: true     // Split large summaries
    }
  }
}
```

**Adaptive Chunking** (for large compactions):

```
// Split summary into paragraph-sized chunks to improve cache hit rates
const paragraphs = summary.split(/\n\n+/);
const chunks = [];
let currentChunk = "";

for (const para of paragraphs) {
  if (estimateTokens(currentChunk + para) > chunkSizeTarget) {
    chunks.push(currentChunk.trim());
    currentChunk = para;
  } else {
    currentChunk += (currentChunk ? "\n\n" : "") + para;
  }
}
```

**Sources**: [src/agents/pi-embedded-runner/compact.ts 1-350](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts#L1-L350) [CHANGELOG.md 278-285](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L278-L285)

---

## Session Lifecycle

### Session Creation

Sessions are created automatically when the first message arrives for a new session key. The Gateway:

1. Resolves session key from inbound message
2. Checks if session file exists
3. Creates JSONL file with initial metadata
4. Adds entry to session metadata store

**Sources**: [src/config/sessions.ts 85-120](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts#L85-L120)

### Session Reset Policies

Sessions can reset automatically based on idle time or daily schedules.

```
idledailyoffYesNoYesNoNoYesReset
Policy?Check Last Active TimeCheck Daily WindowNo Auto-ResetIdle >
Threshold?Trigger Session ResetWithin
Reset Window?Reset
Today?Save Reset Event to TranscriptClear Message HistoryPreserve Session SettingsSend Reset Notification
(if configured)
```

**Reset Configuration**:

```
{
  session: {
    reset: {
      mode: "daily",           // "off" | "idle" | "daily"
      idleHours: 72,           // Hours of inactivity before reset
      dailyWindow: {
        start: "04:00",        // Local time (4am)
        end: "05:00"           // Local time (5am)
      },
      resetByType: {
        dm: "daily",           // Override for DM sessions
        group: "idle",         // Override for group sessions
        thread: "off"          // Override for thread sessions
      },
      resetByChannel: {
        whatsapp: { idleHours: 48 },
        telegram: { mode: "off" }
      },
      preserveSettings: true,  // Keep model/thinking level after reset
      notifyUser: true         // Send "Session reset" message
    }
  }
}
```

**Sources**: [CHANGELOG.md 420-425](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L420-L425) [docs/gateway/configuration.md 520-575](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md#L520-L575)

---

## Session Locking

To prevent concurrent modifications, sessions use file-based locks when running in sequential queue mode.

```
sequentialconcurrentYesNoYes, PID deadNoQueue MessageQueue
Mode?Acquire Session Lock
(file-based)Skip LockLock
Available?Write Lock File
~/.openclaw/locks/Wait + RetryExecute Agent TurnSave Transcript UpdatesDelete Lock FileLock
Stale?Force Release Lock
```

**Lock File Format**:

```
{
  "sessionKey": "agent:main:whatsapp:dm:+15555550123",
  "pid": 12345,
  "startTime": 1704067200000,
  "hostname": "gateway-host"
}
```

**Stale Lock Detection**:

- Check if PID exists in process table
- Compare process start time (Linux: `/proc/<pid>/stat`)
- Release lock if PID recycled or process terminated

**Sources**: [src/agents/session-write-lock.ts 1-120](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/session-write-lock.ts#L1-L120) [CHANGELOG.md 107-110](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L107-L110)

---

## Cross-Session Tools

Agents can interact with other sessions using dedicated tools.

### Session Tools Summary

| Tool | Purpose |
| --- | --- |
| `sessions_list` | List active sessions with filters |
| `sessions_history` | Fetch transcript for another session |
| `sessions_send` | Send message to another session |
| `sessions_spawn` | Create sub-agent session |
| `session_status` | Query current session settings/usage |

### sessions\_list Tool

Lists sessions with optional filters:

```
{
  name: "sessions_list",
  params: {
    agentId?: string,      // Filter by agent
    channel?: string,      // Filter by channel
    scope?: string,        // Filter by scope (dm/group)
    lastN?: number,        // Return only last N sessions
    activeOnly?: boolean   // Exclude idle sessions
  }
}
```

**Example Response**:

```
{
  "sessions": [
    {
      "sessionKey": "agent:main:whatsapp:dm:+15555550123",
      "lastActiveAt": "2026-01-27T12:00:00.000Z",
      "messageCount": 42,
      "model": "anthropic/claude-opus-4-5"
    }
  ]
}
```

### sessions\_send Tool

Sends a message to another session:

```
{
  name: "sessions_send",
  params: {
    sessionKey: string,     // Target session
    message: string,        // Message text
    replyPolicy?: "skip" | "announce" | "reply",
    announceChannel?: string // Where to send reply notification
  }
}
```

**Reply Policies**:

- `skip`: Send message, no reply expected
- `announce`: Send message, post reply summary in current session
- `reply`: Send message, stream full reply back to current session

**Sources**: [src/agents/openclaw-tools/sessions.ts 1-450](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/sessions.ts#L1-L450) [README.md 237-244](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L237-L244)

---

## Multi-Agent Session Isolation

Sessions are scoped per-agent, enabling isolated workspaces and auth profiles.

```
Binding RouterAgent: workAgent: mainSessions Store
~/.openclaw/agents/main/sessions/Auth Profiles
~/.openclaw/agents/main/agent/auth-profiles.jsonWorkspace
~/.openclaw/workspace/Sessions Store
~/.openclaw/agents/work/sessions/Auth Profiles
~/.openclaw/agents/work/agent/auth-profiles.jsonWorkspace
~/work/openclaw/WhatsApp Account: defaultBound to: mainTelegram Account: personalSlack Account: work-teamBound to: work
```

**Binding Configuration**:

```
{
  bindings: {
    whatsapp: {
      default: "main"         // Account ID → Agent ID
    },
    telegram: {
      personal: "main",
      business: "work"
    },
    slack: {
      "work-team": "work"
    }
  }
}
```

**Session Key Scoping**: Each session key includes the agent ID prefix (`agent:main:...`, `agent:work:...`), ensuring complete isolation of conversation history, auth tokens, and workspace files.

**Sources**: [docs/gateway/configuration.md 850-920](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md#L850-L920) [docs/multi-agent-sandbox-tools.md 1-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md#L1-L150)

---

### RPC Methods

| Method | Purpose |
| --- | --- |
| `sessions.list` | List all sessions with filters |
| `sessions.get` | Fetch session metadata |
| `sessions.history` | Retrieve full transcript |
| `sessions.send` | Send message to session |
| `sessions.patch` | Update session settings |
| `sessions.reset` | Manually reset session |
| `sessions.delete` | Delete session entirely |

**Example: Patch Session Settings**:

```
openclaw gateway call sessions.patch --params '{
  "sessionKey": "agent:main:telegram:dm:123456",
  "updates": {
    "model": "anthropic/claude-opus-4-5",
    "thinkingLevel": "high",
    "verboseLevel": "on"
  }
}'
```

### CLI Commands

```
# List all sessions
openclaw sessions list

# Show session details
openclaw session status agent:main:whatsapp:dm:+15555550123

# Reset a session
openclaw session reset agent:main:telegram:group:123456789

# Send message to another session
openclaw message send --to agent:work:slack:dm:U12345 --message "Update"

# View session history
openclaw sessions history agent:main:discord:dm:user123 --last 10
```

**Sources**: [src/commands/sessions.ts 1-280](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/sessions.ts#L1-L280) [docs/cli/sessions.md 1-120](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/sessions.md#L1-L120)

---

## Session Pruning and Compaction Safeguards

When compaction is triggered but fails (e.g., model error), OpenClaw implements safeguards to prevent session corruption.

### Compaction Safeguard Flow

```
YesNo, overflowYesNoYesNoTrigger CompactionSave History SnapshotExecute Compaction
(model summarization)Compaction
Success?Apply Compacted HistorySafeguard
Enabled?Prune Dropped Messages
(message tool sends)Summarize Pruned ContentRetry CompactionRetry
Success?Write Compaction Event
to JSONLRestore History Snapshot
```

**Safeguard Strategy**: When compaction fails due to overflow, OpenClaw prunes "dropped messages" (messages sent via `message` tool that never reached the user) and generates a brief summary of pruned content before retrying compaction.

**Sources**: [src/agents/pi-embedded-runner/compact.ts 200-350](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts#L200-L350) [CHANGELOG.md 15-20](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L15-L20)

---

**Summary**: OpenClaw sessions provide isolated conversation contexts with persistent history, per-session settings, automatic context management, and lifecycle policies. Sessions are identified by structured keys, stored as JSONL transcripts, and support cross-session coordination via dedicated tools. Multi-agent setups benefit from complete session isolation per agent workspace.

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>