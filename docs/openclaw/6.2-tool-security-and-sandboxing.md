Menu

## Tool Security and Sandboxing

Relevant source files
- [.npmrc](https://github.com/openclaw/openclaw/blob/bf6ec64f/.npmrc)
- [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md)
- [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)
- [assets/avatar-placeholder.svg](https://github.com/openclaw/openclaw/blob/bf6ec64f/assets/avatar-placeholder.svg)
- [docs/gateway/configuration-examples.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration-examples.md)
- [docs/gateway/configuration.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md)
- [docs/gateway/doctor.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/doctor.md)
- [docs/gateway/sandbox-vs-tool-policy-vs-elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md)
- [docs/gateway/sandboxing.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md)
- [docs/multi-agent-sandbox-tools.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md)
- [docs/tools/elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/elevated.md)
- [docs/tools/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md)
- [extensions/memory-core/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/extensions/memory-core/package.json)
- [package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json)
- [pnpm-lock.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-lock.yaml)
- [pnpm-workspace.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-workspace.yaml)
- [scripts/clawtributors-map.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/clawtributors-map.json)
- [scripts/update-clawtributors.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.ts)
- [scripts/update-clawtributors.types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.types.ts)
- [src/agents/agent-scope.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/agent-scope.test.ts)
- [src/agents/agent-scope.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/agent-scope.ts)
- [src/agents/bash-tools.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.test.ts)
- [src/agents/bash-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts)
- [src/agents/model-auth.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/model-auth.ts)
- [src/agents/pi-embedded-helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers.ts)
- [src/agents/pi-embedded-runner-extraparams.live.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.live.test.ts)
- [src/agents/pi-embedded-runner-extraparams.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.test.ts)
- [src/agents/pi-embedded-runner.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.ts)
- [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts)
- [src/agents/pi-tools-agent-config.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools-agent-config.test.ts)
- [src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts)
- [src/agents/sandbox-skills.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox-skills.test.ts)
- [src/agents/sandbox.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox.ts)
- [src/commands/auth-choice-options.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-options.test.ts)
- [src/commands/auth-choice-options.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-options.ts)
- [src/commands/auth-choice.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice.test.ts)
- [src/commands/auth-choice.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice.ts)
- [src/commands/configure.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/configure.ts)
- [src/commands/doctor.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/doctor.ts)
- [src/commands/onboard-auth.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-auth.test.ts)
- [src/commands/onboard-auth.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-auth.ts)
- [src/commands/onboard-non-interactive.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive.ts)
- [src/commands/onboard-types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-types.ts)
- [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)
- [src/config/zod-schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts)
- [src/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts)
- [src/wizard/onboarding.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts)
- [ui/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/package.json)
- [ui/src/styles.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles.css)
- [ui/src/styles/layout.mobile.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles/layout.mobile.css)

This page explains OpenClaw's tool security model, including tool policies (allow/deny lists and profiles), approval workflows for dangerous operations, safe binaries, Docker sandbox isolation, and security best practices. For information about available tools and their usage, see [Built-in Tools](https://deepwiki.com/openclaw/openclaw/6.1-built-in-tools). For workspace-level skills configuration, see [Skills System](https://deepwiki.com/openclaw/openclaw/6.3-skills-system).

---

## Overview

OpenClaw provides multiple security layers for controlling what tools agents can execute:

1. **Tool Policies** — Allow/deny lists with profile-based defaults and per-agent/provider overrides
2. **Approval Workflows** — User approval prompts for dangerous commands
3. **Safe Binaries** — Allowlist of common utilities that bypass approval
4. **Docker Sandboxing** — Per-agent or per-session container isolation
5. **Group Tool Policies** — Per-sender restrictions in group chats

---

## Tool Policy System

### Policy Resolution

Tool policies are resolved in order of precedence (later sources override earlier):

```
Global Policy
(tools.allow/deny)Provider Policy
(tools.byProvider[provider].allow/deny)Agent Policy
(agents.list[].tools)Group Policy
(channels..groups..tools)Sandbox Policy
(agents.list[].sandbox.tools)Subagent Policy
(tools.subagent)Final Tool Set
```

**Sources:**[src/agents/pi-tools.ts 156-171](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L156-L171) [src/agents/pi-tools.policy.ts 1-250](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts#L1-L250)

Base allowlists that serve as policy templates:

| Profile | Allowed Tool Groups |
| --- | --- |
| `minimal` | `session_status` only |
| `coding` | `group:fs`, `group:runtime`, `group:sessions`, `group:memory`, `image` |
| `messaging` | `group:messaging`, `sessions_list`, `sessions_history`, `sessions_send`, `session_status` |
| `full` | All tools (no restrictions) |

Configure globally or per-agent:

```
{
  tools: { profile: "coding" },
  agents: {
    list: [
      {
        id: "support",
        tools: { profile: "messaging", allow: ["slack"] }
      }
    ]
  }
}
```

**Sources:**[src/agents/tool-policy.ts 45-70](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts#L45-L70) [docs/tools/index.md 30-74](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md#L30-L74)

### Tool Groups

Shorthand expansions for common tool sets:

| Group | Expands To |
| --- | --- |
| `group:runtime` | `exec`, `bash`, `process` |
| `group:fs` | `read`, `write`, `edit`, `apply_patch` |
| `group:sessions` | `sessions_list`, `sessions_history`, `sessions_send`, `sessions_spawn`, `session_status` |
| `group:memory` | `memory_search`, `memory_get` |
| `group:web` | `web_search`, `web_fetch` |
| `group:ui` | `browser`, `canvas` |
| `group:automation` | `cron`, `gateway` |
| `group:messaging` | `message` |
| `group:nodes` | `nodes` |

Example denial:

```
{
  tools: {
    profile: "coding",
    deny: ["group:runtime"]  // Blocks exec, bash, process
  }
}
```

**Sources:**[src/agents/tool-policy.ts 72-106](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts#L72-L106) [docs/tools/index.md 130-154](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md#L130-L154)

### Provider-Specific Policies

Restrict tools for specific model providers or `provider/model` combinations:

```
{
  tools: {
    profile: "coding",
    byProvider: {
      "google-antigravity": { profile: "minimal" },
      "openai/gpt-5.2": { allow: ["group:fs", "sessions_list"] }
    }
  }
}
```

Provider policies are applied **after** the base profile but **before** global allow/deny, so they can only narrow the tool set.

**Sources:**[docs/tools/index.md 76-128](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md#L76-L128) [src/agents/pi-tools.ts 156-171](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L156-L171)

---

## Approval Workflows

### Exec Tool Approval Modes

The `exec` tool supports three approval modes via `tools.exec.ask`:

| Mode | Behavior |
| --- | --- |
| `off` | No approval required (uses sandbox/host based on `security`) |
| `elevated` | Approval required when session has elevated mode enabled |
| `always` | Approval required for every command |

Security routing is controlled via `tools.exec.security`:

| Value | Behavior |
| --- | --- |
| `host` | Always execute on gateway host |
| `sandbox` | Always execute in sandbox (if enabled) |
| `ask` | Prompt user for host vs sandbox per command |

**Sources:**[src/agents/bash-tools.ts 1-10](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L1-L10) [docs/gateway/configuration.md 82-97](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md#L82-L97)

### Approval Flow

```
MessageChanApprovalSvcExecToolMessageChan["Message Channel"]UserApprovalSvc["Approval Service"]ExecTool["exec Tool"]AgentMessageChanApprovalSvcExecToolMessageChan["Message Channel"]UserApprovalSvc["Approval Service"]ExecTool["exec Tool"]Agentalt[Command in safeBins][Approval required]exec(command="rm -rf /tmp/data")Check safeBins allowlistExecute immediatelyResultCreate approval requestSend approval prompt"Approve: rm -rf /tmp/data?"/approve <code>Approval receivedResume executionResult
```

**Sources:**[src/agents/bash-tools.ts 250-280](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L250-L280) [CHANGELOG.md 149](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L149-L149)

### Approval Commands

Users approve pending requests via the `/approve` command:

```
# List pending approvals
openclaw approvals list

# Approve by code
openclaw approvals approve <code>

# Or in chat
/approve <code>
```

Approval prompts include:

- Command being executed
- Working directory
- Agent ID
- Session key
- Expiration time (default 5 minutes)

**Sources:**[CHANGELOG.md 149-160](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L149-L160) [src/agents/bash-tools.ts 260-275](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L260-L275)

---

## Safe Binaries

### Concept

Safe binaries are commands that bypass approval checks because they're considered low-risk. Configured via `tools.exec.safeBins`:

```
{
  tools: {
    exec: {
      ask: "elevated",
      safeBins: [
        "ls", "cat", "grep", "find", "head", "tail",
        "echo", "date", "pwd", "whoami", "uname"
      ]
    }
  }
}
```

### Resolution

The exec tool resolves binary paths before checking the allowlist:

```
In allowlistNot in allowlistexec(command='ls -la')Parse commandwhich ls → /bin/lsCheck /bin/ls in safeBinsExecute directlyRequest approval
```

For compound commands (`ls | grep foo`), each segment is checked independently. If any segment requires approval, the entire command requires approval.

**Sources:**[src/agents/bash-tools.ts 85-89](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L85-L89) [CHANGELOG.md 18](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L18-L18)

### Default Safe Binaries

OpenClaw includes common read-only utilities in the default safe binaries list:

- File inspection: `ls`, `cat`, `head`, `tail`, `less`, `more`, `file`
- Text processing: `grep`, `awk`, `sed`, `cut`, `sort`, `uniq`, `wc`
- System info: `pwd`, `whoami`, `uname`, `date`, `which`, `env`
- Archiving: `tar`, `zip`, `unzip` (read operations only)

**Sources:**[src/agents/bash-tools.ts 85-89](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L85-L89)

---

## Docker Sandbox Isolation

### Sandbox Configuration

Sandboxes isolate agent execution in Docker containers. Configure globally or per-agent:

```
{
  agents: {
    defaults: {
      sandbox: {
        mode: "non-main",      // off | non-main | all
        scope: "session",      // agent | session
        workspaceAccess: "rw", // ro | rw
        tools: {
          allow: ["read", "write", "exec", "sessions_list"],
          deny: ["browser", "canvas", "nodes", "cron"]
        }
      }
    }
  }
}
```

### Sandbox Modes

| Mode | Behavior |
| --- | --- |
| `off` | No sandboxing (all sessions run on host) |
| `non-main` | Sandbox non-main sessions (groups, channels, subagents) |
| `all` | Sandbox all sessions including main |

**Sources:**[src/agents/sandbox/config.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/config.ts#L1-L100) [docs/gateway/sandboxing.md 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md#L1-L50)

### Sandbox Scopes

| Scope | Lifetime | Workspace |
| --- | --- | --- |
| `agent` | Lives until agent shutdown | Shared `~/.openclaw/agents/<id>/sandbox-workspace` |
| `session` | Per-conversation | Unique `/tmp/openclaw-sandbox-<session-hash>` |

Session-scoped sandboxes are created on-demand and cleaned up when the conversation ends or the Gateway restarts.

**Sources:**[src/agents/sandbox/context.ts 1-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/context.ts#L1-L150) [docs/gateway/sandboxing.md 51-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md#L51-L100)

### Sandbox Context Resolution

```
offnon-mainallmain sessionother sessionResolve Agent ConfigCheck sandbox.modeCheck session keyReturn null
(host execution)Create Sandbox ContextResolve Scope
(agent vs session)Ensure Workspace DirBuild Sandbox Context
{containerName, workspaceDir,
docker: {image, env}}
```

**Sources:**[src/agents/sandbox/context.ts 10-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/context.ts#L10-L150) [src/agents/pi-embedded-runner/sandbox-info.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/sandbox-info.ts#L1-L50)

### Docker Container Lifecycle

When a sandbox is needed:

1. **Create Workspace** — `ensureSandboxWorkspaceForSession` creates the workspace directory
2. **Build Args** — `buildSandboxCreateArgs` constructs `docker run` arguments
3. **Start Container** — Gateway starts the container with workspace mounted at `/workspace`
4. **Execute Commands** — Exec tool routes to container via `docker exec`
5. **Cleanup** — Container stopped when session ends or Gateway restarts

Container args include:

- Read-only root filesystem (`--read-only`)
- Memory limits (`--memory`, `--memory-swap`)
- CPU limits (`--cpus`)
- Network isolation (`--network none` by default)
- Workspace mount (`-v <host>:/workspace`)

**Sources:**[src/agents/sandbox/docker.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/docker.ts#L1-L100) [src/agents/bash-tools.ts 270-290](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L270-L290)

### Sandbox Tool Policy

Sandbox-specific tool policies override agent policies:

```
{
  agents: {
    list: [
      {
        id: "main",
        tools: { allow: ["exec", "read", "write", "browser"] },
        sandbox: {
          mode: "non-main",
          tools: {
            allow: ["exec", "read", "write"],  // No browser in sandbox
            deny: ["browser", "canvas", "nodes"]
          }
        }
      }
    ]
  }
}
```

Sandboxed sessions cannot access:

- Host browser control (unless `browserAllowHostControl: true`)
- Canvas hosts
- Paired nodes (iOS/Android devices)
- Host-only cron jobs

**Sources:**[src/agents/sandbox/tool-policy.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/tool-policy.ts#L1-L50) [docs/multi-agent-sandbox-tools.md 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md#L1-L100)

---

## Group Tool Policies

### Per-Sender Restrictions

Restrict tools based on group sender identity:

```
{
  channels: {
    telegram: {
      groups: {
        "*": {
          tools: {
            bySender: {
              "@untrusted_user": {
                deny: ["exec", "process", "write"]
              }
            }
          }
        }
      }
    }
  }
}
```

Sender matching supports:

- Username: `@username`
- User ID: `123456789`
- E.164 phone: `+1234567890`
- Display name: `"John Doe"`

**Sources:**[CHANGELOG.md 14](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L14-L14) [src/agents/pi-tools.ts 172-185](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L172-L185)

### Precedence with Agent Policies

Group tool policies are applied **after** agent policies:

```
Tool Profile → Provider Profile → Global Policy → 
Provider Policy → Agent Policy → Group Policy → Sandbox Policy
```

This means group policies can further restrict but cannot expand the agent's tool set.

**Sources:**[src/agents/pi-tools.policy.ts 150-250](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts#L150-L250) [docs/multi-agent-sandbox-tools.md 50-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md#L50-L100)

---

## Security Best Practices

```
{
  // Channel access control
  channels: {
    telegram: {
      dmPolicy: "pairing",  // Require pairing for unknown senders
      groups: {
        "*": { requireMention: true }  // Groups require @mention
      }
    }
  },
  
  // Sandbox non-main sessions
  agents: {
    defaults: {
      sandbox: {
        mode: "non-main",
        scope: "session",
        tools: {
          deny: ["browser", "canvas", "nodes", "cron", "gateway"]
        }
      }
    }
  },
  
  // Approval for dangerous operations
  tools: {
    exec: {
      ask: "elevated",
      security: "sandbox",
      safeBins: ["ls", "cat", "grep", "find"]
    }
  }
}
```

**Sources:**[docs/gateway/security.md 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/security.md#L1-L100) [README.md 314-320](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L314-L320)

### Security Audit

Run regular audits with `openclaw doctor`:

```
# Check security warnings
openclaw doctor

# Deep audit
openclaw security audit --deep

# Auto-fix issues
openclaw security audit --fix
```

Doctor checks for:

- Gateway exposure without authentication
- Open DM policies without allowlists
- Sandbox disabled for group sessions
- Missing tool restrictions
- Weak approval configurations

**Sources:**[src/commands/doctor.ts 180-250](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/doctor.ts#L180-L250) [CHANGELOG.md 25](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L25-L25)

### Layered Defense

Implement multiple security layers:

1. **Network** — Bind to loopback, use Tailscale Serve, require authentication
2. **Channel** — Pairing/allowlists, mention gating, per-sender policies
3. **Sandbox** — Container isolation for untrusted sessions
4. **Tools** — Least-privilege policies, approval workflows
5. **Workspace** — Keep secrets outside agent workspace
6. **Model** — Use strongest available model for tool-enabled agents

**Sources:**[README.md 102-113](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L102-L113) [docs/gateway/security.md 1-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/security.md#L1-L150)

### Secrets Management

Never store secrets in:

- Agent workspace (`~/.openclaw/workspace`)
- Bootstrap files (`AGENTS.md`, `SOUL.md`, `TOOLS.md`)
- Skills directories

Store secrets in:

- Environment variables
- Keychain (macOS)
- Dedicated secrets directory outside workspace
- Config with restrictive file permissions

**Sources:**[docs/gateway/security.md 100-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/security.md#L100-L150)

---

## Key Classes and Functions

### Tool Policy Resolution

- `resolveEffectiveToolPolicy` — Combines global, agent, provider policies [src/agents/pi-tools.ts 156-171](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L156-L171)
- `filterToolsByPolicy` — Applies allow/deny lists to tool set [src/agents/pi-tools.policy.ts 50-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts#L50-L100)
- `resolveToolProfilePolicy` — Resolves profile to allowlist [src/agents/tool-policy.ts 150-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts#L150-L200)
- `resolveGroupToolPolicy` — Resolves per-sender group policies [src/agents/pi-tools.policy.ts 200-250](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts#L200-L250)

### Approval System

- `createExecTool` — Creates exec tool with approval logic [src/agents/bash-tools.ts 1-10](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L1-L10)
- Approval prompts sent via message channel [src/agents/bash-tools.ts 260-275](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts#L260-L275)
- `/approve` command handler [CHANGELOG.md 149-160](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md#L149-L160)

### Sandbox System

- `resolveSandboxConfigForAgent` — Determines sandbox config [src/agents/sandbox/config.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/config.ts#L1-L50)
- `resolveSandboxContext` — Builds sandbox context [src/agents/sandbox/context.ts 10-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/context.ts#L10-L50)
- `ensureSandboxWorkspaceForSession` — Creates workspace [src/agents/sandbox/context.ts 50-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/context.ts#L50-L100)
- `buildSandboxCreateArgs` — Constructs docker args [src/agents/sandbox/docker.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/docker.ts#L1-L50)

---

**Sources:**[src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts) [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts) [src/agents/tool-policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts) [src/agents/bash-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts) [src/agents/sandbox/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox/) [docs/gateway/configuration.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md) [docs/tools/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md) [docs/multi-agent-sandbox-tools.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md) [docs/gateway/sandboxing.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md) [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md) [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-7khuxtjp8f" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>