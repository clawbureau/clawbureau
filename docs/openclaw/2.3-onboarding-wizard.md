Menu

## Onboarding Wizard

Relevant source files
- [.npmrc](https://github.com/openclaw/openclaw/blob/bf6ec64f/.npmrc)
- [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md)
- [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)
- [assets/avatar-placeholder.svg](https://github.com/openclaw/openclaw/blob/bf6ec64f/assets/avatar-placeholder.svg)
- [docs/cli/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/index.md)
- [docs/gateway/doctor.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/doctor.md)
- [docs/gateway/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/index.md)
- [docs/gateway/troubleshooting.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/troubleshooting.md)
- [docs/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/index.md)
- [docs/start/getting-started.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/getting-started.md)
- [docs/start/wizard.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md)
- [extensions/memory-core/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/extensions/memory-core/package.json)
- [package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json)
- [pnpm-lock.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-lock.yaml)
- [pnpm-workspace.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-workspace.yaml)
- [scripts/clawtributors-map.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/clawtributors-map.json)
- [scripts/update-clawtributors.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.ts)
- [scripts/update-clawtributors.types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.types.ts)
- [src/agents/agent-scope.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/agent-scope.test.ts)
- [src/agents/agent-scope.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/agent-scope.ts)
- [src/agents/bash-tools.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.test.ts)
- [src/agents/model-auth.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/model-auth.ts)
- [src/agents/pi-embedded-runner-extraparams.live.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.live.test.ts)
- [src/agents/pi-embedded-runner-extraparams.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.test.ts)
- [src/agents/pi-tools-agent-config.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools-agent-config.test.ts)
- [src/agents/sandbox-skills.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox-skills.test.ts)
- [src/commands/auth-choice-options.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-options.test.ts)
- [src/commands/auth-choice-options.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-options.ts)
- [src/commands/auth-choice.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice.test.ts)
- [src/commands/auth-choice.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice.ts)
- [src/commands/configure.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/configure.ts)
- [src/commands/doctor.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/doctor.ts)
- [src/commands/onboard-auth.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-auth.test.ts)
- [src/commands/onboard-auth.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-auth.ts)
- [src/commands/onboard-non-interactive.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive.ts)
- [src/commands/onboard-types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-types.ts)
- [src/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts)
- [src/wizard/onboarding.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts)
- [ui/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/package.json)
- [ui/src/styles.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles.css)
- [ui/src/styles/layout.mobile.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles/layout.mobile.css)

## Purpose and Scope

The onboarding wizard (`openclaw onboard`) is the primary interactive setup tool for OpenClaw. It guides users through the complete initial configuration process: model authentication, workspace initialization, gateway settings, messaging channel integration, and optional background service installation. This page documents the wizard's architecture, execution flow, configuration steps, and output structure.

For post-installation configuration changes, see [Configuration Management](https://deepwiki.com/openclaw/openclaw/4.2-configuration-management). For manual configuration without the wizard, see [Configuration File Structure](https://deepwiki.com/openclaw/openclaw/4.1-configuration-file-structure). For troubleshooting setup issues, see [Doctor Command Guide](https://deepwiki.com/openclaw/openclaw/14.2-doctor-command-guide).

**Sources:**[src/wizard/onboarding.ts 1-400](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L1-L400) [docs/start/wizard.md 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L1-L200)

---

## Command Entry Points

The wizard is invoked via the `openclaw onboard` CLI command, which accepts both interactive and non-interactive modes:

```
# Interactive mode (default)
openclaw onboard

# Non-interactive with daemon install
openclaw onboard --install-daemon --non-interactive --accept-risk

# With explicit auth choice
openclaw onboard --auth-choice token --token $MY_TOKEN --token-provider anthropic

# Reset before onboarding
openclaw onboard --reset

# Remote gateway configuration
openclaw onboard --mode remote --remote-url wss://gateway.example.com --remote-token $TOKEN
```

The command implementation is registered in the CLI program builder and delegates to either `runOnboardingWizard` (interactive) or `runNonInteractiveOnboarding` (non-interactive) based on the `--non-interactive` flag.

**Sources:**[src/wizard/onboarding.ts 87-91](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L87-L91) [src/commands/onboard-non-interactive.ts 10-37](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive.ts#L10-L37) [docs/cli/index.md 276-333](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/index.md#L276-L333)

---

## Wizard Execution Flow

```
--non-interactiveInteractiveNoYesLocalRemoteLocalRemoteopenclaw onboardCheck FlagsrunNonInteractiveOnboardingrunOnboardingWizardrequireRiskAcknowledgementreadConfigFileSnapshotConfig Valid?Prompt: Run doctor firstPrompt: QuickStart vs AdvancedQuickStart FlowAdvanced FlowUse existing gateway config or defaultsPrompt: Local vs RemoteconfigureAuthensureWorkspaceAndSessionsMode?configureGatewayForOnboardingpromptRemoteGatewayConfigsetupChannelsSkip channels/daemon for remotesetupInternalHooksOptional: Install daemonHealth checksetupSkillsfinalizeOnboardingWizardwriteConfigFilePrint summary + next stepsLoad/validate configMode?runNonInteractiveOnboardingLocalrunNonInteractiveOnboardingRemoteWrite configExit
```

**Diagram: Overall Wizard Execution Flow**

The wizard begins by checking for the `--non-interactive` flag. Interactive mode enforces risk acknowledgement via `requireRiskAcknowledgement`, which displays security warnings and requires explicit confirmation before proceeding. The wizard then loads the existing configuration snapshot using `readConfigFileSnapshot` and validates it. Invalid configurations trigger an early exit with a suggestion to run `openclaw doctor`.

For valid configurations, the wizard prompts for the flow type (QuickStart or Advanced). QuickStart mode uses existing gateway settings or sensible defaults, while Advanced mode prompts for every configuration decision. Both flows converge at the authentication step, followed by workspace initialization, gateway/remote configuration (mode-dependent), channel setup, optional daemon installation, health checks, and skill installation.

**Sources:**[src/wizard/onboarding.ts 87-400](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L87-L400) [src/commands/onboard-non-interactive.ts 10-37](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive.ts#L10-L37) [src/wizard/onboarding.types.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.types.ts#L1-L50)

---

## Wizard Modes and Flows

### QuickStart vs Advanced

The wizard supports two configuration flows:

| Flow | Description | Use Case |
| --- | --- | --- |
| **QuickStart** | Uses defaults for gateway settings (loopback, port 18789, token auth, Tailscale off). Prompts only for essential choices (mode, auth, channels). | First-time setup, minimal decisions |
| **Advanced** | Prompts for all configuration options including port, bind mode, auth type, Tailscale exposure, custom bind hosts. | Advanced users, custom network setups |

The flow choice is resolved via the `--flow` flag or an interactive prompt. QuickStart automatically selects local mode and skips detailed gateway configuration if existing settings are detected.

**Sources:**[src/wizard/onboarding.ts 118-152](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L118-L152) [docs/start/wizard.md 35-47](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L35-L47)

### Local vs Remote Mode

```
Remote ModePrompt for remote URL & tokenSet gateway.mode=remote
gateway.remote.url
gateway.remote.tokenSkip local gateway config
Skip daemon install
Skip channelsLocal ModeConfigure model auth
(OAuth/API keys)Initialize workspace
(AGENTS.md, SOUL.md, etc)Configure gateway
(port, bind, auth, tailscale)Setup channels
(WhatsApp, Telegram, etc)Install daemon
(launchd/systemd)
```

**Diagram: Local vs Remote Mode Configuration Paths**

**Local mode** configures a gateway to run on the current machine. It installs the full stack: authentication profiles, workspace files, gateway service, messaging channel integrations, and optional background daemon (via launchd on macOS or systemd on Linux).

**Remote mode** configures the local OpenClaw CLI to connect to a gateway running elsewhere. It only sets `gateway.mode: "remote"`, `gateway.remote.url`, and `gateway.remote.token`. No local gateway, channels, or daemon are installed. This is useful for connecting to a centralized gateway instance.

Mode selection logic:

- Explicit: `--mode local|remote` flag
- QuickStart: forces local mode
- Interactive: prompted if not using QuickStart

**Sources:**[src/wizard/onboarding.ts 287-317](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L287-L317) [src/commands/onboard-remote.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-remote.ts#L1-L100) [docs/start/wizard.md 51-70](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L51-L70)

---

## Authentication Configuration

```
YesNoKeepReconfigureconfigureAuthensureAuthProfileStore
(agentDir)Existing
auth profiles?Prompt: Keep or reconfigure?promptAuthChoiceGroupedSkip auth configParse AuthChoiceapplyAuthChoice
(cfg, choice, store, prompter)Write auth-profiles.jsonpromptDefaultModel
(cfg, catalog, store)applyPrimaryModel
(cfg, modelRef)Return updated config
```

**Diagram: Authentication Configuration Flow**

The authentication step (`configureAuth`) is responsible for setting up model provider credentials and selecting the primary model. It operates on the agent-scoped auth profile store located at `~/.openclaw/agents/<agentId>/agent/auth-profiles.json`.

The store is managed by `ensureAuthProfileStore` and follows this schema:

```
// Simplified from src/agents/auth-profiles.ts
{
  version: 1,
  profiles: {
    "anthropic:manual": {
      provider: "anthropic",
      type: "apiKey",
      apiKey: "sk-ant-...",
      createdAt: "2024-01-01T00:00:00.000Z"
    },
    "openai-codex:oauth-1": {
      provider: "openai-codex",
      type: "oauth",
      refreshToken: "...",
      expiresAt: "2024-01-01T00:00:00.000Z"
    }
  },
  order: {
    anthropic: ["anthropic:manual"],
    "openai-codex": ["openai-codex:oauth-1"]
  }
}
```

### AuthChoice Options

The `promptAuthChoiceGrouped` function presents authentication options organized by provider. Available choices are defined in `AUTH_CHOICE_GROUP_DEFS`:

| Choice | Provider | Type | Config Effect |
| --- | --- | --- | --- |
| `token` | Anthropic | setup-token | Prompts for `claude setup-token` output, stores in auth profiles |
| `apiKey` | Anthropic | API key | Prompts for API key, stores in auth profiles |
| `openai-codex` | OpenAI | OAuth | Launches OAuth flow, stores refresh token |
| `openai-api-key` | OpenAI | API key | Prompts for API key, stores in auth profiles |
| `minimax-api` | MiniMax | API key | Prompts for API key, configures M2.1 models |
| `synthetic-api-key` | Synthetic | API key | Configures Anthropic-compatible proxy |
| `venice-api-key` | Venice | API key | Configures uncensored model proxy |
| `gemini-api-key` | Google | API key | Prompts for API key |
| `github-copilot` | GitHub | OAuth | Launches GitHub device flow |
| `skip` | \- | \- | Defers auth configuration |

Each choice is handled by a dedicated `applyXxxConfig` function that updates both the config object and the auth profile store.

### Model Selection

After authentication is configured, `promptDefaultModel` presents a filtered list of models based on:

1. Available auth profiles in the store
2. Model catalog entries matching authenticated providers
3. Model allowlist if configured (`agents.defaults.models`)

The selected model is applied via `applyPrimaryModel`, which sets `agents.defaults.model`.

**Sources:**[src/wizard/onboarding.ts 320-380](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L320-L380) [src/commands/auth-choice.ts 1-500](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice.ts#L1-L500) [src/commands/auth-choice-prompt.ts 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-prompt.ts#L1-L200) [src/commands/auth-choice-options.ts 1-180](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/auth-choice-options.ts#L1-L180) [src/agents/auth-profiles.ts 1-300](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/auth-profiles.ts#L1-L300)

---

## Workspace Initialization

```
NoYesNoYesNoYesNoYesNoYesensureWorkspaceAndSessionsResolve workspace dir
(opts.workspace or default)fs.mkdir(workspaceDir, recursive)writeBootstrapFilesAGENTS.md
exists?Write AGENTS.md
(template from agentsTemplate)Skip AGENTS.mdSOUL.md
exists?Write SOUL.md
(template from soulTemplate)Skip SOUL.mdTOOLS.md
exists?Write TOOLS.md
(template from toolsTemplate)Skip TOOLS.mdMEMORY.md
exists?Write MEMORY.md
(empty template)Skip MEMORY.mdIDENTITY.md
exists?Write IDENTITY.md
(template with placeholders)Skip IDENTITY.mdCreate skills/ directoryReturn workspace path
```

**Diagram: Workspace Initialization Process**

Workspace initialization is handled by `ensureWorkspaceAndSessions`, which creates the agent workspace directory and populates it with bootstrap files. The default workspace path is `~/.openclaw/workspace`, configurable via `agents.defaults.workspace`.

### Bootstrap File Structure

| File | Purpose | Template Source |
| --- | --- | --- |
| `AGENTS.md` | System prompt defining agent behavior, tool policies, and interaction patterns | `agentsTemplate` (embedded in code) |
| `SOUL.md` | Agent personality, tone, and style guidelines | `soulTemplate` (embedded in code) |
| `TOOLS.md` | Tool usage guidance and examples | `toolsTemplate` (embedded in code) |
| `MEMORY.md` | Long-term memory storage (user-editable) | Empty template |
| `IDENTITY.md` | Agent identity metadata (name, avatar, description) | Template with `{{name}}`, `{{description}}`, `{{avatar}}` placeholders |
| `skills/` | Directory for skill definitions (SKILL.md files) | Created empty |

Each file is checked for existence before writing to avoid overwriting user customizations. The workspace path is stored in the configuration as `agents.defaults.workspace` and resolved at runtime via `resolveAgentWorkspaceDir`.

**Sources:**[src/commands/onboard-helpers.ts 200-300](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-helpers.ts#L200-L300) [src/agents/agent-scope.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/agent-scope.ts#L1-L100)

---

## Gateway Configuration

```
QuickStartAdvancedYesNoNoYesYesNoconfigureGatewayForOnboardingFlow type?Use quickstartGateway defaultsPrompt for all gateway optionsApply defaults:
port=18789, bind=loopback
auth=token, tailscale=offPrompt: port (default 18789)Token exists?Prompt: bind mode
(loopback/lan/tailnet/custom/auto)bind=custom?Prompt: custom bind hostPrompt: auth mode
(token/password)randomToken()Keep existing tokenPrompt: Tailscale mode
(off/serve/funnel)mode=funnel?Require password authBuild gateway config objectMerge into cfg.gatewayReturn updated config
```

**Diagram: Gateway Configuration Decision Tree**

Gateway configuration is handled by `configureGatewayForOnboarding`, which sets the gateway runtime parameters. The configuration structure mirrors the `gateway` section of `openclaw.json`.

### Gateway Configuration Schema

```
// Simplified from src/config/types.ts
{
  gateway: {
    mode: "local" | "remote",           // Determines if gateway runs locally
    port: number,                        // WebSocket server port (default 18789)
    bind: "loopback" | "lan" | "tailnet" | "auto" | "custom",
    customBindHost?: string,             // Used when bind="custom"
    auth: {
      mode: "token" | "password",
      token?: string,                    // Generated via randomToken()
      password?: string
    },
    tailscale: {
      mode: "off" | "serve" | "funnel", // Tailscale exposure
      resetOnExit: boolean               // Cleanup on shutdown
    },
    remote?: {
      url: string,                       // wss://... for remote gateway
      token: string
    }
  }
}
```

### Token Generation

Gateway tokens are generated via `randomToken()`, which produces a 32-character base64-encoded random string. The token is stored in `gateway.auth.token` and must be provided by all WebSocket clients (Control UI, CLI, mobile apps) connecting to the gateway.

### Tailscale Integration

When Tailscale mode is enabled:

- `serve`: Gateway remains bound to loopback but is exposed via `tailscale serve` on the tailnet with identity-based auth
- `funnel`: Gateway is exposed publicly via `tailscale funnel`, requires `auth.mode: "password"`

Tailscale configuration is validated at runtime by the gateway server.

**Sources:**[src/wizard/onboarding.gateway-config.ts 1-300](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.gateway-config.ts#L1-L300) [src/commands/onboard-helpers.ts 400-500](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-helpers.ts#L400-L500) [src/config/config.ts 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts#L1-L200)

---

## Channel Setup

```
YesNoYesNoYesNoYesNoYesNoYesNosetupChannelslistChannelPlugins()Prompt: Select channels to configureFilter selected channelsFor each selected channelchannel=whatsapp?channel=telegram?Prompt: Phone number for allowlistSet channels.whatsapp.allowFromPrompt: Bot tokenchannel=discord?Set channels.telegram.botTokenPrompt: Username for allowlistSet channels.telegram.allowFromPrompt: Bot tokenchannel=signal?Set channels.discord.tokenPrompt: User ID for allowlistSet channels.discord.dm.allowFromPrompt: Account phone numberOther channel?Set channels.signal.accounts.defaultPlugin-specific configurationNext channelSet DM policy to pairing/allowlistMore channels?Return updated config
```

**Diagram: Channel Setup Flow**

Channel setup is handled by `setupChannels`, which discovers available channel plugins and configures selected messaging platforms. Each channel has platform-specific configuration requirements.

### Channel Configuration Map

| Channel | Required Config | Optional Config | DM Security Default |
| --- | --- | --- | --- |
| WhatsApp | QR login (credentials stored in `~/.openclaw/credentials/`) | `channels.whatsapp.allowFrom` | pairing |
| Telegram | `channels.telegram.botToken` | `channels.telegram.allowFrom`, `channels.telegram.groups` | pairing |
| Discord | `channels.discord.token` | `channels.discord.dm.allowFrom`, `channels.discord.guilds` | pairing |
| Google Chat | Service account JSON, webhook audience | `channels.googlechat.allowFrom` | pairing |
| Signal | `channels.signal.accounts.default.number` | `channels.signal.allowFrom` | pairing |
| iMessage | Local `imsg` CLI path | `channels.imessage.allowFrom`, `channels.imessage.groups` | pairing |
| Mattermost (plugin) | Bot token, base URL | `mattermost.allowFrom`, `mattermost.groupAllowFrom` | pairing |

### DM Security Policies

All channels default to `dmPolicy: "pairing"` for security:

1. Unknown senders receive a pairing code
2. User approves via `openclaw pairing approve <channel> <code>`
3. Sender is added to local allowlist in `~/.openclaw/state/pairing-store.json`

Alternative policies:

- `allowlist`: Only pre-configured `allowFrom` entries can send DMs
- `open`: Any sender can send DMs (requires explicit `"*"` in `allowFrom`)

**Sources:**[src/commands/onboard-channels.ts 1-400](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-channels.ts#L1-L400) [src/channels/plugins/index.ts 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/channels/plugins/index.ts#L1-L200) [docs/channels/index.md 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/channels/index.md#L1-L100)

---

## Daemon Installation

```
macOSLinuxWindowsOthernpm globalgit cloneYesNoPrompt: Install background service?Platform?Install LaunchAgentInstall systemd user unitInstall scheduled taskSkip daemon installPrompt: Runtime (node/bun)Resolve runtime executable pathInstall method?Use global openclaw CLIUse repo-local openclaw CLIBuild service definitionWrite to ~/Library/LaunchAgents/Write to ~/.config/systemd/user/Write to Task Schedulerlaunchctl load/startsystemctl --user enable/startschtasks /CreateLinux?Service installed
```

**Diagram: Daemon Installation Process**

Daemon installation configures OpenClaw to run as a background service that starts automatically on boot and restarts on failure. The implementation is platform-specific and managed by `resolveGatewayService`.

### Service Definitions

**macOS (LaunchAgent)**

Installed at `~/Library/LaunchAgents/ai.openclaw.gateway.plist`:

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>ai.openclaw.gateway</string>
    <key>ProgramArguments</key>
    <array>
        <string>/path/to/node</string>
        <string>/path/to/openclaw</string>
        <string>gateway</string>
    </array>
    <key>KeepAlive</key>
    <true/>
    <key>RunAtLoad</key>
    <true/>
    <key>StandardOutPath</key>
    <string>~/.openclaw/logs/gateway.log</string>
    <key>StandardErrorPath</key>
    <string>~/.openclaw/logs/gateway.err.log</string>
</dict>
</plist>
```

**Linux (systemd user unit)**

Installed at `~/.config/systemd/user/openclaw-gateway.service`:

```
[Unit]
Description=OpenClaw Gateway
After=network.target

[Service]
Type=simple
ExecStart=/path/to/node /path/to/openclaw gateway
Restart=always
RestartSec=5
Environment="PATH=/usr/bin:/bin"
Environment="OPENCLAW_STATE_DIR=%h/.openclaw"

[Install]
WantedBy=default.target
```

### Runtime Selection

The wizard prompts for runtime choice:

- **Node** (recommended): Required for WhatsApp (Baileys) and Telegram (grammY) due to native dependencies
- **Bun**: Not recommended due to compatibility issues with native modules

The runtime executable path is resolved via `resolveRuntimeExecutable` and stored in the service definition.

### Systemd Lingering

On Linux, the wizard attempts to enable systemd lingering via `loginctl enable-linger $USER`. This prevents systemd from stopping the user service on logout. The wizard tries without sudo first, then prompts for sudo if needed (writes to `/var/lib/systemd/linger/$USER`).

**Sources:**[src/daemon/service.ts 1-500](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/daemon/service.ts#L1-L500) [src/commands/daemon-runtime.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/daemon-runtime.ts#L1-L100) [src/commands/systemd-linger.ts 1-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/systemd-linger.ts#L1-L150)

---

## Skills Installation

```
NoYesYesNoYes, macOSNo or non-macOSYesNoYesNosetupSkillsScan workspace/skills/ directoryList available skills from catalogCheck skill requirements
(dependencies, binaries, env vars)Filter eligible skills
(all requirements met)Prompt: Install optional dependencies?Install?Skip skill installsPrompt: Package manager
(npm/pnpm/bun)Prompt: Select skills to enableFor each selected skillHas npm
dependencies?Run package manager install
in skill directoryHas Homebrew
dependencies?Run brew installMissing env
vars?Print warning about missing env varsNext skillMore skills?
```

**Diagram: Skills Installation Flow**

Skills installation is handled by `setupSkills`, which discovers skill definitions in the workspace and installs optional dependencies. Skills are modular capabilities defined by `SKILL.md` files.

### Skill Definition Structure

Each skill is a directory under `~/.openclaw/workspace/skills/<skill-name>/` containing:

```
<skill-name>/
├── SKILL.md          # Skill description, tool definitions, usage examples
├── package.json      # Optional: npm dependencies
├── requirements.txt  # Optional: Python dependencies
├── Brewfile          # Optional: Homebrew dependencies (macOS only)
└── .env.example      # Optional: Required environment variables
```

The `SKILL.md` file is the canonical skill definition, parsed by the agent runtime to expose tools.

### Skill Requirements Check

The wizard checks skill requirements via the following logic:

1. **npm dependencies**: Checks for `package.json` and verifies `node_modules/` exists
2. **Homebrew dependencies**: Checks for `Brewfile` and verifies binaries are installed (macOS only)
3. **Environment variables**: Checks for `.env.example` and verifies variables are set
4. **Binary availability**: Checks for required binaries in `$PATH`

Skills with all requirements met are marked as "ready" and enabled by default. Skills with missing requirements are marked as "not ready" and skipped unless the user opts to install dependencies.

### Skill Catalog

The skill catalog is sourced from:

1. Bundled skills in `skills/` directory (shipped with OpenClaw)
2. Managed skills (ClawdHub registry, installed via `npx clawdhub`)
3. Workspace skills (user-created skills in workspace)

The wizard only installs dependencies for bundled and managed skills. Workspace skills are assumed to be user-managed.

**Sources:**[src/commands/onboard-skills.ts 1-300](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-skills.ts#L1-L300) [docs/tools/skills.md 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/skills.md#L1-L200) [docs/tools/skills-config.md 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/skills-config.md#L1-L100)

---

## Finalization and Output

```
NoYesNoYesLocalRemotefinalizeOnboardingWizardwriteConfigFile(cfg)logConfigUpdated(runtime)--skip-health?Run gateway health checkSkip health checkHealth OK?Print health warningsPrint success messagePrint configuration summaryPrint next steps:
- Dashboard URL
- CLI commands
- Mobile app linksMode?Print remote-specific tips:
- Test connection
- Configure local toolsPrint outro messageExit with code 0
```

**Diagram: Finalization and Output Flow**

The finalization step (`finalizeOnboardingWizard`) applies metadata, writes the configuration, runs health checks, and prints a summary with next steps.

The `applyWizardMetadata` function adds tracking metadata to the config:

```
{
  _openclaw: {
    lastCommand: "onboard",
    lastMode: "local",
    lastUpdated: "2024-01-01T00:00:00.000Z"
  }
}
```

This metadata is used by `openclaw doctor` to detect configuration drift and suggest repairs.

### Configuration Output

The final configuration is written to `~/.openclaw/openclaw.json` via `writeConfigFile`, which:

1. Creates a backup at `~/.openclaw/openclaw.json.bak`
2. Validates the config against the Zod schema
3. Writes the config as JSON5 (preserves comments)
4. Sets file permissions to `0600` (owner read/write only)

### Health Check

If `--skip-health` is not set, the wizard runs `openclaw health` to verify the gateway is reachable:

1. Attempts WebSocket connection to `gateway.remote.url` (remote mode) or `ws://127.0.0.1:<port>` (local mode)
2. Sends `gateway.health` RPC request
3. Validates response contains `{ ok: true }`
4. Prints warnings if health check fails with suggestions to run `openclaw doctor`

The wizard prints platform-specific next steps:

**Local Mode:**

```
✓ Onboarding complete!

Dashboard: http://127.0.0.1:18789/
CLI: openclaw status --all
Channels: openclaw channels status --probe

Next steps:
  - Open dashboard to start chatting
  - Run 'openclaw channels login' to pair WhatsApp
  - Install mobile apps for voice wake:
    • iOS: https://apps.apple.com/app/openclaw/...
    • Android: https://play.google.com/store/apps/details?id=ai.openclaw.android

Need help? https://docs.openclaw.ai
```

**Remote Mode:**

```
✓ Remote gateway configured!

Gateway: wss://gateway.example.com
Token: ••••••••••••

Next steps:
  - Test connection: openclaw health
  - Use CLI: openclaw agent --message "Hello"
  - Open dashboard: openclaw dashboard

Need help? https://docs.openclaw.ai
```

**Sources:**[src/wizard/onboarding.finalize.ts 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.finalize.ts#L1-L200) [src/commands/onboard-helpers.ts 500-600](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-helpers.ts#L500-L600) [src/config/logging.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/logging.ts#L1-L100)

---

## Non-Interactive Mode

The wizard supports fully non-interactive execution for CI/CD and scripting use cases via the `--non-interactive` flag. This mode requires explicit flags for all configuration decisions and skips all prompts.

### Required Flags for Non-Interactive Onboarding

**Authentication:**

- `--auth-choice <choice>` (required)
- `--token <token>` (required if `auth-choice=token`)
- `--token-provider <provider>` (required if `auth-choice=token`)
- `--anthropic-api-key <key>` (required if `auth-choice=apiKey`)
- Other provider-specific API key flags

**Gateway (Local Mode):**

- `--gateway-port <port>` (default: 18789)
- `--gateway-bind <bind>` (default: loopback)
- `--gateway-auth <token|password>` (default: token)
- `--gateway-token <token>` (auto-generated if not provided)
- `--install-daemon` or `--no-install-daemon` (required)

**Workspace:**

- `--workspace <path>` (required in non-interactive mode)

**Channels:**

- `--skip-channels` (skips channel configuration)

**Other:**

- `--accept-risk` (required; bypasses risk acknowledgement prompt)

### Example Non-Interactive Invocations

**Local gateway with API key:**

```
openclaw onboard \
  --non-interactive \
  --accept-risk \
  --mode local \
  --auth-choice apiKey \
  --anthropic-api-key $ANTHROPIC_API_KEY \
  --workspace ~/.openclaw/workspace \
  --gateway-port 18789 \
  --gateway-bind loopback \
  --gateway-auth token \
  --install-daemon \
  --skip-channels \
  --skip-skills
```

**Remote gateway:**

```
openclaw onboard \
  --non-interactive \
  --accept-risk \
  --mode remote \
  --remote-url wss://gateway.example.com \
  --remote-token $GATEWAY_TOKEN
```

**With setup-token:**

```
openclaw onboard \
  --non-interactive \
  --accept-risk \
  --auth-choice token \
  --token-provider anthropic \
  --token "$(cat /tmp/setup-token.txt)" \
  --workspace ~/.openclaw/workspace \
  --install-daemon \
  --skip-channels
```

**Sources:**[src/commands/onboard-non-interactive.ts 1-37](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive.ts#L1-L37) [src/commands/onboard-non-interactive/local.ts 1-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive/local.ts#L1-L200) [src/commands/onboard-non-interactive/remote.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/onboard-non-interactive/remote.ts#L1-L100)

---

## Configuration Output Schema

The wizard produces a configuration file at `~/.openclaw/openclaw.json` with the following structure:

```
{
  // Agent configuration
  agents: {
    defaults: {
      workspace: "~/.openclaw/workspace",  // Set by workspace step
      model: "anthropic/claude-opus-4-5",  // Set by auth/model step
      models: ["anthropic/*"],             // Optional allowlist
      sandbox: {
        mode: "non-main",                  // Optional sandboxing
        allowedTools: ["bash", "process", "read", "write"]
      }
    }
  },
  
  // Gateway configuration
  gateway: {
    mode: "local",                         // Set by mode selection
    port: 18789,                           // Set by gateway step
    bind: "loopback",                      // Set by gateway step
    auth: {
      mode: "token",                       // Set by gateway step
      token: "..."                         // Generated or provided
    },
    tailscale: {
      mode: "off",                         // Set by gateway step
      resetOnExit: false
    },
    remote: {                              // Only for remote mode
      url: "wss://...",
      token: "..."
    }
  },
  
  // Channel configuration
  channels: {
    whatsapp: {
      allowFrom: ["+15555550123"],         // Set by channel step
      dmPolicy: "pairing"                  // Default
    },
    telegram: {
      botToken: "...",                     // Set by channel step
      allowFrom: ["username"],             // Set by channel step
      dmPolicy: "pairing"                  // Default
    },
    discord: {
      token: "...",                        // Set by channel step
      dm: {
        allowFrom: ["123456789"],          // Set by channel step
        policy: "pairing"                  // Default
      }
    }
    // ... other channels
  },
  
  // Metadata
  _openclaw: {
    lastCommand: "onboard",
    lastMode: "local",
    lastUpdated: "2024-01-01T00:00:00.000Z"
  }
}
```

In addition to `openclaw.json`, the wizard creates or modifies:

| Path | Purpose | Created By |
| --- | --- | --- |
| `~/.openclaw/credentials/oauth.json` | OAuth refresh tokens (if using OAuth auth) | Auth step |
| `~/.openclaw/agents/main/agent/auth-profiles.json` | Auth profile store (API keys + OAuth) | Auth step |
| `~/.openclaw/workspace/AGENTS.md` | Agent system prompt | Workspace step |
| `~/.openclaw/workspace/SOUL.md` | Agent personality | Workspace step |
| `~/.openclaw/workspace/TOOLS.md` | Tool usage guidance | Workspace step |
| `~/.openclaw/workspace/MEMORY.md` | Long-term memory | Workspace step |
| `~/.openclaw/workspace/IDENTITY.md` | Agent identity | Workspace step |
| `~/.openclaw/workspace/skills/` | Skill definitions | Skills step |
| `~/Library/LaunchAgents/ai.openclaw.gateway.plist` | macOS daemon (if installed) | Daemon step |
| `~/.config/systemd/user/openclaw-gateway.service` | Linux daemon (if installed) | Daemon step |
| `~/.openclaw/.env` | Environment variables (API keys) | Auth step |

**Sources:**[src/config/config.ts 1-300](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts#L1-L300) [src/config/types.ts 1-500](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts#L1-L500) [src/wizard/onboarding.ts 1-400](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/wizard/onboarding.ts#L1-L400)

---

## Post-Wizard Actions

After the wizard completes, recommended next steps:

1. **Verify gateway health:**
	```
	openclaw status --deep
	```
2. **Test agent interaction:**
	```
	openclaw agent --message "Hello, world!"
	```
3. **Open Control UI:**
	```
	openclaw dashboard
	# or manually: http://127.0.0.1:18789/
	```
4. **Configure additional channels:**
	```
	openclaw configure --section channels
	```
5. **Enable web search:**
	```
	openclaw configure --section web
	# Set tools.web.search.apiKey (Brave Search API key)
	```
6. **Review security settings:**
	```
	openclaw security audit --deep
	```

For configuration drift or issues, run `openclaw doctor` to detect and repair common problems.

**Sources:**[docs/start/wizard.md 140-200](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L140-L200) [docs/start/getting-started.md 100-150](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/getting-started.md#L100-L150)

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>