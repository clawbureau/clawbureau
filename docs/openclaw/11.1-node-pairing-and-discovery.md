Menu

## Node Pairing and Discovery

Relevant source files
- [.npmrc](https://github.com/openclaw/openclaw/blob/bf6ec64f/.npmrc)
- [AGENTS.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/AGENTS.md)
- [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md)
- [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)
- [apps/android/app/build.gradle.kts](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts)
- [apps/ios/Sources/Info.plist](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/Sources/Info.plist)
- [apps/ios/Tests/Info.plist](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/Tests/Info.plist)
- [apps/ios/project.yml](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/project.yml)
- [assets/avatar-placeholder.svg](https://github.com/openclaw/openclaw/blob/bf6ec64f/assets/avatar-placeholder.svg)
- [docs/platforms/fly.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/platforms/fly.md)
- [docs/platforms/mac/release.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/platforms/mac/release.md)
- [docs/reference/RELEASING.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/reference/RELEASING.md)
- [extensions/memory-core/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/extensions/memory-core/package.json)
- [fly.private.toml](https://github.com/openclaw/openclaw/blob/bf6ec64f/fly.private.toml)
- [fly.toml](https://github.com/openclaw/openclaw/blob/bf6ec64f/fly.toml)
- [package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json)
- [pnpm-lock.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-lock.yaml)
- [pnpm-workspace.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-workspace.yaml)
- [scripts/clawtributors-map.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/clawtributors-map.json)
- [scripts/update-clawtributors.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.ts)
- [scripts/update-clawtributors.types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.types.ts)
- [scripts/write-build-info.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/write-build-info.ts)
- [src/agents/pi-embedded-runner-extraparams.live.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.live.test.ts)
- [src/agents/pi-embedded-runner-extraparams.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.test.ts)
- [src/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts)
- [src/infra/git-commit.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/infra/git-commit.ts)
- [ui/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/package.json)
- [ui/src/styles.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles.css)
- [ui/src/styles/layout.mobile.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles/layout.mobile.css)

**Purpose:** This page explains how device nodes (iOS, Android, macOS) discover OpenClaw gateways on the network and establish authenticated connections. For information about node capabilities and the actions nodes can execute, see [Node Capabilities](https://deepwiki.com/openclaw/openclaw/11.2-node-capabilities). For gateway configuration and network binding, see [Gateway Configuration](https://deepwiki.com/openclaw/openclaw/3.1-gateway-configuration).

---

## Overview

OpenClaw device nodes use **Bonjour/mDNS** and **DNS-SD** (DNS-based Service Discovery) to discover gateways on the local network and Tailscale tailnets. Once discovered, nodes establish a WebSocket connection and authenticate using the Bridge Protocol. After pairing, nodes advertise their capabilities to the gateway and remain connected for executing device-local actions.

**Key service type:**`_openclaw-gw._tcp`  
**Default port:**`18789` (configurable via `gateway.port`)  
**Supported platforms:** iOS (native Bonjour), Android (dnsjava), macOS (native Bonjour)

---

## Discovery Flow

```
Device Node(Browser)Local NetworkmDNSGateway(Advertiser)Device Node(Browser)Local NetworkmDNSGateway(Advertiser)Service record includes:- hostname- port- TXT metadataBind to port 18789Advertise _openclaw-gw._tcpBrowse for _openclaw-gw._tcpService found eventResolve serviceIP address, port, TXT recordsDisplay in gateway list
```

The gateway advertises itself on the local network using the service type `_openclaw-gw._tcp`. Nodes listen for this service type and resolve the service to obtain connection details.

**Sources:**  
[apps/ios/Sources/Info.plist 30-33](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/Sources/Info.plist#L30-L33)  
[apps/android/app/build.gradle.kts 115-116](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts#L115-L116)

---

### DNS-SD on Tailscale Networks

For Tailscale networks, DNS-SD queries use unicast DNS rather than multicast mDNS. This allows discovery across Tailscale tailnets where traditional mDNS broadcast packets don't propagate.

**Android implementation:** Uses `dnsjava` library for unicast DNS-SD queries against Tailscale DNS servers.

**Sources:**  
[apps/android/app/build.gradle.kts 115-116](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts#L115-L116)

---

## Pairing Flow

### Sequence Diagram

```
Auth SystemGatewayWebSocket ServerDevice Node(iOS/Android/macOS)UserAuth SystemGatewayWebSocket ServerDevice Node(iOS/Android/macOS)UserIncludes device info:- platform- device name- capabilitiesStore gateway credentialsAdvertise capabilities:- camera- screen- location- system.runSelect gateway from listWebSocket connect (ws://IP:18789)Connection establishedpairing.requestGenerate pairing tokenToken + expirypairing.challengeApprove pairing(via CLI/UI)Validate approvalApprovedpairing.approvednode.registerRegistration completePeriodic heartbeat
```

**Key steps:**

1. **Discovery:** Node finds gateway via mDNS/DNS-SD
2. **Connection:** Node opens WebSocket to gateway IP:port
3. **Challenge:** Gateway issues pairing challenge
4. **Approval:** User approves pairing (manual step)
5. **Registration:** Node registers and advertises capabilities
6. **Persistence:** Node stores credentials for reconnection

**Sources:**  
[README.md 223-229](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L223-L229)  
[AGENTS.md 120](https://github.com/openclaw/openclaw/blob/bf6ec64f/AGENTS.md#L120-L120)

---

## Code Entities

### Discovery Components

```
Android NodeiOS NodeGateway Sideadvertises_openclaw-gw._tcpbrowsesbrowsesservice recordsservice recordsWebSocketWebSocketgateway/server.ts
WebSocket ServerDiscovery Advertiser
@homebridge/ciaoBridge Protocol HandlerNetServiceBrowser
(iOS native)BonjourDelegateBridgeClientDNS-SD Browser
dnsjava libraryBridgeClientLocal Network
mDNS/DNS-SD
```

**Key classes and modules:**

| Component | Location | Role |
| --- | --- | --- |
| `@homebridge/ciao` | [package.json 163](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json#L163-L163) | Bonjour/mDNS service advertiser (gateway) |
| `NetServiceBrowser` | iOS Foundation | Native Bonjour browser on iOS |
| `dnsjava` | [apps/android/app/build.gradle.kts 116](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts#L116-L116) | DNS-SD resolver for Android |
| Gateway WebSocket | [src/gateway/server.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.ts) | Accepts node connections |
| Bridge Protocol | Gateway protocol handlers | Pairing and node registration messages |

**Sources:**  
[package.json 163](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json#L163-L163)  
[apps/android/app/build.gradle.kts 116](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts#L116-L116)  
[src/gateway/server.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.ts)

---

## Node Registration

After successful pairing, nodes register with the gateway and advertise their available capabilities.

```
Advertised Capabilitiesnode.registerDevice NodeNode Registry
(Gateway)camera.*
snap/clipscreen.recordlocation.getsystem.run
(macOS only)system.notify
```

**Capability metadata includes:**

- Capability name (e.g., `camera.snap`, `screen.record`)
- Permission status (granted/denied/not-determined)
- Platform-specific constraints
- Device identifier

**Sources:**  
[README.md 223-229](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L223-L229)  
[AGENTS.md 122-129](https://github.com/openclaw/openclaw/blob/bf6ec64f/AGENTS.md#L122-L129)

---

## Managing Nodes via CLI

```
openclaw nodes list
```

Shows all paired nodes with their status, platform, and connection state.

### Describe Node Capabilities

```
openclaw nodes describe <node-id>
```

Displays detailed capability map and permission status for a specific node.

### Node Status

```
openclaw nodes status
```

Shows connection health, uptime, and availability of registered nodes.

**Sources:**  
[README.md 283-284](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L283-L284)  
[AGENTS.md 329](https://github.com/openclaw/openclaw/blob/bf6ec64f/AGENTS.md#L329-L329)

---

## Security and Authentication

### Token-Based Pairing

Pairing requires manual approval on the gateway side. The gateway generates a time-limited token that must be validated before the node is permanently registered.

**Security properties:**

- Pairing tokens expire (default: 5 minutes)
- User must explicitly approve each device
- Credentials stored securely (iOS Keychain, Android EncryptedSharedPreferences)
- Nodes re-authenticate on reconnection

### Gateway Binding Modes

Node discovery respects gateway binding configuration:

| Bind Mode | Discovery Scope |
| --- | --- |
| `loopback` | Nodes cannot discover (gateway bound to 127.0.0.1) |
| `lan` | Local network discovery via mDNS |
| `tailnet` | Tailscale network discovery via DNS-SD |
| `auto` | Prefers `loopback`, falls back to `lan` if Tailscale/remote |

**Recommendation:** Use `bind: loopback` with SSH tunnels or Tailscale Serve for secure remote access. Enable `bind: lan` or `bind: tailnet` only when device nodes need to discover the gateway directly.

**Sources:**  
[README.md 197-210](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L197-L210)  
[docs/platforms/fly.md 40-88](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/platforms/fly.md#L40-L88)

---

## Troubleshooting Discovery

### Node Not Finding Gateway

**Check:**

1. Gateway binding mode (`gateway.bind` in config)
2. Firewall rules (allow port 18789)
3. mDNS traffic not blocked (common in enterprise networks)
4. iOS: Local Network permission granted ([apps/ios/Sources/Info.plist 36-37](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/Sources/Info.plist#L36-L37))
5. Android: Local Network Usage permission granted

### Discovery on Tailscale Networks

For Tailscale discovery:

- Ensure `gateway.tailscale.mode` is `serve` or `funnel`
- Android nodes use unicast DNS-SD against Tailscale DNS servers
- iOS nodes may require Tailscale app installed for network routing

### Pairing Approval Timeout

If pairing challenges expire before approval:

- Increase `gateway.pairing.timeout` (default: 300 seconds)
- Verify gateway is reachable from node
- Check gateway logs for pairing requests

**Sources:**  
[docs/platforms/fly.md 235-248](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/platforms/fly.md#L235-L248)  
[README.md 197-210](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L197-L210)

---

## Platform-Specific Notes

### iOS

- Uses native `NetServiceBrowser` for mDNS discovery
- Requires Local Network permission (declared in Info.plist)
- Credentials stored in Keychain

**Sources:**  
[apps/ios/Sources/Info.plist 30-37](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/ios/Sources/Info.plist#L30-L37)

### Android

- Uses `dnsjava` library for DNS-SD resolution
- Supports both mDNS and unicast DNS-SD (Tailscale)
- Credentials stored in EncryptedSharedPreferences

**Sources:**  
[apps/android/app/build.gradle.kts 115-116](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/android/app/build.gradle.kts#L115-L116)

### macOS

- Menu bar app can run in "node mode" alongside gateway
- Advertises node capabilities when gateway is remote
- Uses native Bonjour APIs

**Sources:**  
[README.md 273-277](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md#L273-L277)  
[AGENTS.md 120-129](https://github.com/openclaw/openclaw/blob/bf6ec64f/AGENTS.md#L120-L129)

---

- **[Node Capabilities](https://deepwiki.com/openclaw/openclaw/11.2-node-capabilities):** Actions nodes can execute (camera, screen, location, system commands)
- **[Gateway Configuration](https://deepwiki.com/openclaw/openclaw/3.1-gateway-configuration):** Binding modes, ports, and network settings
- **[Gateway Protocol](https://deepwiki.com/openclaw/openclaw/3.2-gateway-protocol):** WebSocket RPC protocol and Bridge Protocol details
- **[Remote Access](https://deepwiki.com/openclaw/openclaw/3.4-remote-access):** SSH tunnels and Tailscale Serve for remote gateway access

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-7khuxtjp8f" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-5cnv3xfsc84" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>