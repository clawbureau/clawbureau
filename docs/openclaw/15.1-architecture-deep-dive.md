Menu

## Architecture Deep Dive

Relevant source files
- [.npmrc](https://github.com/openclaw/openclaw/blob/bf6ec64f/.npmrc)
- [CHANGELOG.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/CHANGELOG.md)
- [README.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/README.md)
- [assets/avatar-placeholder.svg](https://github.com/openclaw/openclaw/blob/bf6ec64f/assets/avatar-placeholder.svg)
- [docs/gateway/configuration-examples.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration-examples.md)
- [docs/gateway/configuration.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md)
- [docs/gateway/sandbox-vs-tool-policy-vs-elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md)
- [docs/gateway/sandboxing.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md)
- [docs/multi-agent-sandbox-tools.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md)
- [docs/tools/elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/elevated.md)
- [docs/tools/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md)
- [extensions/memory-core/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/extensions/memory-core/package.json)
- [package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/package.json)
- [pnpm-lock.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-lock.yaml)
- [pnpm-workspace.yaml](https://github.com/openclaw/openclaw/blob/bf6ec64f/pnpm-workspace.yaml)
- [scripts/clawtributors-map.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/clawtributors-map.json)
- [scripts/protocol-gen-swift.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/protocol-gen-swift.ts)
- [scripts/update-clawtributors.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.ts)
- [scripts/update-clawtributors.types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/scripts/update-clawtributors.types.ts)
- [src/agents/bash-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts)
- [src/agents/pi-embedded-helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers.ts)
- [src/agents/pi-embedded-runner-extraparams.live.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.live.test.ts)
- [src/agents/pi-embedded-runner-extraparams.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner-extraparams.test.ts)
- [src/agents/pi-embedded-runner.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.ts)
- [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts)
- [src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts)
- [src/agents/sandbox.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox.ts)
- [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)
- [src/config/zod-schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts)
- [src/cron/run-log.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cron/run-log.test.ts)
- [src/cron/run-log.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cron/run-log.ts)
- [src/cron/store.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cron/store.ts)
- [src/gateway/protocol/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/index.ts)
- [src/gateway/protocol/schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema.ts)
- [src/gateway/server.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.ts)
- [src/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts)
- [ui/package.json](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/package.json)
- [ui/src/styles.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles.css)
- [ui/src/styles/layout.mobile.css](https://github.com/openclaw/openclaw/blob/bf6ec64f/ui/src/styles/layout.mobile.css)

## Purpose and Scope

This document provides a technical deep dive into OpenClaw's architecture, focusing on component interactions, data flow, and implementation details. It bridges high-level system concepts to concrete code entities (classes, functions, file paths) to help developers understand how the system works internally.

For operational guidance on running the Gateway, see [Gateway](https://deepwiki.com/openclaw/openclaw/3-gateway). For configuration reference, see [Configuration System](https://deepwiki.com/openclaw/openclaw/4-configuration-system). For agent behavior details, see [Agent System](https://deepwiki.com/openclaw/openclaw/5-agent-system).

---

## System Architecture Overview

OpenClaw is built around a central **Gateway Control Plane** that orchestrates all subsystems. The Gateway runs as a single Node.js process, exposing a WebSocket server (default port 18789) that handles client connections, agent execution, channel routing, and tool invocation.

```
ExtensionsChannelsAgent RuntimeState & ConfigGateway CoreEntry Pointsopenclaw CLI
(src/cli/program.ts)gateway command
(src/commands/gateway.ts)src/index.ts
(isMainModule check)startGatewayServer()
(src/gateway/server.impl.ts)WebSocket Server
ws library on port 18789Protocol Handler
(src/gateway/protocol/)Frame Validator
(validateRequestFrame)loadConfig()
(src/config/config.ts)Session Store
(src/config/sessions.ts)~/.openclaw/
State DirectoryrunEmbeddedPiAgent()
(src/agents/pi-embedded-runner/)@mariozechner/pi-agent-core
(external package)createOpenClawCodingTools()
(src/agents/pi-tools.ts)Channel Router
(src/web/autoreply.ts)WhatsApp (Baileys)
(src/whatsapp/)Telegram (grammY)
(src/telegram/)Discord (discord.js)
(src/discord/)Plugin Loader
(src/plugins/loader.ts)Plugin Registry
(src/plugins/registry.ts)extensions/*
```

**Sources**: [src/index.ts 1-95](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/index.ts#L1-L95) [src/gateway/server.impl.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.impl.ts) [src/cli/program.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/program.ts) [src/commands/gateway.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/gateway.ts)

---

## Gateway Control Plane

The Gateway is implemented in [src/gateway/server.impl.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.impl.ts) The `startGatewayServer()` function initializes the WebSocket server, loads configuration, starts channels, and registers protocol handlers.

### WebSocket Protocol

The Gateway protocol is defined in [src/gateway/protocol/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/) with TypeBox schemas. All frames follow a request/response pattern with unique `id` fields for correlation.

```
RequestFrame JSONValid RequestFrameResponseFrame/ErrorShapeJSON responseWebSocket ClientGateway Server
(ws.WebSocketServer)Protocol Handler
(handleFrame)Frame Validator
(validateRequestFrame)RPC Method Router
```

Frame types from [src/gateway/protocol/schema/frames.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/frames.ts):

- `RequestFrame`: `{ id, method, params, connect? }`
- `ResponseFrame`: `{ id, type: "response", payload }`
- `EventFrame`: `{ id, type: "event", event, data }`
- `ErrorShape`: `{ id, type: "error", code, message, ... }`

The protocol version is defined as `PROTOCOL_VERSION` in [src/gateway/protocol/schema/protocol-schemas.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/protocol-schemas.ts)

**Sources**: [src/gateway/server.impl.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.impl.ts) [src/gateway/protocol/schema/frames.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/frames.ts) [src/gateway/protocol/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/index.ts)

### Gateway Lifecycle

```
Plugin LoaderWebSocket ServerChannel AdaptersloadConfig()startGatewayServer()gateway commandopenclaw CLIPlugin LoaderWebSocket ServerChannel AdaptersloadConfig()startGatewayServer()gateway commandopenclaw CLIAccept client connectionsgateway runLoad openclaw.jsonOpenClawConfigStart with configDiscover & load pluginsPlugin registryStart enabled channelsChannel connectionsListen on port 18789Server readyGateway runningClient frameRoute to handlerResponse/Event
```

**Sources**: [src/commands/gateway.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/gateway.ts) [src/gateway/server.impl.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/server.impl.ts) [src/config/config.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts)

---

## Agent Execution Pipeline

Agent execution is orchestrated by the embedded Pi Agent runtime in [src/agents/pi-embedded-runner/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/)

### Execution Flow

The primary entry point is `runEmbeddedPiAgent()` in [src/agents/pi-embedded-runner/run.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run.ts) It handles:

1. Session resolution and locking
2. System prompt building
3. Memory search context injection
4. Tool registration and filtering
5. Model selection and failover
6. Stream processing and tool execution
7. Response delivery
```
runEmbeddedPiAgent()
(pi-embedded-runner/run.ts)Resolve Session Key
(routing/session-key.ts)Load Session History
(config/sessions.ts)Memory Search
(memory/search.ts)Build System Prompt
(pi-embedded-runner/system-prompt.ts)Create Tools
(agents/pi-tools.ts)Filter by Policy
(agents/pi-tools.policy.ts)Select Model
(agents/model-auth.ts)Pi Agent Core
(@mariozechner/pi-agent-core)Subscribe Handler
(pi-embedded-subscribe.ts)Tool Execution
(exec, read, write, etc.)Save Session
(config/sessions.ts)
```

**Sources**: [src/agents/pi-embedded-runner/run.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run.ts) [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts) [src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts)

### Tool Registration and Filtering

Tools are created by `createOpenClawCodingTools()` in [src/agents/pi-tools.ts 107-368](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L107-L368) and filtered through multiple policy layers:

```
Base Coding Tools
(from pi-coding-agent)OpenClaw Tools
(createOpenClawTools)Plugin Tools
(listChannelAgentTools)Global Policy
(tools.allow/deny)Agent Policy
(agents.list[].tools)Provider Policy
(tools.byProvider)Group Policy
(channels..groups..tools)Sandbox Policy
(sandbox.tools)Subagent Policy
(isSubagentSessionKey)Filtered Tool Set
(sent to model)
```

The policy resolution logic is in [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts) Tool groups (e.g., `group:fs`, `group:runtime`) are expanded in [src/agents/tool-policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts)

**Sources**: [src/agents/pi-tools.ts 107-368](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts#L107-L368) [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts) [src/agents/tool-policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts)

### Stream Processing

The `subscribeEmbeddedPiSession()` function in [src/agents/pi-embedded-subscribe.ts 30-301](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts#L30-L301) subscribes to model stream events and processes:

- `text_delta`: Accumulates text chunks, handles reasoning tags (`<think>`, `<final>`)
- `tool_call`: Executes tools and collects results
- `text_end`: Finalizes assistant text, sends block replies
- `tool_result`: Processes tool execution results
- `error`: Handles model errors and triggers failover

The `EmbeddedBlockChunker` class splits text into chunks based on markdown structure for block streaming.

**Sources**: [src/agents/pi-embedded-subscribe.ts 30-301](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts#L30-L301) [src/agents/pi-embedded-block-chunker.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-block-chunker.ts)

---

## Configuration System

Configuration is loaded from `~/.openclaw/openclaw.json` (JSON5 format) with environment variable overrides.

```
loadConfig()
(config/config.ts)Load .env Files
(infra/dotenv.ts)Read openclaw.json
(JSON5.parse)Process $include
(config/includes.ts)Substitute ${VAR}
(config/env-substitution.ts)Migrate Legacy
(config/migrations.ts)Validate Schema
(OpenClawSchema from Zod)OpenClawConfig
(typed object)
```

The Zod schema is defined in [src/config/zod-schema.ts 30-356](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts#L30-L356) TypeScript types are generated in [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)

**Sources**: [src/config/config.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts) [src/config/zod-schema.ts 30-356](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts#L30-L356) [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)

### Configuration Precedence

Configuration values follow this precedence (highest to lowest):

| Priority | Source | Example |
| --- | --- | --- |
| 1 | Environment variables | `ANTHROPIC_API_KEY` |
| 2 | CLI flags | `--port 18789` |
| 3 | `openclaw.json` config | `gateway.port: 18789` |
| 4 | `.env` files | `ANTHROPIC_API_KEY=sk-...` |
| 5 | System defaults | Hardcoded in code |

Environment variable substitution (`${VAR}` syntax) is processed in [src/config/env-substitution.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/env-substitution.ts)

**Sources**: [src/config/config.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts) [src/config/env-substitution.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/env-substitution.ts) [src/infra/dotenv.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/infra/dotenv.ts)

---

## Session Management

Sessions track conversation history per user/channel/group. Session keys follow a hierarchical pattern.

### Session Key Resolution

Session keys are derived by `deriveSessionKey()` in [src/config/sessions.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts):

```
YesNoYesNoChannel + Peer + AccountIs DM?Is Group?DM Scope Config
(session.dmScope)agent:main:mainagent:main:channel:dm:peeragent:main:channel:group:id
```

Session keys have the format:

- Main: `agent:<agentId>:main`
- DM: `agent:<agentId>:<channel>:dm:<peerId>`
- Group: `agent:<agentId>:<channel>:group:<groupId>`

The multi-agent router binds session keys to agents via `bindings` config in [src/routing/bindings.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/routing/bindings.ts)

**Sources**: [src/config/sessions.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts) [src/routing/session-key.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/routing/session-key.ts) [src/routing/bindings.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/routing/bindings.ts)

### Session Store

Sessions are persisted in `~/.openclaw/agents/<agentId>/sessions/<sessionKey>/session.json`. The store structure:

```
{
  sessionKey: string;
  messages: Message[];  // Pi Agent Core message format
  metadata: {
    createdAt: number;
    updatedAt: number;
    model?: string;
    thinkingLevel?: string;
    // ... additional metadata
  };
}
```

Load/save functions are in [src/config/sessions.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts) Session compaction (summarization) is triggered when context exceeds limits in [src/agents/pi-embedded-runner/compact.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts)

**Sources**: [src/config/sessions.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions.ts) [src/agents/pi-embedded-runner/compact.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts)

---

## Channel Architecture

Channels connect messaging platforms to the Gateway. Each channel adapter translates platform-specific messages to a common format.

### Channel Routing

The `monitorChannelForReplies()` function in [src/web/autoreply.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/web/autoreply.ts) routes inbound messages through access control and session resolution:

```
Agent RuntimeMessage QueueSession ResolverAccess ControlmonitorChannelForReplies()Channel AdapterAgent RuntimeMessage QueueSession ResolverAccess ControlmonitorChannelForReplies()Channel Adapteralt[Access Denied][Access Granted]Inbound messageCheck dmPolicy/groupPolicySilent drop/pairing codeContinueResolve session keySessionKeyEnqueue messageTrigger agent runStream response
```

Access control policies (pairing, allowlist, open) are defined in [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts) and enforced in channel-specific code.

**Sources**: [src/web/autoreply.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/web/autoreply.ts) [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)

### Channel Adapters

Each channel has an adapter module:

| Channel | Module | Library |
| --- | --- | --- |
| WhatsApp | [src/whatsapp/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/whatsapp/) | `@whiskeysockets/baileys` |
| Telegram | [src/telegram/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/) | `grammy` |
| Discord | [src/discord/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/discord/) | `discord-api-types` |
| Slack | [src/slack/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/slack/) | `@slack/bolt` |
| Signal | [src/signal/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/signal/) | `signal-cli` (external) |
| iMessage | [src/imessage/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/imessage/) | `imsg` (macOS only) |

Adapters implement a common interface for sending/receiving messages, handling attachments, and managing presence indicators.

**Sources**: [src/whatsapp/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/whatsapp/) [src/telegram/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/) [src/discord/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/discord/) [src/slack/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/slack/) [src/signal/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/signal/) [src/imessage/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/imessage/)

---

## Tool System

Tools are typed functions exposed to the agent for execution. The tool registry filters tools based on configuration policies before sending them to the model.

### Built-in Tools

Core tools are defined in [src/agents/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/):

| Tool | File | Purpose |
| --- | --- | --- |
| `exec` | [bash-tools.exec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/bash-tools.exec.ts) | Run shell commands |
| `process` | [bash-tools.process.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/bash-tools.process.ts) | Manage background processes |
| `read` | `@mariozechner/pi-coding-agent` | Read file contents |
| `write` | `@mariozechner/pi-coding-agent` | Write file contents |
| `edit` | `@mariozechner/pi-coding-agent` | Edit file with hunks |
| `apply_patch` | [apply-patch.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/apply-patch.ts) | Apply structured patches |
| `message` | [openclaw-tools/message.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/message.ts) | Send messages to channels |
| `browser` | [openclaw-tools/browser.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/browser.ts) | Control browser via CDP |
| `canvas` | [openclaw-tools/canvas.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/canvas.ts) | Interact with A2UI canvas |
| `cron` | [openclaw-tools/cron.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/cron.ts) | Schedule cron jobs |
| `sessions_*` | [openclaw-tools/sessions.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/sessions.ts) | Cross-session coordination |
| `memory_*` | [openclaw-tools/memory.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/memory.ts) | Search/retrieve memory |
| `nodes` | [openclaw-tools/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/openclaw-tools/nodes.ts) | Invoke device node actions |

**Sources**: [src/agents/bash-tools.exec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.exec.ts) [src/agents/bash-tools.process.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.process.ts) [src/agents/apply-patch.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/apply-patch.ts) [src/agents/openclaw-tools/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/)

### Tool Policy Resolution

Tool policies are resolved by `resolveEffectiveToolPolicy()` in [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts):

```
YesNoTool RequestGlobal Policy
(tools.allow/deny)Agent Policy
(agents.list[].tools)Provider Policy
(tools.byProvider)Group Policy
(channels..groups..tools)Sandbox Policy
(sandbox.tools)Subagent Policy
(sessions tool policy)Allowed?Execute ToolBlock Tool
```

The `filterToolsByPolicy()` function in [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts) applies all policies and returns the filtered tool set.

**Sources**: [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts) [src/agents/tool-policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-policy.ts)

### Tool Execution Context

Tools receive an execution context with:

- `sessionKey`: Current session identifier
- `agentId`: Current agent identifier
- `config`: Full OpenClaw configuration
- `sandbox`: Sandbox context (if enabled)
- `abortSignal`: Cancellation signal

The `exec` tool in [src/agents/bash-tools.exec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.exec.ts) demonstrates the pattern for tool implementation with sandboxing, approval workflows, and background execution.

**Sources**: [src/agents/bash-tools.exec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.exec.ts) [src/agents/openclaw-tools/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/)

---

## Memory System

Memory search provides semantic and full-text search over workspace files. The system indexes files, generates embeddings, and maintains a hybrid BM25+vector search index.

### Indexing Pipeline

```
Cache missCache hitIndex Trigger
(manual or auto)Chunk Files
(by size/structure)Check Embedding Cache
(SQLite)Generate Embeddings
(OpenAI/Gemini/Anthropic)Update CacheUpdate FTS5 Index
(BM25 search)Update Vector Store
(sqlite-vec)
```

Indexing logic is in [src/memory/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/index.ts) File discovery and change detection use `chokidar` watchers.

**Sources**: [src/memory/index.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/index.ts) [src/memory/providers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/providers.ts)

### Search Flow

Search queries use hybrid retrieval: BM25 for keyword matching + vector similarity for semantic matching. Results are merged and scored.

```
Score Mergersqlite-vec IndexFTS5 BM25 Indexsearch()memory_search toolScore Mergersqlite-vec IndexFTS5 BM25 Indexsearch()memory_search toolQuery textGenerate query embeddingKeyword searchVector search (k=20)BM25 resultsVector resultsWeighted mergeTop N results
```

Search implementation is in [src/memory/search.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/search.ts) The `memory_search` tool is registered in [src/agents/openclaw-tools/memory.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/memory.ts)

**Sources**: [src/memory/search.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/search.ts) [src/agents/openclaw-tools/memory.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/memory.ts)

### Memory Providers

Memory search supports multiple embedding providers configured via `memorySearch.provider`:

| Provider | Config Key | Implementation |
| --- | --- | --- |
| OpenAI | `openai` | [memory/providers/openai.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/memory/providers/openai.ts) |
| Anthropic | `anthropic` | [memory/providers/anthropic.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/memory/providers/anthropic.ts) |
| Gemini | `gemini` | [memory/providers/gemini.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/memory/providers/gemini.ts) |
| Custom | `custom` | [memory/providers/custom.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/memory/providers/custom.ts) |

The provider interface is defined in [src/memory/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/types.ts)

**Sources**: [src/memory/providers/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/providers/) [src/memory/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/types.ts)

---

## Plugin Architecture

Plugins extend OpenClaw with new channels, tools, providers, and memory backends. Plugins are discovered from the `extensions/` directory.

### Plugin Discovery

The plugin loader in [src/plugins/loader.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/loader.ts) discovers plugins by:

1. Scanning `extensions/` for `package.json` files
2. Reading the `openclaw.extensions` field
3. Importing the declared module paths
4. Validating the plugin manifest
```
Plugin Loader
(plugins/loader.ts)extensions/Read package.jsonParse openclaw.extensionsImport moduleValidate manifestPlugin Registry
(plugins/registry.ts)
```

**Sources**: [src/plugins/loader.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/loader.ts) [src/plugins/registry.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/registry.ts)

### Plugin Manifest

Plugins declare their capabilities in `package.json`:

```
{
  "openclaw": {
    "extensions": ["./index.ts"],
    "config": {
      "schema": {...},
      "uiHints": {...}
    }
  }
}
```

The manifest schema is defined in [src/config/types.plugins.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.plugins.ts) Plugins can contribute:

- **Channels**: New messaging platform integrations
- **Tools**: Additional agent tools
- **Providers**: Model provider integrations
- **Memory**: Alternative memory search backends

**Sources**: [src/config/types.plugins.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.plugins.ts) [src/plugins/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/types.ts)

### Plugin Slots

Plugins register capabilities via slots in [src/plugins/registry.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/registry.ts):

| Slot | Purpose | Example |
| --- | --- | --- |
| `channel` | Messaging platforms | MS Teams, Matrix, Nostr |
| `tool` | Agent tools | Lobster workflow, LLM task |
| `provider` | Model providers | Custom inference endpoints |
| `memory` | Memory backends | LanceDB extension |

Slots are queried by subsystems (e.g., channel router, tool registry) to discover plugin-provided capabilities.

**Sources**: [src/plugins/registry.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/registry.ts) [src/plugins/slots.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/slots.ts)

---

## Device Nodes

Device nodes (iOS, Android, macOS apps) pair with the Gateway to provide device-local capabilities like camera access, screen recording, and system commands.

### Pairing Flow

Nodes discover the Gateway via Bonjour/mDNS and pair using a challenge-response protocol:

```
Pairing StoreGateway ServermDNS/BonjourDevice NodePairing StoreGateway ServermDNS/BonjourDevice NodeDiscover _openclaw._tcpGateway IP + Portnode.pair.requestGenerate challengeChallenge + Device IDSign challengenode.pair.verifyVerify signatureSave device identityPairing complete
```

Pairing logic is in [src/pairing/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/pairing/) and [src/gateway/protocol/schema/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/nodes.ts) The node pairing store is at `~/.openclaw/devices/nodes.json`.

**Sources**: [src/pairing/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/pairing/) [src/gateway/protocol/schema/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/nodes.ts)

### Node Invocation

Paired nodes are invoked via the `nodes` tool or `node.invoke` RPC method:

```
Capability requestWebSocket invokeExecute capabilityReturn resultnodes tool
(openclaw-tools/nodes.ts)node.invoke RPC
(gateway/protocol/)Gateway ServerDevice Node
(iOS/Android/macOS)Tool Result
```

Node capabilities are declared in the pairing handshake and stored in the device registry. Examples:

- `camera.snap`: Take a photo
- `screen.record`: Record screen video
- `location.get`: Get GPS coordinates
- `system.run`: Execute shell command (macOS only)
- `canvas.*`: A2UI canvas operations

**Sources**: [src/agents/openclaw-tools/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/openclaw-tools/nodes.ts) [src/gateway/protocol/schema/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/nodes.ts)

### Node Permissions

macOS nodes track TCC (Transparency, Consent, and Control) permissions and report their status via `node.describe`. The Gateway uses this to provide actionable error messages when capabilities are unavailable.

The permission map includes:

- Camera access
- Screen recording access
- Microphone access
- Accessibility access (for system commands)

**Sources**: [src/gateway/protocol/schema/nodes.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/nodes.ts) [apps/macos/](https://github.com/openclaw/openclaw/blob/bf6ec64f/apps/macos/)

---

## Data Flow: Message to Response

This section traces a complete message flow from inbound channel message to streamed response.

```
WhatsApp AdaptersubscribeEmbeddedPiSession()Model ProviderTool RegistryMemory SearchrunEmbeddedPiAgent()Message QueueAccess ControlmonitorChannelForReplies()WhatsApp AdapterUserWhatsApp AdaptersubscribeEmbeddedPiSession()Model ProviderTool RegistryMemory SearchrunEmbeddedPiAgent()Message QueueAccess ControlmonitorChannelForReplies()WhatsApp AdapterUserloop[Agent Turn]Send WhatsApp messageInbound message eventCheck dmPolicyAllowedResolve session keyEnqueue messageStart agent runSearch relevant contextContext snippetsBuild tool registryFiltered toolsBuild system promptStream requesttext_deltaStream chunktool_callExecute toolTool resulttext_endSave sessionDelivery completeDisplay response
```

**Sources**: [src/web/autoreply.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/web/autoreply.ts) [src/agents/pi-embedded-runner/run.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run.ts) [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts)

---

## Design Decisions

### Single-Process Architecture

OpenClaw runs as a single Node.js process (the Gateway) rather than microservices. This simplifies deployment, reduces latency, and makes state management straightforward. Multi-agent isolation is achieved through configuration rather than process boundaries.

### Embedded Pi Agent Core

The agent runtime (`@mariozechner/pi-agent-core`) is embedded rather than running as a separate service. This enables tight integration with tools, synchronous tool execution, and efficient stream processing.

**Sources**: [src/agents/pi-embedded-runner/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/)

### Session-Based Tool Scoping

Tools (especially `exec` and `process`) are scoped per session or agent to prevent cross-session interference. Background processes are tracked with unique session IDs and cleaned up on timeout.

**Sources**: [src/agents/bash-tools.exec.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.exec.ts) [src/agents/bash-tools.process.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.process.ts)

### Policy Layering

Tool policies are layered (global → agent → provider → group → sandbox → subagent) with each layer narrowing the tool set. This allows fine-grained control without complex conditional logic.

**Sources**: [src/agents/pi-tools.policy.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.policy.ts)

### Channel Adapter Pattern

Each messaging platform has a dedicated adapter module that translates platform-specific events to a common message format. This isolates platform quirks and makes it easy to add new channels.

**Sources**: [src/whatsapp/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/whatsapp/) [src/telegram/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/) [src/discord/](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/discord/)

### Plugin-Based Extensions

Extensions are discovered from the local `extensions/` directory rather than installed as npm packages. This allows rapid iteration and keeps plugin code alongside core code for easier development.

**Sources**: [src/plugins/loader.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/plugins/loader.ts)

---

This architecture supports OpenClaw's goal of being a personal, local-first AI assistant that integrates with existing messaging platforms while maintaining strong security boundaries and extensibility.

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-7khuxtjp8f" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-5cnv3xfsc84" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-hmbioix2qbm" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg> <svg id="mermaid-z5tp3lz1enf" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>