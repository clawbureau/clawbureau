Menu

## Configuration File Structure

Relevant source files
- [.prettierignore](https://github.com/openclaw/openclaw/blob/bf6ec64f/.prettierignore)
- [docs/cli/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/index.md)
- [docs/cli/memory.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/memory.md)
- [docs/concepts/memory.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/memory.md)
- [docs/gateway/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/index.md)
- [docs/gateway/troubleshooting.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/troubleshooting.md)
- [docs/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/index.md)
- [docs/start/getting-started.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/getting-started.md)
- [docs/start/wizard.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md)
- [src/agents/memory-search.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.test.ts)
- [src/agents/memory-search.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts)
- [src/agents/tools/memory-tool.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tools/memory-tool.ts)
- [src/auto-reply/reply/agent-runner.heartbeat-typing.runreplyagent-typing-heartbeat.retries-after-compaction-failure-by-resetting-session.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/agent-runner.heartbeat-typing.runreplyagent-typing-heartbeat.retries-after-compaction-failure-by-resetting-session.test.ts)
- [src/cli/memory-cli.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.test.ts)
- [src/cli/memory-cli.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/cli/memory-cli.ts)
- [src/config/config.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts)
- [src/config/schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts)
- [src/config/types.tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.tools.ts)
- [src/config/zod-schema.agent-runtime.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts)
- [src/memory/index.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/index.test.ts)
- [src/memory/internal.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.test.ts)
- [src/memory/internal.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/internal.ts)
- [src/memory/manager-cache-key.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager-cache-key.ts)
- [src/memory/manager.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts)
- [src/memory/sync-memory-files.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/sync-memory-files.ts)

This page documents the complete structure of OpenClaw's primary configuration file (`openclaw.json`), covering all configuration domains, their schemas, field purposes, and how they relate to system components. For guidance on editing and managing configuration, see [Configuration Management](https://deepwiki.com/openclaw/openclaw/4.2-configuration-management). For multi-agent setup patterns, see [Multi-Agent Configuration](https://deepwiki.com/openclaw/openclaw/4.3-multi-agent-configuration).

---

## File Location and Format

OpenClaw's configuration lives at `~/.openclaw/openclaw.json` by default. The file location can be overridden via `OPENCLAW_CONFIG_PATH` or the `--profile` flag.

**Format**: JSON5 (supports comments, trailing commas, unquoted keys)  
**Validation**: Zod schemas enforce type safety and flag unknown keys  
**Encoding**: UTF-8

The configuration system refuses to start the Gateway when the file contains unknown keys or invalid values. Run `openclaw doctor` to validate and repair configuration issues.

**Sources**: [src/config/config.ts 1-15](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts#L1-L15) [docs/index.md 149](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/index.md#L149-L149)

---

## Configuration Domains Overview

```
Discovery & PresenceExtensions & AutomationSessions & UXMessaging ChannelsMemory & ModelsTool SystemAgent ExecutionGateway Control PlaneRuntime & Operationsopenclaw.json
(~/.openclaw/)meta
version trackingupdate
channel, auto-checkdiagnostics
logging, OTEL, tracelogging
file, console levelsgateway
port, bind, auth, reloadnodeHost
browser proxygateway.controlUi
web dashboardgateway.http.endpoints
OpenAI API, tools invokeagents.defaults
workspace, model, tools, memoryagents.list[]
isolated agentsagents.defaults.sandbox
Docker, browser, pruneagents.defaults.heartbeat
scheduled pingstools
profile, allow/denytools.exec
security, approvals, sandboxtools.web
search, fetchtools.media
image, audio, videotools.message
cross-context policyagents.defaults.memorySearch
provider, index, syncauth
profiles, order, cooldownsagents.defaults.models
provider configschannels.*
whatsapp, telegram, discordchannels.{channel}
tokens, policies, retrysession
dmScope, identityLinksmessages
ackReaction, debouncecommands
native, text, bashui
colors, assistantplugins
enabled, slots, entriesskills
load, watchcron
scheduled jobshooksbrowser
CDP, snapshotdiscovery
mdns modepresence
```

**Title**: Configuration Domains and Hierarchy

**Sources**: [src/config/schema.ts 1-100](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L1-L100) [src/config/types.tools.ts 1-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.tools.ts#L1-L50) [src/config/zod-schema.agent-runtime.ts 1-80](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts#L1-L80)

---

## Core Structure: Agents and Defaults

OpenClaw uses a **defaults-with-overrides** pattern: `agents.defaults` sets baseline configuration for all agents, and `agents.list[]` entries can override specific fields per agent.

```
Agent List (Isolated Instances)Sandbox & IsolationTool PoliciesMemory SystemModel & AuthAgent Runtime Settingsinherits & overridesinherits & overridesagents.defaults
{baseline config}workspace
~/.openclaw/workspacerepoRoot
git root hintbootstrapMaxChars
20000envelope*
timezone, timestamp, elapsedmodel.primary
provider/modelmodel.fallbacks[]
ordered listimageModel.primary
vision modelcliBackends[]
fallback CLIsmodels
provider configsmemorySearch.enabled
truememorySearch.provider
openai|gemini|local|automemorySearch.model
embedding modelmemorySearch.store
path, vector, cachememorySearch.sync
watch, onSearch, intervalmemorySearch.query
hybrid, maxResults, minScoretools.allow[]
explicit allowlisttools.deny[]
explicit denylisttools.byProvider
per-provider overridestools.exec
security, host, sandboxsandbox.mode
off|non-main|allsandbox.workspaceAccess
none|ro|rwsandbox.docker
image, env, limitssandbox.browser
CDP, VNC, noVNCagents.list[0]
{id:'main', default:true}agents.list[1]
{id:'work', workspace:...}agents.list[].bindings[]
channel routing
```

**Title**: Agent Configuration Structure and Inheritance

**Example Configuration**:

```
{
  agents: {
    defaults: {
      workspace: "~/.openclaw/workspace",
      repoRoot: null, // auto-detect git root
      bootstrapMaxChars: 20000,
      envelopeTimezone: "local",
      envelopeTimestamp: "on",
      envelopeElapsed: "on",
      
      model: {
        primary: "anthropic/claude-sonnet-4-20250514",
        fallbacks: [
          "openai/gpt-4.5-turbo",
          "google/gemini-2.0-flash"
        ]
      },
      
      imageModel: {
        primary: null, // use main model if capable
        fallbacks: []
      },
      
      cliBackends: ["claude-cli"],
      
      models: {
        // provider-specific settings (see Models section)
      },
      
      memorySearch: {
        enabled: true,
        sources: ["memory"],
        extraPaths: [],
        provider: "auto", // openai|gemini|local|auto
        model: "text-embedding-3-small",
        // ... (see Memory Search section)
      },
      
      tools: {
        profile: "coding",
        allow: null,
        alsoAllow: [],
        deny: [],
        byProvider: {},
        // ... (see Tools section)
      },
      
      sandbox: {
        mode: "non-main",
        workspaceAccess: "rw",
        sessionToolsVisibility: "spawned",
        scope: "session",
        // ... (see Sandbox section)
      },
      
      humanDelay: {
        mode: "natural",
        minMs: 800,
        maxMs: 2500
      },
      
      heartbeat: {
        every: "30m",
        activeHours: {
          start: "08:00",
          end: "22:00",
          timezone: "America/New_York"
        },
        model: null,
        session: "main",
        includeReasoning: false,
        target: null,
        to: null,
        prompt: null,
        ackMaxChars: 1000
      }
    },
    
    list: [
      {
        id: "main",
        default: true,
        workspace: "~/.openclaw/workspace",
        agentDir: "~/.openclaw/agents/main"
      },
      {
        id: "work",
        workspace: "~/.openclaw/workspace-work",
        agentDir: "~/.openclaw/agents/work",
        model: {
          primary: "openai/gpt-5.2"
        },
        sandbox: {
          mode: "off"
        },
        bindings: [
          {
            channel: "whatsapp",
            accountId: "biz"
          }
        ]
      }
    ]
  }
}
```

**Field Purposes**:

| Field | Type | Default | Purpose |
| --- | --- | --- | --- |
| `agents.defaults.workspace` | string | `~/.openclaw/workspace` | Agent workspace directory (bootstrap files, memory, skills) |
| `agents.defaults.repoRoot` | string? | null (auto-detect) | Repository root shown in system prompt |
| `agents.defaults.bootstrapMaxChars` | number | 20000 | Max chars per bootstrap file injected into system prompt |
| `agents.defaults.envelopeTimezone` | string | "local" | Timezone for message envelopes (utc, local, user, IANA) |
| `agents.defaults.envelopeTimestamp` | string | "on" | Include absolute timestamps in envelopes |
| `agents.defaults.envelopeElapsed` | string | "on" | Include elapsed time in envelopes |
| `agents.defaults.model.primary` | string | required | Primary model (provider/model format) |
| `agents.defaults.model.fallbacks` | string\[\] | \[\] | Ordered fallback models |
| `agents.defaults.imageModel.primary` | string? | null | Vision model (if primary lacks image input) |
| `agents.defaults.cliBackends` | string\[\] | \[\] | CLI fallbacks (claude-cli, etc) |
| `agents.defaults.humanDelay.mode` | string | "natural" | Delay style for replies (off, natural, custom) |
| `agents.defaults.heartbeat.every` | string? | null | Heartbeat interval (duration string: 30m, 1h) |
| `agents.list[].id` | string | required | Unique agent identifier |
| `agents.list[].default` | boolean | false | Mark as default agent |
| `agents.list[].workspace` | string? | inherits | Override workspace path |
| `agents.list[].bindings` | array? | \[\] | Channel routing rules (see Multi-Agent) |

**Sources**: [src/config/zod-schema.agent-runtime.ts 12-80](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts#L12-L80) [src/agents/memory-search.ts 1-143](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L1-L143) [docs/start/wizard.md 295-308](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L295-L308)

---

## Gateway Configuration

The Gateway control plane is configured under the `gateway` key. This controls WebSocket server binding, authentication, reload behavior, and node management.

```
{
  gateway: {
    mode: "local", // local|remote (required; gateway won't start if unset)
    port: 18789,
    bind: "loopback", // loopback|lan|tailnet|auto|custom
    
    auth: {
      mode: "token", // token|password|tailscale
      token: "generated-by-wizard", // required for non-loopback
      password: null
    },
    
    remote: {
      url: null, // ws:// or wss:// for remote mode
      sshTarget: null, // user@host or user@host:port for SSH tunnel
      sshIdentity: null, // path to SSH identity file
      token: null, // remote gateway token
      password: null,
      tlsFingerprint: null // sha256 TLS fingerprint to pin
    },
    
    controlUi: {
      basePath: "", // URL prefix (e.g. /openclaw)
      allowInsecureAuth: false, // allow token-only auth over HTTP
      dangerouslyDisableDeviceAuth: false // disable device identity checks
    },
    
    http: {
      endpoints: {
        chatCompletions: {
          enabled: false // OpenAI-compatible /v1/chat/completions
        }
      }
    },
    
    reload: {
      mode: "hybrid", // off|soft|restart|hybrid
      debounceMs: 500
    },
    
    nodes: {
      browser: {
        mode: "auto", // auto|manual|off
        node: null // pin to specific node id/name
      },
      allowCommands: [], // extra node.invoke commands
      denyCommands: [] // block specific commands
    },
    
    tailscale: {
      mode: "off", // off|serve|funnel
      hostname: null,
      resetOnExit: false
    }
  }
}
```

**Field Purposes**:

| Field | Type | Default | Purpose |
| --- | --- | --- | --- |
| `gateway.mode` | string | required | Runtime mode (local starts gateway, remote connects) |
| `gateway.port` | number | 18789 | WebSocket + HTTP port |
| `gateway.bind` | string | "loopback" | Network binding (loopback=127.0.0.1, lan=0.0.0.0, tailnet=Tailscale IP) |
| `gateway.auth.mode` | string | "token" | Authentication method |
| `gateway.auth.token` | string? | null | Gateway token (required for non-loopback) |
| `gateway.auth.password` | string? | null | Gateway password (Tailscale funnel) |
| `gateway.remote.url` | string? | null | Remote gateway URL (ws:// or wss://) |
| `gateway.remote.sshTarget` | string? | null | SSH tunnel target (user@host:port) |
| `gateway.controlUi.basePath` | string | "" | URL prefix for Control UI |
| `gateway.controlUi.allowInsecureAuth` | boolean | false | Allow token-only auth over HTTP (not recommended) |
| `gateway.reload.mode` | string | "hybrid" | Hot reload strategy (off, soft, restart, hybrid) |
| `gateway.nodes.browser.mode` | string | "auto" | Browser node routing |
| `gateway.tailscale.mode` | string | "off" | Tailscale exposure (off, serve, funnel) |

**Sources**: [src/config/schema.ts 104-211](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L104-L211) [docs/gateway/index.md 1-117](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/index.md#L1-L117)

---

## Tool Configuration

Tool policies control which tools the agent can use. Policies cascade: `profile` â†’ `allow` / `deny` â†’ `byProvider` overrides â†’ per-agent overrides.

```
Agent Tool OverridesMessage ToolMedia UnderstandingWeb ToolsExec Tool SecurityProvider OverridesBase Policyoverridestools (global defaults)allow[]
explicit allowlistalsoAllow[]
additive allowlistdeny[]
explicit denylistbyProvider
{provider/model: policy}anthropic: {allow:[...]}openai/gpt-5.2: {deny:[...]}exec.host
sandbox|gateway|nodeexec.security
deny|allowlist|fullexec.ask
off|on-miss|alwaysexec.node
node id/nameexec.pathPrepend[]
PATH additionsexec.safeBins[]
stdin-only safe binariesexec.applyPatch
enable for OpenAI modelsweb.search
enabled, provider, apiKeyweb.fetch
enabled, maxChars, firecrawlmedia.image
enabled, models, maxBytesmedia.audio
enabled, models, languagemedia.video
enabled, modelsmessage.crossContext
within/across providermessage.crossContext.marker
origin prefix/suffixmessage.broadcast.enabledagents.list[].tools
per-agent policyagents.list[].tools.elevated
allowFrom restrictionsagents.list[].tools.exec
exec overrides
```

**Title**: Tool Policy Cascade and Configuration Domains

**Example Configuration**:

```
{
  tools: {
    profile: "coding",
    
    // allow and alsoAllow cannot both be set in the same scope
    allow: null, // explicit allowlist (replaces profile)
    alsoAllow: ["lobster"], // additive to profile/allow
    deny: ["exec"], // explicit denylist
    
    byProvider: {
      "anthropic": {
        profile: "full",
        alsoAllow: ["browser"]
      },
      "openai/gpt-5.2": {
        deny: ["web_search"]
      }
    },
    
    exec: {
      host: "sandbox", // sandbox|gateway|node
      security: "allowlist", // deny|allowlist|full
      ask: "on-miss", // off|on-miss|always
      node: null, // default node for exec.host=node
      pathPrepend: ["/opt/homebrew/bin"],
      safeBins: ["cat", "echo", "grep"],
      backgroundMs: 2000,
      timeoutSec: 300,
      approvalRunningNoticeMs: 10000,
      cleanupMs: 3600000,
      notifyOnExit: true,
      applyPatch: {
        enabled: false,
        allowModels: ["gpt-5.2"]
      }
    },
    
    web: {
      search: {
        enabled: true,
        provider: "brave", // brave|perplexity
        apiKey: null, // defaults to BRAVE_API_KEY env
        maxResults: 5,
        timeoutSeconds: 10,
        cacheTtlMinutes: 60,
        perplexity: {
          apiKey: null,
          baseUrl: "https://openrouter.ai/api/v1",
          model: "perplexity/sonar-pro"
        }
      },
      fetch: {
        enabled: true,
        maxChars: 100000,
        timeoutSeconds: 10,
        cacheTtlMinutes: 60,
        maxRedirects: 3,
        userAgent: null,
        readability: true,
        firecrawl: {
          enabled: false,
          apiKey: null,
          baseUrl: "https://api.firecrawl.dev",
          onlyMainContent: true,
          maxAgeMs: null,
          timeoutSeconds: 30
        }
      }
    },
    
    media: {
      models: [
        {
          provider: "openai",
          model: "gpt-4o",
          capabilities: ["image", "audio"]
        }
      ],
      concurrency: 2,
      image: {
        enabled: true,
        maxBytes: 6000000,
        maxChars: 4000,
        prompt: "Describe this image in detail.",
        timeoutSeconds: 30,
        attachments: {
          mode: "first",
          maxAttachments: 1,
          prefer: "first"
        },
        models: [],
        scope: null
      },
      audio: {
        enabled: true,
        maxBytes: 25000000,
        maxChars: 10000,
        prompt: "Transcribe this audio.",
        timeoutSeconds: 60,
        language: null,
        attachments: {
          mode: "first",
          maxAttachments: 1
        },
        models: []
      },
      video: {
        enabled: true,
        maxBytes: 50000000,
        maxChars: 10000,
        prompt: "Describe this video.",
        timeoutSeconds: 120,
        attachments: {
          mode: "first",
          maxAttachments: 1
        },
        models: []
      }
    },
    
    links: {
      enabled: true,
      maxLinks: 3,
      timeoutSeconds: 10,
      models: []
    },
    
    message: {
      crossContext: {
        allowWithinProvider: true,
        allowAcrossProviders: false,
        marker: {
          enabled: true,
          prefix: "From {channel}: ",
          suffix: ""
        }
      },
      broadcast: {
        enabled: true
      }
    },
    
    elevated: {
      enabled: true,
      allowFrom: {
        whatsapp: ["+15555550123"],
        telegram: [123456789]
      }
    }
  }
}
```

**Tool Profiles**:

| Profile | Description | Included Tools |
| --- | --- | --- |
| `minimal` | Read-only queries | `memory_search`, `memory_get` |
| `coding` | Development tasks | `read`, `write`, `edit`, `apply_patch`, `exec`, `memory_*` |
| `messaging` | Cross-channel messaging | `message`, `sessions`, `memory_*` |
| `full` | All tools enabled | All available tools |

**Sources**: [src/config/types.tools.ts 1-430](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.tools.ts#L1-L430) [src/config/schema.ts 167-206](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L167-L206) [src/config/zod-schema.agent-runtime.ts 147-301](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts#L147-L301)

---

Memory search enables semantic search over workspace files using embeddings. Configuration controls the embedding provider, index storage, sync behavior, and query settings.

```
{
  agents: {
    defaults: {
      memorySearch: {
        enabled: true,
        sources: ["memory"], // memory|sessions
        extraPaths: [], // additional dirs/files to index
        
        experimental: {
          sessionMemory: false // index session transcripts
        },
        
        provider: "auto", // openai|gemini|local|auto
        
        remote: {
          baseUrl: null, // custom OpenAI-compatible endpoint
          apiKey: null, // defaults to env vars
          headers: {},
          batch: {
            enabled: true, // use batch API for indexing
            wait: true, // wait for batch completion
            concurrency: 2, // max concurrent batch jobs
            pollIntervalMs: 2000,
            timeoutMinutes: 60
          }
        },
        
        fallback: "none", // openai|gemini|local|none
        model: "text-embedding-3-small",
        
        local: {
          modelPath: null, // GGUF model path or hf: URI
          modelCacheDir: null
        },
        
        store: {
          driver: "sqlite",
          path: "~/.openclaw/memory/{agentId}.sqlite",
          vector: {
            enabled: true, // use sqlite-vec extension
            extensionPath: null // auto-detect or explicit path
          }
        },
        
        chunking: {
          tokens: 400,
          overlap: 80
        },
        
        sync: {
          onSessionStart: true, // index on session start
          onSearch: true, // lazy index on search
          watch: true, // watch files for changes
          watchDebounceMs: 1500,
          intervalMinutes: 0, // 0 = disabled
          sessions: {
            deltaBytes: 100000, // min bytes before reindex
            deltaMessages: 50 // min messages before reindex
          }
        },
        
        query: {
          maxResults: 6,
          minScore: 0.35,
          hybrid: {
            enabled: true, // BM25 + vector hybrid
            vectorWeight: 0.7,
            textWeight: 0.3,
            candidateMultiplier: 4
          }
        },
        
        cache: {
          enabled: true, // cache chunk embeddings
          maxEntries: 50000
        }
      }
    }
  }
}
```

**Memory Provider Resolution**:

1. If `provider` is explicit (`openai`, `gemini`, `local`): use that provider
2. If `provider` is `auto`:
	- Check for `local.modelPath` â†’ use `local`
	- Check for OpenAI API key â†’ use `openai`
	- Check for Gemini API key â†’ use `gemini`
	- Otherwise: disabled

**Index Path Token Substitution**:

- `{agentId}` â†’ replaced with agent ID

**Sources Configuration**:

- `memory`: indexes `MEMORY.md`, `memory.md`, `memory/*.md`
- `sessions`: indexes session transcript JSONL files
- `experimental.sessionMemory: true` enables session indexing (same as `sources: ["sessions"]`)

**Sources**: [src/agents/memory-search.ts 1-143](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/memory-search.ts#L1-L143) [src/memory/manager.ts 1-112](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/memory/manager.ts#L1-L112) [docs/concepts/memory.md 1-180](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/memory.md#L1-L180) [src/config/types.tools.ts 224-324](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.tools.ts#L224-L324)

---

## Sandbox Configuration

Sandboxes provide Docker-based isolation for agent execution. Configuration controls when sandboxes are used, workspace access, and Docker runtime settings.

```
{
  agents: {
    defaults: {
      sandbox: {
        mode: "non-main", // off|non-main|all
        workspaceAccess: "rw", // none|ro|rw
        sessionToolsVisibility: "spawned", // spawned|all
        scope: "session", // session|agent|shared
        perSession: false, // deprecated: use scope instead
        workspaceRoot: null, // custom workspace root
        
        docker: {
          image: "ghcr.io/openclaw/sandbox:latest",
          containerPrefix: "openclaw-sandbox",
          workdir: "/workspace",
          readOnlyRoot: true,
          tmpfs: ["/tmp", "/run"],
          network: "none",
          user: "sandbox",
          capDrop: ["ALL"],
          env: {
            PATH: "/usr/local/bin:/usr/bin:/bin"
          },
          setupCommand: null, // run once per container creation
          pidsLimit: 512,
          memory: "512m",
          memorySwap: "1g",
          cpus: 1.0,
          ulimits: {
            nofile: { soft: 1024, hard: 2048 },
            nproc: 256
          },
          seccompProfile: null,
          apparmorProfile: null,
          dns: [],
          extraHosts: [],
          binds: [] // additional mounts
        },
        
        browser: {
          enabled: false, // enable sandbox browser
          image: "ghcr.io/openclaw/sandbox-browser:latest",
          containerPrefix: "openclaw-browser",
          cdpPort: 9222,
          vncPort: 5900,
          noVncPort: 6080,
          headless: true,
          enableNoVnc: false,
          allowHostControl: false,
          autoStart: false,
          autoStartTimeoutMs: 30000
        },
        
        prune: {
          idleHours: 24, // prune idle containers
          maxAgeDays: 7 // prune old containers
        }
      }
    }
  }
}
```

**Sandbox Mode**:

| Mode | Behavior |
| --- | --- |
| `off` | No sandboxing; agent runs on host |
| `non-main` | Sandbox non-main sessions (keys that don't match `session.mainKey`) |
| `all` | Sandbox all sessions |

**Workspace Access**:

| Mode | Behavior |
| --- | --- |
| `none` | No workspace access; isolated tmpfs |
| `ro` | Read-only workspace mount |
| `rw` | Read-write workspace mount |

**Sandbox Scope**:

| Scope | Behavior |
| --- | --- |
| `session` | One container per session key |
| `agent` | One container per agent (shared across sessions) |
| `shared` | One container shared across all agents |

**Sources**: [src/config/zod-schema.agent-runtime.ts 82-245](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.agent-runtime.ts#L82-L245) [docs/gateway/troubleshooting.md 242-256](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/troubleshooting.md#L242-L256)

---

## Channel Configuration

Channels are configured under the `channels` key, with each messaging platform as a subkey. Most channels support multiple accounts via an `accountId` pattern.

```
{
  channels: {
    whatsapp: {
      // Account-based (default account = "default")
      // Credentials stored in ~/.openclaw/credentials/whatsapp/{accountId}/
      dmPolicy: "pairing", // open|allowlist|pairing
      allowFrom: [], // phone numbers (required for open DMs)
      selfChatMode: false, // same-phone setup
      debounceMs: 500, // batch rapid messages
      groups: {
        "*": { // default policy for all groups
          requireMention: true,
          mentionPatterns: ["@openclaw"]
        },
        "specific-group-id": {
          requireMention: false
        }
      }
    },
    
    telegram: {
      botToken: "123456:ABC-DEF...", // Bot API token
      dmPolicy: "pairing",
      allowFrom: [],
      streamMode: "off", // off|partial|block (draft streaming)
      draftChunk: {
        minChars: 200,
        maxChars: 800,
        breakPreference: "paragraph" // paragraph|newline|sentence
      },
      retry: {
        attempts: 3,
        minDelayMs: 500,
        maxDelayMs: 4000,
        jitter: 0.1
      },
      network: {
        autoSelectFamily: null // true|false|null (override Node.js)
      },
      timeoutSeconds: 500,
      capabilities: {
        inlineButtons: true
      },
      groups: {
        "*": {
          requireMention: true
        }
      },
      customCommands: [], // extra bot menu commands
      commands: {
        native: "auto", // bool|"auto"
        nativeSkills: "auto"
      }
    },
    
    discord: {
      token: "Bot MTk...", // Bot token
      dm: {
        policy: "pairing"
      },
      allowFrom: [],
      retry: {
        attempts: 3,
        minDelayMs: 500,
        maxDelayMs: 4000,
        jitter: 0.1
      },
      maxLinesPerMessage: 30,
      intents: {
        presence: false,
        guildMembers: false
      },
      guilds: {
        "*": {
          requireMention: true
        }
      },
      commands: {
        native: "auto",
        nativeSkills: "auto"
      }
    },
    
    slack: {
      botToken: "xoxb-...",
      appToken: "xapp-...",
      userToken: null,
      userTokenReadOnly: false,
      dm: {
        policy: "pairing"
      },
      allowBots: false,
      thread: {
        historyScope: "thread", // thread|channel
        inheritParent: false
      },
      commands: {
        native: "auto",
        nativeSkills: "auto"
      }
    },
    
    signal: {
      account: "+15555550123",
      dmPolicy: "pairing",
      allowFrom: [],
      cliPath: "~/.openclaw/tools/signal-cli/bin/signal-cli",
      groups: {
        "*": {
          requireMention: true
        }
      }
    },
    
    imessage: {
      cliPath: "/usr/local/bin/imsg",
      dmPolicy: "pairing",
      allowFrom: [],
      groups: {
        "*": {
          requireMention: true
        }
      }
    },
    
    mattermost: {
      botToken: "...",
      baseUrl: "https://chat.example.com",
      chatmode: "oncall", // oncall|onchar|onmessage
      oncharPrefixes: [">", "!"],
      requireMention: true
    }
  }
}
```

**DM Policy Options**:

| Policy | Behavior |
| --- | --- |
| `open` | Accept all DMs (requires `allowFrom: ["*"]`) |
| `allowlist` | Only accept DMs from `allowFrom` list |
| `pairing` | Unknown senders get a pairing code; approve via `openclaw pairing approve` |

**Sources**: [src/config/schema.ts 294-346](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L294-L346) [src/config/schema.ts 367-661](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L367-L661) [docs/start/wizard.md 119-127](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L119-L127)

---

## Authentication and Models

Authentication profiles and model provider configurations control how the agent authenticates with AI services and which models are available.

```
{
  auth: {
    profiles: {
      "anthropic:main": {
        provider: "anthropic",
        mode: "apiKey",
        apiKey: "sk-ant-...",
        email: null,
        expiresAt: null
      },
      "openai:codex": {
        provider: "openai",
        mode: "oauth",
        accessToken: "...",
        refreshToken: "...",
        expiresAt: "2025-12-31T23:59:59Z",
        email: "user@example.com"
      }
    },
    
    order: {
      anthropic: ["anthropic:main", "anthropic:backup"],
      openai: ["openai:codex"]
    },
    
    cooldowns: {
      billingBackoffHours: 5,
      billingBackoffHoursByProvider: {
        anthropic: 3
      },
      billingMaxHours: 24,
      failureWindowHours: 24
    }
  },
  
  agents: {
    defaults: {
      models: {
        aliases: {
          "sonnet": "anthropic/claude-sonnet-4-20250514",
          "gpt5": "openai/gpt-5.2"
        },
        
        providers: {
          anthropic: {
            baseUrl: null,
            apiKey: null, // overrides profile
            headers: {},
            models: {}
          },
          openai: {
            baseUrl: null,
            apiKey: null,
            headers: {},
            models: {}
          },
          google: {
            baseUrl: "https://generativelanguage.googleapis.com",
            apiKey: null,
            headers: {},
            models: {}
          }
        }
      }
    }
  }
}
```

**Auth Profile Structure**:

| Field | Type | Purpose |
| --- | --- | --- |
| `provider` | string | Provider ID (anthropic, openai, google, etc) |
| `mode` | string | Auth mode (apiKey, oauth, token, setupToken) |
| `apiKey` | string? | API key (for apiKey mode) |
| `accessToken` | string? | OAuth access token |
| `refreshToken` | string? | OAuth refresh token |
| `expiresAt` | string? | ISO timestamp for token expiry |
| `email` | string? | Account email (for display/tracking) |

**Auth Order**:

The `auth.order` map controls failover: when a profile fails, the system tries the next profile in the list for that provider.

**Cooldowns**:

- `billingBackoffHours`: Base backoff duration when a profile fails due to billing/credits
- `billingMaxHours`: Cap for exponential backoff
- `failureWindowHours`: Time window for tracking failures (older failures expire)

**Sources**: [src/config/schema.ts 256-260](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L256-L260) [src/config/schema.ts 481-488](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L481-L488) [docs/start/wizard.md 84-106](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L84-L106)

---

## Session and Message Configuration

Session and message settings control conversation scoping, DM routing, and message acknowledgment behavior.

```
{
  session: {
    dmScope: "main", // main|per-peer|per-channel-peer|per-account-channel-peer
    identityLinks: {
      "user@example.com": [
        "telegram:123456789",
        "whatsapp:+15555550123"
      ]
    },
    agentToAgent: {
      maxPingPongTurns: 3 // max reply-back turns
    }
  },
  
  messages: {
    ackReaction: "ðŸ‘€", // emoji for ack (empty disables)
    ackReactionScope: "group-mentions", // group-mentions|group-all|direct|all
    inbound: {
      debounceMs: 500 // batch rapid messages from same sender
    }
  }
}
```

**DM Scope Options**:

| Scope | Behavior |
| --- | --- |
| `main` | All DMs share one session (continuity across channels) |
| `per-peer` | One session per peer (channel-agnostic) |
| `per-channel-peer` | One session per (channel, peer) |
| `per-account-channel-peer` | One session per (channel, account, peer) |

**Identity Links**:

Maps canonical identities to provider-prefixed peer IDs. When a message arrives from a linked peer, the session key uses the canonical identity instead, enabling cross-channel continuity.

**Sources**: [src/config/schema.ts 288-289](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L288-L289) [src/config/schema.ts 596-633](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L596-L633)

---

## Commands, UI, and Browser

```
{
  commands: {
    native: true, // register native commands (Discord/Slack/Telegram)
    nativeSkills: true, // register skill commands
    text: true, // allow text command parsing (slash)
    bash: false, // allow bash chat command (requires tools.elevated)
    bashForegroundMs: 2000,
    config: false, // allow /config chat command
    debug: false, // allow /debug chat command
    restart: false, // allow /restart and gateway restart tool
    useAccessGroups: false // enforce access-group policies
  },
  
  ui: {
    seamColor: "#FF5A2D", // accent color
    assistant: {
      name: "OpenClaw",
      avatar: null
    }
  },
  
  browser: {
    evaluateEnabled: false, // enable browser.evaluate
    snapshotDefaults: {
      mode: "aria" // aria|ai
    },
    remoteCdpTimeoutMs: 30000,
    remoteCdpHandshakeTimeoutMs: 10000
  }
}
```

**Sources**: [src/config/schema.ts 271-278](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L271-L278) [src/config/schema.ts 280-284](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L280-L284)

---

## Plugins and Skills

```
{
  plugins: {
    enabled: true,
    allow: null, // optional allowlist
    deny: [], // optional denylist
    load: {
      paths: [] // additional plugin files/dirs
    },
    slots: {
      memory: "memory-core" // active memory plugin (or "none")
    },
    entries: {
      "memory-core": {
        enabled: true,
        config: {}
      },
      "msteams": {
        enabled: false,
        config: {
          botId: "...",
          botPassword: "..."
        }
      }
    },
    installs: {
      // CLI-managed install metadata (updated by openclaw plugins install)
    }
  },
  
  skills: {
    load: {
      watch: true,
      watchDebounceMs: 1500
    },
    install: {
      nodeManager: "pnpm" // npm|pnpm|bun
    }
  }
}
```

**Plugin Slots**:

Slots provide exclusive assignments for certain capabilities:

- `memory`: memory search provider (default: `memory-core`, or `"none"` to disable)

**Sources**: [src/config/schema.ts 349-365](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L349-L365) [src/config/schema.ts 213-216](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L213-L216)

---

## Logging and Diagnostics

```
{
  logging: {
    level: "info", // error|warn|info|debug|trace
    file: "/tmp/openclaw/openclaw-{date}.log",
    rotation: {
      maxFiles: 7,
      maxAgeDays: 7
    },
    consoleLevel: "info",
    consoleStyle: "pretty" // pretty|compact|json
  },
  
  diagnostics: {
    enabled: false,
    flags: [], // targeted diagnostics (e.g. ["telegram.http"])
    otel: {
      enabled: false,
      endpoint: "http://localhost:4318",
      protocol: "http/protobuf",
      headers: {},
      serviceName: "openclaw",
      traces: true,
      metrics: true,
      logs: true,
      sampleRate: 1.0,
      flushIntervalMs: 5000
    },
    cacheTrace: {
      enabled: false,
      filePath: "~/.openclaw/logs/cache-trace.jsonl",
      includeMessages: true,
      includePrompt: true,
      includeSystem: true
    }
  }
}
```

**Sources**: [src/config/schema.ts 109-126](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L109-L126) [docs/gateway/troubleshooting.md 114-123](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/troubleshooting.md#L114-L123)

---

## Cron and Automation

```
{
  cron: {
    enabled: true,
    jobs: [
      {
        id: "daily-summary",
        enabled: true,
        schedule: {
          cron: "0 9 * * *" // or: at:"09:00", every:"1h"
        },
        action: {
          type: "message",
          target: "+15555550123",
          message: "Daily summary request"
        }
      },
      {
        id: "heartbeat-check",
        enabled: true,
        schedule: {
          every: "30m"
        },
        action: {
          type: "system-event",
          text: "Heartbeat check"
        }
      }
    ]
  }
}
```

**Sources**: [docs/cli/index.md 792-805](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/cli/index.md#L792-L805)

---

## Meta and Update

```
{
  meta: {
    lastTouchedVersion: "0.1.0",
    lastTouchedAt: "2025-01-15T10:30:00Z"
  },
  
  update: {
    channel: "stable", // stable|beta|dev
    checkOnStart: true
  }
}
```

**Sources**: [src/config/schema.ts 105-107](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/schema.ts#L105-L107)

---

## Configuration Validation

OpenClaw validates configuration on every load using Zod schemas. Invalid configuration causes the Gateway to refuse to start.

**Validation Failures**:

- Unknown keys
- Invalid types
- Missing required fields (when `gateway.mode` is set)
- Conflicting settings (e.g. `allow` and `alsoAllow` in same scope)

**Recovery**:

```
openclaw doctor           # report validation errors
openclaw doctor --fix     # apply automated repairs
```

**Sources**: [src/config/config.ts 13](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/config.ts#L13-L13) [docs/gateway/troubleshooting.md 423-440](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/troubleshooting.md#L423-L440)

---

## Configuration Precedence

Configuration is resolved from multiple sources with the following precedence (highest to lowest):

1. **Environment variables** (e.g. `OPENCLAW_GATEWAY_PORT`)
2. **openclaw.json** file
3. **System defaults**

Per-agent configuration follows inheritance:

1. **Agent-specific overrides** (`agents.list[].field`)
2. **Agent defaults** (`agents.defaults.field`)
3. **System defaults**

**Sources**: [src/config/runtime-overrides.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/runtime-overrides.ts) (inferred from architecture)

---

## Complete Example Configuration

```
{
  meta: {
    lastTouchedVersion: "0.1.0",
    lastTouchedAt: "2025-01-15T10:30:00Z"
  },
  
  update: {
    channel: "stable",
    checkOnStart: true
  },
  
  gateway: {
    mode: "local",
    port: 18789,
    bind: "loopback",
    auth: {
      mode: "token",
      token: "generated-by-wizard"
    },
    controlUi: {
      basePath: "",
      allowInsecureAuth: false
    },
    reload: {
      mode: "hybrid",
      debounceMs: 500
    }
  },
  
  agents: {
    defaults: {
      workspace: "~/.openclaw/workspace",
      bootstrapMaxChars: 20000,
      
      model: {
        primary: "anthropic/claude-sonnet-4-20250514",
        fallbacks: ["openai/gpt-4.5-turbo"]
      },
      
      memorySearch: {
        enabled: true,
        provider: "auto",
        sources: ["memory"]
      },
      
      tools: {
        profile: "coding",
        exec: {
          host: "sandbox",
          security: "allowlist"
        }
      },
      
      sandbox: {
        mode: "non-main",
        workspaceAccess: "rw"
      }
    },
    
    list: [
      {
        id: "main",
        default: true
      }
    ]
  },
  
  auth: {
    profiles: {
      "anthropic:main": {
        provider: "anthropic",
        mode: "apiKey",
        apiKey: "sk-ant-..."
      }
    },
    order: {
      anthropic: ["anthropic:main"]
    }
  },
  
  channels: {
    whatsapp: {
      dmPolicy: "pairing",
      groups: {
        "*": {
          requireMention: true
        }
      }
    }
  },
  
  session: {
    dmScope: "main"
  },
  
  messages: {
    ackReaction: "ðŸ‘€",
    ackReactionScope: "group-mentions"
  },
  
  commands: {
    native: true,
    text: true
  },
  
  plugins: {
    enabled: true,
    slots: {
      memory: "memory-core"
    }
  },
  
  logging: {
    level: "info",
    consoleLevel: "info"
  }
}
```

**Sources**: [docs/index.md 149-166](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/index.md#L149-L166) [docs/start/wizard.md 295-308](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/start/wizard.md#L295-L308)

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>