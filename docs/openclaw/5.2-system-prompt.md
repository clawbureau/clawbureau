Menu

## System Prompt

Relevant source files
- [docs/concepts/system-prompt.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/system-prompt.md)
- [docs/gateway/configuration-examples.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration-examples.md)
- [docs/gateway/configuration.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/configuration.md)
- [docs/gateway/sandbox-vs-tool-policy-vs-elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md)
- [docs/gateway/sandboxing.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/gateway/sandboxing.md)
- [docs/multi-agent-sandbox-tools.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/multi-agent-sandbox-tools.md)
- [docs/tools/elevated.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/elevated.md)
- [docs/tools/index.md](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/tools/index.md)
- [src/agents/bash-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bash-tools.ts)
- [src/agents/channel-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/channel-tools.ts)
- [src/agents/cli-runner.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/cli-runner.test.ts)
- [src/agents/cli-runner/helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/cli-runner/helpers.ts)
- [src/agents/pi-embedded-helpers.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers.ts)
- [src/agents/pi-embedded-runner.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.test.ts)
- [src/agents/pi-embedded-runner.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner.ts)
- [src/agents/pi-embedded-runner/compact.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/compact.ts)
- [src/agents/pi-embedded-runner/run.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run.ts)
- [src/agents/pi-embedded-runner/run/attempt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts)
- [src/agents/pi-embedded-runner/run/params.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/params.ts)
- [src/agents/pi-embedded-runner/run/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/types.ts)
- [src/agents/pi-embedded-runner/system-prompt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts)
- [src/agents/pi-embedded-subscribe.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-subscribe.ts)
- [src/agents/pi-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-tools.ts)
- [src/agents/sandbox.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/sandbox.ts)
- [src/agents/system-prompt-params.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.test.ts)
- [src/agents/system-prompt-params.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts)
- [src/agents/system-prompt-report.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts)
- [src/agents/system-prompt.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.test.ts)
- [src/agents/system-prompt.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts)
- [src/auto-reply/reply/commands-context-report.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/commands-context-report.ts)
- [src/commands/agent/run-context.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/agent/run-context.ts)
- [src/commands/agent/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/commands/agent/types.ts)
- [src/config/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/types.ts)
- [src/config/zod-schema.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/zod-schema.ts)
- [src/gateway/protocol/schema/agent.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/gateway/protocol/schema/agent.ts)
- [src/telegram/group-migration.test.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/group-migration.test.ts)
- [src/telegram/group-migration.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/telegram/group-migration.ts)

This document explains how OpenClaw constructs the system prompt for each agent run. The system prompt is assembled dynamically from configuration, workspace files, tool definitions, and runtime context.

For information about agent execution flow, see [Agent Execution Flow](https://deepwiki.com/openclaw/openclaw/5.1-agent-execution-flow). For session-level context and history management, see [Session Management](https://deepwiki.com/openclaw/openclaw/5.3-session-management).

---

## Overview

The system prompt in OpenClaw is **not** the default prompt from `pi-coding-agent`. Instead, OpenClaw builds a custom system prompt for every agent turn using the `buildAgentSystemPrompt` function [src/agents/system-prompt.ts 129-554](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L129-L554) This prompt includes:

- Available tools and their descriptions
- Workspace context files (AGENTS.md, SOUL.md, TOOLS.md, etc.)
- Skills (when available)
- Runtime information (host, OS, model, channel, capabilities)
- Sandbox status (when enabled)
- Current date/time (in user's timezone)
- Documentation paths
- Heartbeat and silent reply instructions

The prompt is intentionally **compact** and uses fixed sections to minimize token usage while providing necessary context.

**Sources:**[src/agents/system-prompt.ts 1-586](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L1-L586) [docs/concepts/system-prompt.md 1-122](https://github.com/openclaw/openclaw/blob/bf6ec64f/docs/concepts/system-prompt.md#L1-L122)

---

## System Prompt Construction Flow

```
OpenClawConfig
(openclaw.json)Workspace Directory
(agents.defaults.workspace)Tool Policy
(tools.allow/deny)Session Key
(agent:main:whatsapp:dm:...)buildSystemPromptParams()
src/agents/system-prompt-params.tsresolveBootstrapContextForRun()
src/agents/bootstrap-files.tsresolveSkillsPromptForRun()
src/agents/skills.tscreateOpenClawCodingTools()
src/agents/pi-tools.tsresolveSandboxContext()
src/agents/sandbox.tsbuildAgentSystemPrompt()
src/agents/system-prompt.ts:129System Prompt Sections:
‚Ä¢ Tooling
‚Ä¢ Skills
‚Ä¢ Memory
‚Ä¢ Workspace
‚Ä¢ Documentation
‚Ä¢ Sandbox
‚Ä¢ Time
‚Ä¢ Runtime
‚Ä¢ ReasoningBootstrap Files:
‚Ä¢ AGENTS.md
‚Ä¢ SOUL.md
‚Ä¢ TOOLS.md
‚Ä¢ IDENTITY.mdbuildEmbeddedSystemPrompt()
src/agents/pi-embedded-runner/system-prompt.tsrunEmbeddedAttempt()
Agent Execution
```

**Sources:**[src/agents/system-prompt.ts 129-554](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L129-L554) [src/agents/pi-embedded-runner/system-prompt.ts 9-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L9-L61) [src/agents/system-prompt-params.ts 1-133](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts#L1-L133)

---

## Prompt Modes

OpenClaw supports three prompt modes controlled by the `promptMode` parameter:

| Mode | Purpose | Sections Included | Use Case |
| --- | --- | --- | --- |
| `full` | Complete system prompt | All sections | Main agent, user-facing sessions |
| `minimal` | Reduced system prompt | Tooling, Workspace, Runtime only | Sub-agents spawned via `sessions_spawn` |
| `none` | Bare minimum | Basic identity line only | Reserved for future use |

The prompt mode is automatically determined at runtime:

- **Subagent sessions** (spawned via `sessions_spawn`): `minimal`
- **All other sessions**: `full`

[src/agents/pi-embedded-runner/run/attempt.ts 328](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts#L328-L328) determines the mode based on `isSubagentSessionKey(params.sessionKey)`.

### Sections Omitted in Minimal Mode

When `promptMode === "minimal"`, the following sections are excluded:

- Skills
- Memory Recall
- OpenClaw Self-Update
- Model Aliases
- User Identity
- Reply Tags
- Messaging
- Voice (TTS)
- Silent Replies
- Heartbeats
- Documentation

This keeps subagent prompts compact and focused on task execution.

**Sources:**[src/agents/system-prompt.ts 12-13](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L12-L13) [src/agents/system-prompt.ts 326-328](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L326-L328) [src/agents/system-prompt.test.ts 26-52](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.test.ts#L26-L52)

---

## Core System Prompt Sections

**Sources:**[src/agents/system-prompt.ts 330-553](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L330-L553)

### Section: Tooling

Lists all available tools with one-line summaries. Tool availability is filtered by:

1. Tool profile (`tools.profile`)
2. Provider-specific policy (`tools.byProvider`)
3. Global allow/deny (`tools.allow`, `tools.deny`)
4. Agent-specific policy (`agents.list[].tools`)
5. Group policy (for group chats)
6. Sandbox tool policy

Tool order is preserved from `toolOrder` array [src/agents/system-prompt.ts 211-235](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L211-L235):

```
read, write, edit, apply_patch, grep, find, ls, exec, process,
web_search, web_fetch, browser, canvas, nodes, cron, message,
gateway, agents_list, sessions_list, sessions_history, sessions_send,
session_status, image
```

Tools not in this order are appended alphabetically.

**Sources:**[src/agents/system-prompt.ts 237-271](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L237-L271) [src/agents/system-prompt.ts 182-208](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L182-L208)

### Section: Skills

Only included when `skillsPrompt` is present and not in minimal mode [src/agents/system-prompt.ts 15-33](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L15-L33)

Provides mandatory skill loading instructions:

```
Before replying: scan <available_skills> <description> entries.
- If exactly one skill clearly applies: read its SKILL.md at <location> with \`read\`, then follow it.
- If multiple could apply: choose the most specific one, then read/follow it.
- If none clearly apply: do not read any SKILL.md.
Constraints: never read more than one skill up front; only read after selecting.
```

The skills prompt itself (XML format with `<available_skills>`) is appended after the rules.

**Sources:**[src/agents/system-prompt.ts 15-33](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L15-L33)

### Section: Memory Recall

Only included when `memory_search` or `memory_get` tools are available [src/agents/system-prompt.ts 35-45](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L35-L45)

```
Before answering anything about prior work, decisions, dates, people, preferences, 
or todos: run memory_search on MEMORY.md + memory/*.md; then use memory_get to 
pull only the needed lines. If low confidence after search, say you checked.
```

**Sources:**[src/agents/system-prompt.ts 35-45](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L35-L45)

### Section: Workspace

Always included. States the working directory path:

```
Your working directory is: /path/to/workspace
Treat this directory as the single global workspace for file operations unless 
explicitly instructed otherwise.
```

Optional workspace notes (e.g., "Reminder: commit your changes in this workspace after edits.") are appended when bootstrap files are present.

**Sources:**[src/agents/system-prompt.ts 397-400](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L397-L400)

### Section: Sandbox

Only included when `sandboxInfo.enabled === true` [src/agents/system-prompt.ts 403-444](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L403-L444)

Describes:

- Sandbox runtime status
- Workspace directory and access mode (none/ro/rw)
- Agent workspace mount path
- Browser bridge URL (if sandbox browser enabled)
- noVNC observer URL (if available)
- Host browser control allowance
- Elevated exec availability and current level

Example:

```
You are running in a sandboxed runtime (tools execute in Docker).
Some tools may be unavailable due to sandbox policy.
Sandbox workspace: /tmp/sandboxes/session-abc123
Agent workspace access: ro (mounted at /agent)
Elevated exec is available for this session.
Current elevated level: ask (ask runs exec on host with approvals; full auto-approves).
```

**Sources:**[src/agents/system-prompt.ts 403-444](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L403-L444)

### Section: Runtime

Always included. Single-line runtime summary built by `buildRuntimeLine()` [src/agents/system-prompt.ts 556-585](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L556-L585):

```
Runtime: agent=main host=mbp-mario repo=/Users/mario/openclaw os=Darwin 23.6.0 (arm64) 
node=v20.11.0 model=anthropic/claude-sonnet-4-5 default_model=anthropic/claude-sonnet-4-5 
channel=telegram capabilities=inlineButtons thinking=off
```

Followed by reasoning visibility status:

```
Reasoning: off (hidden unless on/stream). Toggle /reasoning; /status shows Reasoning when enabled.
```

**Sources:**[src/agents/system-prompt.ts 547-551](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L547-L551) [src/agents/system-prompt.ts 556-585](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L556-L585)

---

## Bootstrap Files and Context Injection

Bootstrap files are workspace files that are **automatically loaded and injected** into the system prompt under the "# Project Context" section [src/agents/system-prompt.ts 497-514](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L497-L514)

### Default Bootstrap Files

OpenClaw searches for these files in the workspace directory (case-insensitive) [src/agents/bootstrap-files.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bootstrap-files.ts)):

- `AGENTS.md` - Agent identity and behavior guidelines
- `SOUL.md` - Persona and tone guidance
- `TOOLS.md` - Tool usage instructions
- `IDENTITY.md` - User/owner identity information

When `SOUL.md` is present, the prompt adds:

```
If SOUL.md is present, embody its persona and tone. Avoid stiff, generic replies; 
follow its guidance unless higher-priority instructions override it.
```

### Bootstrap Resolution Flow

```
resolveBootstrapContextForRun()
src/agents/bootstrap-files.tsWorkspace Directory
(effectiveWorkspace)OpenClawConfig
(agents.defaults.bootstrap)Load bootstrap files
(case-insensitive)Apply char limits
(resolveBootstrapMaxChars)getGlobalHookRunner()
bootstrap.filter hookcontextFiles[]
{ path, content }bootstrapFiles[]
{ name, path, missing }buildAgentSystemPrompt()
Inject under '# Project Context'
```

### Character Limits

Bootstrap files are capped at `DEFAULT_BOOTSTRAP_MAX_CHARS` (default: 65536 per file) [src/agents/pi-embedded-helpers/bootstrap.ts 13](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers/bootstrap.ts#L13-L13) Configure via:

```
{
  agents: {
    defaults: {
      bootstrap: {
        maxChars: 32768  // Override per-file limit
      }
    }
  }
}
```

### Custom Bootstrap Files

Add custom bootstrap files via config:

```
{
  agents: {
    defaults: {
      bootstrap: {
        files: [
          "AGENTS.md",
          "SOUL.md",
          "custom/GUIDELINES.md",
          "docs/CONTEXT.md"
        ]
      }
    }
  }
}
```

**Sources:**[src/agents/bootstrap-files.ts 1-302](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bootstrap-files.ts#L1-L302) [src/agents/pi-embedded-helpers/bootstrap.ts 1-190](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-helpers/bootstrap.ts#L1-L190) [src/agents/system-prompt.ts 497-514](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L497-L514)

---

## Tool Descriptions and Summaries

Tool descriptions appear in two places:

1. **System prompt** (Tooling section)
2. **Tool schemas** (JSON Schema descriptions sent to models)

### Built-in Tool Summaries

Core tool summaries are defined in `coreToolSummaries` [src/agents/system-prompt.ts 182-208](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L182-L208):

```
const coreToolSummaries: Record<string, string> = {
  read: "Read file contents",
  write: "Create or overwrite files",
  edit: "Make precise edits to files",
  apply_patch: "Apply multi-file patches",
  exec: "Run shell commands (pty available for TTY-required CLIs)",
  process: "Manage background exec sessions",
  browser: "Control web browser",
  canvas: "Present/eval/snapshot the Canvas",
  nodes: "List/describe/notify/camera/screen on paired nodes",
  cron: "Manage cron jobs and wake events (use for reminders...)",
  message: "Send messages and channel actions",
  gateway: "Restart, apply config, or run updates...",
  // ...
}
```

### External Tool Summaries

Plugin tools can provide summaries via `toolSummaries` parameter [src/agents/system-prompt.ts 237-257](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L237-L257):

```
const externalToolSummaries = new Map<string, string>();
for (const [key, value] of Object.entries(params.toolSummaries ?? {})) {
  const normalized = key.trim().toLowerCase();
  if (!normalized || !value?.trim()) continue;
  externalToolSummaries.set(normalized, value.trim());
}
```

### Tool Name Casing

Tool names preserve caller casing while deduping by lowercase [src/agents/system-prompt.ts 239-248](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L239-L248):

```
const canonicalByNormalized = new Map<string, string>();
for (const name of canonicalToolNames) {
  const normalized = name.toLowerCase();
  if (!canonicalByNormalized.has(normalized)) {
    canonicalByNormalized.set(normalized, name);
  }
}
```

This allows tools to be referenced as `Read`, `read`, or `READ` consistently.

**Sources:**[src/agents/system-prompt.ts 182-271](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L182-L271) [src/agents/tool-summaries.ts 1-82](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/tool-summaries.ts#L1-L82)

---

## Dynamic Context

### Time and Timezone

When `userTimezone` is provided, the system prompt includes [src/agents/system-prompt.ts 52-55](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L52-L55):

```
## Current Date & Time
Time zone: America/Chicago
```

Time formatting uses `formatUserTime()` [src/agents/date-time.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/date-time.ts) with support for 12-hour and 24-hour formats.

### Runtime Information

The runtime info is built by `buildSystemPromptParams()` [src/agents/system-prompt-params.ts 15-133](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts#L15-L133) and includes:

```
{
  agentId: "main",
  host: "mbp-mario",
  repoRoot: "/Users/mario/openclaw",
  os: "Darwin 23.6.0",
  arch: "arm64",
  node: "v20.11.0",
  model: "anthropic/claude-sonnet-4-5",
  defaultModel: "anthropic/claude-sonnet-4-5",
  channel: "telegram",
  capabilities: ["inlineButtons"],
  channelActions: ["reactions", "stickers", "polls", ...]
}
```

### Channel Capabilities

Channel capabilities are resolved per-provider [src/config/channel-capabilities.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/channel-capabilities.ts) and influence what the agent can do:

- `inlineButtons` - Inline buttons supported (Telegram)
- Other provider-specific capabilities

For Telegram, inline button scope is checked via `resolveTelegramInlineButtonsScope()` [src/agents/pi-embedded-runner/run/attempt.ts 249-260](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts#L249-L260)

### Reaction Guidance

For Telegram and Signal, reaction guidance level is included [src/agents/system-prompt.ts 470-492](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L470-L492):

```
## Reactions
Reactions are enabled for Telegram in MINIMAL mode.
React ONLY when truly relevant:
- Acknowledge important user requests or confirmations
- Express genuine sentiment (humor, appreciation) sparingly
- Avoid reacting to routine messages or your own replies
Guideline: at most 1 reaction per 5-10 exchanges.
```

**Sources:**[src/agents/system-prompt-params.ts 1-133](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts#L1-L133) [src/agents/system-prompt.ts 52-55](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L52-L55) [src/agents/system-prompt.ts 310-327](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L310-L327) [src/agents/system-prompt.ts 470-492](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L470-L492)

---

## Customization

### Extra System Prompt

The `extraSystemPrompt` parameter adds custom text to the prompt [src/agents/system-prompt.ts 464-469](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L464-L469):

```
if (extraSystemPrompt) {
  const contextHeader = promptMode === "minimal" 
    ? "## Subagent Context" 
    : "## Group Chat Context";
  lines.push(contextHeader, extraSystemPrompt, "");
}
```

This is used for:

- **Group chats**: Group-specific instructions
- **Subagents**: Spawner's task context

### Owner Numbers

Owner numbers are included in the User Identity section [src/agents/system-prompt.ts 47-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L47-L50):

```
## User Identity
Owner numbers: +15555550123, +447700900456. Treat messages from these numbers as the user.
```

### Message Tool Hints

Channel-specific message tool hints are resolved via `resolveChannelMessageToolHints()` [src/agents/channel-tools.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/channel-tools.ts) and added to the Messaging section [src/agents/system-prompt.ts 86-98](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L86-L98)

### TTS Hints

TTS hints are built by `buildTtsSystemPromptHint()` [src/tts/tts.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/tts/tts.ts) and added to the Voice section [src/agents/system-prompt.ts 106-111](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L106-L111)

**Sources:**[src/agents/system-prompt.ts 464-469](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L464-L469) [src/agents/system-prompt.ts 47-50](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L47-L50) [src/agents/system-prompt.ts 86-98](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L86-L98) [src/agents/system-prompt.ts 106-111](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L106-L111)

---

## System Prompt Override (Pi Agent Integration)

OpenClaw overrides the `pi-coding-agent` system prompt using `createSystemPromptOverride()` [src/agents/pi-embedded-runner/system-prompt.ts 1-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L1-L61):

```
export function createSystemPromptOverride(systemPromptText: string) {
  return (sdk: AgentSdk) => {
    return {
      system: [{ type: "text", text: systemPromptText, cache: false }],
      tools: sdk.tools,
    };
  };
}
```

This is applied in the agent run flow:

```
buildEmbeddedSystemPrompt()
Wrapper functionbuildAgentSystemPrompt()
Core system prompt buildercreateSystemPromptOverride()
Pi agent SDK overridecreateAgentSession()
Pi coding agentAgent Execution
```

The override is passed to `createAgentSession()` [src/agents/pi-embedded-runner/run/attempt.ts 457](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts#L457-L457):

```
const systemPromptOverride = createSystemPromptOverride(appendPrompt);
const session = createAgentSession(piAgent, {
  sessionManager: guardedSessionManager,
  systemPromptOverride,
  // ...
});
```

**Sources:**[src/agents/pi-embedded-runner/system-prompt.ts 1-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L1-L61) [src/agents/pi-embedded-runner/run/attempt.ts 454-468](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/run/attempt.ts#L454-L468)

---

## Inspection and Debugging

### /context Command

The `/context` command shows what's in the system prompt for the current session [src/auto-reply/reply/commands-context-report.ts 48-231](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/commands-context-report.ts#L48-L231)

Example output:

```
üìä System Prompt Report (session)

üîß Tooling (15 tools, ~450 tok)
üõ†Ô∏è Tools.md (~120 tok)
üìö Skills (3 skills, ~280 tok)
üìÑ Bootstrap (4 files, ~1.8k tok)
  - AGENTS.md (~800 tok)
  - SOUL.md (~600 tok)
  - TOOLS.md (~300 tok)
  - IDENTITY.md (~100 tok)

üì¶ Total: ~2.7k tokens
```

### System Prompt Report

The system prompt report is stored in session state [src/config/sessions/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions/types.ts#LNaN-LNaN):

```
export type SessionSystemPromptReport = {
  source: "run" | "command";
  timestamp?: number;
  sections: Array<{
    name: string;
    chars: number;
  }>;
  bootstrap?: Array<{
    path: string;
    chars: number;
  }>;
  tools?: Array<{
    name: string;
    chars: number;
  }>;
  skills?: {
    prompt: number;
    count: number;
  };
  totalChars: number;
};
```

### buildSystemPromptReport

The `buildSystemPromptReport()` function [src/agents/system-prompt-report.ts 1-172](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts#L1-L172) analyzes the system prompt and returns a breakdown:

```
export function buildSystemPromptReport(params: {
  systemPrompt: string;
  toolNames?: string[];
  contextFiles?: Array<{ path: string; content: string }>;
  skillsPrompt?: string;
}): SessionSystemPromptReport
```

**Sources:**[src/auto-reply/reply/commands-context-report.ts 1-231](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/auto-reply/reply/commands-context-report.ts#L1-L231) [src/agents/system-prompt-report.ts 1-172](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts#L1-L172) [src/config/sessions/types.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/config/sessions/types.ts#LNaN-LNaN)

---

## Summary of Key Functions

| Function | File | Purpose |
| --- | --- | --- |
| `buildAgentSystemPrompt` | [src/agents/system-prompt.ts 129-554](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L129-L554) | Core system prompt builder |
| `buildEmbeddedSystemPrompt` | [src/agents/pi-embedded-runner/system-prompt.ts 9-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L9-L61) | Wrapper for embedded runner |
| `buildSystemPromptParams` | [src/agents/system-prompt-params.ts 15-133](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts#L15-L133) | Gather runtime context |
| `buildSystemPromptReport` | [src/agents/system-prompt-report.ts 5-172](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts#L5-L172) | Analyze prompt sections |
| `createSystemPromptOverride` | [src/agents/pi-embedded-runner/system-prompt.ts 1-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L1-L61) | Pi agent SDK integration |
| `resolveBootstrapContextForRun` | [src/agents/bootstrap-files.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/bootstrap-files.ts) | Load bootstrap files |
| `resolveSkillsPromptForRun` | [src/agents/skills.ts](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/skills.ts) | Load skills prompt |
| `buildRuntimeLine` | [src/agents/system-prompt.ts 556-585](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L556-L585) | Format runtime info |

**Sources:**[src/agents/system-prompt.ts 1-586](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt.ts#L1-L586) [src/agents/pi-embedded-runner/system-prompt.ts 1-61](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/pi-embedded-runner/system-prompt.ts#L1-L61) [src/agents/system-prompt-params.ts 1-133](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-params.ts#L1-L133) [src/agents/system-prompt-report.ts 1-172](https://github.com/openclaw/openclaw/blob/bf6ec64f/src/agents/system-prompt-report.ts#L1-L172)

<svg id="mermaid-fu8dstus3vp" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 2412 512" style="max-width: 512px;" role="graphics-document document" aria-roledescription="error"><g></g><g><path class="error-icon" d="m411.313,123.313c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32-9.375,9.375-20.688-20.688c-12.484-12.5-32.766-12.5-45.25,0l-16,16c-1.261,1.261-2.304,2.648-3.31,4.051-21.739-8.561-45.324-13.426-70.065-13.426-105.867,0-192,86.133-192,192s86.133,192 192,192 192-86.133 192-192c0-24.741-4.864-48.327-13.426-70.065 1.402-1.007 2.79-2.049 4.051-3.31l16-16c12.5-12.492 12.5-32.758 0-45.25l-20.688-20.688 9.375-9.375 32.001-31.999zm-219.313,100.687c-52.938,0-96,43.063-96,96 0,8.836-7.164,16-16,16s-16-7.164-16-16c0-70.578 57.422-128 128-128 8.836,0 16,7.164 16,16s-7.164,16-16,16z"></path><path class="error-icon" d="m459.02,148.98c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l16,16c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16.001-16z"></path><path class="error-icon" d="m340.395,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688 6.25-6.25 6.25-16.375 0-22.625l-16-16c-6.25-6.25-16.375-6.25-22.625,0s-6.25,16.375 0,22.625l15.999,16z"></path><path class="error-icon" d="m400,64c8.844,0 16-7.164 16-16v-32c0-8.836-7.156-16-16-16-8.844,0-16,7.164-16,16v32c0,8.836 7.156,16 16,16z"></path><path class="error-icon" d="m496,96.586h-32c-8.844,0-16,7.164-16,16 0,8.836 7.156,16 16,16h32c8.844,0 16-7.164 16-16 0-8.836-7.156-16-16-16z"></path><path class="error-icon" d="m436.98,75.605c3.125,3.125 7.219,4.688 11.313,4.688 4.094,0 8.188-1.563 11.313-4.688l32-32c6.25-6.25 6.25-16.375 0-22.625s-16.375-6.25-22.625,0l-32,32c-6.251,6.25-6.251,16.375-0.001,22.625z"></path><text class="error-text" x="1440" y="250" font-size="150px" style="text-anchor: middle;">Syntax error in text</text> <text class="error-text" x="1250" y="400" font-size="100px" style="text-anchor: middle;">mermaid version 11.12.2</text></g></svg>