{
  "name": "clawbureau-trust-vnext",
  "project": "clawbureau",
  "description": "Trust vNext: verifier hardening, anti-replay, prompt integrity commitments, confidential consulting contracts/policies, sandbox attestations, and witnessed-web strategy.",
  "branchName": "ralph/trust-vnext",
  "userStories": [
    {
      "id": "CVF-US-021",
      "title": "Recompute event hashes in clawverify (fail-closed)",
      "description": "As a verifier, I want clawverify to recompute event hashes from canonical event headers so that tampered event chains cannot be used to claim higher trust tiers.",
      "acceptanceCriteria": [
        "For every event in event_chain, recompute event_hash_b64u per docs/roadmaps/proof-of-harness/ADAPTER_SPEC_v1.md",
        "Reject proof bundles where any event_hash_b64u mismatches the recomputed value",
        "Reject proof bundles where chain root no longer matches after recomputation",
        "Add unit tests covering tamper cases"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented recomputation of event_hash_b64u from canonical headers in services/clawverify/src/verify-proof-bundle.ts and added vitest coverage for tamper cases."
    },
    {
      "id": "CVF-US-022",
      "title": "Enforce envelope signer DID equals payload agent DID",
      "description": "As a verifier, I want the proof bundle envelope signer DID to match payload.agent_did so authorship/accountability cannot be swapped.",
      "acceptanceCriteria": [
        "If envelope.signer_did !== payload.agent_did, verification fails",
        "Add tests for mismatch cases"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented fail-closed check in services/clawverify/src/verify-proof-bundle.ts: envelope.signer_did must equal payload.agent_did. Added unit test coverage."
    },
    {
      "id": "CVF-US-023",
      "title": "Disable attestation tier uplift until signatures are verified",
      "description": "As a marketplace, I want attestations to only affect trust tiers when they are cryptographically verified against an allowlist of attesters.",
      "acceptanceCriteria": [
        "If attestations are present but not signature-verified, they do not increase trust tier",
        "Add an allowlist mechanism for attester DIDs (similar to gateway receipt signer allowlist)",
        "Add tests for shape-only attestations"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented allowlisted signature verification for proof bundle attestations (attester allowlist + JCS canonicalization + Ed25519). Added Env config ATTESTATION_SIGNER_DIDS and unit tests to ensure shape-only attestations do not uplift trust_tier."
    },
    {
      "id": "CVF-US-024",
      "title": "Strict JSON schema validation (Ajv) for proof bundles + receipts",
      "description": "As a verifier, I want strict schema validation so unknown fields, missing required fields, and type mismatches fail closed.",
      "acceptanceCriteria": [
        "Validate proof bundles, receipts, URM, and attestations using Ajv against schemas in packages/schema",
        "Fail closed on additionalProperties violations",
        "Return deterministic error codes for schema failures"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Added Ajv (draft 2020-12) schema validation for proof bundle envelopes and gateway receipt envelopes using schemas in packages/schema. Implemented Workers-safe Ajv *standalone* validators (no runtime new Function) and fail-closed SCHEMA_VALIDATION_FAILED errors with field paths derived from Ajv errors. Added unit tests for unknown-field rejection."
    },
    {
      "id": "CVF-US-025",
      "title": "Receipt numeric + size hardening",
      "description": "As a verifier, I want receipt fields to be strictly validated (finite numbers, bounded sizes) so attackers cannot bypass checks with NaN/Infinity or DoS the verifier.",
      "acceptanceCriteria": [
        "Reject NaN/Infinity/non-finite numeric fields (tokens, latency, etc.)",
        "Enforce max counts and byte-size limits for events/receipts/metadata",
        "Enforce uniqueness constraints for event_id and receipt_id within a bundle",
        "Add tests for edge cases"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Hardened receipt numeric validation (finite + integer + bounds) and proof bundle validation (max counts, metadata byte-size limits, and uniqueness checks for event_id + receipt_id). Added unit tests for Infinity/non-integer receipts, duplicate IDs, and oversized metadata."
    },
    {
      "id": "POH-US-013",
      "title": "Align trust tier semantics across PoH + marketplace",
      "description": "As a platform, I want consistent tier naming/meaning across clawverify outputs and marketplace requirements so automation gates are coherent.",
      "acceptanceCriteria": [
        "Define canonical tier labels (self, gateway-receipted, sandbox-attested, tee-attested, witnessed-web)",
        "clawverify outputs the canonical tier (or components + derived tier)",
        "docs/specs/agent-economy/MVP.md references the same tier definitions"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Added canonical marketplace-facing `proof_tier` to clawverify (bundle + agent endpoints) with aligned numeric `poh_tier` mapping (unknown=0, self=1, gateway=2, sandbox=3, tee=4, witnessed_web=5). Updated Agent Economy MVP spec tier definitions and added tests for gateway-tier bundles."
    },
    {
      "id": "CPX-US-031",
      "title": "Durable idempotency store for clawproxy",
      "description": "As a gateway, I want idempotency to be durable across instances so receipts cannot be replayed or duplicated across deploys.",
      "acceptanceCriteria": [
        "Replace in-memory idempotency with durable storage (KV/DO/D1/etc.)",
        "Same nonce returns same response/receipt only if request fingerprint matches",
        "Same nonce with different fingerprint fails closed",
        "Add tests for cross-instance semantics"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Replaced in-memory nonce cache with a per-nonce Durable Object idempotency store. Requests compute a stable fingerprint (provider URL + request body + binding fields + payment mode). Same nonce+fingerprint replays the stored response; different fingerprints fail closed; concurrent in-flight reuse returns 409. Added unit tests exercising lock/commit/replay/mismatch and simulated restart persistence."
    },
    {
      "id": "POH-US-014",
      "title": "Marketplace replay database",
      "description": "As a marketplace, I want to reject duplicate submissions that reuse run_id or receipt_id so trust tiers cannot be inflated via replay.",
      "acceptanceCriteria": [
        "Persist seen (agent_did, run_id) pairs and reject duplicates",
        "Persist seen (receipt_signer_did, receipt_id) pairs and reject duplicates",
        "Return deterministic error codes for replay rejection"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Implemented a marketplace replay DB in services/clawbounties: D1 migration adds replay_runs (agent_did, run_id) and replay_receipts (receipt_signer_did, receipt_id) with PK uniqueness. Submission handler reserves these keys for proof-bundle-VALID submissions and rejects duplicates with deterministic error codes (REPLAY_RUN_ID_REUSED / REPLAY_RECEIPT_ID_REUSED)."
    },
    {
      "id": "POH-US-015",
      "title": "URM materialization + CAS retrieval contract",
      "description": "As a verifier, I want URM bytes to be retrievable and hash-verified so URM references are meaningful and fail-closed.",
      "acceptanceCriteria": [
        "Verification either includes URM bytes or fetches them by URI",
        "Verifier computes resource_hash_b64u and compares to proof bundle reference",
        "Fail closed if URM bytes are missing/unfetchable"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Implemented URM materialization verification in clawverify: /v1/verify/bundle now accepts an optional `urm` document and fail-closed rejects bundles that contain a URM reference without providing the URM bytes. The verifier validates the URM against the strict schema (Ajv standalone), recomputes the SHA-256 hash (base64url), enforces binding (urm_id + agent_did + run_id when event_chain is valid), and compares to payload.urm.resource_hash_b64u. Marketplace (clawbounties) now forwards `urm` to clawverify and requires it when proof_bundle_envelope.payload.urm is present."
    },
    {
      "id": "POH-US-016",
      "title": "Prompt commitment evidence (OpenClaw)",
      "description": "As a marketplace/verifier, I want prompt-pack commitments and per-call rendered system prompt hashes so replay means evidence re-validation (not token reproduction) and prompt injection risk is reduced.",
      "acceptanceCriteria": [
        "Compute a prompt_root_hash_b64u over prompt-pack inputs",
        "Record rendered_system_prompt_hash_b64u per llm_call",
        "Persist commitments in URM and/or proof bundle metadata",
        "Add tests for determinism of hashing/canonicalization"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Implemented prompt commitment evidence as optional proof bundle metadata: `prompt_pack` + `system_prompt_report`. OpenClaw recorder now (a) computes prompt_root_hash_b64u over sorted prompt pack entry commitments (hash-only) and (b) computes rendered_system_prompt_hash_b64u per llm_call while stripping prompt plaintext from the hashed payload. clawverify validates these objects when present and fail-closed enforces bindings to (run_id + agent_did) and llm_call event references. Added determinism + mismatch test coverage."
    },
    {
      "id": "POH-US-017",
      "title": "New schema: system_prompt_report / prompt_pack",
      "description": "As a platform, I want versioned schemas for prompt commitments so they are verifiable and evolve safely.",
      "acceptanceCriteria": [
        "Add new schema(s) under packages/schema for prompt commitment objects",
        "Register schemas in clawverify schema registry",
        "Verifier validates prompt commitment objects when present"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Added versioned schemas: packages/schema/poh/prompt_pack.v1.json and packages/schema/poh/system_prompt_report.v1.json. Registered schema IDs in clawverify schema registry allowlist, generated Workers-safe Ajv standalone validators, and verifier validates these objects when present (fail-closed on schema/binding/hash mismatches)."
    },
    {
      "id": "CPX-US-032",
      "title": "Strict auth header mode (CST vs provider keys)",
      "description": "As a gateway, I want unambiguous header rules so CSTs and provider API keys cannot be confused or exploited.",
      "acceptanceCriteria": [
        "Define a strict mode where CST must be in a canonical header (e.g. X-CST)",
        "Provider keys must be in X-Provider-API-Key",
        "Reject ambiguous/mixed Authorization usages in strict mode",
        "Document behavior in docs/prds/clawproxy.md"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Implemented STRICT_AUTH_HEADERS mode in clawproxy to remove Authorization overload ambiguity, updated client integrations to send CST via X-CST, and documented strict vs default behavior."
    },
    {
      "id": "CCO-US-021",
      "title": "Work Policy Contract (WPC) registry API (signed policies)",
      "description": "As a platform, I want a signed policy registry so jobs can pin a WPC hash and gateways/verifiers can enforce it.",
      "acceptanceCriteria": [
        "Define a canonical WPC JSON shape + hashing (JCS + SHA-256)",
        "Implement create/read endpoints that return signed WPC envelopes",
        "Document how policy_hash is computed and validated"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Implemented signed WPC registry API in services/clawcontrols (POST/GET /v1/wpc) with canonical policy_hash_b64u = sha256(JCS(payload)), and added policy schemas under packages/schema/policy/."
    },
    {
      "id": "CWC-US-001",
      "title": "Confidential Work Contract (CWC) schema + signing",
      "description": "As a buyer and worker, I want a contract that pins tier requirements, egress limits, and policy hashes so confidential consulting is enforceable and verifiable.",
      "acceptanceCriteria": [
        "Define a versioned CWC schema (buyer signs, worker countersigns)",
        "CWC includes required tier, wpc_hash, disclosure/privacy mode, dispute terms",
        "Marketplace stores and enforces CWC hash at job post + submission time"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Added CWC v1 schemas (payload + envelope) under packages/schema/policy and integrated into clawbounties: post bounty accepts optional buyer-signed cwc_buyer_envelope for direct-hire, accept requires worker countersign cwc_worker_envelope (stored on the bounty), and submission enforces policy binding by requiring verified+bound gateway receipts to carry binding.policy_hash matching the pinned WPC hash."
    },
    {
      "id": "CEA-US-010",
      "title": "clawea sandbox attestation MVP",
      "description": "As a verifier, I want allowlisted sandbox attestations so sandbox-enforced runs can lift trust tiers beyond gateway receipts.",
      "acceptanceCriteria": [
        "Produce a signed execution attestation object bound to run_id",
        "Verifier validates signature and attester DID allowlist",
        "Tier uplift only happens when attestation is valid"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Done end-to-end. Links: clawea private PR #3 https://github.com/clawbureau/clawea/pull/3; clawbureau PR #104 https://github.com/clawbureau/clawbureau/pull/104; submodule bump PR #105 https://github.com/clawbureau/clawbureau/pull/105; smoke: scripts/poh/smoke-execution-attestation.mjs"
    },
    {
      "id": "POH-US-018",
      "title": "Witnessed-web receipts for subscription/web auth",
      "description": "As a platform, I want a credible path for subscription-web usage evidence (ChatGPT/Claude/Gemini web) that does not rely on a workerâ€™s local machine.",
      "acceptanceCriteria": [
        "Define a web_receipt schema and signed envelope type",
        "Introduce an allowlisted witness service that can sign web receipts",
        "Verifier recognizes web_receipt but does not equate it to gateway API receipts by default"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Shipped POH-US-018 end-to-end. Added schemas (`web_receipt.v1`, `web_receipt_envelope.v1`), golden fixture, strict Ajv standalone validation, verifier module (`verify-web-receipt.ts`), and endpoint `POST /v1/verify/web-receipt` with fail-closed signer allowlist (`WEB_RECEIPT_SIGNER_DIDS`). Verified semantics remain distinct from gateway receipts via `proof_tier=witnessed_web` and `equivalent_to_gateway=false`. Deployed clawverify staging/prod and passed smoke (`scripts/poh/smoke-web-receipt.mjs`) including tamper-invalid path."
    },
    {
      "id": "OCL-US-001",
      "title": "OpenClaw Airlock: trusted vs untrusted context partition",
      "description": "As a harness, I want buyer repos/uploads to be treated as untrusted data so they cannot modify system-prompt-authoritative context (bootstrap/skills/policy).",
      "acceptanceCriteria": [
        "Separate a trusted IdentityRoot (bootstrap/personality/skills) from an untrusted JobRoot (buyer repo/files)",
        "Disable bootstrap/skills auto-discovery for untrusted mounts in sensitive profiles",
        "Document the Airlock pattern in docs/integration/OPENCLAW_INTEGRATION.md"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Implemented Airlock guardrails in provider-clawproxy plugin config (`airlock` block): classify bootstrap files by IdentityRoot vs JobRoot, include only trusted roots in prompt-pack capture, and fail closed with `AIRLOCK_BOOTSTRAP_VIOLATION` when non-trusted bootstrap files are detected in sensitive mode (`requireTrustedBootstrap=true`). Added regression tests and integration docs for the pattern."
    },
    {
      "id": "OCL-US-002",
      "title": "OpenClaw: role-based directive authorization (buyer cannot change security)",
      "description": "As an operator, I want directives (/elevated, /exec, /model, etc.) to be applied only by authorized roles so buyers cannot downgrade security posture via prompt injection.",
      "acceptanceCriteria": [
        "Introduce directive authorization by role (operator vs buyer)",
        "Buyer messages cannot apply directives that affect tool/sandbox/security",
        "Add regression tests for directive parsing and authorization"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Implemented plugin-level directive authorization in provider-clawproxy (`directiveAuth` config): restricted directives are extracted from prompt/message text and evaluated against sender role allowlists. Buyer/unknown roles are fail-closed for restricted directives with deterministic denial codes (`DIRECTIVE_AUTH_ROLE_REQUIRED`, `DIRECTIVE_AUTH_DENIED`). Added regression tests for directive extraction, authorization evaluation, and before_agent_start rejection behavior."
    },
    {
      "id": "OCL-US-003",
      "title": "OpenClaw: Sensitive Consulting Profile preset",
      "description": "As a worker, I want a one-click preset for sensitive consulting that is safe-by-default (sandboxed, minimal tools, no network) and produces verifiable evidence.",
      "acceptanceCriteria": [
        "Ship a preset that sets sandbox.mode=all and minimal tool profile",
        "Disable skill binary auto-allow (autoAllowBins) in the sensitive profile",
        "Default deny browser/web/tools/sessions/message and raw network",
        "Document the preset + intended trust tier mapping"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Added sensitive preset artifact (`packages/openclaw-provider-clawproxy/presets/sensitive-consulting.openclaw.json`) with sandbox-all + network-none + minimal tool profile + denylist for browser/web/session/message/network groups. Added plugin `sensitiveProfile` checks to fail closed when any skill.json uses `autoAllowBins=true` (`SENSITIVE_PROFILE_SKILL_BIN_AUTOALLOW_FORBIDDEN`). Documented trust-tier mapping and preset usage in OpenClaw integration docs; added regression tests for preset constraints and sensitive-profile enforcement."
    },
    {
      "id": "POH-US-019",
      "title": "Streaming-safe shim for external harness CLIs",
      "description": "As an operator, I want the clawproof shim proxy to support streaming/SSE so external harnesses can reliably produce gateway-tier bundles.",
      "acceptanceCriteria": [
        "Shim forwards streaming responses without buffering entire bodies",
        "Receipts are extracted/attached in a deterministic way (e.g. final event or trailer object)",
        "Header injection (run_id/event_hash/idempotency) works for streaming flows",
        "Add smoke test coverage for at least one streaming harness/provider"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Implemented streaming pass-through in clawproxy + SSE trailer receipt comments; shim forwards SSE without buffering and captures receipts (with nonce receipt lookup fallback via GET /v1/receipt/:nonce)."
    },
    {
      "id": "POH-US-020",
      "title": "Pre-hash redaction middleware in PoH recorders/adapters",
      "description": "As a platform, we must redact secrets/PII before hashing event payloads or embedding URM metadata so proofs are safe to store/share and cannot leak credentials via future materialization/debugging.",
      "acceptanceCriteria": [
        "Implement a redaction utility (regex-based) ported from agentlog/redact.py",
        "clawproof-adapters recordEvent() redacts payload before computing payload_hash_b64u and event_hash_b64u",
        "OpenClaw recorder recordEvent() redacts payload before hashing",
        "URM metadata is redacted and bounded to verifier metadata limits",
        "Add unit tests covering common secret patterns (JWT, Bearer, sk-*, ghp_*, etc.)"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Implemented pre-hash redaction in packages/clawproof-adapters and packages/openclaw-provider-clawproxy (recorder). Added redaction utility modules and vitest coverage in clawproof-adapters. URM metadata is redacted and bounded to 16KB to avoid fail-closed verifier rejection."
    },
    {
      "id": "OCL-US-004",
      "title": "OpenClaw: Trust Pulse artifact + URM pointer (non-tier)",
      "description": "As a buyer and worker, I want a small, redacted, derived summary of run actions (tool names + file touches) visible for UX without exposing transcripts, and explicitly not affecting proof tiers.",
      "acceptanceCriteria": [
        "Generate a trust_pulse.v1 document (tools + relative file touches) as a self-reported artifact",
        "Attach a small pointer (schema + artifact hash + non-tier flags) into URM.metadata.trust_pulse",
        "Ensure no absolute paths or traversal segments are included in file paths",
        "Ensure trust pulse is bounded and redacted",
        "Verifier/marketplace must ignore trust pulse fields for proof tier computation"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Added packages/schema/poh/trust_pulse.v1.json. The clawproof adapter session + OpenClaw recorder now generate a Trust Pulse document, attach a trust_pulse pointer in URM metadata, and include the trust pulse hash as a URM output resource (self-reported, tier_uplift=false)."
    },
    {
      "id": "AGL-US-001",
      "title": "agentlog: local PoH verification badge (verify command)",
      "description": "As an OpenClaw user, I want a local command that tells me whether a run is verifiably gateway-tier (or not) using PoH artifacts (bundle+URM+receipts), without uploading transcripts.",
      "acceptanceCriteria": [
        "Add an agentlog verify subcommand that verifies a proof bundle + URM against clawverify",
        "Fail closed when URM is missing, receipts are untrusted, or bindings are invalid",
        "Output derived-only status (no transcript content)"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Implemented `agentlog verify` in /Users/gfw/code/agentlog/cli.py. The command discovers bundle+URM JSON artifacts (e.g. .clawproof/*-bundle.json + *-urm.json), calls clawverify /v1/verify/bundle with {envelope, urm}, and prints a derived-only VERIFIED/UNVERIFIED badge with proof_tier/trust_tier. Fail-closed on missing URM or verifier invalidation."
    },
    {
      "id": "CBT-US-022",
      "title": "clawbounties: Trust Pulse storage + auto-load viewer by submission",
      "description": "As a reviewer, I want Trust Pulse to be loadable by submission_id so I can review run context without manual paste/upload.",
      "acceptanceCriteria": [
        "POST /v1/bounties/{bounty_id}/submit accepts optional trust_pulse and stores it server-side",
        "Trust Pulse storage is bound to proof bundle context (run_id + agent_did) and authenticated worker_did",
        "If URM.metadata.trust_pulse.artifact_hash_b64u is present, enforce hash match (fail-closed)",
        "Add GET /v1/submissions/{submission_id}/trust-pulse (admin key OR owning worker token)",
        "/trust-pulse supports ?submission_id=sub_... and fetches via Authorization header (no URL tokens)"
      ],
      "priority": 24,
      "passes": true,
      "notes": "Implemented D1 table submission_trust_pulse + ingestion/binding checks, added GET retrieval endpoint, and updated /trust-pulse viewer to fetch by submission_id."
    },
    {
      "id": "CEA-US-049H",
      "title": "Requester scoped auth + simulation launcher for clawbounties requester-closure lane",
      "description": "As operations, we need fail-closed requester auth and staging simulation tooling so requester closure can be validated end-to-end with scoped CST/JWT identities.",
      "acceptanceCriteria": [
        "Replace temporary requester header auth for POST /v1/bounties, /approve, /reject with scoped requester CST/JWT introspection",
        "Keep legacy admin + x-requester-did path behind explicit compat flag (disabled by default in staging)",
        "Add deterministic auth errors for missing token, scope mismatch, and requester DID mismatch",
        "Add reviewer read endpoints for submissions with fail-closed auth",
        "Add clawea requester token broker endpoint with tenant/operator checks and audit event",
        "Add staging simulation launcher with parameterized run size and artifact output"
      ],
      "priority": 25,
      "passes": true,
      "notes": "Implemented scoped requester auth + usage logging in services/clawbounties, added reviewer endpoints + migration 0014_requester_auth_events.sql, added clawea endpoint POST /v1/billing/clawbounties/requester-token (operator-only) backed by clawscope issue flow with audit logs, and added scripts/clawbounties/smoke-requester-closure-simulation.mjs for real staging flow execution. Added staging route override for /v1/bounties* to prevent legacy route shadowing. Captured deterministic auth smoke evidence at artifacts/smoke/requester-auth/2026-02-11T19-25-45Z-staging/result.json and requester-closure simulation PASS evidence at artifacts/simulations/clawbounties-requester-closure/2026-02-11T19-20-52-597Z-staging-runs-3/result.json."
    },
    {
      "id": "ICP-US-001",
      "title": "Controller-first provisioning hard cutover",
      "description": "As identity operations, we need controller-first registration (owner->controller->agent) with owner-bound sensitive policy so token control can fail closed.",
      "acceptanceCriteria": [
        "Controller registration endpoint with signed owner challenge and deterministic error codes",
        "Agent registration under controller with deterministic chain persistence",
        "Owner-bound sensitive authorization policy update endpoint + read models"
      ],
      "priority": 26,
      "passes": true,
      "notes": "Delivered in `services/clawclaim/src/index.ts`: control-plane challenge endpoint, owner-signed controller registration, controller->agent registration, owner-bound sensitive policy update, and deterministic controller/agent read/list endpoints; later extended with lifecycle portability endpoints (rotation/transfer/export/import) and M5 identity productization flows. Test coverage: `services/clawclaim/test/control-plane.test.ts`, `services/clawclaim/test/claim-lifecycle-portability.test.ts`. Latest deploy versions: staging `2204a9ff-2376-4910-944c-8b517a526122`, prod `b2be579c-eb85-4c41-b3cd-80a439848368`; latest smoke artifacts: `artifacts/smoke/identity-control-plane/2026-02-11T23-49-28-476Z-staging-m5/result.json`, `artifacts/smoke/identity-control-plane/2026-02-11T23-49-48-765Z-prod-m5/result.json`."
    },
    {
      "id": "ICP-US-002",
      "title": "Canonical CST lane + migration gate",
      "description": "As platform security, we need canonical CST issuance bound to control chains while legacy exchange remains temporary and explicitly gated.",
      "acceptanceCriteria": [
        "Canonical issuance endpoint enforces owner/controller/agent chain checks for sensitive scopes",
        "Legacy issuance mode is explicitly configurable (enabled|migration|disabled) and deterministic for sensitive scope handling",
        "Sensitive-transition introspection matrix and key-rotation/revocation stream contract endpoints are available"
      ],
      "priority": 27,
      "passes": true,
      "notes": "Delivered in `services/clawscope/src/index.ts`: `POST /v1/tokens/issue/canonical`, migration-gated legacy `POST /v1/tokens/issue`, deterministic matrix endpoint `POST /v1/tokens/introspect/matrix`, revocation stream `GET /v1/revocations/stream`, key overlap contract `GET /v1/keys/rotation-contract`, and M5 observability/reporting route integration. Added canonical claim fields to `packages/schema/auth/scoped_token_claims.v1.json`. Latest deploy versions: staging `aa78cace-a561-4efe-908a-8696cbbc40f8`, prod `56b88b3f-7914-42dc-a680-a6a9b43f3d8d`; latest smoke artifacts: `artifacts/smoke/identity-control-plane/2026-02-11T23-49-28-476Z-staging-m5/result.json`, `artifacts/smoke/identity-control-plane/2026-02-11T23-49-48-765Z-prod-m5/result.json`; kid interop artifact: `artifacts/smoke/identity-control-plane/2026-02-11T22-43-00-300Z-kid-interop/result.json`."
    },
    {
      "id": "ICP-US-003",
      "title": "Verification APIs for control chain + token control",
      "description": "As integrators, we need deterministic verification APIs for owner/controller/agent chains and token-control semantics with remediation hints.",
      "acceptanceCriteria": [
        "Add one-call owner/controller/agent chain verification endpoint in clawverify",
        "Add token-control verification endpoint validating scope hash, aud/scope, exp, revocation and transition matrix decisions",
        "Responses include deterministic remediation hints"
      ],
      "priority": 28,
      "passes": true,
      "notes": "Delivered in `services/clawverify/src/index.ts` with new endpoints `POST /v1/verify/control-chain` and `POST /v1/verify/token-control` plus deterministic remediation hints. New verification modules: `verify-control-chain.ts`, `verify-token-control.ts`; tests: `test/control-chain.test.ts`, `test/token-control.test.ts`. Latest deploy versions: staging `c2602134-d6ad-4110-b71e-2837edf59082`, prod `8d79f1f9-1a97-4b61-a796-0d1622f0181e`; latest smoke artifacts: `artifacts/smoke/identity-control-plane/2026-02-11T22-42-34-634Z-staging/result.json`, `artifacts/smoke/identity-control-plane/2026-02-11T22-42-46-640Z-prod/result.json`."
    },
    {
      "id": "CCL-US-013",
      "title": "Owner-confirmed DID rotation continuity",
      "description": "As identity operations, we need owner-confirmed controller/agent DID rotation continuity so authorization chains survive key and DID migrations.",
      "acceptanceCriteria": [
        "Rotation confirm endpoint supports controller and agent roles with owner challenge signatures",
        "Alias records preserve continuity for controller/agent chain lookups",
        "Replay/idempotency outcomes are deterministic and fail-closed"
      ],
      "priority": 29,
      "passes": true,
      "notes": "Shipped in clawclaim via `POST /v1/control-plane/rotations/confirm` with alias persistence + alias-resolved chain reads. Coverage: `services/clawclaim/test/claim-lifecycle-portability.test.ts` and staging/prod smoke artifacts `.../2026-02-11T22-10-50-682Z-staging/` + `.../2026-02-11T22-11-02-225Z-prod/`."
    },
    {
      "id": "CCL-US-014",
      "title": "Controller transfer state machine + freeze semantics",
      "description": "As identity operations, we need deterministic transfer state transitions and transfer-pending mutation freeze semantics.",
      "acceptanceCriteria": [
        "Transfer request marks controller as transfer_pending",
        "Transfer confirm finalizes ownership + policy propagation",
        "Mutation paths fail closed while transfer_pending"
      ],
      "priority": 30,
      "passes": true,
      "notes": "Shipped in clawclaim with endpoints `POST /v1/control-plane/controllers/{controller_did}/transfer/request` and `/transfer/confirm`, plus deterministic freeze errors (`CONTROLLER_TRANSFER_FROZEN`). Validated in unit tests + staging/prod identity smoke."
    },
    {
      "id": "CCL-US-015",
      "title": "Signed identity export/import portability bundle",
      "description": "As platform operations, we need signed export/import portability bundles with tamper/stale checks and deterministic idempotency.",
      "acceptanceCriteria": [
        "Export emits signed bundle envelope with deterministic hash",
        "Import verifies bundle hash/signature/freshness and rejects tampered or stale bundles",
        "Import replay behavior is deterministic"
      ],
      "priority": 31,
      "passes": true,
      "notes": "Shipped in clawclaim with `POST /v1/control-plane/identity/export` and `/identity/import`, HMAC signing (`CLAIM_EXPORT_SIGNING_KEY`), deterministic import operation keys, and fail-closed tamper/stale checks. Added schema `packages/schema/identity/identity_export_bundle.v1.json`. Validated by unit tests + staging/prod identity smoke."
    },
    {
      "id": "CSC-US-016",
      "title": "Cross-environment kid interoperability",
      "description": "As operations, we need deterministic key interoperability so CST introspection does not fail with TOKEN_UNKNOWN_KID during overlap windows.",
      "acceptanceCriteria": [
        "Support verify-only overlap public keys without granting signing rights",
        "Expose kid diagnostics in introspection responses",
        "Validate staging<->prod introspection interoperability in smoke artifacts"
      ],
      "priority": 32,
      "passes": true,
      "notes": "Implemented via `SCOPE_VERIFY_PUBLIC_KEYS_JSON` and introspection `kid`/`kid_source` diagnostics in clawscope. Cross-env interop smoke: `artifacts/smoke/identity-control-plane/2026-02-11T22-43-00-300Z-kid-interop/result.json`."
    },
    {
      "id": "CSC-US-017",
      "title": "Rotation overlap contract v2",
      "description": "As integrators, we need deterministic overlap metadata for accepted key windows.",
      "acceptanceCriteria": [
        "Rotation contract includes signing/verify-only/expiring kid sets",
        "JWKS exposes accepted keys only",
        "Typecheck/tests pass"
      ],
      "priority": 33,
      "passes": true,
      "notes": "`GET /v1/keys/rotation-contract` upgraded to `contract_version=2` with `signing_kids`, `verify_only_kids`, `expiring_kids`; JWKS filtered to accepted keys."
    },
    {
      "id": "CSC-US-018",
      "title": "Deterministic kid error taxonomy",
      "description": "As downstream callers, we need stable kid-failure semantics for fail-closed automation.",
      "acceptanceCriteria": [
        "Unknown kid yields TOKEN_UNKNOWN_KID",
        "Expired overlap yields TOKEN_KID_EXPIRED",
        "Behavior documented for downstream consumers"
      ],
      "priority": 34,
      "passes": true,
      "notes": "Implemented deterministic `TOKEN_KID_EXPIRED` while preserving `TOKEN_UNKNOWN_KID`; consumed downstream by clawverify mapping and Agent C compatibility note."
    },
    {
      "id": "CVF-US-031",
      "title": "Verifier mapping for key-overlap failures",
      "description": "As downstream systems, we need token-control verification to map upstream kid failures deterministically.",
      "acceptanceCriteria": [
        "Map TOKEN_UNKNOWN_KID -> TOKEN_CONTROL_KEY_UNKNOWN",
        "Map TOKEN_KID_EXPIRED -> TOKEN_CONTROL_KEY_EXPIRED",
        "Typecheck/tests pass"
      ],
      "priority": 35,
      "passes": true,
      "notes": "Implemented in `services/clawverify/src/verify-token-control.ts`; covered by `services/clawverify/test/token-control.test.ts`."
    },
    {
      "id": "CVF-US-032",
      "title": "Verifier remediation semantics for key overlap",
      "description": "As operators, we need explicit remediation hints for key overlap failures.",
      "acceptanceCriteria": [
        "Provide deterministic reissue/sync hints for key errors",
        "Keep fail-closed verification status",
        "Typecheck/tests pass"
      ],
      "priority": 36,
      "passes": true,
      "notes": "Added deterministic remediation hints for key overlap mapping outcomes in token-control verification responses."
    },
    {
      "id": "CVF-US-033",
      "title": "Downstream compatibility contract for token key transitions",
      "description": "As integration teams, we need a stable compatibility contract for kid transition behavior and error handling.",
      "acceptanceCriteria": [
        "Publish compatibility note for Agent C",
        "Back guidance with staging/prod interop artifacts",
        "Keep contract deterministic"
      ],
      "priority": 37,
      "passes": true,
      "notes": "Compatibility guidance published in `scripts/identity/COMPATIBILITY-NOTE-AGENT-C-token-kid.md` + identity runbook, validated by `scripts/identity/smoke-scope-kid-interop.mjs` artifact set."
    },
    {
      "id": "CCL-US-016",
      "title": "M6 canonical issuance bootstrap via claim challenge/exchange",
      "description": "As identity operations, we need M6 conformance automation to obtain canonical CSTs through claim challenge/exchange flow without direct scope issuance assumptions.",
      "acceptanceCriteria": [
        "Conformance runner uses claim scoped-token challenge/exchange for canonical token bootstrap",
        "Dependency misconfiguration remains deterministic and fail-closed",
        "Staging/prod M6 conformance matrices pass with this issuance path"
      ],
      "priority": 38,
      "passes": true,
      "notes": "Implemented in `scripts/identity/run-identity-control-plane-m6-suite.mjs`; validated by staging/prod conformance artifacts: `artifacts/smoke/identity-control-plane/2026-02-12T00-52-18-553Z-staging/conformance-matrix.json`, `.../2026-02-12T00-52-32-525Z-prod/conformance-matrix.json`."
    },
    {
      "id": "CPX-US-017",
      "title": "M6 universal canonical CST enforcement in clawproxy",
      "description": "As trust operations, we need clawproxy to enforce canonical CST requirements consistently across staging/prod with deterministic failures.",
      "acceptanceCriteria": [
        "Proxy rejects missing legacy auth in strict canonical mode",
        "Canonical CST subject/chain consistency checks are enforced",
        "M6 conformance matrix shows legacy reject + canonical path behavior"
      ],
      "priority": 39,
      "passes": true,
      "notes": "Staging config key alignment deployed (`e6d6aa64-983b-40ad-bf45-92db7b4ce975`), production enforcement remained on (`21044cf8-d891-45f4-a1ef-ba5f05164603`). Evidence in M6 conformance matrices."
    },
    {
      "id": "CCO-US-022",
      "title": "M6 canonical token-control enforcement for clawcontrols writes",
      "description": "As policy governance, we need clawcontrols write APIs to require canonical CST verification through clawverify token-control contract.",
      "acceptanceCriteria": [
        "Legacy admin auth is rejected when canonical requirement flag is enabled",
        "Canonical token-control verification is required before WPC writes",
        "M6 conformance matrix validates legacy rejection and canonical acceptance"
      ],
      "priority": 40,
      "passes": true,
      "notes": "Deploys: staging `48dc04b6-24ae-4cde-917d-48fd0781ef48`, prod `0c6685f9-b82c-41fe-9d40-8b375f6bdde7`. Evidence in M6 conformance matrices."
    },
    {
      "id": "CSC-US-019",
      "title": "M6 key transparency + revocation SLO governance closure",
      "description": "As security operations, we need key transparency history/snapshot APIs and revocation SLO reporting as first-class runtime contracts.",
      "acceptanceCriteria": [
        "Signed transparency snapshots are queryable and auditable",
        "Revocation SLO report endpoint is protected and returns deterministic telemetry schema",
        "M6 ops suite reports pass in staging and prod"
      ],
      "priority": 41,
      "passes": true,
      "notes": "Deploys: staging `028de033-b1ac-45b5-82f5-904cd517e5b7`, prod `89b90fad-84da-4920-aceb-27d46c45256a`. Ops evidence: `artifacts/ops/identity-control-plane/2026-02-12T00-52-18-553Z-staging/deploy-summary.json`, `.../2026-02-12T00-52-32-525Z-prod/deploy-summary.json`."
    },
    {
      "id": "CVF-US-034",
      "title": "M6 transparency-aware token-control verification",
      "description": "As downstream enforcement systems, we need token-control verification to fail closed on stale/unknown/expired transparency key states.",
      "acceptanceCriteria": [
        "Transparency freshness and kid checks are enforced in token-control verification",
        "Deterministic transparency error taxonomy is returned",
        "M6 ops suite passes in staging and prod"
      ],
      "priority": 42,
      "passes": true,
      "notes": "Implemented in `services/clawverify/src/verify-token-control.ts`; validated by M6 suite pass across staging/prod deploy summaries."
    },
    {
      "id": "ICP-US-004",
      "title": "M6 conformance + DR evidence runner",
      "description": "As release operations, we need a single M6 suite that emits conformance, transparency, revocation SLO, and recovery drill artifacts with deploy versions.",
      "acceptanceCriteria": [
        "Runner writes conformance matrix, key transparency report, revocation SLO report, recovery drill report, and deploy summary",
        "Staging and prod runs produce pass=true deployment summaries",
        "Artifacts are saved under smoke/ops identity-control-plane directories with immutable timestamps"
      ],
      "priority": 43,
      "passes": true,
      "notes": "Runner: `scripts/identity/run-identity-control-plane-m6-suite.mjs`. Passing artifacts: staging `artifacts/ops/identity-control-plane/2026-02-12T00-52-18-553Z-staging/deploy-summary.json`, prod `artifacts/ops/identity-control-plane/2026-02-12T00-52-32-525Z-prod/deploy-summary.json`."
    }
  ],
  "metadata": {
    "updatedAt": "2026-02-12T01:07:00Z",
    "seededFrom": "docs/roadmaps/proof-of-harness/oracle/2026-02-07/next-building-blocks-plan.gpt-5.2-pro.md"
  }
}
