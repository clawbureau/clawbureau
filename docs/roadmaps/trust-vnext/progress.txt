## Codebase Patterns
- Trust vNext work is expected to span multiple services: clawverify, clawproxy, clawea, clwbounties/marketplace, and OpenClaw integration points.
- “Replay” should mean **evidence re-validation** + deterministic checks, not bit-identical LLM output reproduction.
- High trust tiers must be **fail-closed** and should not rely on trusting a worker’s local machine.

# Ralph Progress Log
Started: 2026-02-07T19:53:07Z
---

## 2026-02-07T19:53:07Z - Roadmap seeded (planning)
- What was implemented
  - Added a new roadmap folder: `docs/roadmaps/trust-vnext/`.
  - Seeded `prd.json` from the synthesis oracle:
    - `docs/roadmaps/proof-of-harness/oracle/2026-02-07/next-building-blocks-plan.gpt-5.2-pro.md`
  - Created this `progress.txt` for append-only progress tracking (Ralph compatible).
- Files changed
  - docs/roadmaps/trust-vnext/README.md
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
---

## 2026-02-07T23:19:57Z - CVF-US-021
- What was implemented
  - Hardened proof bundle verification by recomputing `event_hash_b64u` for every event using the canonical event header key order (ADAPTER_SPEC_v1 §4.2).
  - Fail-closed: proof bundles are rejected when any `event_hash_b64u` mismatches the recomputed value.
  - Added unit tests to ensure tampering is detected even if the chain links are internally consistent.
- Files changed
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/test/proof-bundle-event-hash.test.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
---

## 2026-02-07T23:22:57Z - CVF-US-022
- What was implemented
  - Enforced proof bundle authorship binding:
    - `envelope.signer_did` MUST equal `payload.agent_did`
  - Added unit test coverage to ensure a signature-valid bundle cannot claim a different `agent_did`.
- Files changed
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/test/proof-bundle-event-hash.test.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
---

## 2026-02-08T00:07:01Z - CVF-US-023
- What was implemented
  - Prevented fake/shape-only attestations from uplifting trust tiers.
  - Proof bundle attestations now only count when:
    - the attester DID is allowlisted (`ATTESTATION_SIGNER_DIDS`)
    - the signature verifies (Ed25519 over RFC8785 JCS canonical bytes with signature field blanked)
    - the attestation is bound to the bundle subject (`subject_did === payload.agent_did`)
- Files changed
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/src/index.ts
  - services/clawverify/src/verify-agent.ts
  - services/clawverify/src/types.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
---

## 2026-02-08T00:48:02Z - CVF-US-024
- What was implemented
  - Added Workers-safe Ajv (draft 2020-12) schema validation gates (standalone validators; no runtime codegen) for:
    - proof bundle envelopes
    - gateway receipt envelopes
  - Fail-closed behavior:
    - schema mismatches (including additionalProperties:false) return `SCHEMA_VALIDATION_FAILED`
    - response includes a deterministic `field` path derived from Ajv errors
  - Added/updated PoH schemas to support strict validation:
    - `packages/schema/poh/proof_bundle_envelope.v1.json`
    - `packages/schema/poh/gateway_receipt.v1.json`
    - `packages/schema/poh/gateway_receipt_envelope.v1.json`
    - tightened `proof_bundle.v1` receipt binding via `$ref` to `receipt_binding.v1.json`
  - Added unit tests to ensure unknown fields are rejected.
- Files changed
  - services/clawverify/src/schema-validation.ts
  - services/clawverify/src/schema-validators.generated.ts
  - services/clawverify/scripts/generate-schema-validators.mjs
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/src/verify-receipt.ts
  - services/clawverify/src/types.ts
  - services/clawverify/test/ajv-schema-validation.test.ts
  - packages/schema/poh/proof_bundle.v1.json
  - packages/schema/poh/gateway_receipt.v1.json
  - packages/schema/poh/gateway_receipt_envelope.v1.json
  - packages/schema/poh/proof_bundle_envelope.v1.json
  - packages/schema/README.md
  - packages/schema/prd.json
  - packages/schema/progress.txt
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
  - services/clawverify/package.json
  - services/clawverify/package-lock.json
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
---

## 2026-02-08T04:29:24Z - CVF-US-025
- What was implemented
  - Receipt numeric hardening in clawverify:
    - Reject non-finite numbers (NaN/Infinity) and non-integer counts for tokens/latency
    - Added reasonable upper bounds for tokens and latency
  - Proof bundle hardening:
    - Enforced max counts for event_chain/receipts/attestations
    - Enforced byte-size limits for metadata blobs (bundle metadata, URM metadata, receipt metadata)
    - Enforced uniqueness of event_id and receipt_id within a bundle (fail-closed)
  - Added unit tests for edge cases.
- Files changed
  - services/clawverify/src/verify-receipt.ts
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/test/receipt-numeric-hardening.test.ts
  - services/clawverify/test/proof-bundle-hardening.test.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
---

## 2026-02-08T23:25:48Z - POH-US-013
- What was implemented
  - Defined canonical proof tiers across verifier + marketplace docs.
  - `clawverify` now outputs `proof_tier` (canonical, marketplace-facing) on:
    - `POST /v1/verify/bundle`
    - `POST /v1/verify/agent`
  - `poh_tier` numeric mapping is now aligned to `proof_tier`:
    - `unknown=0, self=1, gateway=2, sandbox=3, tee=4, witnessed_web=5`
  - Updated `docs/specs/agent-economy/MVP.md` to reference the same tier definitions.
  - Added tests for gateway-tier bundles (valid receipt + binding) and for event-chain-only bundles.
- Files changed
  - services/clawverify/src/types.ts
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/src/verify-agent.ts
  - services/clawverify/src/index.ts
  - services/clawverify/test/proof-tier-gateway.test.ts
  - services/clawverify/test/proof-bundle-event-hash.test.ts
  - services/clawverify/test/proof-bundle-attestations.test.ts
  - docs/specs/agent-economy/MVP.md
  - docs/prds/clawverify.md
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
## 2026-02-08T23:44:30Z - CPX-US-031
- What was implemented
  - Replaced clawproxy in-memory nonce cache with a **durable idempotency store** using Durable Objects (one DO per nonce).
  - Enforced nonce fingerprinting:
    - same nonce + same fingerprint => replay stored response/receipt
    - same nonce + different fingerprint => fail closed
    - same nonce while in-flight => 409 (retry later)
  - Added a `wrangler.toml` DO binding + migration and wired `Env.IDEMPOTENCY`.
  - Added unit tests covering lock/commit/replay/mismatch and simulated restart persistence.
- Files changed
  - services/clawproxy/src/idempotency.ts
  - services/clawproxy/src/index.ts
  - services/clawproxy/src/types.ts
  - services/clawproxy/wrangler.toml
  - services/clawproxy/test/idempotency-do.test.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawproxy && npm test && npm run typecheck
---

## 2026-02-09T01:29:33Z - POH-US-014
- What was implemented
  - Added a D1 replay database for marketplace submissions:
    - `replay_runs`: unique (agent_did, run_id)
    - `replay_receipts`: unique (receipt_signer_did, receipt_id)
  - Submission flow now rejects replayed evidence:
    - Fail-closed binding: `proof_bundle_envelope.payload.agent_did` must match authenticated `worker_did`.
    - For proof-bundle-VALID submissions, reserve replay keys and reject duplicates with deterministic error codes:
      - `REPLAY_RUN_ID_REUSED`
      - `REPLAY_RECEIPT_ID_REUSED`
- Files changed
  - services/clawbounties/migrations/0008_marketplace_replay_db.sql
  - services/clawbounties/src/index.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawbounties && npm run typecheck
---

## 2026-02-09T03:43:25Z - POH-US-015
- What was implemented
  - Added **URM materialization** support (fail-closed) in `clawverify` bundle verification:
    - `POST /v1/verify/bundle` now accepts an optional `urm` document alongside the `envelope`.
    - If the proof bundle includes `payload.urm` (a URM reference), the request MUST provide the materialized URM document (`urm`) or verification returns INVALID (`URM_MISSING`).
    - Verifier validates URM with Workers-safe Ajv standalone validators (`urm.v1`), recomputes the URM hash (SHA-256 base64url), and compares it to `payload.urm.resource_hash_b64u`.
    - Enforces binding: `urm.urm_id`, `urm.agent_did`, and `urm.run_id` (when event_chain is valid) must match the bundle.
  - Updated marketplace (`clawbounties`) submission flow to forward and require URM materialization when the bundle includes a URM reference.
  - Hardened marketplace verifier client behavior to treat 422 verification responses as normal (invalid proofs), not dependency errors.
- Files changed
  - services/clawverify/scripts/generate-schema-validators.mjs
  - services/clawverify/src/schema-validators.generated.ts
  - services/clawverify/src/schema-validation.ts
  - services/clawverify/src/types.ts
  - services/clawverify/src/index.ts
  - services/clawverify/src/verify-proof-bundle.ts
  - services/clawverify/src/verify-agent.ts
  - services/clawverify/test/urm-materialization.test.ts
  - services/clawbounties/src/index.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawverify && npm test && npm run typecheck && npm run lint
  - cd services/clawbounties && npm run typecheck
---

## 2026-02-09T14:10:00Z - POH-US-019
- What was implemented
  - Added streaming/SSE support in `clawproxy` for requests with `stream:true`:
    - Upstream provider responses are forwarded as streams (no full buffering).
    - Response hashes are computed incrementally and used to issue signed gateway receipts.
    - Receipts are committed to the durable idempotency store (receipt-only marker for streaming) and also appended as SSE comment trailers for shim extraction.
  - Updated `@clawbureau/clawproof-adapters` shim to support streaming:
    - Detects streaming requests and forwards SSE from clawproxy without buffering.
    - Injects PoH binding headers (X-Run-Id/X-Event-Hash/X-Idempotency-Key) for streaming flows.
    - Captures canonical `_receipt_envelope` from clawproxy SSE trailer comments, strips them before returning to the harness, and falls back to deterministic nonce receipt lookup (`GET /v1/receipt/:nonce`) when needed.
- Files changed
  - services/clawproxy/src/index.ts
  - services/clawproxy/src/receipt.ts
  - services/clawproxy/package.json
  - services/clawproxy/package-lock.json
  - packages/clawproof-adapters/src/types.ts
  - packages/clawproof-adapters/src/session.ts
  - packages/clawproof-adapters/src/shim.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawproxy && npm test && npm run typecheck
  - cd packages/clawproof-adapters && npm run typecheck
---

## 2026-02-09T16:25:00Z - POH-US-020
- What was implemented
  - Added pre-hash redaction middleware (ported from agentlog/redact.py) to prevent secrets/PII from entering immutable PoH hashes:
    - `packages/clawproof-adapters` now redacts event payloads before computing `payload_hash_b64u` / `event_hash_b64u`.
    - OpenClaw harness recorder (`@openclaw/provider-clawproxy`) now redacts event payloads before hashing.
  - URM `metadata` is redacted and bounded to 16KB to avoid fail-closed verifier rejection.
- Files changed
  - packages/clawproof-adapters/src/redact.ts
  - packages/clawproof-adapters/src/session.ts
  - packages/clawproof-adapters/test/redact-and-trust-pulse.test.ts
  - packages/openclaw-provider-clawproxy/src/redact.ts
  - packages/openclaw-provider-clawproxy/src/recorder.ts
  - packages/openclaw-provider-clawproxy/src/types.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd packages/clawproof-adapters && npm run typecheck && npm test
  - cd packages/openclaw-provider-clawproxy && npm run typecheck
---

## 2026-02-09T16:26:00Z - OCL-US-004
- What was implemented
  - Implemented a small **Trust Pulse** artifact (self-reported, non-tier) that summarizes:
    - tool names used + counts
    - relative file paths touched + touch counts
  - Trust Pulse is:
    - redacted
    - bounded
    - explicitly marked `tier_uplift=false`
  - Producers attach a pointer to the Trust Pulse hash in `URM.metadata.trust_pulse`.
  - Added a versioned schema for the Trust Pulse document.
- Files changed
  - packages/schema/poh/trust_pulse.v1.json
  - packages/schema/README.md
  - packages/clawproof-adapters/src/session.ts
  - packages/clawproof-adapters/src/types.ts
  - packages/clawproof-adapters/src/cli.ts
  - packages/clawproof-adapters/test/redact-and-trust-pulse.test.ts
  - packages/openclaw-provider-clawproxy/src/types.ts
  - packages/openclaw-provider-clawproxy/src/recorder.ts
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd packages/clawproof-adapters && npm run typecheck && npm test
  - cd packages/openclaw-provider-clawproxy && npm run typecheck
---

## 2026-02-09T16:40:00Z - AGL-US-001
- What was implemented
  - Added a local PoH verification UX to `agentlog`:
    - New `agentlog verify <path>` subcommand discovers a proof bundle envelope + materialized URM JSON (e.g. `.clawproof/*-bundle.json` + `*-urm.json`).
    - Calls `POST /v1/verify/bundle` on `clawverify` with `{ envelope, urm }` and prints a derived-only VERIFIED/UNVERIFIED badge.
    - Fail-closed: missing URM or verifier invalidation returns UNVERIFIED and exit code 2.
- Files changed
  - (external repo) /Users/gfw/code/agentlog/cli.py
  - (external repo) /Users/gfw/code/agentlog/README.md
  - docs/roadmaps/trust-vnext/prd.json
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd /Users/gfw/code/agentlog && python3 -m unittest discover -s tests -q
---

## 2026-02-09T18:54:00Z - Trust Pulse marketplace: storage + auto-load viewer
- What was implemented
  - Added server-side storage for Trust Pulse (self-reported, non-tier) at bounty submission time:
    - `POST /v1/bounties/{bounty_id}/submit` accepts optional `trust_pulse`.
    - Enforces `tier_uplift=false`, binds to proof bundle context (`run_id` + `agent_did`), and validates against authenticated `worker_did`.
    - If URM contains `metadata.trust_pulse.artifact_hash_b64u`, enforces hash match (fail-closed).
  - Added auth-gated retrieval endpoint:
    - `GET /v1/submissions/{submission_id}/trust-pulse` (admin key OR owning worker token).
  - Updated public `/trust-pulse` viewer to fetch by `submission_id` (token via `Authorization` header; no URL tokens).
- Files changed
  - services/clawbounties/src/index.ts
  - services/clawbounties/migrations/0009_submission_trust_pulse.sql
  - services/clawbounties/progress.txt
  - docs/roadmaps/proof-of-harness/oracle/2026-02-09/* (Trust Pulse marketplace prompts/outputs)
  - docs/roadmaps/trust-vnext/progress.txt
- Quality checks
  - cd services/clawbounties && npm run typecheck
---

## 2026-02-09T17:16:38Z - POH-US-016/017 Prompt commitments (prompt_pack + system_prompt_report)
- What was implemented
  - Added prompt commitment evidence (hash-only, non-tier) to reduce prompt injection ambiguity:
    - `prompt_pack` (commitment over prompt-pack input hashes) with `prompt_root_hash_b64u`.
    - `system_prompt_report` (per-llm_call `rendered_system_prompt_hash_b64u`), bound to the proof bundle event chain.
  - OpenClaw recorder (`@openclaw/provider-clawproxy`) now:
    - Computes `rendered_system_prompt_hash_b64u` for llm_call events from the exact system prompt string.
    - Strips prompt plaintext from the hashed event payload (stores only the hash).
    - Optionally computes + embeds a `prompt_pack` from `promptPackEntries` at finalize time.
    - Embeds both objects into proof bundle `payload.metadata`.
  - clawverify now validates these objects when present (fail-closed):
    - Schema validation via Workers-safe Ajv standalone validators.
    - Recomputes + enforces `prompt_root_hash_b64u` against canonical entry list.
    - Enforces system_prompt_report bindings to (run_id + agent_did) and llm_call event references.
- Files changed
  - packages/schema/poh/prompt_pack.v1.json
  - packages/schema/poh/system_prompt_report.v1.json
  - packages/schema/README.md
  - packages/openclaw-provider-clawproxy/src/{types.ts,index.ts,recorder.ts}
  - services/clawverify/src/{verify-proof-bundle.ts,schema-validation.ts,schema-registry.ts,schema-validators.generated.ts,types.ts}
  - services/clawverify/scripts/generate-schema-validators.mjs
  - services/clawverify/test/prompt-commitments.test.ts
  - docs/roadmaps/trust-vnext/{prd.json,progress.txt}
- Quality checks
  - cd packages/openclaw-provider-clawproxy && npm run typecheck
  - cd services/clawverify && npm run typecheck && npm test
---

## 2026-02-10T00:38:35Z - CCO-US-021
- What was implemented
  - Implemented `clawcontrols` Work Policy Contract (WPC) registry API (signed policies):
    - `POST /v1/wpc` (admin-gated) creates a WPC addressed by `policy_hash_b64u = sha256(JCS(payload))` and returns a signed envelope.
    - `GET /v1/wpc/:policy_hash_b64u` fetches the previously created WPC envelope.
  - Added versioned schemas for WPC payloads + envelopes under `packages/schema/policy/`.
  - Updated clawcontrols PRD implementation status and moved the `clawcontrols.com/*` route off `claw-domains` to the new worker.
- Files changed
  - services/clawcontrols/*
  - packages/schema/policy/*
  - packages/schema/{README.md,progress.txt}
  - docs/prds/clawcontrols.md
  - services/claw-domains/wrangler.toml
  - docs/roadmaps/trust-vnext/{prd.json,progress.txt}
- Quality checks
  - cd services/clawcontrols && npm run typecheck && npm test
---

## 2026-02-10T03:00:00Z - CWC-US-001
- What was implemented
  - Added versioned schemas for Confidential Work Contracts (CWC):
    - `packages/schema/policy/confidential_work_contract.v1.json`
    - `packages/schema/policy/confidential_work_contract_envelope.v1.json`
  - Marketplace (clawbounties) now supports storing and enforcing a pinned CWC hash:
    - `POST /v1/bounties` accepts optional `cwc_buyer_envelope` for **direct-hire** bounties.
      - Verifies buyer signature and binds buyer/worker DIDs to the bounty.
      - Stores `cwc_hash_b64u` + `wpc_policy_hash_b64u` + required tier on the bounty.
    - `POST /v1/bounties/{id}/accept` requires `cwc_worker_envelope` countersign when a CWC is pinned.
      - Stores the worker countersign on the bounty.
    - `POST /v1/bounties/{id}/submit` enforces policy binding for otherwise-valid proofs:
      - Requires at least one **verified + run-bound** gateway receipt.
      - Requires `receipt.payload.binding.policy_hash` to match the pinned `wpc_policy_hash_b64u` on all verified+bound receipts.
  - OpenClaw provider-clawproxy plugin config expanded to support WPC headers:
    - `policyHashB64u`, `confidentialMode`, `receiptPrivacyMode`.
    - Sends `X-Policy-Hash` / `X-Confidential-Mode` / `X-Receipt-Privacy-Mode` to clawproxy.
- Files changed
  - packages/schema/policy/confidential_work_contract.v1.json
  - packages/schema/policy/confidential_work_contract_envelope.v1.json
  - packages/schema/bounties/post_bounty_request.v2.json
  - packages/schema/README.md
  - services/clawbounties/migrations/0010_confidential_work_contract.sql
  - services/clawbounties/src/index.ts
  - packages/openclaw-provider-clawproxy/openclaw.plugin.json
  - packages/openclaw-provider-clawproxy/src/{openclaw.ts,provider.ts,types.ts}
  - docs/roadmaps/trust-vnext/{prd.json,progress.txt}
- Quality checks
  - cd services/clawbounties && npm run typecheck
  - cd packages/openclaw-provider-clawproxy && npm run typecheck && npm test
---

## 2026-02-10T13:45:00Z - POH-US-021 (CWC job CST binding)
- What was implemented
  - Extended CWC enforcement with job-scoped CST bindings:
    - New D1 column `cwc_token_scope_hash_b64u` stores the expected deterministic scope hash.
    - `POST /v1/bounties/{id}/accept` computes/stores the expected hash and (best-effort) issues a clawscope CST, returned as `cwc_auth`.
    - New worker endpoint: `POST /v1/bounties/{id}/cst` issues/returns the CST for the accepted worker.
    - `POST /v1/bounties/{id}/submit` enforces `receipt.payload.binding.token_scope_hash_b64u` matches the expected value on verified+run-bound receipts.
- Files changed
  - services/clawbounties/migrations/0011_cwc_job_cst.sql
  - services/clawbounties/src/index.ts
  - docs/roadmaps/proof-of-harness/oracle/2026-02-10/*
- Quality checks
  - cd services/clawbounties && npm run typecheck
---

## 2026-02-10T17:30:00Z - POH-US-022 (job CST binding for non-CWC)
- What was implemented
  - Generalized receipt non-transferability beyond CWC bounties:
    - New bounty field `job_token_scope_hash_b64u` stores deterministic expected v1 scope hash.
    - On acceptance, marketplace computes/persists job scope hash for `min_proof_tier != self` bounties.
    - `/v1/bounties/{id}/cst` now supports non-CWC bounties and returns `job_auth`.
    - Submission verification enforces `binding.token_scope_hash_b64u` on verified+bound gateway receipts matches the expected job hash when configured.
  - Updated worker harness tooling to accept either `cwc_auth` or `job_auth` CST response shapes.
- Files changed
  - services/clawbounties/migrations/0012_job_cst_binding.sql
  - services/clawbounties/src/index.ts
  - packages/clawproof-adapters/src/cli.ts
  - packages/openclaw-provider-clawproxy/src/index.ts
  - scripts/poh/smoke-cwc-job-cst-binding.mjs
- Quality checks
  - cd services/clawbounties && npm run typecheck
  - cd packages/clawproof-adapters && npm run typecheck && npm test
  - cd packages/openclaw-provider-clawproxy && npm run typecheck
---

## 2026-02-10T19:15:00Z - CPX-US-036 (OpenRouter-through-fal via clawproxy)
- What was implemented
  - Added fal OpenRouter router support to clawproxy for OpenAI-compatible endpoints:
    - Routing selector: when request body `model` starts with `openrouter/`, clawproxy routes the request to:
      - base: `https://fal.run/openrouter/router/openai/v1`
      - endpoints: `/chat/completions` and `/responses` (OpenAI-compatible)
    - Upstream auth is enforced as `Authorization: Key <FAL_KEY>` (not Bearer).
    - clawproxy strips the leading `openrouter/` prefix from the upstream request body `model` value, but keeps the original model string in the receipt for auditability.
    - Fail-closed: platform-paid mode is not allowed for `openrouter/*` models.
    - Receipts include `metadata.upstream = "fal_openrouter"` and `metadata.upstream_model` for auditability.
  - Improved harness tooling test coverage:
    - Added unit tests for marketplace `/cst` response parsing (supports `cwc_auth` and `job_auth`).
    - OpenClaw clawproxy provider now routes `openrouter/*` models via `/v1/proxy/openai`.
- Files changed
  - services/clawproxy/src/providers.ts
  - services/clawproxy/src/index.ts
  - services/clawproxy/test/providers.test.ts
  - packages/openclaw-provider-clawproxy/src/{provider.ts,index.ts,marketplace-cst.ts}
  - packages/openclaw-provider-clawproxy/test/{marketplace-cst.test.mjs,openrouter-routing.test.mjs}
  - packages/openclaw-provider-clawproxy/package.json
  - packages/clawproof-adapters/src/{cli.ts,marketplace-cst.ts}
  - packages/clawproof-adapters/test/marketplace-cst.test.ts
- Quality checks
  - cd services/clawproxy && npm run typecheck && npm test
  - cd packages/openclaw-provider-clawproxy && npm run typecheck && npm test
  - cd packages/clawproof-adapters && npm run typecheck && npm test
---
