# Gemini Deep Think Review — Round 2: The Enterprise Moat (2026-02-12)

> Canonical architectural decisions for the Notary Architecture, Round 2.
> Generated by Gemini Deep Think in response to 5 hard problems on product moat and enterprise architecture.
> These decisions are binding unless explicitly superseded.

---

## Problem 6: The Incumbent Threat (Model Providers Building Verification)

**Decision: The Causality Moat — Execution Provenance, Not Intelligence Verification**

Incumbents have a structural blind spot: Models do not execute code.

### What Clawsig Proves That Incumbents Cannot

Anthropic can cryptographically prove that Claude *output* a specific `bash` command. But Anthropic **cannot** prove that the `bash` command was actually executed on the user's host, what the `stdout` was, or what files were modified as a side effect.

Clawsig's moat is not proving the intelligence; it is proving the **Execution Provenance**. Clawsig binds the Model (M), the Tools (T), and the Side-Effects (S) into a single cryptographic chain. OpenAI provides half the puzzle (intent). Clawsig provides the cryptographic lock between intent and impact.

### Auditor Independence

The Deloitte analogy holds perfectly, with a sharp edge: **Liability**. When an AI agent accidentally drops a production database or leaks PII, the enterprise must assign liability. If OpenAI provides the agent, the gateway, *and* the verification, they are marking their own homework. In a GRC context, self-attestation is an inherent conflict of interest. Enterprises *require* a neutral third-party oracle.

### Multi-Provider Orchestration

Enterprise AI is moving to multi-agent, multi-model routing (Claude for coding, GPT-4o for reasoning, local LLaMA for PII redaction). No single incumbent can verify a cross-vendor workflow. Clawsig's structural advantage is that the `proof_bundle` acts as the universal aggregator.

### Standards Body Play and Time Horizon

| Timeframe | Action |
|-----------|--------|
| 0-6 months | Embed `@clawbureau/clawsig-sdk` into LangChain, AutoGPT, CrewAI, Vercel AI SDK. Make `.clawsig` the default export format before Microsoft/OpenAI forces a proprietary one. |
| 6-18 months | Form the **Agent Verification Alliance (AVA)**. Put CISOs and GRC vendors (Vanta, Drata) on the board, NOT model providers. |
| 18+ months | Donate the specification to Linux Foundation or CNCF. Claw Bureau retains `clawea.com` (commercial) and `clawverify.com` (oracle). Become the "Red Hat" of agentic trust. |

---

## Problem 7: WPC Policy Language — Expressiveness vs. Verifiability

**Decision: AWS IAM-style JSON DSL (v1) → AWS Cedar (v2)**

### Policy Language Survey

| Language | Expressiveness | Verifiability | Recommendation |
|----------|---------------|---------------|----------------|
| JSON Schema (current) | 3/10 | 10/10 | Too weak for CISOs |
| OPA/Rego | 9/10 | 4/10 | Heavy, slow, non-deterministic |
| AWS Cedar | 8/10 | 9/10 | Excellent but needs WASM runtime |
| **IAM-style JSON DSL** | **7/10** | **9/10** | **v1 recommendation** |

For v1, build a custom JSON DSL modeled on AWS IAM (`Effect`, `Action`, `Resource`, `Condition`). Universally understood by DevOps. Blazing-fast, 100% deterministic offline evaluator in TypeScript.

### Enterprise Policy Encoding Examples

| CISO Request | WPC Implementation |
|---|---|
| No prod DB access off-hours | `Condition: { "NumericLessThan": { "Context:Hour": "18" } }` |
| Human approval for secrets | `Action: "side_effect:filesystem_write", Resource: "**/secrets/**", Condition: { "Bool": { "Context:HasHumanApproval": true } }` |
| Max $50 spend per task | Cannot do offline (stateful). WPC caps `max_tokens_per_call`; global tracking requires `clawproxy` or x402 state. |

### Composability: Strict Intersection

CISOs demand **Strict Intersection** (deny by default, bound by parent). If the Global Org WPC says "No network egress outside *.internal", a Repo-level WPC cannot override this to allow "github.com". The verifier evaluates `Parent && Child`. Child policies can only narrow constraints.

### The Killer Policy: Blast Radius Auto-Escalation

"This agent is authorized to read the entire codebase to fix a bug, but the WPC cryptographically guarantees it made zero outbound network requests and only wrote to `src/fix.ts`. If it attempts to touch `package.json` or reach out to AWS, execution pauses and requires a `HumanApprovalReceipt` from a CODEOWNER."

---

## Problem 8: Multi-Agent Orchestration Verification

**Decision: Merkle DAG via Delegation Receipts + Strict Liability Cascade**

### Bundle Composition (The Merkle DAG)

Do not shove all agents into one event chain. Create a DAG using a new primitive: the `delegation_receipt`.

When Agent A (Manager) delegates to Agent B (Worker):
1. Agent B completes work and generates `proof_bundle_B`.
2. Agent A receives it, hashes it (`bundle_hash_B`), and embeds that hash inside a `delegation_receipt` in its own event chain.

The Orchestrator's proof bundle acts as the Merkle Root.

### Cross-Agent Trust and Blame (Strict Liability)

If Manager A delegates to Worker B, and Worker B violates the policy (uses GPT-4 instead of Claude):
- Worker B's bundle is INVALID.
- Because Manager A's event chain relies on Worker B's bundle hash, **Manager A's bundle also becomes INVALID**.

Blame cascades up. The Orchestrator is strictly liable for the supply chain of its delegates. It is the orchestrator's cryptographic obligation to verify its subordinates' bundles offline before merging their output.

### Temporal Ordering (Causal Time via Hash Links)

Do not rely on wall-clock timestamps across distributed agents — clocks drift. Use **Lamport Causal Ordering via Hash Links**.

Worker B cannot sign its bundle until it finishes. Manager A must include Worker B's `bundle_hash_b64u` in its own event chain. Therefore, Worker B must have completed before Manager A resumed. Cryptography enforces time.

### Swarm Verification Scope

If 10 agents compete and the orchestrator picks 1, **only the bundle of the selected agent matters**. Verification scope is strictly the **Causal Path** that led to the final committed side-effect.

---

## Problem 9: Enterprise Compliance Mapping

**Decision: SOC2 is the Wedge, EU AI Act is the Whale, Vanta/Drata Partnership is the Channel**

### SOC2 Type II Mapping

| SOC2 Control | Clawsig Evidence |
|---|---|
| CC6.1 (Logical Access) | WPC (`allowed_models`, `minimum_model_identity_tier`). Proves agent only used approved intelligence. |
| CC6.2 (System Boundaries) | `side_effect_receipt` (Network Egress). Cryptographically proves exactly what IPs the agent communicated with. |
| CC7.1 (Detection of Changes) | `tool_receipt` + event chain. Immutable log of every file the agent touched. |
| CC7.2 (Monitoring) | Receipt Transparency Log. Every agent action is logged to an append-only Merkle tree. |
| CC8.1 (Change Management) | "Claw Verified" GitHub App. The `proof_bundle.json` replaces traditional human peer review by proving the code was generated under policy. |

### EU AI Act Article 14 (Human Oversight) Narrative

"Claw Bureau provides the industry's only cryptographic proof of Article 14 compliance. High-risk actions are mathematically locked until a `HumanApprovalReceipt` is signed by a verified operator. The offline verifier guarantees no autonomous deployment can bypass this oversight."

### Compliance Export Schema

New export from `clawverify`: `GET /v1/verify/bundle?compliance_framework=soc2`

```json
{
  "report_version": "1",
  "framework": "SOC2_Type2",
  "proof_bundle_hash_b64u": "abc...",
  "controls": [
    {
      "control_id": "CC8.1",
      "status": "PASS",
      "evidence_ref": "human_approval_receipt:req_123",
      "narrative": "Cryptographic proof of human review obtained prior to side-effect execution."
    }
  ]
}
```

### Partnership Strategy

Partner with Vanta or Drata. If Vanta ingests this JSON to automatically pass SOC2 audits, Clawsig becomes mandatory infrastructure overnight.

---

## Problem 10: Gateway Key Compromise (The Existential Threat)

**Decision: Mandatory Receipt Transparency (RT) Log + Ephemeral Worker Keys**

### The Ultimate Defense: Receipt Transparency

Cannot solve this by hiding the key better. Solve by making a stolen key **useless**.

Elevate `clawlogs` from optional audit sink to **Mandatory Receipt Transparency (RT) Log** (like Certificate Transparency for TLS).

1. Every time `clawproxy` signs a `gateway_receipt`, it **synchronously** submits the receipt hash to the `clawlogs` Merkle tree.
2. `clawverify` is updated: A gateway receipt is **INVALID** if it does not contain a valid `log_inclusion_proof`.

**Why this defeats key compromise:** If an attacker steals the `clawproxy` key today and forges a receipt for a malicious PR dated 3 months ago, they cannot insert it back in time into the transparency log. The verifier sees a valid signature but no inclusion proof, and flags it as a forgery.

### Ephemeral Worker Keys

- Root Key lives offline in AWS KMS / HashiCorp Vault.
- Every 24 hours, the Root Key signs a `did_rotation.v1.json` certificate delegating authority to a new, ephemeral Ed25519 key injected into Cloudflare Workers.
- If the Worker key is dumped from memory, it is only valid for 24 hours.

### Compromise Detection and Recovery

**Detection:** Cron job reading the RT log. If a receipt appears for a tenant that didn't initiate a run, the key is burned.

**Recovery (The Epoch Cutoff):**
1. Revoke the compromised `kid` in `clawscope`'s JWKS.
2. Because of the Receipt Transparency Log, we do not have to invalidate all historical receipts.
3. Any receipt signed by the compromised key remains valid **IF AND ONLY IF** its `log_inclusion_proof` timestamp places it in a Merkle root published before the exact minute the compromise was detected.

---

## Execution Sequence (Gemini Recommended Priority)

| Priority | Problem | Action | Affects |
|----------|---------|--------|---------|
| 1 | P10 (Security) | Elevate `clawlogs` to RT. Enforce `log_inclusion_proof` in `clawverify-core`. Signature without transparency no longer achieves `gateway` tier. | clawlogs, clawverify-core, clawproxy |
| 2 | P9 (Revenue) | Ship `compliance_report.v1.json` generator in CLI. Translates math into SOC2 checkmarks. | clawverify-cli, new schema |
| 3 | P8 (Orchestration) | Ship `delegation_receipt` schema for Merkle DAG bundle composition. | schema, SDK, clawverify-core |
| 4 | P6 (Adoption) | Supply-side infiltration: PRs to LangChain, Vercel AI SDK, CrewAI integrating `clawsig-sdk`. | External repos |
| 5 | P7 (Policy) | Transition WPC to IAM-style JSON AST for Blast Radius policies without sacrificing offline verifiability. | schema, clawverify-core, GitHub App |

---

## Cross-Cutting Decisions Summary

| Decision | Binding? | Affects |
|----------|----------|---------|
| Causality Moat (execution provenance, not intelligence) | Yes | All positioning and messaging |
| Auditor independence argument for enterprise sales | Yes | Go-to-market |
| Agent Verification Alliance (AVA) at 6-18 months | Strategic | Governance |
| Donate spec to LF/CNCF at 18+ months | Strategic | Long-term |
| IAM-style JSON DSL for WPC v1, Cedar for v2 | Yes | WPC schema, verifier |
| Strict Intersection for policy composability | Yes | WPC evaluator |
| Merkle DAG via delegation_receipt for multi-agent | Yes | Schema, SDK, verifier |
| Strict liability cascade (blame goes up) | Yes | Verification semantics |
| Lamport causal ordering via hash links | Yes | Event chain verification |
| Mandatory Receipt Transparency Log | Yes (critical) | clawlogs, clawproxy, clawverify |
| Ephemeral 24h worker keys from offline root | Yes | clawproxy key management |
| Epoch Cutoff for compromise recovery | Yes | Incident response |
| SOC2 as wedge, EU AI Act as whale | Yes | Sales strategy |
| Vanta/Drata partnership for compliance automation | Yes | Channel strategy |
| Compliance report JSON schema | Yes | CLI, new schema |
