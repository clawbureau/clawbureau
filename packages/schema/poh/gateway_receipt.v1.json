{
  "$id": "https://schemas.clawbureau.org/claw.poh.gateway_receipt.v1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Gateway Receipt v1",
  "description": "Gateway receipt payload (proof-of-harness). Signed as part of a SignedEnvelope<GatewayReceiptPayload>.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "receipt_version",
    "receipt_id",
    "gateway_id",
    "provider",
    "model",
    "request_hash_b64u",
    "response_hash_b64u",
    "tokens_input",
    "tokens_output",
    "latency_ms",
    "timestamp"
  ],
  "properties": {
    "receipt_version": { "const": "1" },
    "receipt_id": { "type": "string", "minLength": 1 },
    "gateway_id": { "type": "string", "minLength": 1 },
    "provider": { "type": "string", "minLength": 1 },
    "model": { "type": "string", "minLength": 1 },
    "request_hash_b64u": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 8,
      "description": "SHA-256 hash of request bytes, base64url (no padding)."
    },
    "response_hash_b64u": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]+$",
      "minLength": 8,
      "description": "SHA-256 hash of response bytes, base64url (no padding)."
    },
    "tokens_input": { "type": "number", "minimum": 0 },
    "tokens_output": { "type": "number", "minimum": 0 },
    "latency_ms": { "type": "number", "minimum": 0 },
    "timestamp": { "type": "string", "format": "date-time" },
    "binding": { "$ref": "https://schemas.clawbureau.org/claw.poh.receipt_binding.v1.json" },
    "metadata": {
      "type": "object",
      "description": "Optional receipt metadata. These fields are signed as part of the receipt payload but must not be interpreted as stronger guarantees than their tier semantics.",
      "properties": {
        "model_identity": {
          "$ref": "https://schemas.clawbureau.org/claw.poh.model_identity.v1.json"
        },
        "model_identity_hash_b64u": {
          "type": "string",
          "pattern": "^[A-Za-z0-9_-]+$",
          "minLength": 8,
          "description": "sha256_b64u(JCS(model_identity)) for stable deduping."
        },
        "audit_result_refs": {
          "type": "array",
          "description": "Optional references to audit_result_attestation artifacts that cover this output.",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["resource_hash_b64u"],
            "properties": {
              "resource_type": { "type": "string" },
              "resource_hash_b64u": {
                "type": "string",
                "pattern": "^[A-Za-z0-9_-]+$",
                "minLength": 8
              },
              "uri": { "type": "string" }
            }
          }
        },
        "x402_payment_ref": {
          "type": "string",
          "minLength": 1,
          "description": "x402 payment transaction hash or facilitator reference. Present when request was paid via x402."
        },
        "x402_amount_minor": {
          "type": "integer",
          "minimum": 0,
          "description": "Amount settled in minor units (e.g., 1 USDC = 1000000 minor units). Present when request was paid via x402."
        },
        "x402_currency": {
          "type": "string",
          "minLength": 1,
          "description": "Payment currency (e.g., USDC). Present when request was paid via x402."
        },
        "x402_network": {
          "type": "string",
          "minLength": 1,
          "description": "Payment network (e.g., base-sepolia, base). Present when request was paid via x402."
        },
        "log_inclusion_proof": {
          "$ref": "https://schemas.clawbureau.org/claw.poh.log_inclusion_proof.v1.json",
          "description": "Receipt Transparency (RT) inclusion proof. Present when the receipt hash has been submitted to the clawlogs append-only Merkle tree. A receipt without this field has not been transparency-logged and should be treated with lower trust by verifiers."
        }
      },
      "additionalProperties": true
    }
  }
}
