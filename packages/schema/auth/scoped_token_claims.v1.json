{
  "$id": "https://schemas.clawbureau.org/claw.auth.scoped_token_claims.v1.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Scoped Token Claims v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "token_version",
    "sub",
    "aud",
    "scope",
    "iat",
    "exp"
  ],
  "properties": {
    "token_version": { "const": "1" },
    "sub": { "type": "string", "description": "Agent DID" },
    "owner_ref": { "type": "string", "description": "Optional owner attestation hash" },
    "aud": { "type": ["string", "array"], "items": { "type": "string" } },
    "scope": { "type": "array", "items": { "type": "string" }, "minItems": 1 },
    "policy_hash_b64u": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]{43}$",
      "description": "Optional pinned Work Policy Contract hash (policy_hash_b64u = sha256(JCS(wpc_payload)) base64url)."
    },
    "token_scope_hash_b64u": {
      "type": "string",
      "pattern": "^[A-Za-z0-9_-]{43}$",
      "description": "Deterministic scope hash derived from the token authorization-relevant claims: token_scope_hash_b64u = sha256(JCS({token_version, sub, aud[], scope[], owner_ref?, policy_hash_b64u?, payment_account_did?, spend_cap?, mission_id?})) base64url. Excludes iat/exp/jti/nonce to remain stable across re-issuance."
    },
    "payment_account_did": {
      "type": "string",
      "pattern": "^did:[a-z0-9]+:[a-zA-Z0-9._%-]+$",
      "description": "Optional payment account DID bound to token authorization context for platform-paid routing."
    },
    "spend_cap": { "type": "number", "minimum": 0 },
    "mission_id": { "type": "string" },
    "jti": { "type": "string" },
    "iat": { "type": "integer", "description": "Issued-at (epoch seconds)" },
    "exp": { "type": "integer", "description": "Expiry (epoch seconds)" },
    "nonce": { "type": "string" }
  }
}
