{
  "project": "clawbureau",
  "branchName": "feat/marketplace/CBT-OPS-004-control-plane-assimilation-finalize",
  "description": "clawbounties.com (Bounty Marketplace) \u2014 PRD \u2014 Marketplace for agent work with test/quorum/requester closures.",
  "userStories": [
    {
      "id": "CBT-US-001",
      "title": "Post bounty",
      "description": "As a requester, I want to post a bounty so that agents can bid.",
      "acceptanceCriteria": [
        "Require title/description/reward",
        "Create escrow hold",
        "Set closure type",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented in commit 000b44a"
    },
    {
      "id": "CBT-US-002",
      "title": "Accept bounty",
      "description": "As a agent, I want to accept a bounty so that I can work.",
      "acceptanceCriteria": [
        "Reserve slot",
        "Check eligibility",
        "Return acceptance receipt",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Implemented in commit e2ed084"
    },
    {
      "id": "CBT-US-003",
      "title": "Submit work",
      "description": "As a agent, I want to submit signed output so that I can get paid.",
      "acceptanceCriteria": [
        "Require signature envelope",
        "Attach proof bundle hash",
        "Set status pending",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Implemented in commit b0391f1"
    },
    {
      "id": "CBT-US-004",
      "title": "Test-based auto-approval",
      "description": "As a system, I want auto verification so that payments are fast.",
      "acceptanceCriteria": [
        "Run test harness",
        "Approve if tests pass",
        "Reject if fail",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Implemented in commit 3eb581f"
    },
    {
      "id": "CBT-US-005",
      "title": "Quorum review",
      "description": "As a requester, I want multiple reviewers so that quality is ensured.",
      "acceptanceCriteria": [
        "Select reviewers by rep",
        "Collect signed votes",
        "Release on quorum",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Implemented in commit 7ad28c4"
    },
    {
      "id": "CBT-US-006",
      "title": "Bounty search",
      "description": "As a agent, I want to browse bounties so that I can find work.",
      "acceptanceCriteria": [
        "Filter by tags",
        "Sort by reward",
        "Show trust requirements",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Implemented in commit 558ad8c"
    },
    {
      "id": "CBT-US-007",
      "title": "Dispute handling",
      "description": "As a agent, I want to dispute rejection so that fairness is preserved.",
      "acceptanceCriteria": [
        "Open dispute",
        "Route to trials",
        "Freeze payout",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Implemented in commit d042302"
    },
    {
      "id": "CBT-US-008",
      "title": "Stake requirements",
      "description": "As a marketplace, I want stake rules so that bad-faith behavior is costly.",
      "acceptanceCriteria": [
        "Require worker/requester stakes based on trust tier and bounty size",
        "Lock stakes in ledger bonded bucket",
        "Release or slash stakes based on trial outcome",
        "Typecheck passes"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Implemented in commit cb5c6f5"
    },
    {
      "id": "CBT-US-009",
      "title": "Proof tier classification",
      "description": "As a marketplace, I want proof tiers so that reputation weights are fair.",
      "acceptanceCriteria": [
        "Classify submissions as self/gateway/sandbox based on receipts/attestations",
        "Store proof tier with submission",
        "Pass proof tier to clawrep for weighting",
        "Typecheck passes"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Added proof tier classification for submissions (self/gateway/sandbox) based on provided receipt/attestation references. Stored proof_tier + proof_evidence on Submission, returned proof_tier in submitWork response, and forwarded submission_proof_tier to clawrep reviewer selection for downstream weighting."
    },
    {
      "id": "CBT-US-010",
      "title": "Fee disclosure",
      "description": "As a requester, I want full cost clarity so that I can budget.",
      "acceptanceCriteria": [
        "Show all-in cost at posting (principal + fees)",
        "Show worker net at acceptance",
        "Use clawcuts fee policy version",
        "Typecheck passes"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Made fee disclosure deterministic and explicit: bounties now require fee_policy_version + all_in_cost at posting, and acceptance receipts include worker_net (reward principal), fee_policy_version, and all_in_cost so agents can see net payout and requester total cost. Typecheck passes."
    },
    {
      "id": "CBT-US-011",
      "title": "Difficulty scalar",
      "description": "As a requester, I want difficulty metadata so that rep weighting is transparent.",
      "acceptanceCriteria": [
        "Require difficulty scalar (K) on posting",
        "Immutable after posting",
        "Include K in bounty receipts and rep events",
        "Typecheck passes"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Difficulty scalar K is required at posting (validated + persisted). Added K to PostBounty response (posting receipt) and ensured it is forwarded to clawrep reviewer selection (rep weighting). Acceptance receipts already include difficulty_scalar; updates preserve immutability."
    },
    {
      "id": "CBT-US-012",
      "title": "Code bounty commit proofs",
      "description": "As a reviewer, I want commit proofs so that agent code is trustworthy.",
      "acceptanceCriteria": [
        "Require commit.sig.json for code bounties",
        "Verify commit proof via clawverify",
        "Link commit proof to proof bundle",
        "Typecheck passes"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Code bounties now require a did-work style commit.sig.json at submission (SubmitWorkRequest.commit_sig). Signature is verified (Ed25519 over message 'commit:<sha>' from did:key) and the extracted commit_sha is stored on the Submission alongside proof_bundle, linking the commit proof to the proof bundle."
    },
    {
      "id": "CBT-US-013",
      "title": "PoH tier gating",
      "description": "As a marketplace, I want trust-tier requirements so that high-value jobs are safe.",
      "acceptanceCriteria": [
        "Allow requesters to set minimum PoH tier",
        "Enforce tier requirements at acceptance",
        "Expose tier requirement in listing",
        "Typecheck passes"
      ],
      "priority": 13,
      "passes": true,
      "notes": "PoH tier gating is implemented end-to-end: PostBountyRequest supports min_poh_tier (default 0) and persists it on Bounty; acceptBounty enforces eligibility by calling clawtrust eligibilityService with required_poh_tier; searchBounties exposes trust_requirements.min_poh_tier in BountyListing."
    },
    {
      "id": "CBT-US-014",
      "title": "Owner-verified voting",
      "description": "As a requester, I want verified voters so that sybil attacks are reduced.",
      "acceptanceCriteria": [
        "Require owner-verified status for quorum votes (optional)",
        "Record owner attestation reference with votes",
        "Allow fallback to non-verified votes with higher stake",
        "Typecheck passes"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Implemented owner-verified voting enforcement in quorum review: when bounty.require_owner_verified_votes is enabled, owner-verified reviewers must include owner_attestation_ref (stored on vote), and non-owner-verified reviewers can still vote only by providing a fallback_stake meeting a minimum threshold. Quorum initiation prefers owner-verified reviewers but falls back to non-verified selection if insufficient verified reviewers are available."
    },
    {
      "id": "CBT-US-015",
      "title": "Public landing + skill docs",
      "description": "As a developer, I want public landing/docs/skill endpoints so that I can discover and integrate clawbounties quickly.",
      "acceptanceCriteria": [
        "GET / returns an HTML landing page with links to /docs and /skill.md",
        "GET /docs returns minimal human-readable docs (HTML or markdown)",
        "GET /skill.md returns an OpenClaw-compatible skill file (frontmatter + markdown)",
        "OpenClaw frontmatter: metadata is a single-line JSON object string",
        "GET /robots.txt and /sitemap.xml exist (minimal)",
        "GET /.well-known/security.txt exists",
        "Typecheck passes"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Added a minimal public Cloudflare Worker at services/clawbounties with GET /, /docs, /skill.md (OpenClaw frontmatter metadata as single-line JSON object string), /robots.txt, /sitemap.xml, and /.well-known/security.txt."
    },
    {
      "id": "CBT-US-016",
      "title": "Production deploy (routes + health)",
      "description": "As a developer, I want clawbounties deployed to real domains so that clients can discover and integrate it.",
      "acceptanceCriteria": [
        "Configure worker routes for clawbounties.com and www.clawbounties.com",
        "Configure staging route staging.clawbounties.com",
        "DNS records exist for apex + staging + www",
        "GET /health returns status/version/environment",
        "Typecheck passes"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Added services/clawbounties/wrangler.toml + wrangler deps, deployed staging+prod, and added GET /health."
    },
    {
      "id": "CBT-US-017",
      "title": "Marketplace API: post + list bounties (escrow hold)",
      "description": "As a requester, I want to post bounties that automatically create an escrow hold so that work is financially guaranteed.",
      "acceptanceCriteria": [
        "POST /v1/bounties accepts schema v2 fields: title, description, reward.amount_minor (USD), closure_type, difficulty_scalar",
        "Supports schema v2 job flavoring via is_code_bounty + tags[] (no legacy job_type)",
        "Calls clawcuts /v1/fees/simulate using params.is_code_bounty + params.closure_type",
        "Calls clawescrow /v1/escrows to hold buyer_total_minor (stored fee snapshot)",
        "Persists a Bounty v2 record in D1 (idempotent via idempotency_key; auto-derived when omitted)",
        "GET /v1/bounties lists bounties (filters: status, is_code_bounty, tag)",
        "Admin auth fail-closed for /v1 endpoints",
        "Typecheck passes"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Upgraded clawbounties post/list API to schema v2 shapes (reward object, is_code_bounty + tags) and updated cuts integration to v2 params; persists D1 records and creates escrow holds."
    },
    {
      "id": "CBT-US-018",
      "title": "Worker registry + token auth (MVP)",
      "description": "As an OpenClaw worker, I want to register and receive an auth token so that I can safely participate in the marketplace loop.",
      "acceptanceCriteria": [
        "POST /v1/workers/register issues a short-lived bearer token (stored hashed)",
        "GET /v1/workers lists workers (filters: job_type, tag)",
        "GET /v1/workers/self validates the token and returns the worker record",
        "D1 persistence + token rotation on re-register",
        "Typecheck passes"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Implemented worker registry endpoints with D1 persistence and hashed auth tokens, plus listing and self endpoints for discovery and token validation."
    },
    {
      "id": "CBT-US-019",
      "title": "Bounty accept (worker auth + escrow assign)",
      "description": "As a worker, I want to accept a bounty so that I can be assigned in escrow and begin work.",
      "acceptanceCriteria": [
        "POST /v1/bounties/{bounty_id}/accept requires worker bearer token auth",
        "Enforces worker_did matches the authenticated worker token",
        "Enforces direct-hire (metadata.requested_worker_did) when set",
        "Calls clawescrow /v1/escrows/{escrow_id}/assign",
        "Persists acceptance (worker_did, accepted_at, status=accepted) in D1",
        "Typecheck passes"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Added worker-authenticated bounty accept endpoint that assigns the escrow worker, records acceptance in D1, and returns an acceptance receipt."
    },
    {
      "id": "CBT-US-020",
      "title": "Worker bounty list (polling)",
      "description": "As a worker, I want to list open bounties so that I can find work to accept.",
      "acceptanceCriteria": [
        "GET /v1/bounties?status=open requires worker bearer token auth",
        "Filters by is_code_bounty and tag query params",
        "Direct-hire bounties only appear for the requested worker",
        "Response omits requester/admin-only fields",
        "Typecheck passes"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Added worker-authenticated bounty listing that only returns open bounties and filters direct-hire assignments to the requesting worker."
    },
    {
      "id": "CBT-US-021",
      "title": "Submit work (clawverify pipeline)",
      "description": "As a worker, I want to submit my work with proof bundles so that it can be verified and reviewed.",
      "acceptanceCriteria": [
        "POST /v1/bounties/{bounty_id}/submit requires worker bearer token auth",
        "Requires proof_bundle_envelope; commit_proof_envelope required for code bounties",
        "Calls clawverify /v1/verify/bundle (fail-closed)",
        "Calls clawverify /v1/verify/commit-proof for code bounties",
        "Persists submissions with verification status + proof_tier",
        "Moves accepted bounties to pending_review on valid submission",
        "Typecheck passes"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Added worker-authenticated submission endpoint that verifies proof bundles (and commit proofs for code bounties), persists submission records, and advances accepted bounties to pending_review when valid."
    },
    {
      "id": "CBT-OPS-001",
      "title": "Requester scoped auth + simulation launcher",
      "description": "As operations, we need fail-closed requester auth and a real staging simulation launcher so requester-closure bounty flows can be validated end-to-end without D1 injection.",
      "acceptanceCriteria": [
        "POST /v1/bounties + /approve + /reject require scoped requester CST/JWT auth with DID-bound subject checks",
        "Legacy admin + x-requester-did requester path remains behind explicit compat flag (disabled by default)",
        "Deterministic requester auth errors for missing token, missing scope, and requester_did mismatch",
        "Add reviewer endpoints GET /v1/bounties/{bounty_id}/submissions and GET /v1/submissions/{submission_id} with fail-closed auth",
        "Persist requester auth usage context for bounty actions",
        "Add staging simulation launcher with parameterized run size and artifact output",
        "Typecheck passes"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Implemented scoped requester token introspection via clawscope for post/approve/reject, kept the legacy path behind REQUESTER_AUTH_COMPAT_LEGACY (default false), added reviewer read endpoints, added requester auth usage event persistence, and added scripts/clawbounties/smoke-requester-closure-simulation.mjs for real staging flow validation. Added staging route override for /v1/bounties* to prevent legacy route shadowing. Captured deterministic auth smoke evidence at artifacts/smoke/requester-auth/2026-02-11T19-25-45Z-staging/result.json and full requester-closure E2E pass artifact at artifacts/simulations/clawbounties-requester-closure/2026-02-11T19-20-52-597Z-staging-runs-3/result.json."
    },
    {
      "id": "CBT-US-022",
      "title": "Test harness lane operational",
      "description": "As marketplace ops, I want the clawtrials harness lane to be routable and deterministic so closure_type=test bounties can auto-decide safely.",
      "acceptanceCriteria": [
        "Provide clawtrials API endpoint POST /v1/harness/run with deterministic request/response schema",
        "Ensure staging domain staging.clawtrials.com resolves to API worker (no parked landing fallback for /v1/harness/run)",
        "Integrate clawbounties test auto-approval path with fail-closed deterministic errors when harness is unavailable or invalid",
        "Validate staging test-lane behavior with smoke evidence"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Production complete. Staging + prod harness lane validated with deterministic contracts and fail-closed invalid replay behavior. Evidence: staging gate/report `artifacts/simulations/clawbounties/2026-02-11T22-14-08-561Z-prod-gate/gate-report.json`; prod gate/report `artifacts/simulations/clawbounties/2026-02-11T22-23-53-242Z-prod-gate/gate-report.json`; prod test smoke `artifacts/simulations/clawbounties/2026-02-11T22-21-49-713Z-test-e2e/test-smoke.json`."
    },
    {
      "id": "CBT-US-023",
      "title": "Real E2E simulation runner (no D1 injection)",
      "description": "As marketplace ops, I want API-only requester/test simulation runners so we can route real internal work through clawbounties immediately.",
      "acceptanceCriteria": [
        "Add scripts/poh/smoke-clawbounties-e2e-requester.mjs using real APIs: register -> post -> accept -> submit -> approve/reject",
        "Add scripts/poh/smoke-clawbounties-e2e-test.mjs using real APIs: register -> post(test) -> accept -> submit -> harness auto decision",
        "Add scripts/poh/simulate-clawbounties-batch.mjs for load batches without direct D1 mutation",
        "Simulation scripts emit deterministic failures and fail-closed on dependency outages"
      ],
      "priority": 24,
      "passes": true,
      "notes": "Production complete. API-only requester/test smoke runners and batch runner validated in staging and prod with scoped requester token issuance via clawscope (no D1 simulation shortcuts). Evidence: requester prod `artifacts/simulations/clawbounties/2026-02-11T22-20-53-579Z-requester-e2e/requester-smoke.json`; test prod `artifacts/simulations/clawbounties/2026-02-11T22-21-49-713Z-test-e2e/test-smoke.json`; batch prod 10/50 `artifacts/simulations/clawbounties/2026-02-11T22-22-07-779Z-batch-10/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-22-33-468Z-batch-50/summary.json`."
    },
    {
      "id": "CBT-US-024",
      "title": "Submission review/listing ergonomics",
      "description": "As requesters/reviewers/operators, I want first-class submission listing/detail APIs and simulation artifacts so review loops are fast and auditable.",
      "acceptanceCriteria": [
        "Implement GET /v1/bounties/:id/submissions with explicit admin/worker/requester auth boundaries",
        "Implement GET /v1/submissions/:id with deterministic error contracts and review-friendly fields",
        "Batch simulation writes artifacts under artifacts/simulations/clawbounties/<timestamp>/",
        "Artifacts include total jobs, per-step success/failure, deterministic error buckets, stuck-state counts, per-step latency stats, and closure_type breakdown"
      ],
      "priority": 25,
      "passes": true,
      "notes": "Production complete. Submission list/detail endpoints validated through requester/worker flows and reflected in deterministic simulation metrics artifacts across staging/prod. Evidence: prod requester smoke `artifacts/simulations/clawbounties/2026-02-11T22-20-53-579Z-requester-e2e/requester-smoke.json`; prod test smoke `artifacts/simulations/clawbounties/2026-02-11T22-21-49-713Z-test-e2e/test-smoke.json`; batch metrics `artifacts/simulations/clawbounties/2026-02-11T22-22-07-779Z-batch-10/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-22-33-468Z-batch-50/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-23-42-689Z-batch-200/summary.json`."
    },
    {
      "id": "CBT-US-025",
      "title": "Production gate preflight pack",
      "description": "As marketplace ops, I want a deterministic preflight gate pack so GO PROD decisions are based on a reproducible artifact instead of ad-hoc checks.",
      "acceptanceCriteria": [
        "Add one-command gate script that validates staging route reachability + health for clawbounties and clawtrials",
        "Gate script validates auth contracts (fail-closed missing token + valid requester token path)",
        "Gate script validates harness availability directly and through clawbounties test-lane integration",
        "Gate script writes machine-readable and markdown report artifacts under artifacts/simulations/clawbounties/<timestamp>/ with recommendation + blockers"
      ],
      "priority": 26,
      "passes": true,
      "notes": "Production complete. One-command gate pack now green in both staging and prod with route/health, auth fail-closed, harness integration, and deterministic invalid-replay checks. Evidence: `artifacts/simulations/clawbounties/2026-02-11T22-14-08-561Z-prod-gate/{gate-report.json,gate-report.md}` and `artifacts/simulations/clawbounties/2026-02-11T22-23-53-242Z-prod-gate/{gate-report.json,gate-report.md}`."
    },
    {
      "id": "CBT-US-026",
      "title": "Scale reliability pipeline (200+ runs)",
      "description": "As marketplace ops, I want the batch simulation runner to sustain 200+ API-only runs with bounded concurrency and backpressure so staging scale signals are trustworthy.",
      "acceptanceCriteria": [
        "Extend batch runner with bounded concurrency cap and adaptive backpressure controls",
        "Support 200+ run mode without D1 injection shortcuts",
        "Emit deterministic error-bucket accounting (raw + classified) and detailed stuck-state reporting",
        "Write summary + jobs artifacts under artifacts/simulations/clawbounties/<timestamp>/"
      ],
      "priority": 27,
      "passes": true,
      "notes": "Production complete. 200+ reliability mode validated with bounded concurrency/backpressure and zero stuck states in staging + prod. Evidence: staging 200 `artifacts/simulations/clawbounties/2026-02-11T22-17-00-795Z-batch-200/summary.json`; prod 200 `artifacts/simulations/clawbounties/2026-02-11T22-23-42-689Z-batch-200/summary.json`."
    },
    {
      "id": "CBT-US-027",
      "title": "Funding-aware orchestration",
      "description": "As marketplace ops, I want funding preflight checks before large simulation waves so we avoid noisy escrow failures and can classify insufficient funds deterministically.",
      "acceptanceCriteria": [
        "Batch runner performs requester funding preflight before high-volume execution",
        "Insufficient funds is classified into dedicated summary buckets",
        "Runner supports aborting or continuing based on configured funding policy",
        "Summary artifacts include funding preflight outcome and funding-related blockers"
      ],
      "priority": 28,
      "passes": true,
      "notes": "Production complete. Funding preflight executed and recorded in all batch summaries; insufficient-funds classification remained deterministic. Blockers encountered during rollout were resolved fail-closed: TOKEN_UNKNOWN_KID (requester token issuance source corrected to clawscope) and DB_WRITE_FAILED requester_auth_events table missing (prod migration applied). Evidence: `artifacts/simulations/clawbounties/2026-02-11T22-22-07-779Z-batch-10/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-22-33-468Z-batch-50/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-23-42-689Z-batch-200/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T22-23-53-242Z-prod-gate/gate-report.json`."
    },
    {
      "id": "CBT-US-028",
      "title": "Identity control-plane contract assimilation",
      "description": "As marketplace ops, I want requester and worker auth contracts aligned with identity control-plane outputs so production auth decisions are deterministic across services.",
      "acceptanceCriteria": [
        "Align marketplace requester token checks with clawscope/clawclaim control-plane claim contracts",
        "Document required claim/audience/scope invariants for requester and worker lanes",
        "Add deterministic contract smoke assertions for identity-control-plane compatibility"
      ],
      "priority": 29,
      "passes": true,
      "notes": "Production complete. Requester/worker auth now enforces control-plane claims (`token_hash`, `token_scope_hash_b64u`, `token_lane`, `iat`, `exp`) with deterministic scope+audience contract checks and fail-closed legacy rejection for worker local tokens. Evidence: staging gate `artifacts/simulations/clawbounties/2026-02-11T23-13-16-036Z-prod-gate/gate-report.json`, prod gate `artifacts/simulations/clawbounties/2026-02-11T23-13-25-303Z-prod-gate/gate-report.json`, staging requester/test e2e `artifacts/simulations/clawbounties/2026-02-11T23-06-24-298Z-requester-e2e/requester-smoke.json`, `artifacts/simulations/clawbounties/2026-02-11T23-06-32-801Z-test-e2e/test-smoke.json`, prod requester/test e2e `artifacts/simulations/clawbounties/2026-02-11T23-10-20-634Z-requester-e2e/requester-smoke.json`, `artifacts/simulations/clawbounties/2026-02-11T23-10-29-162Z-test-e2e/test-smoke.json`."
    },
    {
      "id": "CBT-US-029",
      "title": "Sensitive transition enforcement hardening",
      "description": "As marketplace ops, I want sensitive production transitions guarded by canonical control-plane semantics so auth shortcuts cannot bypass governance.",
      "acceptanceCriteria": [
        "Map sensitive marketplace operations to explicit control-plane transition semantics",
        "Fail-closed on missing/invalid sensitive transition evidence",
        "Add deterministic error contracts for sensitive transition denials"
      ],
      "priority": 30,
      "passes": true,
      "notes": "Production complete. Sensitive transitions (`post_bounty`, `approve_bounty`, `reject_bounty`) now require scoped requester auth, enforce `payment_account_did` binding to `sub`, revalidate revocation/activity via clawscope `/v1/tokens/introspect/matrix`, and persist control-plane audit evidence in `requester_auth_events` (`token_scope_hash_b64u`, `token_lane`, `payment_account_did`, `token_iat`, `token_exp`, `sensitive_transition`, `control_plane_check_json`) via migration `0015_requester_auth_events_control_plane.sql`. Deterministic denials include `SENSITIVE_TRANSITION_REQUIRES_SCOPED_TOKEN`, `REQUESTER_CONTROL_CLAIM_REQUIRED`, `REQUESTER_CONTROL_BINDING_MISMATCH`, `REQUESTER_SENSITIVE_AUTH_REVALIDATION_FAILED`. Evidence: staging/prod gates `artifacts/simulations/clawbounties/2026-02-11T23-13-16-036Z-prod-gate/gate-report.json`, `artifacts/simulations/clawbounties/2026-02-11T23-13-25-303Z-prod-gate/gate-report.json`."
    },
    {
      "id": "CBT-US-030",
      "title": "API-only simulation discipline for control-plane lane",
      "description": "As marketplace ops, I want control-plane assimilation validated through API-only simulations so production confidence does not rely on datastore shortcuts.",
      "acceptanceCriteria": [
        "Extend simulation/gate packs with control-plane contract checks (no D1 mutation shortcuts)",
        "Emit deterministic artifacts for control-plane auth outcomes and blockers",
        "Define rollout and rollback playbook for CBT-OPS-004 productionization"
      ],
      "priority": 31,
      "passes": true,
      "notes": "Production complete. Simulation/gate pack is strict-auth API-only: requester legacy header path is explicitly rejected (`REQUESTER_TOKEN_REQUIRED`), worker legacy registration token path is explicitly rejected (`WORKER_TOKEN_CANONICAL_REQUIRED`), and worker/requester scoped tokens are auto-issued through clawscope for deterministic replay. Staging artifacts: requester e2e `artifacts/simulations/clawbounties/2026-02-11T23-06-24-298Z-requester-e2e/requester-smoke.json`, test e2e `artifacts/simulations/clawbounties/2026-02-11T23-06-32-801Z-test-e2e/test-smoke.json`, batch 10/50/200 `artifacts/simulations/clawbounties/2026-02-11T23-06-49-664Z-batch-10/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T23-07-27-180Z-batch-50/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T23-09-15-458Z-batch-200/summary.json`, gate (includes invalid-harness replay) `artifacts/simulations/clawbounties/2026-02-11T23-13-16-036Z-prod-gate/gate-report.json`. Prod artifacts: requester/test e2e `artifacts/simulations/clawbounties/2026-02-11T23-10-20-634Z-requester-e2e/requester-smoke.json`, `artifacts/simulations/clawbounties/2026-02-11T23-10-29-162Z-test-e2e/test-smoke.json`; batch 10/50/200 `artifacts/simulations/clawbounties/2026-02-11T23-10-42-942Z-batch-10/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T23-11-14-085Z-batch-50/summary.json`, `artifacts/simulations/clawbounties/2026-02-11T23-12-36-717Z-batch-200/summary.json`; gate (includes invalid-harness replay) `artifacts/simulations/clawbounties/2026-02-11T23-13-25-303Z-prod-gate/gate-report.json`."
    },
    {
      "id": "CBT-US-031",
      "title": "Loss-event risk coupling",
      "description": "As marketplace risk ops, I want clawbounties to ingest adverse loss events and force deterministic disputed-state coupling for affected bounties.",
      "acceptanceCriteria": [
        "Add bounty_risk_events persistence with idempotency + source-loss-event uniqueness",
        "Implement POST /v1/risk/loss-events protected by BOUNTIES_RISK_KEY",
        "On first risk event, move mutable bounties into disputed status fail-closed",
        "Persist source metadata (severity/reason/amount/account_did) for auditability",
        "Replay path must be deterministic and conflict on mismatched idempotency payload"
      ],
      "priority": 32,
      "passes": true,
      "notes": "Shipped to staging+prod with migration 0017 bounty_risk_events and BOUNTIES_RISK_KEY-protected POST /v1/risk/loss-events. Deterministic replay/conflict behavior and disputed-state coupling validated via ECON risk-loop smokes artifacts/simulations/econ-risk-loss-loop/2026-02-12T04-56-17-530Z-staging/smoke.json and artifacts/simulations/econ-risk-loss-loop/2026-02-12T05-00-54-595Z-prod/smoke.json."
    },
    {
      "id": "CBT-US-032",
      "title": "Loss-event risk clear records",
      "description": "As marketplace risk ops, I want clawbounties to record deterministic risk-clear events for a bounty when a loss event is resolved, without auto-undisputing the bounty.",
      "acceptanceCriteria": [
        "Add bounty_risk_event_clears persistence with idempotency_key UNIQUE and UNIQUE(source_loss_event_id, bounty_id)",
        "Implement POST /v1/risk/loss-events/clear protected by BOUNTIES_RISK_KEY",
        "Replay path returns 200 replay on matching payload; mismatch returns 409 IDEMPOTENCY_CONFLICT",
        "Conflict on duplicate (source_loss_event_id, bounty_id) returns deterministic 409",
        "Does not mutate bounty status (no auto-undispute)",
        "Validated in end-to-end clawsettle loss resolve smoke"
      ],
      "priority": 33,
      "passes": true,
      "notes": "Shipped to staging+prod with migration 0018 bounty_risk_event_clears and BOUNTIES_RISK_KEY-protected POST /v1/risk/loss-events/clear. Evidence: deploy summary artifacts/ops/econ-risk/2026-02-12T14-29-11Z-econ-risk-max-002-rollout/deploy-summary.json; apply+resolve smokes artifacts/simulations/econ-risk-loss-resolve-loop/2026-02-12T14-23-31-632Z-staging/smoke.json and artifacts/simulations/econ-risk-loss-resolve-loop/2026-02-12T14-28-29-206Z-prod/smoke.json (resolve outbox forwarded to clawbounties clear)."
    }
  ]
}
