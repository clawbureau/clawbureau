{
  "project": "clawbureau",
  "branchName": "feat/marketplace/CCU-OPS-001-clawcuts-monetization",
  "description": "clawcuts.com (Pricing Engine) — PRD — Fee engine and take-rate policies for markets and escrow.",
  "userStories": [
    {
      "id": "CCU-US-001",
      "title": "Define fee policies",
      "description": "As a operator, I want to set fees so that revenue is consistent.",
      "acceptanceCriteria": [
        "Create policy per product",
        "Version policies",
        "Activate/deactivate",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Implemented D1-backed policy control plane with immutable version creation (`POST /v1/policies/versions`), explicit activate/deactivate lifecycle, bootstrap defaults, and strict admin-gated operations. Evidence: artifacts/simulations/clawcuts/2026-02-12T00-10-13-377Z-staging/smoke.json and artifacts/simulations/clawcuts/2026-02-12T00-11-08-054Z-prod/smoke.json."
    },
    {
      "id": "CCU-US-002",
      "title": "Apply fees",
      "description": "As a ledger, I want to apply fees so that settlements are correct.",
      "acceptanceCriteria": [
        "Apply stored fee snapshot on release (do not recompute)",
        "Record fee event",
        "Support discounts",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Added `POST /v1/fees/apply` + `POST /v1/fees/apply/finalize` idempotent settlement pipeline that consumes stored snapshots only, validates policy hash/version binding, and records deterministic transfer plans + ledger refs. Escrow release now uses clawcuts apply fail-closed before ledger fanout."
    },
    {
      "id": "CCU-US-003",
      "title": "Referral splits",
      "description": "As a growth, I want referral splits so that partners are rewarded.",
      "acceptanceCriteria": [
        "Define split rules",
        "Apply on transactions",
        "Ledger event emitted",
        "Typecheck passes"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Referral split rule fields (`referral_bps`, `referral_min_minor`) added to policies; simulation emits deterministic split plans; escrow release executes dedicated referral transfers (`kind=escrow_release_referral`) with separate ledger_refs.referral_transfers."
    },
    {
      "id": "CCU-US-004",
      "title": "Policy audit",
      "description": "As a auditor, I want fee change logs so that pricing is transparent.",
      "acceptanceCriteria": [
        "Log policy changes",
        "Include actor + timestamp",
        "Expose history API",
        "Typecheck passes"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Policy audit log persisted in `policy_audit_events` with actor+timestamp and exposed via `GET /v1/policies/{product}/{policy_id}/history` and `/history.csv`."
    },
    {
      "id": "CCU-US-005",
      "title": "Fee simulation",
      "description": "As a operator, I want simulate fees so that pricing changes are safe.",
      "acceptanceCriteria": [
        "Input sample transaction",
        "Return computed fees",
        "No ledger mutation",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Implemented POST /v1/fees/simulate with built-in policies (bounties_v1 + tips_v1), deterministic BigInt money math (ceil + min_fee_minor), and stable policy_hash_b64u."
    },
    {
      "id": "CCU-US-006",
      "title": "Revenue reporting",
      "description": "As a finance, I want fee revenue reports so that I can track income.",
      "acceptanceCriteria": [
        "Monthly fee summary",
        "Export CSV",
        "Segment by product",
        "Typecheck passes"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Implemented `GET /v1/reports/revenue/monthly` with JSON + CSV exports segmented by product/policy/version and totals for gross principal, platform fee, referral payout, and retained platform revenue."
    },
    {
      "id": "CCU-US-007",
      "title": "Fee simulation params v2 (is_code_bounty + closure_type)",
      "description": "As a marketplace, I want fee simulation to accept schema-v2 bounty lane params so that posting bounties doesn't require legacy job_type fields.",
      "acceptanceCriteria": [
        "bounties_v1 policy selects rules using params.is_code_bounty + params.closure_type",
        "job_type is no longer required/accepted",
        "GET /skill.md example uses is_code_bounty + closure_type",
        "Typecheck passes"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Updated /v1/fees/simulate to use params.is_code_bounty + params.closure_type per Agent Economy MVP spec (schema v2 alignment)."
    }
  ]
}
