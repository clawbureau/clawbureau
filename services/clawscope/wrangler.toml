name = "clawscope"
account_id = "b8f2c66f1848dff476faa874282d781e"
main = "src/index.ts"
compatibility_date = "2025-01-01"
compatibility_flags = ["nodejs_compat"]

routes = [
  { pattern = "clawscope.com/*", zone_name = "clawscope.com" },
  { pattern = "www.clawscope.com/*", zone_name = "clawscope.com" }
]

[[kv_namespaces]]
binding = "SCOPE_REVOCATIONS"
id = "30f94e9e07fe426cb295b3efc9936836"

[vars]
SCOPE_VERSION = "0.1.0"
SCOPE_POLICY_VERSION = "1"
SCOPE_POLICY_TIER = "default"

# Simple policy knobs (used if SCOPE_POLICY_JSON is not set):
SCOPE_ALLOW_WILDCARDS = "0"
SCOPE_ALLOWED_SCOPE_PREFIXES = "proxy:,clawproxy:,clawbounties:,control:"
SCOPE_ALLOWED_SCOPES = ""
SCOPE_SENSITIVE_SCOPE_PREFIXES = "control:"
SCOPE_LEGACY_EXCHANGE_MODE = "migration"
SCOPE_KEY_ROTATION_OVERLAP_SECONDS = "3600"
CLAIM_CONTROL_BASE_URL = "https://clawclaim.com"

# Limits (also used as fallback defaults for tiers):
SCOPE_MAX_TTL_SECONDS = "3600"
SCOPE_MAX_SCOPE_ITEMS = "64"
SCOPE_MAX_SCOPE_LENGTH = "128"

SCOPE_REVOCATION_TTL_SECONDS = "2592000" # 30 days

# Optional: structured policy config (overrides knobs above)
# SCOPE_POLICY_JSON = "{\"version\":\"1\",\"tiers\":{\"default\":{\"max_ttl_seconds\":3600,\"allow_wildcards\":false,\"allowed_scope_prefixes\":[\"proxy:\",\"clawproxy:\"]}}}"

# Optional KV binding (needed for revocation + event feed + audit trail):
# [[kv_namespaces]]
# binding = "SCOPE_REVOCATIONS"
# id = "<create via wrangler kv:namespace create clawscope-revocations>"

# Secrets to be set via wrangler secret put:
# - SCOPE_SIGNING_KEY (Ed25519 seed, base64url; required unless using SCOPE_SIGNING_KEYS_JSON)
# - SCOPE_SIGNING_KEYS_JSON (JSON array of Ed25519 seeds; base64url; first key is active; optional)
# - SCOPE_ADMIN_KEY (string; required for token issuance/revocation)

[env.staging]
name = "clawscope-staging"
routes = [
  { pattern = "staging.clawscope.com/*", zone_name = "clawscope.com" }
]

[env.staging.vars]
SCOPE_VERSION = "0.1.0"
SCOPE_POLICY_VERSION = "1"
SCOPE_POLICY_TIER = "default"
SCOPE_ALLOW_WILDCARDS = "0"
SCOPE_ALLOWED_SCOPE_PREFIXES = "proxy:,clawproxy:,clawbounties:,control:"
SCOPE_ALLOWED_SCOPES = ""
SCOPE_SENSITIVE_SCOPE_PREFIXES = "control:"
SCOPE_LEGACY_EXCHANGE_MODE = "migration"
SCOPE_KEY_ROTATION_OVERLAP_SECONDS = "3600"
CLAIM_CONTROL_BASE_URL = "https://staging.clawclaim.com"
SCOPE_MAX_TTL_SECONDS = "3600"
SCOPE_MAX_SCOPE_ITEMS = "64"
SCOPE_MAX_SCOPE_LENGTH = "128"
SCOPE_REVOCATION_TTL_SECONDS = "2592000"

[[env.staging.kv_namespaces]]
binding = "SCOPE_REVOCATIONS"
id = "0eabaa70badf4983b5f20d671d1d943d"
