# clawea-www -- Enterprise marketing + SEO site for clawea.com
#
# This worker serves the public-facing marketing pages, programmatic SEO
# content, sitemap, and robots.txt. The platform API worker handles /v1/*
# routes on the same domain.
#
# Route precedence: this worker catches /* EXCEPT /v1/*, /health, /staging/*
# which the platform API worker handles via its own route bindings.

name = "clawea-www"
account_id = "b8f2c66f1848dff476faa874282d781e"
main = "src/index.ts"
compatibility_date = "2026-02-01"

routes = [
  { pattern = "clawea.com/*", zone_name = "clawea.com" },
  { pattern = "www.clawea.com/*", zone_name = "clawea.com" }
]

[vars]
ENVIRONMENT = "production"
SITE_URL = "https://www.clawea.com"
INDEXNOW_KEY = "edf20368863e485aa92e1b95fa15872a"
INDEXNOW_MAX_ATTEMPTS = "4"
INDEXNOW_RETRY_BASE_MS = "900"
INDEXNOW_RETRY_MAX_MS = "30000"
GOOGLE_INDEX_MAX_ATTEMPTS = "4"
GOOGLE_INDEX_RETRY_BASE_MS = "1200"
GOOGLE_INDEX_RETRY_MAX_MS = "45000"
INDEX_QUEUE_ENABLED = "1"
INDEX_QUEUE_MAX_ENTRIES_PER_RUN = "40"
INDEX_QUEUE_INDEXNOW_MAX_ATTEMPTS = "8"
INDEX_QUEUE_GOOGLE_MAX_ATTEMPTS = "6"
INDEX_QUEUE_RETRY_BASE_MS = "60000"
INDEX_QUEUE_RETRY_MAX_MS = "3600000"
TURNSTILE_REQUIRED = "1"
EXPERIMENT_SEED = "aeo-rev-005-default"
EXPERIMENT_CONFIG_KEY = "experiment-config-v1"

# Secrets (set with `wrangler secret put <NAME>`):
# - INDEX_AUTOMATION_TOKEN
# - LEADS_API_TOKEN
# - GOOGLE_INDEXING_SERVICE_ACCOUNT_JSON
# - TURNSTILE_SECRET_KEY
# - TURNSTILE_SITE_KEY
# - LEAD_ID_HASH_SALT

[[d1_databases]]
binding = "DB"
database_name = "clawea-www"
database_id = "f4e6a39b-1894-4554-b682-e0c719719aa4"
preview_database_id = "82781bed-d57c-4fe7-8269-74f54c12f69d"
migrations_dir = "migrations"

[[kv_namespaces]]
binding = "VARIANT_CONFIG"
id = "c026646d19914778b9c438f007485383"
preview_id = "36e71f3724914ab09ffda6425edf6bc8"

[[queues.producers]]
binding = "LEAD_JOBS"
queue = "clawea-www-lead-jobs"

[[queues.consumers]]
queue = "clawea-www-lead-jobs"
max_batch_size = 25
max_batch_timeout = 10
max_retries = 8

[placement]
mode = "smart"

[triggers]
crons = ["*/20 * * * *"]

# ---------- R2 (article storage) ----------
[[r2_buckets]]
binding = "ARTICLES"
bucket_name = "clawea-www"
preview_bucket_name = "clawea-www-staging"

# ---------- Staging ----------
[env.staging]
name = "clawea-www-staging"
routes = [
  { pattern = "staging-www.clawea.com/*", zone_name = "clawea.com" }
]

[env.staging.triggers]
crons = ["*/20 * * * *"]

[env.staging.vars]
ENVIRONMENT = "staging"
SITE_URL = "https://staging-www.clawea.com"
INDEXNOW_KEY = "edf20368863e485aa92e1b95fa15872a"
INDEXNOW_MAX_ATTEMPTS = "4"
INDEXNOW_RETRY_BASE_MS = "900"
INDEXNOW_RETRY_MAX_MS = "30000"
GOOGLE_INDEX_MAX_ATTEMPTS = "4"
GOOGLE_INDEX_RETRY_BASE_MS = "1200"
GOOGLE_INDEX_RETRY_MAX_MS = "45000"
INDEX_QUEUE_ENABLED = "1"
INDEX_QUEUE_MAX_ENTRIES_PER_RUN = "20"
INDEX_QUEUE_INDEXNOW_MAX_ATTEMPTS = "6"
INDEX_QUEUE_GOOGLE_MAX_ATTEMPTS = "6"
INDEX_QUEUE_RETRY_BASE_MS = "30000"
INDEX_QUEUE_RETRY_MAX_MS = "1800000"
TURNSTILE_REQUIRED = "1"
EXPERIMENT_SEED = "aeo-rev-005-staging"
EXPERIMENT_CONFIG_KEY = "experiment-config-v1"

[[env.staging.d1_databases]]
binding = "DB"
database_name = "clawea-www-staging"
database_id = "82781bed-d57c-4fe7-8269-74f54c12f69d"
preview_database_id = "82781bed-d57c-4fe7-8269-74f54c12f69d"
migrations_dir = "migrations"

[[env.staging.kv_namespaces]]
binding = "VARIANT_CONFIG"
id = "1051001c69364031be8fc0f79324fefc"
preview_id = "fff86d64d9b442e180daecbb2e09fdcc"

[[env.staging.queues.producers]]
binding = "LEAD_JOBS"
queue = "clawea-www-lead-jobs-staging"

[[env.staging.queues.consumers]]
queue = "clawea-www-lead-jobs-staging"
max_batch_size = 25
max_batch_timeout = 10
max_retries = 8

[[env.staging.r2_buckets]]
binding = "ARTICLES"
bucket_name = "clawea-www-staging"
preview_bucket_name = "clawea-www-staging"
