{
  "slug": "workflows/cloud-cost-anomaly-response",
  "title": "Cloud cost anomaly response | Secure Agent Workflow | Claw EA",
  "category": "workflows",
  "html": "<p>This workflow handles a cloud cost spike with permissioned execution: the agent can investigate broadly, but any irreversible action (stop workloads, scale down, disable services) is blocked unless it matches policy-as-code and gets step-up approvals.</p>\n<p>Run it on OpenClaw as the baseline agent runtime, then bind the run to a WPC and a job-scoped CST so every model call and decision is traceable via gateway receipts and a proof bundle.</p>\n\n<h2>Step-by-step runbook</h2>\n<p>Use this when you receive a billing alert, budget threshold breach, or “bill shock” notification from your cloud provider or FinOps tooling. The goal is to move from “spike detected” to “bounded action and verified recovery” without giving an agent broad, prompt-only permissions.</p>\n\n<ol>\n  <li>\n    <p><strong>Open an incident and freeze the blast radius.</strong> Create a job that scopes the agent to a single account, subscription, or billing project, plus a single time window. Issue a CST from clawscope that encodes a scope hash for that job and optionally pins the WPC hash.</p>\n  </li>\n  <li>\n    <p><strong>Bind the run to a WPC before the agent starts.</strong> Store a WPC (Work Policy Contract) in clawcontrols that specifies allowed tools, read versus write phases, and explicit approval gates. The point is that the execution layer must enforce the policy, not the prompt.</p>\n  </li>\n  <li>\n    <p><strong>Collect read-only facts first (no mutations).</strong> Pull cost and usage breakdowns via official API (for example: AWS Cost Explorer, Azure Cost Management, or GCP billing export queries), plus relevant inventory and tag metadata. Keep the agent in a read-only tool profile during this phase and run tools in a sandbox where feasible.</p>\n  </li>\n  <li>\n    <p><strong>Explain the spike with a ranked hypothesis list.</strong> Require the agent to attribute the anomaly to concrete drivers: new resource types, region changes, SKU changes, data egress, logging growth, autoscaling behavior, or failed spot capacity. The output should include “what changed” and “how to verify” with queries the agent already ran.</p>\n  </li>\n  <li>\n    <p><strong>Simulate-first and draft a remediation plan.</strong> Force a dry-run phase where the agent proposes actions and generates a rollback plan, but is not allowed to apply changes. If the provider supports plan mode (for example IaC plan), use that; otherwise, treat “simulate-first” as a hard policy rule that blocks apply tools until approval is recorded.</p>\n  </li>\n  <li>\n    <p><strong>Step-up approvals for irreversible actions.</strong> Any stop/scale/disable operation must require a human approval step that references the incident ID, target resources, and expected cost impact. Approvals can be implemented via an internal ticketing workflow or an MCP server that records approvals, but the WPC must make “approval required” machine-checkable.</p>\n  </li>\n  <li>\n    <p><strong>Execute in a write window with narrow permissions.</strong> Re-issue a tighter CST for the write phase, still pinned to the same WPC, and limit tools to only the exact mutation operations approved. Route model traffic through clawproxy so you receive gateway receipts for every model call used to decide and execute changes.</p>\n  </li>\n  <li>\n    <p><strong>Verify outcomes and package proof.</strong> Re-run the same cost and usage queries for the post-change window, confirm the anomaly slope has normalized, and document residual risk. Produce a proof bundle that includes the gateway receipts, policy hash, scope hash, and execution metadata for audit and later review.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>Cloud cost response is a high-risk automation category because the fastest fixes are often irreversible and affect availability. The controls below focus on preventing an agent from escalating from investigation into unreviewed shutdowns, and on ensuring you can prove what happened after the fact.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Prompt-only “approval” spoofing</td>\n      <td>An agent claims approval in text and proceeds to stop workloads or disable services.</td>\n      <td>WPC-enforced step-up approvals that must be recorded as a real artifact, plus tool gating so write tools cannot run without an approval reference.</td>\n    </tr>\n    <tr>\n      <td>Wrong account or billing scope</td>\n      <td>The agent mitigates costs in the wrong org, subscription, or project, causing outages with no cost benefit.</td>\n      <td>CST scope hash bound to a single account and time window; require policy hash pinning so a different WPC cannot be substituted mid-run.</td>\n    </tr>\n    <tr>\n      <td>Overbroad tool access</td>\n      <td>An investigation step turns into configuration drift, deletion, or security regression.</td>\n      <td>Two-phase tool profiles: read-only first, then a narrow, approved write window; sandbox tools in OpenClaw to reduce local blast radius.</td>\n    </tr>\n    <tr>\n      <td>Runaway model usage during incident</td>\n      <td>Investigation increases your own model spend and slows response.</td>\n      <td>Budget fields in the WPC and operational guardrails in the harness; automatic cost budget enforcement is optional and can be implemented if you need hard stop behavior.</td>\n    </tr>\n    <tr>\n      <td>Disputed post-incident narrative</td>\n      <td>Teams disagree on what the agent saw, what it asked the model, and why it took action.</td>\n      <td>Gateway receipts for model calls from clawproxy, then a proof bundle that binds receipts to the job, CST scope hash, and WPC hash.</td>\n    </tr>\n    <tr>\n      <td>Replay of prior “approved” execution</td>\n      <td>A token or approval artifact is reused to re-run a destructive action later.</td>\n      <td>Marketplace anti-replay binding using job-scoped CST binding, and short TTL CSTs for write phases.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This JSON-like WPC sketch shows the core idea: the agent can read broadly to diagnose a spike, but cannot apply changes until a dry-run completes and a human approval artifact is present. The enforcement point is the execution layer, so the policy is checked even if the prompt is manipulated.</p>\n\n<pre>\n{\n  \"wpc_version\": \"1\",\n  \"intent\": \"cloud_cost_anomaly_response\",\n  \"scope\": {\n    \"cloud_account_ref\": \"aws:123456789012 OR azure:/subscriptions/0000... OR gcp:billingAccount/AAAAAA-BBBBBB-CCCCCC\",\n    \"time_window_utc\": { \"start\": \"2026-02-10T00:00:00Z\", \"end\": \"2026-02-11T00:00:00Z\" }\n  },\n  \"execution\": {\n    \"runtime\": \"openclaw\",\n    \"require_sandbox_for_tools\": true,\n    \"simulate_first\": true,\n    \"phases\": [\n      {\n        \"name\": \"read_only_diagnosis\",\n        \"tools_allow\": [\n          \"cost.query\",\n          \"usage.breakdown\",\n          \"inventory.list\",\n          \"tags.read\",\n          \"logs.read\"\n        ],\n        \"tools_deny\": [ \"stop_workload\", \"scale_down\", \"disable_service\", \"delete_resource\" ]\n      },\n      {\n        \"name\": \"approved_write_window\",\n        \"requires_step_up_approval\": true,\n        \"approval_ref_required\": true,\n        \"tools_allow\": [ \"scale_down\", \"disable_service\", \"stop_workload\" ],\n        \"constraints\": {\n          \"deny_if_missing_rollback_plan\": true,\n          \"max_targets\": 5\n        }\n      }\n    ]\n  },\n  \"token_controls\": {\n    \"cst_required\": true,\n    \"cst_scope_hash_required\": true,\n    \"optional_policy_hash_pinning\": true,\n    \"write_phase_ttl_minutes\": 15\n  },\n  \"budgets\": {\n    \"incident_spend_budget_usd\": 2000,\n    \"model_spend_budget_usd\": 50,\n    \"note\": \"Hard enforcement can be implemented; always record spend estimates and stop conditions.\"\n  },\n  \"model_calls\": {\n    \"route_via\": \"clawproxy\",\n    \"require_gateway_receipts\": true,\n    \"provider_hint\": \"openrouter_via_fal\"\n  },\n  \"audit\": {\n    \"produce_proof_bundle\": true,\n    \"store_trust_pulse\": true\n  }\n}\n</pre>\n\n<h2>What proof do you get?</h2>\n<p>Every model call routed through clawproxy emits gateway receipts. Those receipts make it practical to verify what the model was asked and what it returned during the incident timeline, without relying on a mutable app log.</p>\n<p>Claw EA packages receipts and execution metadata into a proof bundle, including the WPC hash, CST scope hash, and job identifiers. If you use Trust Pulse, you can store the artifact for later viewing and audit, and rely on marketplace anti-replay binding to reduce reuse of job-scoped credentials.</p>\n<p>This proof set is useful for post-incident review: “what data did we query,” “what options did we consider,” “who approved the irreversible step,” and “what was executed under which policy.” It also helps you rerun the same investigation with the same constraints if the anomaly recurs.</p>\n\n<h2>Rollback posture</h2>\n<p>Cost mitigation often trades off availability. Treat rollback as a first-class deliverable: you want a safe way to restore service even if the original mitigation was correct but operationally disruptive.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Scale down a workload</td>\n      <td>Restore previous replica counts or autoscaling settings from the captured baseline, then monitor error rates and queue depth.</td>\n      <td>Pre-change inventory snapshot plus post-change verification queries included in the proof bundle.</td>\n    </tr>\n    <tr>\n      <td>Stop workloads</td>\n      <td>Start only the minimal set of services required for core functionality, then re-enable dependencies in order.</td>\n      <td>Approval reference, target list, and timestamps bound to CST scope hash and WPC hash.</td>\n    </tr>\n    <tr>\n      <td>Disable a cloud service feature</td>\n      <td>Re-enable the feature with the prior configuration, and run a short canary window before full restore.</td>\n      <td>Recorded dry-run outputs and the exact applied change set, plus gateway receipts for the decision path.</td>\n    </tr>\n    <tr>\n      <td>Rotate credentials or revoke access after suspected abuse</td>\n      <td>Issue new least-privilege credentials and re-run the read-only diagnosis to confirm cost drivers persist.</td>\n      <td>CST revocation events, new CST issuance for the follow-up job, and a new proof bundle for the verification pass.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>FAQ</h2>\n\n<h3>Why is prompt-only control not enough for cost anomaly response?</h3>\n<p>Because the dangerous step is not “what the agent says,” it is what the agent can execute. A permissioned execution layer enforces WPC rules even if the model is manipulated into claiming approvals or skipping simulation.</p>\n\n<h3>How do WPC and CST work together during an incident?</h3>\n<p>The WPC defines what is allowed, including dry-run requirements and approval gates. The CST issued by clawscope scopes a specific job and can optionally pin the policy hash, so a run cannot silently switch to a looser policy.</p>\n\n<h3>Do I get an audit trail of the model’s involvement?</h3>\n<p>Yes, if you route model traffic through clawproxy you receive gateway receipts for model calls. Claw EA then bundles those receipts into a proof bundle with job metadata for verification and review.</p>\n\n<h3>Can the agent query AWS, Azure, or GCP billing data?</h3>\n<p>Yes, via official API or via an MCP server you operate. Keep those calls in the read-only phase, then require explicit approvals for any mutation of runtime infrastructure.</p>\n\n<h3>How do you handle budgets if automatic enforcement is not guaranteed?</h3>\n<p>Put budget limits in the WPC and require the agent to compute a spend estimate before proposing changes, then gate write actions on approval. If you need hard stop behavior, automatic cost budget enforcement is optional and can be implemented in the harness.</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (audit + footguns)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n  <li><a href=\"https://cloud.google.com/blog/topics/cost-management/palo-alto-networks-custom-cost-anomaly-detection-with-ai-bill-shocks\">Google Cloud Blog: Palo Alto Networks cost anomaly detection to avoid bill shocks</a></li>\n  <li><a href=\"https://docs.aws.amazon.com/pdfs/prescriptive-guidance/latest/agentic-ai-serverless/agentic-ai-serverless.pdf\">AWS Prescriptive Guidance: Building serverless architectures for agentic AI on AWS</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "This workflow handles a cloud cost spike with permissioned execution: the agent can investigate broadly, but any irreversible action (stop workloads, scale down, disable services) is blocked unless it matches policy-as-c",
  "faqs": [
    {
      "q": "Why is prompt-only control not enough for cost anomaly response?",
      "a": "Because the dangerous step is not “what the agent says,” it is what the agent can execute. A permissioned execution layer enforces WPC rules even if the model is manipulated into claiming approvals or skipping simulation."
    },
    {
      "q": "How do WPC and CST work together during an incident?",
      "a": "The WPC defines what is allowed, including dry-run requirements and approval gates. The CST issued by clawscope scopes a specific job and can optionally pin the policy hash, so a run cannot silently switch to a looser policy."
    },
    {
      "q": "Do I get an audit trail of the model’s involvement?",
      "a": "Yes, if you route model traffic through clawproxy you receive gateway receipts for model calls. Claw EA then bundles those receipts into a proof bundle with job metadata for verification and review."
    },
    {
      "q": "Can the agent query AWS, Azure, or GCP billing data?",
      "a": "Yes, via official API or via an MCP server you operate. Keep those calls in the read-only phase, then require explicit approvals for any mutation of runtime infrastructure."
    },
    {
      "q": "How do you handle budgets if automatic enforcement is not guaranteed?",
      "a": "Put budget limits in the WPC and require the agent to compute a spend estimate before proposing changes, then gate write actions on approval. If you need hard stop behavior, automatic cost budget enforcement is optional and can be implemented in the harness."
    }
  ],
  "sources": [
    {
      "title": "Security Copilot agent development planning guide",
      "uri": "https://learn.microsoft.com/en-us/copilot/security/developer/planning-guide"
    },
    {
      "title": "AWS Prescriptive Guidance - Building serverless architectures for agentic AI on AWS",
      "uri": "https://docs.aws.amazon.com/pdfs/prescriptive-guidance/latest/agentic-ai-serverless/agentic-ai-serverless.pdf"
    },
    {
      "title": "AWS Marketplace: Cloudchipr - Amazon.com",
      "uri": "https://aws.amazon.com/marketplace/pp/prodview-enwub346vrmva"
    },
    {
      "title": "To avoid “bill shocks,” Palo Alto Networks deploys custom AI-powered cost anomaly detection",
      "uri": "https://cloud.google.com/blog/topics/cost-management/palo-alto-networks-custom-cost-anomaly-detection-with-ai-bill-shocks"
    },
    {
      "title": "Use AI for security",
      "uri": "https://cloud.google.com/architecture/framework/security/use-ai-for-security"
    },
    {
      "title": "Playbooks overview",
      "uri": "https://docs.cloud.google.com/security-command-center/docs/playbooks-overview"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T11:36:18.460Z",
  "indexable": true
}