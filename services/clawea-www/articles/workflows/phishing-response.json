{
  "slug": "workflows/phishing-response",
  "title": "Inbox phishing triage with safe links policy | Secure Agent Workflow | Claw EA",
  "category": "workflows",
  "html": "<p>This workflow runs inbox phishing triage under a safe-links-first posture, where the agent is not allowed to click, fetch, or forward anything unless a policy allows it. OpenClaw is the baseline agent runtime, and Claw EA adds permissioned execution so the agent can only take actions covered by a Work Policy Contract (WPC) and a scoped token (CST).</p>\n<p>Prompt-only controls fail because an attacker can embed instructions inside an email, PDF, or landing page and push the model to take irreversible actions. Policy-as-code is the execution layer that stays in force even when the prompt is compromised, and it produces evidence (gateway receipts and a proof bundle) you can verify after the fact.</p>\n\n<h2>Step-by-step runbook</h2>\n<ol>\n  <li>\n    <p><strong>Define the triage scope and outputs.</strong> Decide what the agent is allowed to produce (for example: a verdict, indicators list, and a recommended containment action). Decide what is forbidden without human approval: clicking links, fetching external content, forwarding messages, and quarantining messages.</p>\n  </li>\n  <li>\n    <p><strong>Publish a WPC for “phishing triage: read-only”.</strong> The WPC is a signed, hash-addressed policy artifact served by clawcontrols, and it should express tool limits, data handling rules, and the safe-links policy requirement. Treat the WPC hash as a release artifact, and change it only through your normal change control.</p>\n  </li>\n  <li>\n    <p><strong>Issue a CST pinned to the WPC.</strong> Use clawscope to mint a CST for this job class, with optional policy hash pinning to the WPC so the token cannot be reused under a different policy. Bind the CST to a single triage job when possible to reduce replay value.</p>\n  </li>\n  <li>\n    <p><strong>Run the agent in a sandbox with minimal tools.</strong> In OpenClaw, enable sandboxing for the session and keep the tool profile narrow. Prefer a read-only workspace and deny elevated execution for this workflow so “analyze” cannot turn into “execute”.</p>\n  </li>\n  <li>\n    <p><strong>Integrate mailbox access with least privilege.</strong> For Microsoft 365, access is typically via official API using Microsoft Graph permissions/scopes, with authentication governed by Entra ID. If you are using Conditional Access and PIM, require the same controls for the service principal or delegated user that backs the triage runner.</p>\n  </li>\n  <li>\n    <p><strong>Enforce safe link handling at the policy boundary.</strong> The agent must not dereference URLs directly. If a link must be evaluated, the workflow should rely on Microsoft Defender for Office 365 Safe Links policy outcomes when available, otherwise the agent can only submit the URL to an approved reputation service endpoint via allowlisted egress (optional and environment-specific).</p>\n  </li>\n  <li>\n    <p><strong>Capture and store verification artifacts.</strong> Route model calls through clawproxy so you get gateway receipts for each model call. Store the resulting proof bundle and, when needed, publish a Trust Pulse for audit viewing and later review.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>This workflow assumes inbound email content is hostile. The main risk is that the content manipulates the model into taking irreversible actions or exfiltrating data, especially through link clicking, external fetches, or message forwarding.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Prompt injection inside the email body</td>\n      <td>The model is instructed to “verify the link” or “forward to security” and attempts prohibited actions.</td>\n      <td>Permissioned execution via WPC tool restrictions; deny forward/quarantine tools; enforce “no URL fetch” rule at the tool layer, not in the prompt.</td>\n    </tr>\n    <tr>\n      <td>Malicious link and drive-by content</td>\n      <td>A click or fetch pulls attacker-controlled content and can cascade into more instructions or credential harvesting.</td>\n      <td>Safe-links-first handling; do not dereference URLs; only consult Safe Links policy results or allowlisted reputation endpoints (optional) using controlled egress.</td>\n    </tr>\n    <tr>\n      <td>Data exfiltration through model calls</td>\n      <td>Email content, headers, or PII gets sent to a model provider without a record, or gets mixed into logs.</td>\n      <td>Route model traffic through clawproxy to generate gateway receipts; enforce redaction and “only required fields” extraction in the agent plan; keep mailbox reads scoped and minimal.</td>\n    </tr>\n    <tr>\n      <td>Over-permissioned Graph access</td>\n      <td>The runner can delete, forward, or quarantine broadly, turning a single compromise into a tenant-wide incident.</td>\n      <td>Least-privilege Microsoft Graph permissions/scopes; require Entra ID governance (Conditional Access, PIM where applicable); separate read-only triage identity from remediation identity.</td>\n    </tr>\n    <tr>\n      <td>Replay of a prior authorization</td>\n      <td>A token is reused later to rerun triage or perform unintended actions.</td>\n      <td>Marketplace anti-replay binding using job-scoped CST binding; short TTL CST; optional policy hash pinning to the WPC.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This is a simplified, JSON-like WPC sketch for read-only triage with a safe links policy. It shows the parts that matter operationally: deny irreversible actions, restrict network egress, and add explicit handling for URL artifacts.</p>\n\n<pre>\n{\n  \"wpc_version\": \"1\",\n  \"workflow\": \"phishing_response.inbox_triage\",\n  \"mode\": \"read_only\",\n  \"tools\": {\n    \"allow\": [\n      \"mail.read_headers\",\n      \"mail.read_body\",\n      \"mail.read_attachments_metadata\",\n      \"ioc.extract\",\n      \"report.write_case_notes\"\n    ],\n    \"deny\": [\n      \"mail.forward\",\n      \"mail.quarantine\",\n      \"mail.delete\",\n      \"browser.open\",\n      \"http.fetch\",\n      \"shell.exec\",\n      \"tools.elevated\"\n    ]\n  },\n  \"network\": {\n    \"egress_allowlist\": {\n      \"domains\": [\n        \"graph.microsoft.com\",\n        \"security.microsoft.com\"\n      ],\n      \"ips\": [\n        \"0.0.0.0/32\"\n      ]\n    }\n  },\n  \"url_handling\": {\n    \"do_not_dereference\": true,\n    \"allowed_resolution\": [\n      \"defender_safe_links_verdict_only\"\n    ]\n  },\n  \"input_validation\": {\n    \"treat_external_text_as_untrusted\": true,\n    \"strip_or_quote\": [\n      \"instructions_in_email_body\",\n      \"instructions_in_attachment_text\",\n      \"instructions_in_web_previews\"\n    ],\n    \"require_explicit_user_intent_for\": [\n      \"forward\",\n      \"quarantine\",\n      \"external_fetch\"\n    ]\n  }\n}\n</pre>\n\n<p>The key point is that the deny list blocks the irreversible operations even if the model tries to call them. The egress allowlist is shown explicitly because safe links posture breaks down if the agent can fetch arbitrary URLs (this control can be implemented in your environment and enforced outside clawproxy as an optional hardening layer).</p>\n\n<h2>What proof do you get?</h2>\n<p>Each model call routed through clawproxy emits gateway receipts that are signed and can be verified later. These receipts let you answer basic questions with evidence: which model was called, when, with what policy context, and whether the call was bound to the expected job-scoped CST.</p>\n<p>At the end of a run, Claw EA packages the receipts and related metadata into a proof bundle for audit and verification. If you need a durable, reviewable artifact for stakeholders, you can store and view it as a Trust Pulse, and tie it back to the exact WPC hash and CST scope hash used for the run.</p>\n\n<h2>Rollback posture</h2>\n<p>Phishing triage has a safer rollback posture if you keep the agent read-only and push containment into a separate, approval-gated workflow. That separation reduces the chance that a single injected email can trigger quarantines or message forwarding at scale.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Classify and summarize a suspected phish (read-only)</td>\n      <td>Discard the result; rerun with a newer WPC if needed.</td>\n      <td>Proof bundle linking run inputs, WPC hash, CST scope hash, and gateway receipts.</td>\n    </tr>\n    <tr>\n      <td>Rewrite analyst notes into a case system</td>\n      <td>Revert the case note entry via the case system’s audit history.</td>\n      <td>Gateway receipts for the model calls that produced the note; proof bundle tying the note text to the run.</td>\n    </tr>\n    <tr>\n      <td>Quarantine messages (high risk)</td>\n      <td>Move back or release from quarantine, depending on the mail system’s capabilities.</td>\n      <td>Should be in a separate workflow with its own WPC; proof bundle proves whether quarantine was even permitted.</td>\n    </tr>\n    <tr>\n      <td>Forward emails (high risk)</td>\n      <td>Not reliably reversible once delivered externally.</td>\n      <td>WPC deny list should block it in this workflow; proof bundle shows attempted tool calls if the agent tried.</td>\n    </tr>\n    <tr>\n      <td>Fetch external content from URLs (high risk)</td>\n      <td>Not reversible; can trigger secondary payload delivery or tracking.</td>\n      <td>WPC and egress allowlist prevent dereference; gateway receipts show no external fetch tool calls occurred.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>FAQ</h2>\n\n<h3>Why is policy-as-code required instead of “tell the agent not to click links”?</h3>\n<p>Because the email is untrusted input, and it can contain instructions engineered to override the prompt. Policy-as-code enforces the rule at execution time, so even if the model tries to call a browser or fetch tool, the call is denied by the WPC.</p>\n\n<h3>How do Safe Links policies fit into this workflow?</h3>\n<p>Safe Links is the organizational control that rewrites and checks URLs in Microsoft Defender for Office 365. This workflow treats Safe Links outcomes as the only acceptable “link evaluation” signal, and it blocks direct URL dereferencing by the agent.</p>\n\n<h3>Can this triage run against Microsoft 365 mailboxes?</h3>\n<p>Yes, typically via official API using Microsoft Graph permissions/scopes with Entra ID authentication. Keep triage read-only and use a separate identity and WPC for any remediation actions like quarantining.</p>\n\n<h3>What stops token reuse or replay across jobs?</h3>\n<p>CSTs are issued by clawscope and can be bound to a job using marketplace anti-replay binding (job-scoped CST binding). You can also use optional policy hash pinning so the CST is only valid under the intended WPC.</p>\n\n<h3>What does an auditor actually review after an incident?</h3>\n<p>They review the WPC hash that defined allowed actions, the CST scope hash used for the run, and the gateway receipts for model calls emitted by clawproxy. The proof bundle packages these artifacts so verification does not rely on screenshots or application logs alone.</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (audit + footguns)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/defender-office-365/safe-links-policies-configure\">Set up Safe Links policies in Microsoft Defender for Office 365</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/defender-xdr/phishing-triage-agent\">Microsoft Defender XDR phishing triage agent documentation</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "This workflow runs inbox phishing triage under a safe-links-first posture, where the agent is not allowed to click, fetch, or forward anything unless a policy allows it. OpenClaw is the baseline agent runtime, and Claw E",
  "faqs": [
    {
      "q": "Why is policy-as-code required instead of “tell the agent not to click links”?",
      "a": "Because the email is untrusted input, and it can contain instructions engineered to override the prompt. Policy-as-code enforces the rule at execution time, so even if the model tries to call a browser or fetch tool, the call is denied by the WPC."
    },
    {
      "q": "How do Safe Links policies fit into this workflow?",
      "a": "Safe Links is the organizational control that rewrites and checks URLs in Microsoft Defender for Office 365. This workflow treats Safe Links outcomes as the only acceptable “link evaluation” signal, and it blocks direct URL dereferencing by the agent."
    },
    {
      "q": "Can this triage run against Microsoft 365 mailboxes?",
      "a": "Yes, typically via official API using Microsoft Graph permissions/scopes with Entra ID authentication. Keep triage read-only and use a separate identity and WPC for any remediation actions like quarantining."
    },
    {
      "q": "What stops token reuse or replay across jobs?",
      "a": "CSTs are issued by clawscope and can be bound to a job using marketplace anti-replay binding (job-scoped CST binding). You can also use optional policy hash pinning so the CST is only valid under the intended WPC."
    },
    {
      "q": "What does an auditor actually review after an incident?",
      "a": "They review the WPC hash that defined allowed actions, the CST scope hash used for the run, and the gateway receipts for model calls emitted by clawproxy. The proof bundle packages these artifacts so verification does not rely on screenshots or application logs alone."
    }
  ],
  "sources": [
    {
      "title": "Microsoft Security Copilot Phishing Triage Agent in Microsoft Defender",
      "uri": "https://learn.microsoft.com/en-us/defender-xdr/phishing-triage-agent"
    },
    {
      "title": "Microsoft Security Copilot agents overview",
      "uri": "https://learn.microsoft.com/en-us/copilot/security/agents-overview"
    },
    {
      "title": "AWS Marketplace: Abnormal - Cloud Email Security - Amazon.com",
      "uri": "https://aws.amazon.com/marketplace/pp/prodview-erwjiypgjdjps"
    },
    {
      "title": "Cloud CISO Perspectives: Our Big Sleep agent makes a big leap",
      "uri": "https://cloud.google.com/blog/products/identity-security/cloud-ciso-perspectives-our-big-sleep-agent-makes-big-leap"
    },
    {
      "title": "Configure the advanced delivery policy for non-Microsoft phishing simulations and email delivery to SecOps mailboxes - Microsoft Defender for Office 365",
      "uri": "https://learn.microsoft.com/en-us/defender-office-365/advanced-delivery-policy-configure"
    },
    {
      "title": "Set up Safe Links policies in Microsoft Defender for Office 365 - Microsoft Defender for Office 365",
      "uri": "https://learn.microsoft.com/en-us/defender-office-365/safe-links-policies-configure"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T11:44:58.564Z",
  "indexable": true
}