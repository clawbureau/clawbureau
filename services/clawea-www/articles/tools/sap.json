{
  "slug": "tools/sap",
  "title": "SAP for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "\n<p>SAP systems hold financial records, purchase orders, vendor master data, and HR payroll. An agent with write access to SAP via official API can post journal entries, approve purchase requisitions, or modify supplier bank details. Prompt-level instructions alone cannot prevent a misconfigured or compromised agent from executing these actions; you need machine-enforced policy gates that restrict which API calls are permitted, scope credentials to specific operations, and produce tamper-evident audit records for every model-assisted action.</p>\n\n<p>Claw EA connects to SAP via official API with enterprise buildout controls. This integration is planned and requires WPC approval gates, scoped tokens (CST), and explicit least-privilege auth scopes before any write or admin action reaches SAP.</p>\n\n<h2>Step-by-step runbook</h2>\n\n<ol>\n<li><strong>Map the SAP surface.</strong> Identify which SAP APIs the agent needs (e.g., OData services for purchase orders, BAPI wrappers for goods receipt). List every endpoint and HTTP method. Read-only endpoints go in one group; write and admin endpoints go in another.</li>\n\n<li><strong>Author a Work Policy Contract (WPC).</strong> Encode the allowed SAP endpoints, HTTP methods, and business object types into a signed WPC. The WPC is hash-addressed and stored in the clawcontrols registry, so any modification produces a different hash and fails verification.</li>\n\n<li><strong>Issue a scoped token (CST).</strong> Use clawscope to mint a CST pinned to the WPC's policy hash. The CST limits the agent's session to the exact SAP operations declared in the contract. Pin it to a specific job ID for anti-replay binding.</li>\n\n<li><strong>Configure the OpenClaw agent.</strong> OpenClaw is the baseline agent runtime. Set the agent's tool policy to deny all SAP write tools by default, then allow only the endpoints listed in the WPC. Run the agent in sandbox mode to contain tool execution.</li>\n\n<li><strong>Route model calls through clawproxy.</strong> All LLM inference passes through clawproxy, which emits gateway receipts for each model call. These receipts record the prompt hash, model identifier, and timestamp.</li>\n\n<li><strong>Execute and collect proof.</strong> When the agent completes its SAP task, a proof bundle is assembled containing gateway receipts, the WPC hash, and the CST binding. Store the resulting Trust Pulse artifact for audit viewing.</li>\n\n<li><strong>Review and rotate.</strong> After each job, verify the proof bundle. Rotate the CST. If the WPC needs changes (new endpoints, broader scope), a new contract must be signed and a new hash issued.</li>\n</ol>\n\n<h2>Threat model</h2>\n\n<table>\n<thead>\n<tr><th>Threat</th><th>What happens</th><th>Control</th></tr>\n</thead>\n<tbody>\n<tr><td>Agent posts fraudulent journal entries</td><td>Financial statements are corrupted; regulatory exposure</td><td>WPC restricts allowed transaction codes and API endpoints; CST scoped to read-only unless explicit write approval exists</td></tr>\n<tr><td>Prompt injection via SAP notification text</td><td>Attacker-controlled text in a purchase order description tricks the agent into approving or modifying records</td><td>OpenClaw sandbox isolates tool execution; tool policy denies elevated actions; gateway receipts capture the model call that preceded the action</td></tr>\n<tr><td>Credential over-provisioning</td><td>Agent's SAP service account has SAP_ALL or broad authorization objects, enabling lateral movement across modules</td><td>CST is pinned to a specific policy hash; the WPC enumerates exact OData paths and methods; SAP-side service account uses least-privilege authorization objects</td></tr>\n<tr><td>Replay of a previous job's token</td><td>Old CST is reused to execute unauthorized SAP operations</td><td>Marketplace anti-replay binding ties CST to a specific job ID; reuse in a different context fails validation</td></tr>\n<tr><td>Agent modifies vendor bank details</td><td>Payment fraud via supplier master data manipulation</td><td>WPC excludes vendor master write endpoints; any attempt to call them is blocked before reaching SAP</td></tr>\n</tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n\n<pre><code>{\n  \"wpc_version\": \"1.0\",\n  \"name\": \"sap-po-read-agent\",\n  \"target\": \"sap\",\n  \"connection\": \"official_api\",\n  \"auth\": {\n    \"type\": \"oauth\",\n    \"scope\": [\"API_PURCHASEORDER_2.read\"]\n  },\n  \"allowed_operations\": [\n    {\n      \"service\": \"API_PURCHASEORDER_2\",\n      \"methods\": [\"GET\"],\n      \"entity_sets\": [\"A_PurchaseOrder\", \"A_PurchaseOrderItem\"]\n    }\n  ],\n  \"denied_operations\": [\n    {\n      \"service\": \"API_PURCHASEORDER_2\",\n      \"methods\": [\"POST\", \"PATCH\", \"DELETE\"]\n    },\n    {\n      \"service\": \"API_BUSINESS_PARTNER\",\n      \"methods\": [\"*\"]\n    }\n  ],\n  \"cst_binding\": {\n    \"policy_hash_pinned\": true,\n    \"max_ttl_seconds\": 900\n  }\n}</code></pre>\n\n<p>This WPC allows the agent to read purchase orders but blocks creation, modification, and deletion. It also denies all access to the Business Partner API, preventing vendor master changes. The CST is pinned to this policy hash and expires after 15 minutes.</p>\n\n<h2>What proof do you get?</h2>\n\n<p>Every model call the agent makes is routed through clawproxy, which emits a <strong>gateway receipt</strong> containing the prompt hash, model identifier, response hash, and timestamp. These receipts are signed and cannot be altered after the fact.</p>\n\n<p>At job completion, receipts are bundled with the WPC hash and CST metadata into a <strong>proof bundle</strong>. This bundle is the single artifact an auditor needs to reconstruct what the agent was allowed to do, what model calls it made, and whether the policy was respected throughout execution.</p>\n\n<p>The proof bundle is stored as a <strong>Trust Pulse</strong> artifact, viewable in the marketplace. For SAP-regulated environments (SOX, GxP), this gives you a per-job audit trail that ties agent behavior back to a specific, immutable policy contract. Transparency log inclusion proofs are planned and can be added when available.</p>\n\n<h2>Rollback posture</h2>\n\n<table>\n<thead>\n<tr><th>Action</th><th>Safe rollback</th><th>Evidence</th></tr>\n</thead>\n<tbody>\n<tr><td>Agent posted an incorrect goods receipt</td><td>Reverse the material document in SAP using standard reversal transaction; revoke the CST immediately via clawscope</td><td>Proof bundle shows the exact model call and WPC that authorized the action</td></tr>\n<tr><td>CST leaked or suspected compromise</td><td>Revoke the CST; issue a new one with a fresh job binding; no SAP credentials are embedded in the CST itself</td><td>Revocation event logged in clawscope audit trail</td></tr>\n<tr><td>WPC found to be overly permissive</td><td>Publish a new, tighter WPC with a new hash; old CSTs pinned to the previous hash become invalid for new jobs</td><td>Old and new WPC hashes are both in the clawcontrols registry for comparison</td></tr>\n<tr><td>Agent ran against wrong SAP tenant</td><td>Kill the agent session; CST anti-replay binding prevents the same token from being used on a different job</td><td>Gateway receipts show which model calls were made; proof bundle ties them to the specific CST and WPC</td></tr>\n</tbody>\n</table>\n\n<h2>FAQ</h2>\n\n<h3>Is the SAP integration available as a native connector today?</h3>\n<p>No. SAP connectivity is planned and requires enterprise buildout. The agent connects to SAP via official API using OAuth, API key, or service account authentication. Write and admin actions require WPC approval gates and scoped tokens before any call reaches SAP.</p>\n\n<h3>Why can't prompt instructions replace policy-as-code for SAP?</h3>\n<p>A prompt instruction like \"do not modify vendor bank details\" is advisory. The model can ignore it, especially under prompt injection. A WPC is a signed, hash-addressed artifact that is enforced at the execution layer before the API call is made. The agent never gets the chance to call a denied endpoint.</p>\n\n<h3>How does this work with SAP's own authorization model?</h3>\n<p>Claw EA's controls operate as an outer boundary. The SAP service account should still use least-privilege authorization objects (e.g., restrict to specific company codes or purchasing organizations). The WPC adds a second, agent-specific layer that is independent of SAP's internal role assignments.</p>\n\n<h3>Can the agent use SAP's Joule alongside Claw EA controls?</h3>\n<p>Joule is SAP's embedded AI copilot with its own interaction patterns. If your agent calls SAP APIs that Joule also uses, the WPC and CST controls apply to your agent's calls regardless. Joule's own security model is managed within SAP BTP.</p>\n\n<h3>What happens if automatic cost budget enforcement is needed?</h3>\n<p>Automatic cost budget enforcement is planned. Today, you can set a short CST TTL (e.g., 15 minutes) and limit the number of allowed operations in the WPC to bound exposure. Per-call cost tracking is available through gateway receipts.</p>\n\n<h2>Sources</h2>\n<ul>\n<li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security</a></li>\n<li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n<li><a href=\"https://community.sap.com/t5/security-and-compliance-blog-posts/limiting-agent-autonomy-least-privilege-and-tool-access-for-agentic-ai/ba-p/14224584\">Agent IAM and the Principle of Least Privilege - SAP Community</a></li>\n<li><a href=\"https://community.sap.com/t5/technology-blog-posts-by-sap/securing-enterprise-ai-on-sap-btp-zero-trust-authentication-with-sap-ai/ba-p/14289975\">Securing Enterprise AI on SAP BTP: Zero Trust Authentication - SAP Community</a></li>\n<li><a href=\"https://architecture.learning.sap.com/docs/ref-arch/e5eb3b9b1d/5\">AI Agents and Agent Builder - SAP Architecture Center</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "SAP systems hold financial records, purchase orders, vendor master data, and HR payroll. An agent with write access to SAP via official API can post journal entries, approve purchase requisitions, or modify supplier bank",
  "faqs": [
    {
      "q": "Is the SAP integration available as a native connector today?",
      "a": "No. SAP connectivity is planned and requires enterprise buildout. The agent connects to SAP via official API using OAuth, API key, or service account authentication. Write and admin actions require WPC approval gates and scoped tokens before any call reaches SAP."
    },
    {
      "q": "Why can't prompt instructions replace policy-as-code for SAP?",
      "a": "A prompt instruction like \"do not modify vendor bank details\" is advisory. The model can ignore it, especially under prompt injection. A WPC is a signed, hash-addressed artifact that is enforced at the execution layer before the API call is made. The agent never gets the chance to call a denied endpoint."
    },
    {
      "q": "How does this work with SAP's own authorization model?",
      "a": "Claw EA's controls operate as an outer boundary. The SAP service account should still use least-privilege authorization objects (e.g., restrict to specific company codes or purchasing organizations). The WPC adds a second, agent-specific layer that is independent of SAP's internal role assignments."
    },
    {
      "q": "Can the agent use SAP's Joule alongside Claw EA controls?",
      "a": "Joule is SAP's embedded AI copilot with its own interaction patterns. If your agent calls SAP APIs that Joule also uses, the WPC and CST controls apply to your agent's calls regardless. Joule's own security model is managed within SAP BTP."
    },
    {
      "q": "What happens if automatic cost budget enforcement is needed?",
      "a": "Automatic cost budget enforcement is planned. Today, you can set a short CST TTL (e.g., 15 minutes) and limit the number of allowed operations in the WPC to bound exposure. Per-call cost tracking is available through gateway receipts."
    }
  ],
  "sources": [
    {
      "title": "Securing Enterprise AI on SAP BTP:  Zero Trust Aut... - SAP Community",
      "uri": "https://community.sap.com/t5/technology-blog-posts-by-sap/securing-enterprise-ai-on-sap-btp-zero-trust-authentication-with-sap-ai/ba-p/14289975"
    },
    {
      "title": "Agent IAM and the Principle of Least Privilege",
      "uri": "https://community.sap.com/t5/security-and-compliance-blog-posts/limiting-agent-autonomy-least-privilege-and-tool-access-for-agentic-ai/ba-p/14224584"
    },
    {
      "title": "Principles to Practice: Securing SAP Business AI",
      "uri": "https://community.sap.com/t5/human-capital-management-blog-posts-by-sap/principles-to-practice-securing-sap-business-ai/ba-p/14090586"
    },
    {
      "title": "AI Agents & Agent Builder | SAP Architecture Center",
      "uri": "https://architecture.learning.sap.com/docs/ref-arch/e5eb3b9b1d/5"
    },
    {
      "title": "8 Critical Pain Points of MCP in an Enterprise - SAP Community",
      "uri": "https://community.sap.com/t5/artificial-intelligence-blogs-posts/8-critical-pain-points-of-mcp-in-an-enterprise/ba-p/14303370"
    },
    {
      "title": "Integrating and Extending Joule - SAP Architecture Center",
      "uri": "https://architecture.learning.sap.com/docs/ref-arch/06ff6062dc"
    },
    {
      "title": "Exploring Joule & Joule Agents - SAP Learning",
      "uri": "https://learning.sap.com/courses/becoming-an-sap-btp-solution-architect/using-joule"
    },
    {
      "title": "SAP Business AI - SAP Support Portal",
      "uri": "https://support.sap.com/en/product/onboarding-resource-center/business-ai.html"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T16:37:47.152Z",
  "indexable": true
}