{
  "slug": "tools/azure-storage",
  "title": "Azure Storage for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "<h2>Direct Answer</h2>\n<p>Azure Storage is a high-impact tool for enterprise agents because it can read and write business data at scale, and small mistakes turn into large data exposure or data loss. Claw EA treats Azure Storage access as permissioned execution: actions are allowed only when a Work Policy Contract (WPC) is satisfied, and the run is bound to scoped tokens (CST) plus verifiable gateway receipts and proof bundles.</p>\n<p>This is not a native connector today. Azure Storage can be connected via official API with enterprise buildout controls, with write and admin actions gated by WPC approval, CST scope hash, and explicit least-privilege auth scopes.</p>\n\n<h2>Step-by-step runbook</h2>\n<p>Use this runbook when you want an OpenClaw-based agent to interact with blobs, containers, or queues without turning “agent can access storage” into “agent can exfiltrate everything.” The goal is deterministic permissions, traceable runs, and fast rollback.</p>\n<ol>\n  <li>\n    <p><strong>Define the storage blast radius</strong> (accounts, containers, prefixes, and operations). Treat “list containers” and “enumerate blobs” as sensitive because it reveals names, tenancy structure, and data layout.</p>\n    <p>Write down the minimum set of operations for the job, for example: read a single prefix, write to a staging prefix, delete only temporary outputs.</p>\n  </li>\n  <li>\n    <p><strong>Choose the enterprise auth pattern</strong> for Azure Storage via official API. For enterprise builds, this is typically Microsoft Entra ID with a service principal or managed identity, then Azure RBAC roles on the storage account or container.</p>\n    <p>Use least privilege and separate identities for read-only versus write paths; avoid reusing human identities for agent runs.</p>\n  </li>\n  <li>\n    <p><strong>Create a WPC that encodes allowed operations</strong> for the Azure Storage tool. The WPC should include the allowed account, container, and prefix constraints, plus whether “list” is permitted.</p>\n    <p>Store the signed, hash-addressed WPC in the WPC registry (served by clawcontrols) and treat the hash as the policy identifier used in runs.</p>\n  </li>\n  <li>\n    <p><strong>Issue job-scoped CST</strong> (from clawscope) that pins to the WPC hash when you need strict change control. This keeps an agent from silently switching to a broader policy mid-run, and supports anti-replay binding for job-scoped CST usage.</p>\n    <p>Set short TTLs and rotate between jobs. Do not reuse CST across unrelated tasks.</p>\n  </li>\n  <li>\n    <p><strong>Route model calls through clawproxy</strong> so you get gateway receipts for every model call used to plan or justify storage actions. This matters when an incident review needs to connect “why was delete called” to the model outputs that caused it.</p>\n    <p>At the end of the run, collect the proof bundle that ties together the receipts and metadata required for verification and audit.</p>\n  </li>\n  <li>\n    <p><strong>Run in OpenClaw with sandbox and tool policy enabled</strong> as the baseline runtime control. Use OpenClaw’s tool policy and sandboxing to limit local file and process access, then use the WPC for remote action constraints.</p>\n    <p>Run OpenClaw’s security audit regularly after config or policy changes to catch common “open gateway” and permission footguns.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>Azure Storage is attractive to attackers because it is both data and delivery: it can store sensitive documents and also serve as a staging area for malicious payloads. Agents add risk because they can be driven by prompt injection, mis-scoped credentials, or unsafe tooling defaults.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control (operational)</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Overbroad read access</td>\n      <td>Agent lists containers or reads large prefixes, leaking regulated data into prompts, logs, or downstream tools.</td>\n      <td>WPC restricts account, container, and prefix; CST scope hash enforces the bound policy; separate read identities; disable list operations unless required.</td>\n    </tr>\n    <tr>\n      <td>Unsafe write or overwrite</td>\n      <td>Agent overwrites canonical blobs, corrupts datasets, or writes unreviewed content into production paths.</td>\n      <td>WPC requires explicit allowlist of write prefixes and disallows overwrite unless named; require a review gate for “write to prod” actions; use separate storage location for drafts.</td>\n    </tr>\n    <tr>\n      <td>Destructive delete</td>\n      <td>Agent deletes containers or critical blobs due to a misread instruction or malicious prompt.</td>\n      <td>WPC blocks delete by default; allow delete only on temporary prefixes with narrow patterns; use time-limited CST and require re-authorization for any delete expansion.</td>\n    </tr>\n    <tr>\n      <td>Credential misuse and replay</td>\n      <td>Tokens are copied from one job to another, or from a lower-trust environment into prod, then used to access storage.</td>\n      <td>Job-scoped CST binding to prevent replay across jobs; short TTL; separate Entra ID applications per environment; rotate secrets and revoke on incident.</td>\n    </tr>\n    <tr>\n      <td>Prompt injection leading to exfiltration</td>\n      <td>Agent is tricked into uploading local files or secrets to a blob, or into copying blobs to attacker-controlled locations.</td>\n      <td>OpenClaw sandbox and tool policy limit local file reads; WPC denies unknown destinations and restricts uploads to approved prefixes; human approval gate for cross-account copy.</td>\n    </tr>\n    <tr>\n      <td>Audit gaps</td>\n      <td>You cannot prove what the model said, what policy was in force, or which runs touched which data.</td>\n      <td>Route model calls through clawproxy for gateway receipts; produce a proof bundle per run; store the bundle for later verification and attach it to change tickets.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This example shows the shape of a WPC that constrains Azure Storage actions. Treat it as a sketch: your enterprise buildout can map these fields to the specific Azure Storage operations you allow via official API.</p>\n<pre>{\n  \"wpc_version\": \"1\",\n  \"policy_name\": \"azure-storage-ingest-staging-only\",\n  \"constraints\": {\n    \"azure\": {\n      \"tenant_id\": \"00000000-0000-0000-0000-000000000000\",\n      \"subscription_id\": \"11111111-1111-1111-1111-111111111111\"\n    },\n    \"storage\": {\n      \"accounts\": [\"stgacct01\"],\n      \"containers\": [\"ingest\"],\n      \"prefix_allowlist\": [\"incoming/\", \"work/\"],\n      \"operations\": {\n        \"allow\": [\"blob.read\", \"blob.write\", \"blob.list\"],\n        \"deny\": [\"container.delete\", \"blob.delete\", \"account.list\"]\n      },\n      \"write_rules\": {\n        \"no_overwrite\": true,\n        \"max_object_bytes\": 104857600\n      }\n    }\n  },\n  \"approvals\": {\n    \"required_for\": [\"any_delete\", \"write_outside_prefix_allowlist\"]\n  },\n  \"attestation\": {\n    \"require_cst_policy_hash_pinning\": true\n  }\n}</pre>\n<p>Prompt-only controls fail here because the model can be induced to ignore text instructions under pressure. A permissioned execution layer enforces the policy even when the prompt is adversarial, and it fails closed when a requested action is outside the WPC.</p>\n\n<h2>What proof do you get?</h2>\n<p>For model reasoning and planning, clawproxy emits gateway receipts for model calls. These receipts are signed and can be used to verify what model traffic occurred during the run, which matters when a storage action needs post-incident justification.</p>\n<p>Claw EA packages receipts and run metadata into a proof bundle. In practice, you attach the proof bundle to your incident ticket or change record, and optionally store a Trust Pulse artifact for audit viewing.</p>\n<p>For Azure Storage actions themselves, the enterprise buildout can log and correlate tool invocations to the same job identifier and CST used for the run. This gives you one thread from “who authorized” to “what policy was in force” to “what the agent attempted.”</p>\n\n<h2>Rollback posture</h2>\n<p>Rollback for agents touching storage is about constraining what can change, then making reversal cheap. You want a safe stop that works even when the agent is confused or the prompt is hostile.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence to collect</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Agent begins unexpected enumeration</td>\n      <td>Revoke the CST and end the job; tighten WPC to remove list permissions and reissue a new CST for a corrected run.</td>\n      <td>Proof bundle plus the WPC hash referenced by the CST; list of attempted operations and affected prefixes.</td>\n    </tr>\n    <tr>\n      <td>Unexpected writes to a prefix</td>\n      <td>Move writes behind a staging prefix; block additional writes by updating policy and rotating credentials; clean up staging content with a scripted, human-reviewed job.</td>\n      <td>Proof bundle; inventory of written blob names and hashes; job-scoped CST identifier used for the run.</td>\n    </tr>\n    <tr>\n      <td>Suspected credential leakage</td>\n      <td>Revoke CST immediately; rotate Entra ID secrets or credential material; reduce RBAC role scope; require re-approval to resume.</td>\n      <td>Proof bundle; CST issuance and revocation records; affected storage account and identity.</td>\n    </tr>\n    <tr>\n      <td>Need to pause all agent storage access</td>\n      <td>Fail closed by removing WPC approval for any storage actions and blocking CST issuance for that policy until review completes.</td>\n      <td>WPC change record, policy hash history, and proof bundles from recent runs for sampling.</td>\n    </tr>\n  </tbody>\n</table>\n<p>Some controls such as egress allowlists enforced outside clawproxy can be implemented as part of an enterprise buildout if you need additional containment. Treat that as a separate layer from permissioning the storage tool itself.</p>\n\n<h2>FAQ</h2>\n<h3>Is Azure Storage supported as a native Claw EA connector today?</h3>\n<p>No. Azure Storage can be connected via official API with enterprise buildout controls, and you should plan for a scoped, audited tool implementation rather than assuming out-of-the-box connectivity.</p>\n\n<h3>Why is prompt-only guidance not enough for storage access?</h3>\n<p>Because prompts are not enforcement. A WPC is enforced by the execution layer, so disallowed reads, writes, and deletes fail closed even if the model is manipulated or simply mistaken.</p>\n\n<h3>How do WPC and CST work together for least privilege?</h3>\n<p>The WPC defines the allowed operations and scope, and the CST is issued to match that scope for a specific job. With CST scope hash and optional policy hash pinning, the run stays bound to the intended policy.</p>\n\n<h3>What Microsoft controls should we pair with Claw EA?</h3>\n<p>Use Microsoft Entra ID identities (managed identity or app registrations), Azure RBAC roles scoped to the smallest resource set, and Conditional Access and PIM for human administrators. Keep admin actions separate from agent identities and require explicit approvals for privilege increases.</p>\n\n<h3>What do we hand to audit or incident response?</h3>\n<p>Provide the WPC hash, CST identifiers used for the run, gateway receipts, and the proof bundle. If you use Trust Pulse, store the audit artifact there for consistent review access.</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (audit + footguns)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/governance-security-across-organization\">Governance and security for AI agents across the organization (Microsoft Learn)</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/build-secure-process\">Process to build agents across your organization (Microsoft Learn)</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "Azure Storage is a high-impact tool for enterprise agents because it can read and write business data at scale, and small mistakes turn into large data exposure or data loss. Claw EA treats Azure Storage access as permis",
  "faqs": [
    {
      "q": "Is Azure Storage supported as a native Claw EA connector today?",
      "a": "No. Azure Storage can be connected via official API with enterprise buildout controls, and you should plan for a scoped, audited tool implementation rather than assuming out-of-the-box connectivity."
    },
    {
      "q": "Why is prompt-only guidance not enough for storage access?",
      "a": "Because prompts are not enforcement. A WPC is enforced by the execution layer, so disallowed reads, writes, and deletes fail closed even if the model is manipulated or simply mistaken."
    },
    {
      "q": "How do WPC and CST work together for least privilege?",
      "a": "The WPC defines the allowed operations and scope, and the CST is issued to match that scope for a specific job. With CST scope hash and optional policy hash pinning, the run stays bound to the intended policy."
    },
    {
      "q": "What Microsoft controls should we pair with Claw EA?",
      "a": "Use Microsoft Entra ID identities (managed identity or app registrations), Azure RBAC roles scoped to the smallest resource set, and Conditional Access and PIM for human administrators. Keep admin actions separate from agent identities and require explicit approvals for privilege increases."
    },
    {
      "q": "What do we hand to audit or incident response?",
      "a": "Provide the WPC hash, CST identifiers used for the run, gateway receipts, and the proof bundle. If you use Trust Pulse, store the audit artifact there for consistent review access."
    }
  ],
  "sources": [
    {
      "title": "Governance and security for AI agents across the organization",
      "uri": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/governance-security-across-organization"
    },
    {
      "title": "Process to build agents across your organization - Microsoft Learn",
      "uri": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/build-secure-process"
    },
    {
      "title": "Azure permissions for AI + machine learning",
      "uri": "https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/ai-machine-learning"
    },
    {
      "title": "Enterprise security and governance - Azure Machine Learning",
      "uri": "https://learn.microsoft.com/en-us/azure/machine-learning/concept-enterprise-security?view=azureml-api-2"
    },
    {
      "title": "Set up your environment for Azure AI Foundry Agent Service - Azure AI Foundry",
      "uri": "https://learn.microsoft.com/en-us/azure/ai-foundry/agents/environment-setup"
    },
    {
      "title": "Azure permissions for Security - Microsoft Learn",
      "uri": "https://learn.microsoft.com/en-us/azure/role-based-access-control/permissions/security"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T12:13:16.873Z",
  "indexable": true
}