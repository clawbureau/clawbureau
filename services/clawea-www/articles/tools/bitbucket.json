{
  "slug": "tools/bitbucket",
  "title": "Bitbucket for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "<p>Bitbucket is a high-impact surface for enterprise agents because a single token can grant read access to proprietary code, and write access can change what gets built, tested, and deployed. If you want an agent to touch Bitbucket safely, you need permissioned execution that is enforced by policy-as-code, not prompt-only guidance.</p>\n<p>Claw EA runs OpenClaw as the baseline agent runtime and adds an execution permission layer: WPC = Work Policy Contract gates what the agent may do, CST = scoped token limits where it can do it, and clawproxy emits gateway receipts for model calls that can be packaged into proof bundles for audit and replay checks.</p>\n\n<h2>Step-by-step runbook</h2>\n<ol>\n  <li>\n    <p>Define the Bitbucket actions you actually need, separated into read-only and write/admin. Start with read-only for repository browsing, diff review, and PR summarization, then add narrowly-scoped write actions (commenting on PRs, opening PRs) only when there is an owner-approved use case.</p>\n  </li>\n  <li>\n    <p>Create a WPC = Work Policy Contract that encodes allowed repositories, allowed operations, and required human approvals. Treat “merge”, “branch deletion”, “permission changes”, and “pipeline config changes” as denied by default unless you have a formal change process.</p>\n  </li>\n  <li>\n    <p>Provision Bitbucket authentication via official API with enterprise buildout controls. Use least-privilege auth scopes and separate identities for read actions versus write actions, so a compromise in a read workflow does not silently become a write workflow.</p>\n  </li>\n  <li>\n    <p>Issue a CST = scoped token (issued by clawscope) to the agent job, scoped to the specific WPC and the specific tool capabilities. Enable optional policy hash pinning so the CST is only valid when the exact WPC hash is in force.</p>\n  </li>\n  <li>\n    <p>Run the agent inside OpenClaw with sandboxing and a tight tool allowlist. Use OpenClaw’s separation of sandbox, tool policy, and elevated execution to ensure that a Bitbucket workflow cannot “accidentally” become shell access or filesystem traversal.</p>\n  </li>\n  <li>\n    <p>Route model calls through clawproxy so you get gateway receipts. Store the resulting proof bundle alongside the Bitbucket change record (PR link, commit SHA) so an auditor can verify what the model was asked and what it returned.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>Bitbucket risk is not just “bad code suggestions”. The more common enterprise failures are token misuse, unintended write scope, and agent-triggered changes that bypass normal review and traceability.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Prompt injection via issue, PR comment, or README</td>\n      <td>The agent is tricked into exfiltrating code, changing a pipeline file, or modifying security checks while claiming it is following instructions.</td>\n      <td>WPC denies sensitive write paths by default; OpenClaw tool allowlists limit what tools can run; require approval gates for write/admin actions.</td>\n    </tr>\n    <tr>\n      <td>Over-privileged Bitbucket token</td>\n      <td>A “helper” token quietly has admin rights, enabling repo permission changes, branch deletion, or bypassing protection rules.</td>\n      <td>Split identities and scopes; WPC approval gates for write/admin actions; CST scoping to restrict which actions can be invoked in the job.</td>\n    </tr>\n    <tr>\n      <td>Unreviewed changes to CI configuration</td>\n      <td>The agent edits build definitions or pipeline scripts and introduces supply-chain risk, or disables security scanning.</td>\n      <td>WPC denies changes to CI and security-critical files unless explicitly allowed; require PR-based workflow only, no direct pushes.</td>\n    </tr>\n    <tr>\n      <td>Cross-repo data leakage</td>\n      <td>An agent working in one project reads another project’s repo because the token is org-wide, then summarizes proprietary code into an external model prompt.</td>\n      <td>WPC restricts repositories by allowlist; CST scope hash ties the job to that policy; route model calls through clawproxy for receipts and review.</td>\n    </tr>\n    <tr>\n      <td>Replay or “same token, new job” misuse</td>\n      <td>A valid credential is reused later to run different instructions against the same repos without the original approvals.</td>\n      <td>Marketplace anti-replay binding using job-scoped CST binding; require per-job CST issuance with short TTL and policy hash pinning.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This is a simplified, JSON-like sketch of how teams typically encode Bitbucket constraints in a WPC. The key is that the policy is machine-enforced at execution time, not “suggested” in a system prompt.</p>\n<pre>\n{\n  \"tool\": \"bitbucket_via_official_api\",\n  \"policy\": {\n    \"repos_allowlist\": [\n      \"WORKSPACE_A/proj-web\",\n      \"WORKSPACE_A/proj-api\"\n    ],\n    \"read\": {\n      \"allow\": [\"list_repos\", \"get_file\", \"get_diff\", \"list_prs\", \"get_pr\"]\n    },\n    \"write\": {\n      \"allow\": [\"create_branch\", \"create_pr\", \"comment_pr\"],\n      \"deny\": [\"merge_pr\", \"delete_branch\", \"change_repo_permissions\", \"direct_push_main\"],\n      \"approval_required\": true\n    },\n    \"paths\": {\n      \"deny_globs\": [\n        \"**/bitbucket-pipelines.yml\",\n        \"**/.pipeline/**\",\n        \"**/.github/**\",\n        \"**/SECURITY*\"\n      ]\n    },\n    \"auth\": {\n      \"least_privilege_scopes_required\": true,\n      \"separate_identities_for_read_vs_write\": true\n    },\n    \"attestation\": {\n      \"require_gateway_receipts\": true,\n      \"emit_proof_bundle\": true\n    }\n  }\n}\n</pre>\n\n<h2>What proof do you get?</h2>\n<p>For any model calls routed through clawproxy, you receive gateway receipts that can be independently checked. These receipts let you answer operational questions like “which model responded”, “what inputs were sent”, and “what output the agent received”, tied to the job context.</p>\n<p>Claw EA can package those receipts with job metadata into a proof bundle. In practice, you attach the proof bundle identifier to the PR or change ticket so audit can verify that the agent stayed within the WPC and that the run is not a replay of an older authorization.</p>\n<p>If you need a central place for review, you can store the bundle as a Trust Pulse artifact for audit/viewing. This does not replace code review, but it makes agent activity verifiable in the same way you expect build logs and change records to be verifiable.</p>\n\n<h2>Rollback posture</h2>\n<p>Bitbucket-integrated agents should have explicit rollback actions that are safe, fast, and do not depend on the agent behaving well after a failure. You want to be able to freeze changes, revoke authority, and reconstruct what happened from receipts and proof bundles.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Agent made an incorrect code change in a branch</td>\n      <td>Close the PR, delete the agent branch, and revert via normal SCM practices. Keep “merge” denied for the agent unless explicitly approved.</td>\n      <td>PR history plus proof bundle for the run; gateway receipts for the model calls that proposed the diff.</td>\n    </tr>\n    <tr>\n      <td>Agent attempted a write action outside policy</td>\n      <td>Fail closed at the WPC gate and treat it as an incident signal. Do not widen scope mid-run; create a new job with a new CST if an exception is approved.</td>\n      <td>WPC hash and CST scope hash for the job; proof bundle showing blocked attempts and the run context.</td>\n    </tr>\n    <tr>\n      <td>Credential suspected compromised</td>\n      <td>Revoke the CST and rotate the Bitbucket credential used via official API. Re-run only after reviewing the WPC and reducing scope.</td>\n      <td>CST issuance and revocation records; proof bundle showing the last permitted actions and when they occurred.</td>\n    </tr>\n    <tr>\n      <td>Untrusted plugin or misconfigured tool policy</td>\n      <td>Disable the extension, tighten OpenClaw tool allowlists, and rerun OpenClaw security audit checks. Restore service only after a minimal policy set passes review.</td>\n      <td>OpenClaw configuration diff plus the proof bundle for affected jobs; gateway receipts where applicable.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>FAQ</h2>\n<h3>Why is prompt-only control not enough for Bitbucket agents?</h3>\n<p>Prompts do not enforce permission boundaries when the agent is under pressure from injected instructions or ambiguous tasks. A WPC is enforced at execution time, and a CST constrains what the job can actually invoke even if the model “decides” otherwise.</p>\n\n<h3>Is this a native Bitbucket connector in Claw EA today?</h3>\n<p>No. Bitbucket can be connected via official API with enterprise buildout controls, and you should treat it as an integration project with explicit scope and review.</p>\n\n<h3>What actions should be allowed first?</h3>\n<p>Start with read-only operations that support review: listing PRs, reading diffs, and summarizing changes. Add write actions later, and keep merge and permission changes behind explicit approval gates in the WPC.</p>\n\n<h3>How do gateway receipts help in an incident?</h3>\n<p>They give you a verifiable record of model calls routed through clawproxy, tied to the job context. Combined into a proof bundle, they support “what happened” reconstruction without relying on the agent’s self-report.</p>\n\n<h3>How does this relate to OpenClaw sandboxing?</h3>\n<p>OpenClaw sandboxing reduces blast radius for tool execution, while tool policy controls what tools are callable. Claw EA’s WPC and CST add permissioned, job-scoped constraints so Bitbucket access is governed as an execution contract, not an instruction.</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (audit + footguns)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n  <li><a href=\"https://docs.aws.amazon.com/codeguru/latest/security-ug/get-started-bitbucket.html\">Integrate with Bitbucket (Amazon CodeGuru Security)</a></li>\n  <li><a href=\"https://docs.aws.amazon.com/pdfs/prescriptive-guidance/latest/agentic-ai-multitenant/agentic-ai-multitenant.pdf\">AWS Prescriptive Guidance: Building multi-tenant architectures for agentic AI on AWS</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "Bitbucket is a high-impact surface for enterprise agents because a single token can grant read access to proprietary code, and write access can change what gets built, tested, and deployed. If you want an agent to touch ",
  "faqs": [
    {
      "q": "Why is prompt-only control not enough for Bitbucket agents?",
      "a": "Prompts do not enforce permission boundaries when the agent is under pressure from injected instructions or ambiguous tasks. A WPC is enforced at execution time, and a CST constrains what the job can actually invoke even if the model “decides” otherwise."
    },
    {
      "q": "Is this a native Bitbucket connector in Claw EA today?",
      "a": "No. Bitbucket can be connected via official API with enterprise buildout controls, and you should treat it as an integration project with explicit scope and review."
    },
    {
      "q": "What actions should be allowed first?",
      "a": "Start with read-only operations that support review: listing PRs, reading diffs, and summarizing changes. Add write actions later, and keep merge and permission changes behind explicit approval gates in the WPC."
    },
    {
      "q": "How do gateway receipts help in an incident?",
      "a": "They give you a verifiable record of model calls routed through clawproxy, tied to the job context. Combined into a proof bundle, they support “what happened” reconstruction without relying on the agent’s self-report."
    },
    {
      "q": "How does this relate to OpenClaw sandboxing?",
      "a": "OpenClaw sandboxing reduces blast radius for tool execution, while tool policy controls what tools are callable. Claw EA’s WPC and CST add permissioned, job-scoped constraints so Bitbucket access is governed as an execution contract, not an instruction."
    }
  ],
  "sources": [
    {
      "title": "Integrating agentic AI into your enterprise's software development lifecycle - GitHub Docs",
      "uri": "https://docs.github.com/en/copilot/tutorials/roll-out-at-scale/enable-developers/integrate-ai-agents"
    },
    {
      "title": "Managing access to GitHub Copilot coding agent - GitHub Docs",
      "uri": "https://docs.github.com/en/copilot/concepts/agents/coding-agent/access-management"
    },
    {
      "title": "AWS Prescriptive Guidance - Building multi-tenant architectures for agentic AI on AWS",
      "uri": "https://docs.aws.amazon.com/pdfs/prescriptive-guidance/latest/agentic-ai-multitenant/agentic-ai-multitenant.pdf"
    },
    {
      "title": "Integrate with Bitbucket - Amazon CodeGuru Security",
      "uri": "https://docs.aws.amazon.com/codeguru/latest/security-ug/get-started-bitbucket.html"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T16:44:42.333Z",
  "indexable": true
}