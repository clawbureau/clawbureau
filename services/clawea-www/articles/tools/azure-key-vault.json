{
  "slug": "tools/azure-key-vault",
  "title": "Azure Key Vault for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "<h2>Direct Answer</h2>\n<p>Azure Key Vault is the right place to store production secrets, keys, and certificates, but it is a high-impact target for enterprise agents. If an agent can read or mutate vault contents from a prompt, a single prompt-injection or misconfigured plugin can turn into credential theft, key rotation, or outage.</p>\n<p>Claw EA runs OpenClaw as the baseline agent runtime and treats Key Vault access as permissioned execution: actions must be authorized by policy-as-code, not by prompt text. In practice that means a WPC (Work Policy Contract) for what is allowed, a CST (scoped token) for how the job is authorized, and proof artifacts (gateway receipts and proof bundles) for audit.</p>\n\n<h2>Step-by-step runbook</h2>\n<p>This integration is not a native connector today. Azure Key Vault can be connected via official API with enterprise buildout controls, using Entra ID authentication and least-privilege Azure RBAC.</p>\n<ol>\n  <li>\n    <p>Define the Key Vault boundary you will permit: vault name(s), secret name prefixes, and whether the agent can only read current versions or also list and manage versions. Decide up front if write, delete, purge, and key operations are disallowed by default.</p>\n  </li>\n  <li>\n    <p>Create a WPC that encodes the allowed Key Vault operations as an explicit allowlist, including any required human approval gates for write and admin actions. Publish the WPC to the WPC registry and treat the policy hash as a release artifact.</p>\n  </li>\n  <li>\n    <p>Issue a CST (from clawscope) bound to the job scope hash, and optionally pin the policy hash so the run cannot silently switch policies. Use short TTLs and separate CSTs for read-only versus write-capable paths.</p>\n  </li>\n  <li>\n    <p>Implement Key Vault tool calls via the official API with enterprise buildout, using Entra ID (application or workload identity) and Azure RBAC roles scoped to the minimum vault scope. If you need interactive access, use Conditional Access and PIM for operators, not for the agent runtime identity.</p>\n  </li>\n  <li>\n    <p>Run the agent in OpenClaw with tool policy tightened: only the Key Vault tool and required supporting utilities are available, and tool execution is sandboxed where possible. Avoid elevated execution except for explicit break-glass runs, because elevated tool execution bypasses the sandbox boundary.</p>\n  </li>\n  <li>\n    <p>Route model traffic through clawproxy so model calls produce gateway receipts. At job completion, package the run output plus receipts into a proof bundle and store it for audit, or publish the audit view as a Trust Pulse when needed.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>Key Vault is a concentration point: one secret can unlock databases, queues, CI systems, and customer data. Treat every agent run as “assume breach”, and design for the case where the agent or a plugin behaves incorrectly.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Prompt injection causes unintended secret retrieval</td>\n      <td>The agent is tricked into calling “get secret” for sensitive names, then exfiltrates values into chat logs, tickets, or model context.</td>\n      <td>WPC allowlist by vault and secret prefix; deny list operations like list-all; OpenClaw tool policy restricts available tools; keep redaction on in logging settings.</td>\n    </tr>\n    <tr>\n      <td>Malicious or compromised plugin expands access</td>\n      <td>A plugin adds a new tool path (or hidden parameters) that can read broader secrets or call admin APIs.</td>\n      <td>WPC must explicitly enumerate methods and resource patterns; CST scope hash pinning plus optional policy hash pinning; OpenClaw extension allowlist and regular security audit.</td>\n    </tr>\n    <tr>\n      <td>Write or delete operations cause outage</td>\n      <td>The agent rotates a credential, overwrites a secret, disables a key, or deletes a certificate, breaking production dependencies.</td>\n      <td>WPC approval gates for write/admin actions; split identities and CSTs for read vs write; require change ticket metadata in the job scope; default deny for delete/purge.</td>\n    </tr>\n    <tr>\n      <td>Over-broad Azure RBAC assignment</td>\n      <td>The runtime identity gets Key Vault Administrator or broad subscription scope, making policy mistakes catastrophic.</td>\n      <td>Azure RBAC roles scoped to a single vault and needed data-plane permissions only; separate admin identity controlled via PIM; periodic access review.</td>\n    </tr>\n    <tr>\n      <td>Secrets leak into model calls</td>\n      <td>Even if the tool call is legitimate, the secret value can appear in prompts, tool outputs, or downstream LLM traffic.</td>\n      <td>Minimize returned fields; redact tool outputs; do not echo secrets back to the model; prefer “use secret to call service” over “retrieve secret and print”.</td>\n    </tr>\n    <tr>\n      <td>Replay of prior privileged job</td>\n      <td>An attacker reuses an old token or job parameters to repeat a previously approved Key Vault action.</td>\n      <td>Marketplace anti-replay binding using job-scoped CST binding; enforce short CST TTL; require fresh WPC verification each run.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This is a sketch of the kind of policy you want in a WPC: explicit operations, explicit resources, and explicit gates. Prompt instructions are not an authorization layer because they can be overridden by untrusted input.</p>\n<pre>\n{\n  \"policy_version\": \"wpc.v1\",\n  \"name\": \"keyvault-permissioned-agent\",\n  \"resources\": {\n    \"azure_key_vault\": {\n      \"vaults\": [\"kv-prod-finance-001\"],\n      \"secrets\": {\n        \"allow_prefixes\": [\"agent/app/\", \"agent/readonly/\"],\n        \"deny_prefixes\": [\"prod/\", \"breakglass/\"]\n      }\n    }\n  },\n  \"operations\": {\n    \"secrets.get\": { \"allowed\": true },\n    \"secrets.list\": { \"allowed\": false },\n    \"secrets.set\": {\n      \"allowed\": true,\n      \"approval\": { \"required\": true, \"reason\": \"Write requires explicit approval\" }\n    },\n    \"secrets.delete\": { \"allowed\": false },\n    \"keys.*\": { \"allowed\": false },\n    \"certificates.*\": { \"allowed\": false }\n  },\n  \"auth\": {\n    \"cst\": {\n      \"require_scope_hash\": true,\n      \"pin_policy_hash\": true\n    }\n  },\n  \"logging\": {\n    \"redact_tool_outputs\": true\n  }\n}\n</pre>\n\n<h2>What proof do you get?</h2>\n<p>For model traffic, clawproxy emits gateway receipts for model calls. Those receipts let you verify what model was called, when, and under which job scope, without trusting an application log line that can be edited.</p>\n<p>At the end of a run, Claw EA can package receipts and run metadata into a proof bundle. If you need an auditor-friendly view, you can store and view the run artifact as a Trust Pulse, with replay checks tied to the job-scoped CST binding.</p>\n\n<h2>Rollback posture</h2>\n<p>Key Vault mistakes are usually reversible, but the operational path depends on whether the agent wrote a new value, removed an old one, or changed access. Plan rollback as part of the WPC, not as an incident improvisation.</p>\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence to collect</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Secret value overwritten</td>\n      <td>Restore prior secret version if available; rotate dependent services in a controlled window; invalidate any leaked value.</td>\n      <td>Proof bundle for the job; change ticket reference in job scope; Key Vault version identifiers recorded by the tool output (redacted values).</td>\n    </tr>\n    <tr>\n      <td>Secret deleted (soft delete enabled)</td>\n      <td>Recover the secret and re-enable access; verify dependent apps reconnect with expected identity.</td>\n      <td>WPC that permitted or denied delete; CST issuance record for the job; run logs showing the attempted operation.</td>\n    </tr>\n    <tr>\n      <td>Key or certificate modified</td>\n      <td>Revert to previous version where possible; reissue certs through your normal PKI workflow; treat as security incident if private material might be exposed.</td>\n      <td>Approval gate record (if required by WPC); proof bundle; inventory of affected workloads and timelines.</td>\n    </tr>\n    <tr>\n      <td>Azure RBAC role assignment changed</td>\n      <td>Remove role assignment; re-run access review; rotate any credentials that could have been accessed during the exposure window.</td>\n      <td>WPC and CST used; operator audit trail (outside Claw EA); proof bundle tying the run to the job scope.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>FAQ</h2>\n<h3>Is Azure Key Vault support available as a native Claw EA connector today?</h3>\n<p>No. It can be connected via official API with enterprise buildout controls, and you should treat the buildout as security-sensitive because it is effectively a privileged tool.</p>\n\n<h3>Why is prompt-only control not enough for Key Vault access?</h3>\n<p>Prompts are instructions, not enforcement. A malicious email, document, or chat message can redirect the agent, so you need policy-as-code enforced by a WPC and job-bounded authorization via CST.</p>\n\n<h3>How do Entra ID and Azure RBAC fit with WPC and CST?</h3>\n<p>Entra ID and Azure RBAC are the cloud authorization layer for the Key Vault identity. WPC and CST are the agent execution authorization layer that constrains when and how that identity is used during a specific job.</p>\n\n<h3>Can the agent use Azure MCP Server for Key Vault?</h3>\n<p>It can be implemented, but this page assumes connection via official APIs and enterprise buildout controls. If you do use an MCP server, still apply the same WPC allowlists and CST job binding, and treat the MCP tool surface as part of the audit scope.</p>\n\n<h3>What do I show an auditor after an incident?</h3>\n<p>Provide the WPC (by hash), the CST scope hash details for the job, and the proof bundle containing gateway receipts and run metadata. This lets an auditor verify what the model calls were and which policy governed the run.</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://learn.microsoft.com/en-us/azure/key-vault/general/secure-key-vault\">Secure your Azure Key Vault (Microsoft Learn)</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide\">Provide access to Key Vault keys, certificates, and secrets with Azure role-based access control (Microsoft Learn)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (OpenClaw docs)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandboxing.md\">OpenClaw Sandboxing (OpenClaw docs)</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "Azure Key Vault is the right place to store production secrets, keys, and certificates, but it is a high-impact target for enterprise agents. If an agent can read or mutate vault contents from a prompt, a single prompt-i",
  "faqs": [
    {
      "q": "Is Azure Key Vault support available as a native Claw EA connector today?",
      "a": "No. It can be connected via official API with enterprise buildout controls, and you should treat the buildout as security-sensitive because it is effectively a privileged tool."
    },
    {
      "q": "Why is prompt-only control not enough for Key Vault access?",
      "a": "Prompts are instructions, not enforcement. A malicious email, document, or chat message can redirect the agent, so you need policy-as-code enforced by a WPC and job-bounded authorization via CST."
    },
    {
      "q": "How do Entra ID and Azure RBAC fit with WPC and CST?",
      "a": "Entra ID and Azure RBAC are the cloud authorization layer for the Key Vault identity. WPC and CST are the agent execution authorization layer that constrains when and how that identity is used during a specific job."
    },
    {
      "q": "Can the agent use Azure MCP Server for Key Vault?",
      "a": "It can be implemented, but this page assumes connection via official APIs and enterprise buildout controls. If you do use an MCP server, still apply the same WPC allowlists and CST job binding, and treat the MCP tool surface as part of the audit scope."
    },
    {
      "q": "What do I show an auditor after an incident?",
      "a": "Provide the WPC (by hash), the CST scope hash details for the job, and the proof bundle containing gateway receipts and run metadata. This lets an auditor verify what the model calls were and which policy governed the run."
    }
  ],
  "sources": [
    {
      "title": "Manage Azure Key Vault with Azure MCP Server - Microsoft Learn",
      "uri": "https://learn.microsoft.com/en-us/azure/developer/azure-mcp-server/services/azure-mcp-server-for-key-vault"
    },
    {
      "title": "Grant permission to applications to access an Azure key vault using ...",
      "uri": "https://learn.microsoft.com/en-us/azure/key-vault/general/rbac-guide"
    },
    {
      "title": "Scaling Agentic Applications - Microsoft Learn",
      "uri": "https://learn.microsoft.com/en-us/microsoft-for-startups/build/scaling-agents"
    },
    {
      "title": "Building your Agent on Azure | Microsoft Learn",
      "uri": "https://learn.microsoft.com/en-us/microsoft-for-startups/build/build-agent"
    },
    {
      "title": "Develop Azure AI services applications with Azure Key Vault - Azure AI services",
      "uri": "https://learn.microsoft.com/en-us/azure/ai-services/use-key-vault"
    },
    {
      "title": "Develop Azure AI services applications with Azure Key Vault - Azure AI services",
      "uri": "https://learn.microsoft.com/en-us/azure/ai-services/use-key-vault?tabs=azure-cli"
    },
    {
      "title": "Secure your Azure Key Vault",
      "uri": "https://learn.microsoft.com/en-us/azure/key-vault/general/secure-key-vault"
    },
    {
      "title": "Best practices for using Azure Key Vault",
      "uri": "https://learn.microsoft.com/en-us/azure/key-vault/general/best-practices"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T16:43:54.947Z",
  "indexable": true
}