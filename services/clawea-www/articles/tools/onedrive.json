{
  "slug": "tools/onedrive",
  "title": "OneDrive for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "\n<p>OneDrive is one of the highest-value targets an enterprise agent can touch: it holds documents, spreadsheets, internal decks, and shared libraries across your entire tenant. Connecting an OpenClaw agent to OneDrive via the Microsoft Graph API is straightforward, but without policy-as-code enforcement, a single misconfigured permission scope can let an agent read, overwrite, or exfiltrate files across every user's drive.</p>\n\n<p>Claw EA treats OneDrive as a permissioned integration, connectable via official API with enterprise buildout controls. Write and admin actions require WPC approval gates, scoped tokens (CST), and explicit least-privilege Microsoft Graph auth scopes. Prompt-level instructions alone cannot enforce these boundaries because the model can be jailbroken or the skill definition can be swapped at runtime.</p>\n\n<h2>Step-by-step runbook</h2>\n\n<ol>\n<li><strong>Register an Entra ID app with minimal Graph scopes.</strong> Start with <code>Files.Read</code> for the specific site or drive. Do not grant <code>Files.ReadWrite.All</code> unless the WPC explicitly requires write access. Use application permissions only if the agent must operate without a signed-in user; prefer delegated permissions where possible.</li>\n\n<li><strong>Author a Work Policy Contract (WPC).</strong> Define the allowed Graph scopes, target drive IDs or site paths, permitted file types, and whether write operations are authorized. The WPC is signed and hash-addressed in the clawcontrols registry.</li>\n\n<li><strong>Issue a scoped token (CST) pinned to the WPC hash.</strong> clawscope issues the CST with the policy hash pinned, so the agent's token is only valid for operations the contract permits. This binds the job to a specific policy version.</li>\n\n<li><strong>Route model calls through clawproxy.</strong> Every LLM inference the agent makes during the OneDrive task produces a gateway receipt. These receipts record the model, prompt hash, and timestamp for later verification.</li>\n\n<li><strong>Implement the OneDrive tool as an OpenClaw plugin.</strong> The plugin calls Microsoft Graph endpoints, passing the Entra ID OAuth token for data access and the CST for Claw Bureau policy checks. Sandbox the plugin using OpenClaw's Docker sandboxing (<code>sandbox.mode: \"all\"</code>) to contain filesystem and network access.</li>\n\n<li><strong>Collect the proof bundle after the run.</strong> The bundle includes gateway receipts, the WPC hash, CST metadata, and job-scoped anti-replay binding. Store the resulting Trust Pulse artifact for audit viewing.</li>\n</ol>\n\n<h2>Threat model</h2>\n\n<table>\n<thead>\n<tr><th>Threat</th><th>What happens</th><th>Control</th></tr>\n</thead>\n<tbody>\n<tr><td>Over-scoped Graph permissions (<code>Files.ReadWrite.All</code>)</td><td>Agent writes or deletes files across the entire tenant</td><td>WPC restricts allowed Graph scopes; CST is pinned to that WPC hash</td></tr>\n<tr><td>Prompt injection via a malicious document</td><td>Agent reads a OneDrive file containing injected instructions, then exfiltrates other files</td><td>OpenClaw sandbox isolates network egress; egress allowlists (planned) can further restrict outbound targets</td></tr>\n<tr><td>Skill swap at runtime</td><td>A modified skill definition changes the agent's target drive or enables write mode</td><td>WPC is hash-addressed and immutable; CST will not validate against a different policy hash</td></tr>\n<tr><td>Token replay across jobs</td><td>A leaked CST is reused for a different OneDrive task</td><td>Marketplace anti-replay binding ties each CST to a specific job scope</td></tr>\n<tr><td>Silent data exfiltration via model context</td><td>Sensitive file contents are sent to the LLM provider in the prompt</td><td>Gateway receipts log every model call; proof bundle enables post-hoc audit of what was sent and when</td></tr>\n</tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n\n<pre><code>{\n  \"wpc_version\": \"1.0\",\n  \"tool\": \"onedrive\",\n  \"connection\": \"microsoft_graph_api\",\n  \"allowed_scopes\": [\n    \"Files.Read\",\n    \"Sites.Read.All\"\n  ],\n  \"denied_scopes\": [\n    \"Files.ReadWrite.All\",\n    \"Sites.ReadWrite.All\",\n    \"Sites.FullControl.All\"\n  ],\n  \"allowed_drive_ids\": [\"b!xYz123...\"],\n  \"write_enabled\": false,\n  \"max_file_size_bytes\": 10485760,\n  \"require_sandbox\": true,\n  \"cst_policy_hash_pin\": true\n}</code></pre>\n\n<p>This WPC fragment restricts the agent to read-only access on a single drive, blocks all write scopes, caps file size at 10 MB, and requires sandbox execution. The CST issued for this job will carry the hash of this exact policy.</p>\n\n<h2>What proof do you get?</h2>\n\n<p>Model-assisted runs produce gateway receipts for every LLM call made during the OneDrive task. These receipts are signed by clawproxy and include the model identifier, a prompt content hash, and a timestamp.</p>\n\n<p>At job completion, receipts are bundled into a proof bundle alongside the WPC hash, CST metadata, and anti-replay job binding. The proof bundle can be submitted to clawverify for tier-based trust assessment. The resulting Trust Pulse artifact is stored in the marketplace for audit viewing by compliance teams or the delegating principal.</p>\n\n<h2>Rollback posture</h2>\n\n<table>\n<thead>\n<tr><th>Action</th><th>Safe rollback</th><th>Evidence</th></tr>\n</thead>\n<tbody>\n<tr><td>Agent reads files only (WPC write_enabled: false)</td><td>No rollback needed; no state was changed in OneDrive</td><td>Gateway receipts confirm model calls; proof bundle confirms read-only policy was active</td></tr>\n<tr><td>Agent writes or uploads files (WPC write_enabled: true)</td><td>OneDrive version history allows file restore; WPC should require versioning on target libraries</td><td>Proof bundle records which files were touched; Graph API audit logs provide file-level change history</td></tr>\n<tr><td>Agent deletes files</td><td>OneDrive recycle bin retains items for 93 days by default; restore from recycle bin</td><td>Proof bundle plus Entra ID sign-in logs identify the app and time window</td></tr>\n<tr><td>Suspected token compromise</td><td>Revoke the CST via clawscope; revoke the Entra ID app's OAuth refresh token via Conditional Access</td><td>CST revocation event is logged; Entra ID audit log records token revocation</td></tr>\n</tbody>\n</table>\n\n<h2>FAQ</h2>\n\n<h3>Is OneDrive integration available as a native connector today?</h3>\n<p>No. OneDrive can be connected via the official Microsoft Graph API with enterprise buildout controls. It is not shipped as an out-of-the-box native connector. The integration requires registering an Entra ID application and building the OpenClaw tool plugin for your environment.</p>\n\n<h3>Why can't prompt instructions replace policy-as-code for OneDrive access?</h3>\n<p>Prompt instructions are advisory. A model can be manipulated through prompt injection, or a skill definition can be altered between runs. A WPC is a signed, hash-addressed artifact that the infrastructure enforces independently of the model's behavior. The CST will not validate against a different policy, so the execution layer rejects unauthorized operations regardless of what the prompt says.</p>\n\n<h3>Which Microsoft Graph scopes should I start with?</h3>\n<p>For read-only document retrieval, <code>Files.Read</code> (delegated) or <code>Files.Read.All</code> (application) is sufficient. If the agent must write, use <code>Files.ReadWrite</code> scoped to a specific drive or site. Avoid tenant-wide write scopes unless the WPC explicitly justifies them and your Conditional Access policies restrict the app's access further.</p>\n\n<h3>How do gateway receipts help if the agent exfiltrates data through the LLM prompt?</h3>\n<p>Gateway receipts log a content hash of every prompt sent to the model provider. During a post-incident review, you can match receipt timestamps and hashes against the proof bundle to determine exactly which file contents were included in model calls and when. This does not prevent exfiltration, but it provides a verifiable audit trail.</p>\n\n<h3>Can I enforce cost budgets on OneDrive agent runs?</h3>\n<p>Automatic cost budget enforcement is planned but not yet shipped. Today, you can set model call limits in the WPC and monitor spend through gateway receipt counts in the proof bundle. For hard budget cutoffs, this would need to be implemented as part of the enterprise buildout.</p>\n\n<h2>Sources</h2>\n<ul>\n<li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security</a></li>\n<li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandboxing.md\">OpenClaw Sandboxing</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/security/security-for-ai/agent-365-security\">Secure AI agents at scale using Microsoft Agent 365</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/governance-security-across-organization\">Governance and security for AI agents across the organization</a></li>\n<li><a href=\"https://learn.microsoft.com/en-us/sharepoint/advanced-management\">SharePoint Advanced Management overview</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "OneDrive is one of the highest-value targets an enterprise agent can touch: it holds documents, spreadsheets, internal decks, and shared libraries across your entire tenant. Connecting an OpenClaw agent to OneDrive via t",
  "faqs": [
    {
      "q": "Is OneDrive integration available as a native connector today?",
      "a": "No. OneDrive can be connected via the official Microsoft Graph API with enterprise buildout controls. It is not shipped as an out-of-the-box native connector. The integration requires registering an Entra ID application and building the OpenClaw tool plugin for your environment."
    },
    {
      "q": "Why can't prompt instructions replace policy-as-code for OneDrive access?",
      "a": "Prompt instructions are advisory. A model can be manipulated through prompt injection, or a skill definition can be altered between runs. A WPC is a signed, hash-addressed artifact that the infrastructure enforces independently of the model's behavior. The CST will not validate against a different policy, so the execution layer rejects unauthorized operations regardless of what the prompt says."
    },
    {
      "q": "Which Microsoft Graph scopes should I start with?",
      "a": "For read-only document retrieval, Files.Read (delegated) or Files.Read.All (application) is sufficient. If the agent must write, use Files.ReadWrite scoped to a specific drive or site. Avoid tenant-wide write scopes unless the WPC explicitly justifies them and your Conditional Access policies restrict the app's access further."
    },
    {
      "q": "How do gateway receipts help if the agent exfiltrates data through the LLM prompt?",
      "a": "Gateway receipts log a content hash of every prompt sent to the model provider. During a post-incident review, you can match receipt timestamps and hashes against the proof bundle to determine exactly which file contents were included in model calls and when. This does not prevent exfiltration, but it provides a verifiable audit trail."
    },
    {
      "q": "Can I enforce cost budgets on OneDrive agent runs?",
      "a": "Automatic cost budget enforcement is planned but not yet shipped. Today, you can set model call limits in the WPC and monitor spend through gateway receipt counts in the proof bundle. For hard budget cutoffs, this would need to be implemented as part of the enterprise buildout."
    }
  ],
  "sources": [
    {
      "title": "Secure AI agents at scale using Microsoft Agent 365",
      "uri": "https://learn.microsoft.com/en-us/security/security-for-ai/agent-365-security"
    },
    {
      "title": "Standard Applications instructions for Microsoft OneDrive ...",
      "uri": "https://learn.microsoft.com/en-us/microsoft-365/education/guide/3-standard/applications/standard-apps-odsp-exo-teams"
    },
    {
      "title": "Considerations to manage Microsoft 365 Copilot and ...",
      "uri": "https://learn.microsoft.com/en-us/purview/ai-m365-copilot-considerations"
    },
    {
      "title": "Understanding permissions for agents in the Microsoft 365 admin center - Microsoft 365 admin",
      "uri": "https://learn.microsoft.com/en-us/microsoft-365/admin/manage/manage-agents-permissions?view=o365-worldwide"
    },
    {
      "title": "Manage access to SharePoint agents",
      "uri": "https://learn.microsoft.com/en-us/sharepoint/manage-access-agents-in-sharepoint"
    },
    {
      "title": "SharePoint Advanced Management overview",
      "uri": "https://learn.microsoft.com/en-us/sharepoint/advanced-management"
    },
    {
      "title": "Governance and security for AI agents across the organization",
      "uri": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/governance-security-across-organization"
    },
    {
      "title": "Data architecture for AI agents across your organization",
      "uri": "https://learn.microsoft.com/en-us/azure/cloud-adoption-framework/ai-agents/data-architecture-plan"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T16:28:56.472Z",
  "indexable": true
}