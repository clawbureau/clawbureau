{
  "slug": "tools/entra-id",
  "title": "Microsoft Entra ID (Azure AD) for Permissioned Agents | Claw EA",
  "category": "tools",
  "html": "<h2>Direct Answer</h2>\n<p>Microsoft Entra ID is the identity and authorization control plane you already use for Microsoft Graph and tenant resources, so it is a natural place to anchor enterprise agent identities and access reviews. For permissioned agents, the important part is not just authenticating to Entra ID, but forcing every high-impact Entra and Graph action to pass a policy-as-code gate and produce auditable proof.</p>\n<p>Claw EA runs OpenClaw as the baseline agent runtime and adds a permissioned execution layer using WPC = Work Policy Contract (signed, hash-addressed policy artifact; served by clawcontrols), CST = scoped token (issued by clawscope), gateway receipts (from clawproxy), and proof bundles. Entra ID can be connected via official API with enterprise buildout controls, but it is not presented here as a native connector.</p>\n\n<h2>Step-by-step runbook</h2>\n<ol>\n  <li>\n    <p>Define the agent’s Entra identity model first: workload identity (app registration or managed identity) or agent identity if you are adopting Microsoft Entra Agent ID (Preview). Write down the exact Microsoft Graph permissions and whether they are delegated or application permissions.</p>\n    <p>Keep the first iteration read-only where possible, since Graph write scopes are where agent mistakes turn into tenant-wide impact.</p>\n  </li>\n  <li>\n    <p>Create a WPC that enumerates allowed Graph operations at the level your auditors will recognize: tenant, resource types, and approved permission scopes. Make the WPC explicit about which actions are “write/admin” and require an approval gate before execution.</p>\n    <p>Because WPCs are signed and hash-addressed, you can pin a specific policy version to a run and later prove which rules were in force.</p>\n  </li>\n  <li>\n    <p>Issue a CST for the job with a scope hash that matches the WPC, and optionally pin the policy hash in the CST. Treat the CST as the single bearer capability that binds the job to its policy, rather than relying on prompt instructions like “do not change users.”</p>\n    <p>This is where permissioned execution differs from prompt-only: the runtime can refuse calls that do not match the policy, even if the model is coerced.</p>\n  </li>\n  <li>\n    <p>Route model calls through clawproxy so you get gateway receipts for every model call used during the run. This matters for Entra tasks because a significant part of the security story is reconstructing why an agent attempted a sensitive Graph action, not just that it did.</p>\n    <p>If you use OpenRouter via fal, keep it behind clawproxy so receipts stay consistent across providers.</p>\n  </li>\n  <li>\n    <p>Implement the Entra and Graph interaction via official API as an enterprise buildout tool for OpenClaw. Enforce “write and admin actions require WPC approval gates, CST, and explicit least-privilege auth scopes” as a hard rule in the tool boundary.</p>\n    <p>Do not let the model dynamically request broader Graph permissions mid-run without a new WPC and a new CST.</p>\n  </li>\n  <li>\n    <p>Enable Conditional Access and, where applicable, Privileged Identity Management (PIM) workflows for the identities the agent uses. Use Conditional Access to constrain when and how the agent identity can obtain tokens, but do not rely on Conditional Access alone to express “what the agent is allowed to do” inside Graph.</p>\n    <p>Think of Conditional Access as access context control, and WPC as action control.</p>\n  </li>\n  <li>\n    <p>At the end of each run, package evidence into a proof bundle that includes gateway receipts plus run metadata (policy hash, scope hash, job binding). Store the artifact as a Trust Pulse for audit and later replay checks.</p>\n    <p>This gives your security team an object they can review without needing to trust the agent’s self-reported logs.</p>\n  </li>\n</ol>\n\n<h2>Threat model</h2>\n<p>Entra ID and Microsoft Graph are high-leverage surfaces: a single over-scoped token can modify users, roles, app consents, Conditional Access, or group memberships. The failure modes below assume the agent runtime is capable, but potentially confused, tricked, or operating with a malicious skill/plugin.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Threat</th>\n      <th>What happens</th>\n      <th>Control</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Over-scoped Microsoft Graph permissions</td>\n      <td>An agent with application permissions like broad directory write can change users, groups, or app consents beyond the intended ticket. The incident looks like legitimate API traffic, because it is.</td>\n      <td>Require least-privilege auth scopes and force write/admin actions behind a WPC approval gate with a job-scoped CST. If the WPC does not authorize the action, the tool must refuse even if the prompt asks.</td>\n    </tr>\n    <tr>\n      <td>Prompt injection triggers admin-like actions</td>\n      <td>A message or document causes the model to “helpfully” add an exception in Conditional Access, grant consent, or create a new credential. Prompt-only safeguards can be bypassed by phrasing.</td>\n      <td>Permissioned execution: WPC expresses the allowed operations and a CST pins that policy. OpenClaw tool policy and sandboxing reduce local blast radius, but Entra actions still require policy gates.</td>\n    </tr>\n    <tr>\n      <td>Malicious plugin or misconfigured tool endpoint</td>\n      <td>A plugin exfiltrates tokens, requests new permissions, or calls Graph endpoints that are not part of the intended workflow. Misconfiguration can also point the tool at the wrong tenant or environment.</td>\n      <td>Use OpenClaw’s tool allow/deny model and sandboxing to constrain execution, then bind the job to a CST scope hash and a WPC policy hash. Keep Graph scopes fixed and reviewed, and separate prod vs non-prod identities.</td>\n    </tr>\n    <tr>\n      <td>Replay of prior approvals or runs</td>\n      <td>A previously approved action is replayed in a new context, or a token is reused to repeat sensitive operations. This is common when agents run on schedules or in shared runtimes.</td>\n      <td>Use marketplace anti-replay binding (job-scoped CST binding) so the authorization is tied to a specific job. Store a proof bundle and verify that the receipts and bindings match the intended run.</td>\n    </tr>\n    <tr>\n      <td>Hard-to-audit “why did it do that?”</td>\n      <td>After an incident, you have Graph audit logs but cannot reconstruct which model outputs led to which calls. Without evidence at the model boundary, you are left with partial timelines.</td>\n      <td>Route model traffic through clawproxy to emit gateway receipts for model calls. Package receipts into a proof bundle so auditors can correlate “model said X” with “tool attempted Y” under a specific WPC and CST.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>Policy-as-code example</h2>\n<p>This example shows the shape of a WPC for an Entra automation job. It separates read operations from write/admin operations, and it pins the run to a specific policy hash via CST so the agent cannot “talk its way” into broader permissions.</p>\n\n<pre>\n{\n  \"wpc_version\": \"v1\",\n  \"policy_name\": \"entra-helpdesk-agent-prod\",\n  \"tenant\": \"contoso.onmicrosoft.com\",\n  \"tools\": {\n    \"microsoft_graph_via_official_api\": {\n      \"allowed_permissions\": [\n        \"User.Read.All\",\n        \"Group.Read.All\"\n      ],\n      \"write_admin_requires_approval\": true,\n      \"allowed_write_operations\": [\n        { \"op\": \"user.resetPassword\", \"constraints\": { \"ticket_required\": true } },\n        { \"op\": \"group.addMember\", \"constraints\": { \"group_allowlist\": [\"Helpdesk-Scoped-Groups\"] } }\n      ]\n    }\n  },\n  \"cst_requirements\": {\n    \"scope_hash_required\": true,\n    \"policy_hash_pinning\": \"optional\"\n  },\n  \"receipts\": {\n    \"require_gateway_receipts\": true,\n    \"bundle_on_completion\": true\n  }\n}\n</pre>\n\n<p>In practice, the “microsoft_graph_via_official_api” tool is an enterprise buildout that refuses calls outside the contract. If the model tries to add a new permission scope or call a different operation, it fails closed and the run records that refusal.</p>\n\n<h2>What proof do you get?</h2>\n<p>For model activity, clawproxy emits gateway receipts for model calls. These receipts are the external, verifiable record of what the model was asked and what it returned at the boundary where actions are decided.</p>\n<p>For the overall job, Claw EA produces a proof bundle that packages gateway receipts with run metadata such as the WPC policy hash, the CST scope hash, and the job binding used for anti-replay. You can store and review the resulting artifact as a Trust Pulse, which is designed for audit viewing and later verification workflows.</p>\n\n<h2>Rollback posture</h2>\n<p>Rollback is about returning the tenant to a safe state quickly and proving which controls were active. You should prepare rollback actions that work even if the agent runtime is paused, compromised, or simply unavailable.</p>\n\n<table>\n  <thead>\n    <tr>\n      <th>Action</th>\n      <th>Safe rollback</th>\n      <th>Evidence</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <td>Stop new sensitive actions</td>\n      <td>Revoke or expire the CST for the job, and require a new CST issuance for any further execution. This cuts off the permissioned execution path without changing tenant configuration.</td>\n      <td>CST issuance and revocation records, plus the last proof bundle showing the job binding that was active.</td>\n    </tr>\n    <tr>\n      <td>Freeze policy at a known-good version</td>\n      <td>Pin the WPC policy hash for subsequent jobs and refuse runs that do not match that hash. This prevents silent policy drift during incident response.</td>\n      <td>WPC hash reference in the job metadata and proof bundle, showing which policy contract governed each run.</td>\n    </tr>\n    <tr>\n      <td>Contain identity blast radius</td>\n      <td>Disable the Entra identity or remove admin consents for high-risk Microsoft Graph permissions, then re-issue least-privilege credentials. Use PIM and Conditional Access adjustments as needed, but treat them as tenant-side containment.</td>\n      <td>Tenant audit logs from Entra plus the agent-side proof bundle that shows what the model attempted and when.</td>\n    </tr>\n    <tr>\n      <td>Contain runtime blast radius</td>\n      <td>Tighten OpenClaw tool policy (deny the Graph tool or restrict profiles) and ensure sandboxing is enabled for the agent sessions that can execute tools. This reduces the chance of lateral movement from an Entra task into local file or shell actions.</td>\n      <td>OpenClaw configuration review and security audit output, plus proof bundles from runs after the change.</td>\n    </tr>\n  </tbody>\n</table>\n\n<h2>FAQ</h2>\n\n<h3>Is this a native Entra ID connector in Claw EA?</h3>\n<p>No. Entra ID can be connected via official API with enterprise buildout controls, and you should assume an integration project that implements the tool boundary and policy enforcement you need.</p>\n\n<h3>Why is prompt-only control not enough for Entra and Microsoft Graph?</h3>\n<p>Because prompts are not enforcement. A model can be tricked or can misunderstand, and Graph will still accept the request if the token is over-scoped.</p>\n<p>Permissioned execution uses WPC rules and CST bindings so the tool refuses disallowed actions even if the model requests them.</p>\n\n<h3>How does Conditional Access fit with WPC and CST?</h3>\n<p>Conditional Access is strong for constraining authentication context, such as where tokens can be acquired and under what conditions. WPC and CST control the action surface inside the agent runtime, so “what can be done” is enforced at execution time.</p>\n\n<h3>Can you support Microsoft Entra Agent ID concepts?</h3>\n<p>Yes, with care. Microsoft Entra Agent ID is described by Microsoft as Preview, so you should plan for change and treat it as an identity model option during enterprise buildout via official API.</p>\n\n<h3>What do auditors actually review after a run?</h3>\n<p>They review the WPC that governed the job, the CST scope hash and any policy hash pinning, and the proof bundle containing gateway receipts for model calls. This combination is designed to answer “who ran what, under which policy, with what model inputs and outputs at the boundary.”</p>\n\n<h2>Sources</h2>\n<ul>\n  <li><a href=\"https://learn.microsoft.com/en-us/entra/agent-id/identity-professional/security-for-ai\">Security for AI agents with Microsoft Entra Agent ID</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/entra/identity/conditional-access/agent-id?tabs=custom-security-attributes\">Conditional Access for Agent ID (Preview)</a></li>\n  <li><a href=\"https://learn.microsoft.com/en-us/entra/agent-id/identity-platform/agent-identities\">Agent identities in Microsoft Entra Agent ID</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/security/index.md\">OpenClaw Gateway Security (audit + footguns)</a></li>\n  <li><a href=\"https://github.com/openclaw/openclaw/blob/5d4f42016f3afdbd5218843648d3ea594541dedc/docs/gateway/sandbox-vs-tool-policy-vs-elevated.md\">OpenClaw: Sandbox vs Tool Policy vs Elevated</a></li>\n</ul>\n\n<div class=\"cta-banner\" data-cta=\"bofu-endcap\">\n  <h2>Ready to put this workflow into production?</h2>\n  <p>Get a scoped deployment plan with Work Policy Contracts, approval gates, and cryptographic proof bundles for your team.</p>\n  <a href=\"/contact\" class=\"cta-btn cta-btn-lg\" data-cta=\"bofu-talk-to-sales\">Talk to Sales</a>\n  <a href=\"/trust\" class=\"cta-btn cta-btn-outline cta-btn-lg\" style=\"margin-left:.75rem\" data-cta=\"bofu-trust-layer\">Review Trust Layer</a>\n</div>\n",
  "description": "Microsoft Entra ID is the identity and authorization control plane you already use for Microsoft Graph and tenant resources, so it is a natural place to anchor enterprise agent identities and access reviews. For permissi",
  "faqs": [
    {
      "q": "Is this a native Entra ID connector in Claw EA?",
      "a": "No. Entra ID can be connected via official API with enterprise buildout controls, and you should assume an integration project that implements the tool boundary and policy enforcement you need."
    },
    {
      "q": "Why is prompt-only control not enough for Entra and Microsoft Graph?",
      "a": "Because prompts are not enforcement. A model can be tricked or can misunderstand, and Graph will still accept the request if the token is over-scoped."
    },
    {
      "q": "How does Conditional Access fit with WPC and CST?",
      "a": "Conditional Access is strong for constraining authentication context, such as where tokens can be acquired and under what conditions. WPC and CST control the action surface inside the agent runtime, so “what can be done” is enforced at execution time."
    },
    {
      "q": "Can you support Microsoft Entra Agent ID concepts?",
      "a": "Yes, with care. Microsoft Entra Agent ID is described by Microsoft as Preview, so you should plan for change and treat it as an identity model option during enterprise buildout via official API."
    },
    {
      "q": "What do auditors actually review after a run?",
      "a": "They review the WPC that governed the job, the CST scope hash and any policy hash pinning, and the proof bundle containing gateway receipts for model calls. This combination is designed to answer “who ran what, under which policy, with what model inputs and outputs at the boundary.”"
    }
  ],
  "sources": [
    {
      "title": "Security for AI agents with Microsoft Entra Agent ID",
      "uri": "https://learn.microsoft.com/en-us/entra/agent-id/identity-professional/security-for-ai"
    },
    {
      "title": "What are agent identities? - Microsoft Entra Agent ID",
      "uri": "https://learn.microsoft.com/en-us/entra/agent-id/identity-platform/what-is-agent-id"
    },
    {
      "title": "Conditional Access for Agent Identities in Microsoft Entra - Microsoft Entra ID",
      "uri": "https://learn.microsoft.com/en-us/entra/identity/conditional-access/agent-id?tabs=custom-security-attributes"
    },
    {
      "title": "Agent identity and blueprint concepts in Microsoft Entra ID",
      "uri": "https://learn.microsoft.com/en-us/entra/agent-id/identity-platform/key-concepts"
    },
    {
      "title": "Microsoft Entra releases and announcements",
      "uri": "https://learn.microsoft.com/en-us/entra/fundamentals/whats-new"
    },
    {
      "title": "Overview of agent identities in Microsoft Entra",
      "uri": "https://learn.microsoft.com/en-us/entra/agent-id/identity-platform/agent-identities"
    }
  ],
  "model": "candidate-01",
  "generatedAt": "2026-02-11T12:17:22.537Z",
  "indexable": true
}