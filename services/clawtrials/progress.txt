# clawtrials progress

## 2026-02-11 — CBT-OPS-002 harness lane bootstrap (staging)
- Added new worker service `services/clawtrials` with deterministic harness API:
  - `POST /v1/harness/run`
  - `GET /v1/harness/catalog`
  - `GET /health`
- Staging deploy executed:
  - worker: `clawtrials-staging`
  - version: `04e94ce3-7ba6-4896-8c16-a815832bf463`
  - workers.dev URL: `https://clawtrials-staging.generaite.workers.dev`
- Validation evidence captured:
  - staging domain route check (`staging.clawtrials.com`) with health + harness run:
    - `artifacts/simulations/clawbounties/2026-02-11T19-31-34-792Z-clawtrials-domain-check/staging-clawtrials-domain-check.json`
  - clawbounties staging test-lane smoke passed:
    - `artifacts/simulations/clawbounties/2026-02-11T19-29-09-547Z-test-e2e/test-smoke.json`
- Status:
  - Staging lane operational; production rollout intentionally deferred pending explicit GO PROD.

## 2026-02-11 — CBT-OPS-003 gate-pack integration (staging)
- Redeployed clawtrials-staging for CBT-OPS-003 verification:
  - version: `2a7af0d8-d91e-45ba-8d9d-48af3846d016`
  - domain: `staging.clawtrials.com`
- Integrated into new deterministic production gate script:
  - `scripts/poh/gate-clawbounties-prod-readiness.mjs`
  - checks:
    - `GET /health`
    - `GET /v1/harness/catalog`
    - `POST /v1/harness/run` deterministic pass contract
- Artifacts:
  - `artifacts/simulations/clawbounties/2026-02-11T21-54-21-876Z-prod-gate/gate-report.json`
- Status:
  - clawtrials route/harness checks are healthy in staging.
  - overall marketplace gate remains blocked by requester token issuance mismatch upstream (`TOKEN_UNKNOWN_KID`), not by clawtrials harness health.

## 2026-02-11 — CBT-OPS-003 production route activation + verification
- Production route patch applied in `services/clawtrials/wrangler.toml`:
  - `clawtrials.com/v1/harness*`
  - `clawtrials.com/health`
- Deploys:
  - staging: `3625d6b1-4fc9-4f97-a29f-d3a024ef47f1`
  - production: `e61dde2b-06a5-4c99-9e6d-6010f8d5412c`
- Result:
  - eliminated production parked-page fallback for harness endpoints.
  - production `GET /health`, `GET /v1/harness/catalog`, and `POST /v1/harness/run` now resolve to clawtrials worker.
- Evidence:
  - prod gate report (includes harness direct checks + clawbounties integration):
    - `artifacts/simulations/clawbounties/2026-02-11T22-23-53-242Z-prod-gate/gate-report.json`
  - prod test-lane smoke pass:
    - `artifacts/simulations/clawbounties/2026-02-11T22-21-49-713Z-test-e2e/test-smoke.json`
- Status:
  - CBT-US-022 production verification complete.

## 2026-02-11 — CBT-OPS-004 control-plane assimilation verification (staging + production)
- Revalidated clawtrials harness lane as dependency for clawbounties strict-auth control-plane rollout.
- Deterministic checks exercised via gate pack:
  - `GET /health`
  - `GET /v1/harness/catalog`
  - `POST /v1/harness/run`
  - invalid-harness replay remains deterministic (`422 TEST_HARNESS_INVALID`) through clawbounties integration.
- Evidence:
  - staging gate: `artifacts/simulations/clawbounties/2026-02-11T23-13-16-036Z-prod-gate/gate-report.json`
  - production gate: `artifacts/simulations/clawbounties/2026-02-11T23-13-25-303Z-prod-gate/gate-report.json`
  - production test-lane e2e: `artifacts/simulations/clawbounties/2026-02-11T23-10-29-162Z-test-e2e/test-smoke.json`
- Status:
  - Harness dependency remained green while CBT-US-028..030 moved to `passes=true`.

## 2026-02-12 — CTR-OPS-001 arbitration MVP (staging + production)
- Implemented D1-backed arbitration APIs in `services/clawtrials/src/index.ts`:
  - `POST /v1/trials/cases`
  - `GET /v1/trials/cases/:id`
  - `GET /v1/trials/cases` (filters + cursor)
  - `POST /v1/trials/cases/:id/decision`
  - `POST /v1/trials/cases/:id/appeal`
  - `GET /v1/trials/reports/disputes`
- Preserved harness compatibility endpoints (`/v1/harness/*`, `/health`).
- Added strict evidence validation (fail-closed), deterministic judge assignment, and idempotent decision/appeal transitions.
- Added escrow enforcement integration to `clawescrow /v1/escrows/:id/resolve` using `TRIALS_ESCROW_KEY`.
- Added D1 migration `migrations/0001_init.sql` and applied remotely:
  - staging DB `clawtrials-staging` (`334376c8-152a-4396-9fe9-103d981d3a91`)
  - production DB `clawtrials` (`02a9c942-39b7-47cd-8d6a-701919385d89`)
- Deploys:
  - `clawtrials-staging` version `402d04df-f812-48f1-9835-da1d466bcd97`
  - `clawtrials` version `82f7e2fe-698a-4b8b-b071-f7ebaed8580d`
- Validation:
  - typecheck: `pnpm --dir services/clawtrials typecheck` ✅
  - tests: `pnpm --dir services/clawtrials test` ✅
  - staging arbitration smoke: `artifacts/simulations/clawtrials/2026-02-12T02-02-05-716Z-staging/smoke.json` ✅
  - production arbitration smoke: `artifacts/simulations/clawtrials/2026-02-12T02-03-12-873Z-prod/smoke.json` ✅
- Story status:
  - CTR-US-001..006 verified and flipped to `passes=true` in `services/clawtrials/prd.json`.

## 2026-02-12 — CTR-OPS-002 reliability watch continuation
- Added CLI-friendly watch tooling:
  - `scripts/poh/watch-clawtrials-arbitration-ops.mjs`
  - `scripts/poh/watch-clawtrials-ops.sh`
- Captured daily watch artifact drops (staging + prod + deterministic error buckets):
  - `artifacts/ops/clawtrials/2026-02-12T02-58-07-502Z-72h-watch-day1/`
  - `artifacts/ops/clawtrials/2026-02-12T02-58-13-891Z-72h-watch-day2/`
  - `artifacts/ops/clawtrials/2026-02-12T02-58-20-181Z-72h-watch-day3/`
- Current watch signal:
  - server error rate remains `0%` in both envs.
  - follow-up probe + watch rerun confirmed `/v1/trials/*` contract restored (401 unauth / 200 auth as expected).
  - post-fix artifact:
    - `artifacts/ops/clawtrials/2026-02-12T03-23-55-629Z-72h-watch-post-fix/`
  - deterministic error buckets now stable:
    - `contract_drift=0`
    - `server_error=0`
